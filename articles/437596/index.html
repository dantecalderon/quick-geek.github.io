<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OTRS: LDAP Authentication, Authorization, and Synchronization (FreeIPA, AD)</title>
  <meta name="description" content="OTRS is an open-source open-source Ticket Request System, written in Perl. 

 There are two options: 



- OTRS Business Solution - paid version 
- ((...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>OTRS: LDAP Authentication, Authorization, and Synchronization (FreeIPA, AD)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/it/eo/2d/iteo2de4gfi-h7dhk7hi1djav1a.png" alt="image"><br><br>  <a href="https://otrs.com/">OTRS</a> is an open-source open-source Ticket Request System, written in Perl. <br><br>  There are two options: <br><br><ul><li>  OTRS Business Solution - paid version </li><li>  <a href="https://community.otrs.com/">((OTRS)) Community Edition</a> - free version </li></ul><br>  I will list a little of the fact that this system supports: <br><br><ul><li>  ITSM module (Service Level Management, Change Management, Configuration Management, CMDB) </li><li>  responsive web interface </li><li>  API </li><li>  SLA and services </li><li>  multi-tenancy </li><li>  escalation </li><li>  Authentication: DB, LDAP, HTTPBasicAuth, Radius </li><li>  support for MySQL, MariaDB, PostgreSQL, Oracle </li></ul><br>  And if you look for flaws in it - this is the unusual interface and the complexity of setting up.  Under the cut - about the basics of authorization (group, RBAC, support for several client companies), authentication and synchronization of metadata (name, phone, etc.) using various LDAP directories <br><a name="habracut"></a><br><h2>  Clients, queues, agents and groups </h2><br>  After installing OTRS, you will be immediately available: <br><br><ul><li>  <b>clients</b> - can create applications by sending a letter or using web access </li><li>  <b>queues</b> - each application is in one of the queues of applications </li><li>  <b>agents</b> - IT professionals working on the execution of applications from the queues available to them </li><li>  <b>Groups</b> - an entity that connects queues, clients and agents, as well as specifies the rights of agents ‚Äî for example, only reading, changing the priority of an application, etc. </li></ul><br><img src="https://habrastorage.org/webt/5w/tc/yr/5wtcyrvgrlrl7uhahh_udj_1l9y.png" alt="image"><br><br><h2>  Standard groups </h2><br>  After installing the system, you will see three groups created: <br><br><ul><li>  <b>admin</b> - group members can administer (configure) OTRS </li><li>  <b>stats</b> - the ability to customize and run reports </li><li>  <b>users</b> - standard group for clients, queues and agents </li></ul><br><h2>  Rights associated with groups </h2><br><h3>  Basic rights </h3><br>  The basic rights that can be configured in the group, limiting the actions of agents: <br><br><ul><li>  <b>read only</b> - <b>read only</b> permissions in this group / queue </li><li>  <b>move</b> - the rights to move applications to this group / queue </li><li>  <b>Creation</b> - rights to create applications in this group / queue </li><li>  <b>note</b> - rights to add notes to requests in this group / queue </li><li>  <b>owner</b> - rights to change the owner of applications in this group / queue </li><li>  <b>priority</b> - the right to change the priority of applications in this group / queue </li><li>  <b>read / write</b> - full read and write permissions for requests in this group / queue </li></ul><br><h3>  Additional rights </h3><br>  There are also additional rights, the display of which can be enabled in the settings (System :: Permission): <br><br><ul><li>  <b>reports</b> - provides access to the reports page </li><li>  <b>redirect</b> - the right to redirect / bounce the mail message (link redirect / bounce to ticketZoom) </li><li>  <b>create</b> - the right to make a response to the application </li><li>  <b>customer</b> - the right to change the customer for this application </li><li>  <b>forward</b> - the right to forward messages (using the Forward button) </li><li>  <b>pending</b> - the right to transfer the request pending </li><li>  <b>phone</b> - the right to add the customer‚Äôs call content to the application as a message / note </li><li>  <b>responsible</b> - The right to change the person responsible for the application </li></ul><br>  Consider this in more detail: <br><br><ul><li>  each client can be included in one or several groups, initially all clients belong to the users group </li><li>  each order queue is associated with any one of the groups </li><li>  through the web interface, the client can make applications in those queues to which groups have access, in which it is included </li><li>  When the client sends an application via e-mail, it is possible to change the characteristics of the application, including the queue to which the application falls, by analyzing the attributes of the letter (for example, the sender's address or the message header). </li><li>  if the client made a phone call, the agent can make a request manually by selecting any of the queues available to the agent </li><li>  It is desirable that the client request is always in the queues available to the client, otherwise he will not be able to access it through the web interface </li><li>  agents can perform actions on requests in accordance with the rights to the queue in which the application is located </li></ul><br><img src="https://habrastorage.org/webt/eh/xz/8g/ehxz8gmrdrbni4babbqwj_cfxmk.png" alt="image"><br><br><h2>  Database Authentication </h2><br>  The standard way to authenticate and authorize agents and clients is the database. <br><br>  For example, setting agent authentication using a database looks like this: <br><br><pre><code class="perl hljs">$Self-&gt;{<span class="hljs-string"><span class="hljs-string">'AuthModule'</span></span>} = <span class="hljs-string"><span class="hljs-string">'Kernel::System::Auth::DB'</span></span>;</code> </pre> <br>  Customers: <br><br><pre> <code class="perl hljs">$Self-&gt;{<span class="hljs-string"><span class="hljs-string">'Customer::AuthModule'</span></span>} = <span class="hljs-string"><span class="hljs-string">'Kernel::System::CustomerAuth::DB'</span></span>; $Self-&gt;{<span class="hljs-string"><span class="hljs-string">'Customer::AuthModule::DB::Table'</span></span>} = <span class="hljs-string"><span class="hljs-string">'customer_user'</span></span>; $Self-&gt;{<span class="hljs-string"><span class="hljs-string">'Customer::AuthModule::DB::CustomerKey'</span></span>} = <span class="hljs-string"><span class="hljs-string">'login'</span></span>; $Self-&gt;{<span class="hljs-string"><span class="hljs-string">'Customer::AuthModule::DB::CustomerPassword'</span></span>} = <span class="hljs-string"><span class="hljs-string">'pw'</span></span>;</code> </pre> <br>  We will also leave this authentication method and add LDAP authentication with it. <br><br><h2>  Roles and Companies </h2><br>  We will also expand authorization capabilities by adding roles and companies: <br><br><ul><li>  <b>Roles</b> - allow you to more flexibly manage access, linking groups and agents together </li><li>  <b>companies</b> - allow you to isolate applications of different customers (whether they are different departments or companies) </li></ul><br><img src="https://habrastorage.org/webt/dm/59/ti/dm59titblhtfolxudg69gyp3bs0.png" alt="image"><br><br><h2>  Formulation of the problem </h2><br>  You are the OTRS system administrator at my-it-company.com, which provides services to other companies (or divisions within your holding). <br><br>  You really wouldn‚Äôt want to manually create accounts for new agents and clients, as well as fill out additional information, such as email address, phone number, position, address and account number - this is all already in LDAP directories. <br><br>  And your company will also get obvious advantages - a single employee password to all systems, blocking an LDAP account will block access to all other services. <br><br>  <i>my-it-company.com</i> runs on Linux and uses Red Hat FreeIPA as the directory server, and the departments you serve are various Microsoft Active Directory forests with which you do not have federation, but you can connect to domain controllers. <br><br>  You need to separate the flow of requests from different clients, as well as implement different levels of agent access to the queues - managers should be able to change the priority of tasks in the system. <br><br>  Employees of your company can also set tasks in the system for internal needs of <i>my-it-company.com</i> , sometimes being both agents and clients at the same time (and sometimes not). <br><br><img src="https://habrastorage.org/webt/rb/je/y4/rbjey4jhao-a1f-h1eqfsqvrbwg.png" alt="image"><br><br><h2>  Training </h2><br><h3>  Accounts to view LDAP </h3><br>  If anonymous browsing of the directory tree is prohibited, then we will create accounts in the domains <i>my-it-company.com</i> , <i>pear.com</i> and <i>macrohard.com</i> whose rights are enough for us to make requests to LDAP (let's call them, for example, ldap-bot) <br><br><h3>  FreeIPA groups for synchronization with OTRS roles </h3><br>  Let's get three groups of users on FreeIPA that will be synchronized with our OTRS roles, for example: <br><br><ul><li>  <b>otrs-sa</b> - members of this group will have access to the administration of OTRS, but we will not give access to the queues so that there is no desire to always work under the administrator), </li><li>  <b>otrs-admins</b> - our managers who have the right to change the priority of applications) and </li><li>  <b>otrs-helpdesk</b> - accounts of our specialists </li></ul><br><h3>  Attribute that defines belonging to a company </h3><br>  Select the attribute by which we will determine the affiliation to the company.  Let it be the attribute "Organization".  For example, you did everything organizationally and technically, and all users in all domains always have a value in the "Organization" field: <br><br><ul><li>  <b>my-it-company</b> - for my-it-company.com employees </li><li>  <b>pear-company</b> - for employees pear.com </li><li>  <b>macrohard-company</b> - for employees at macrohard.com </li></ul><br><h3>  Define user attributes used by FreeIPA </h3><br>  We study the FreeIPA scheme, finding out the names of the attributes that we need to synchronize (name, login, phone, etc.). <br><br><pre> <code class="bash hljs">kinit laptevs ipa user-show --all --raw laptevs</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">We get a similar conclusion:</b> <div class="spoiler_text">  dn: uid = laptevs, cn = users, cn = accounts, dc = my-it-company, dc = com <br>  uid: laptevs <br>  givenname: Stanislav <br>  sn: Laptev <br>  cn: Laptev Stanislav <br>  initials: SL <br>  homedirectory: / home / laptevs <br>  gecos: Laptev Stanislav <br>  loginshell: / bin / sh <br>  krbcanonicalname: laptevs@my-IT-COMPANY.COM <br>  krbprincipalname: laptevs@my-IT-comPANY.COM <br>  mail: laptevs@my-IT-COMPANY.COM <br>  uidnumber: 1344600003 <br>  gidnumber: 1344600003 <br>  l: Moscow <br>  telephonenumber: +7 (863) 999-99-99 <br>  mobile: +7 (999) 999-99-99 <br>  ou: My-it-company <br>  title: SysAdm <br>  sshpubkeyfp: SHA256: Yi8mKF + j28 / r2cpxLgIbvZ / Oymt57rhliHKhqBuJxqE laptevs-putty (ssh-rsa) <br>  nsaccountlock: FALSE <br>  has_password: TRUE <br>  has_keytab: TRUE <br>  displayName: Laptev Stanislav <br>  ipaSshPubKey: c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBQkpRQUFBZ0VBNjQ1RTJjSjIvWXVVYm9GNzdZY3hLNzBndm1jWlgrZjBZTVpsaXRQVXNCWFZ0cENtTEtwcjRwK2JEeUdhRzNLTWx1T08ydW9wS0pXRk9mWE83Zzl3OTYzdklQblN3MzVHSmI3VGhhbk1pTXpNUE82T1lQZEY0em14b2k4N 0RGYkdXV2V6aGwzcitsbmFGYTB0dEQ5TkFWRU1Fb3BMdmkzcHZ1UXpyVmNjVlMxamFxY1dNT2ZGUC9TRlVoY1dGeVpZd3Z6eW0wWnZObUZtdjVjVHJGNzJMSXZOdHlsNkZGK2ZaU3ZpS01mcXZ6NStkT2xZZGd5bVVSOG5iaVpkTXZKaTIvbzhjTy84ekpoMFhtSnVRSjJXNEVvYVEvajVTTm8ySjZ6NklXNk I3cFB4Y002a0tJcUp5N08zTkNOcGRrVmVQbEFHbThsOFZDREpVa1RLSjRGOS9mSTZFUkhxVUZwK3p1VENTR1R3ZWlKdXppenFSZWJTTkNiMXh3RldmUitvYzFLdWNZSU5QbTYxRi93YXhOcC9aSG9OK2w1dCtkYWI4cElZSGZzTnNUNWx2RWt4Ukh0bnNyeUxsbWk1ZVdzd3RBbDB3TUpWd1cvUWNJcjhOaVN Ybm96Q3dHWTZCaTQ2L0FGTGVidmFLV0tKRmpKZFgxOFlRVDRpVzZGaE83aW40TGlUamlNaENXbStvbjNQbERYeXZpdkJ1WkFXUldXNEdjbXREVW8rSVhZT2t3MWh3UldqdkJtcExHMVZpMFhPckltbmQybTVZdWk1bHo0b1ZlekFRN1NjYVlrdDBoVEdQU1Z2UHpmVlowYWJCQlpiRmViK1hUV2tpSnBPMHBO T3dodGNadHYrN3RMMnc1OFN3QnhVTUk4NzUzdG5Sc1h1blBXZERqcUsxSDA9IGxhcHRldnMtcHV0dHk = <br>  ipaUniqueID: 68d46dac-1d3c-11e9-82fd-0242ac110002 <br>  krbExtraData: AAL4VkVcbGFwdGV2c0BPTUlLUk9OLlBSTwA = <br>  krbLastFailedAuth: 20190123084142Z <br>  krbLastPwdChange: 20190121052200Z <br>  krbLoginFailedCount: 0 <br>  krbPasswordExpiration: 20190421052200Z <br>  memberof: cn = otrs-admins, cn = groups, cn = accounts, dc = my-it-company, dc = com <br>  memberof: cn = ipausers, cn = groups, cn = accounts, dc = my-it-company, dc = com <br>  mepManagedEntry: cn = laptevs, cn = groups, cn = accounts, dc = my-it-company, dc = com <br>  objectClass: top <br>  objectClass: person <br>  objectClass: organizationalperson <br>  objectClass: inetorgperson <br>  objectClass: inetuser <br>  objectClass: posixaccount <br>  objectClass: krbprincipalaux <br>  objectClass: krbticketpolicyaux <br>  objectClass: ipaobject <br>  objectClass: ipasshuser <br>  objectClass: ipaSshGroupOfPubKeys <br>  objectClass: mepOriginEntry </div></div><br>  <b>dn</b> : uid = laptevs, cn = users, cn = accounts, dc = my-it-company, dc = com <br>  <b>uid</b> : laptevs <br>  <b>givenname</b> : Stanislav <br>  <b>sn</b> : Laptev <br>  <b>cn</b> : Laptev Stanislav <br>  <b>mail</b> : laptevs@my-IT-COMPANY.COM <br>  <b>l</b> : Moscow <br>  <b>telephonenumber</b> : +7 (863) 999-99-99 <br>  <b>mobile</b> : +7 (999) 999-99-99 <br>  <b>ou</b> : My-it-company <br>  <b>title</b> : SysAdm <br><br><h2>  OTRS configuration setup </h2><br><h3>  Configuration files </h3><br><ul><li>  <b>/ opt / otrs /</b> - as a rule, OTRS files are located here </li><li>  <b>Kernel / Config.pm</b> - the configuration file you are editing </li><li>  <b>Kernel / Config / Defaults.pm</b> - a file with standard settings, you do not edit it, but in it you can view all existing parameters and comments </li></ul><br><h3>  Agent configuration </h3><br><h4>  Agent Authentication </h4><br><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # Agents authentication # # --------------------------------------------------- # # my-it-company.com LDAP backend $Self-&gt;{AuthModule} = 'Kernel::System::Auth::LDAP'; # –ê–¥—Ä–µ—Å LDAP-—Å–µ—Ä–≤–µ—Ä–∞ $Self-&gt;{'AuthModule::LDAP::Host'} = 'my-it-company.com'; $Self-&gt;{'AuthModule::LDAP::BaseDN'} = 'dc=my-it-company,dc=com'; $Self-&gt;{'AuthModule::LDAP::UID'} = 'uid'; # –ë–ª–æ–∫ –Ω—É–∂–µ–Ω, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤ $Self-&gt;{'AuthModule::LDAP::SearchUserDN'} = 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com'; $Self-&gt;{'AuthModule::LDAP::SearchUserPw'} = 'bot-password!'; # –§–∏–ª—å—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞ –∫ LDAP. –ü—É—Å—Ç—å —É –Ω–∞—Å –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∏–º–µ—é—â–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç "—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞" $Self-&gt;{'AuthModule::LDAP::AlwaysFilter'} = '(mail=*)'; # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π $Self-&gt;{'AuthModule::LDAP::Charset'} = 'utf-8'; $Self-&gt;{'AuthModule::UseSyncBackend'} = 'AuthSyncBackend'; # my-it-company.com DB backend $Self-&gt;{AuthModule2} = 'Kernel::System::Auth::DB'; $Self-&gt;{'AuthModule::DB::CryptType2'} = 'sha2'; # --------------------------------------------------- # # End Agents authentication # # --------------------------------------------------- #</span></span></code> </pre> <br><h4>  Agent synchronization (LDAP groups with OTRS roles) </h4><br><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # Agent authentication sync # # (enable agent data sync. after succsessful # # authentication) # # --------------------------------------------------- # # my-it-company.com LDAP auth sync. backend. $Self-&gt;{AuthSyncModule} = 'Kernel::System::Auth::Sync::LDAP'; $Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'my-it-company.com'; $Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'bot-password!'; $Self-&gt;{'AuthSyncModule::LDAP::AlwaysFilter'} = '(mail=*)'; $Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = { # DB -&gt; LDAP UserFirstname =&gt; 'givenName', UserLastname =&gt; 'sn', UserEmail =&gt; 'mail', }; $Self-&gt;{'AuthSyncModule::LDAP::AccessAttr'} = 'member'; $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'DN'; $Self-&gt;{'AuthSyncModule::LDAP::UserSyncRolesDefinition'} = { # ldap group 'cn=otrs-sa,cn=groups,cn=accounts,dc=my-it-company,dc=com' =&gt; { # otrs role 'otrs-sa' =&gt; 1, }, 'cn=otrs-admins,cn=groups,cn=accounts,dc=my-it-company,dc=com' =&gt; { 'otrs-admins' =&gt; 1, }, 'cn=otrs-helpdesk,cn=groups,cn=accounts,dc=my-it-company,dc=com' =&gt; { 'helpdesk' =&gt; 1, } }; $Self-&gt;{DatabaseUserTable} = 'users'; $Self-&gt;{DatabaseUserTableUserID} = 'id'; $Self-&gt;{DatabaseUserTableUserPW} = 'pw'; $Self-&gt;{DatabaseUserTableUser} = 'login'; # --------------------------------------------------- # # End Agents authentication sync # # --------------------------------------------------- #</span></span></code> </pre><br>  If you decide that the roles do not suit you, and you only want groups, I‚Äôll give two examples of synchronizing LDAP groups with OTRS groups - simplified and with rights settings for each group. <br><br><div class="spoiler">  <b class="spoiler_title">Alternative synchronization of agents (LDAP groups with OTRS groups, with rights indicated)</b> <div class="spoiler_text"><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # Agent authentication sync # # (enable agent data sync. after succsessful # # authentication) # # --------------------------------------------------- # # my-it-company.com LDAP auth sync. backend. $Self-&gt;{AuthSyncModule} = 'Kernel::System::Auth::Sync::LDAP'; $Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'my-it-company.com'; $Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'bot-password!'; $Self-&gt;{'AuthSyncModule::LDAP::AlwaysFilter'} = '(mail=*)'; $Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = { # DB -&gt; LDAP UserFirstname =&gt; 'givenName', UserLastname =&gt; 'sn', UserEmail =&gt; 'mail', }; $Self-&gt;{'AuthSyncModule::LDAP::AccessAttr'} = 'member'; $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'DN'; # AuthSyncModule::LDAP::UserSyncGroupsDefinition # (If "LDAP" was selected for AuthModule and you want to sync LDAP # groups to otrs groups, define the following.) $Self-&gt;{'AuthSyncModule::LDAP::UserSyncGroupsDefinition'} = { # ldap group 'cn=otrs-admins,cn=groups,cn=accounts,dc=my-it-company,dc=com' =&gt; { # otrs group 'admin' =&gt; { # permission rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, 'stats' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, 'users' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, 'pear-group' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, 'macrohard-group' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, }, 'cn=otrs-helpdesk,cn=groups,cn=accounts,dc=my-it-company,dc=com' =&gt; { 'stats' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, 'users' =&gt; { rw =&gt; 1, move_into =&gt; 1, create =&gt; 1, note =&gt; 1, owner =&gt; 1, prioriry =&gt; 1, ro =&gt; 1, }, } }; $Self-&gt;{DatabaseUserTable} = 'users'; $Self-&gt;{DatabaseUserTableUserID} = 'id'; $Self-&gt;{DatabaseUserTableUserPW} = 'pw'; $Self-&gt;{DatabaseUserTableUser} = 'login'; # --------------------------------------------------- # # End Agents authentication sync # # --------------------------------------------------- #</span></span></code> </pre> <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Alternative simplified agent synchronization (LDAP groups with OTRS roles with rw rights)</b> <div class="spoiler_text"><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # Agent authentication sync # # (enable agent data sync. after succsessful # # authentication) # # --------------------------------------------------- # # my-it-company.com LDAP auth sync. backend. $Self-&gt;{AuthSyncModule} = 'Kernel::System::Auth::Sync::LDAP'; $Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'my-it-company.com'; $Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com'; $Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'bot-password!'; $Self-&gt;{'AuthSyncModule::LDAP::AlwaysFilter'} = '(mail=*)'; $Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = { # DB -&gt; LDAP UserFirstname =&gt; 'givenName', UserLastname =&gt; 'sn', UserEmail =&gt; 'mail', }; $Self-&gt;{'AuthSyncModule::LDAP::AccessAttr'} = 'member'; $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'DN'; # –í–∫–ª—é—á–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –≤ –∫–∞–∫–∏–µ-–ª–∏–±–æ –≥—Ä—É–ø–ø—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å # AuthSyncModule::LDAP::UserSyncInitialGroups # (sync following group with rw permission after initial create of first agent # login) $Self-&gt;{'AuthSyncModule::LDAP::UserSyncInitialGroups'} = [ 'users', ]; $Self-&gt;{DatabaseUserTable} = 'users'; $Self-&gt;{DatabaseUserTableUserID} = 'id'; $Self-&gt;{DatabaseUserTableUserPW} = 'pw'; $Self-&gt;{DatabaseUserTableUser} = 'login'; # --------------------------------------------------- # # End Agents authentication sync # # --------------------------------------------------- #</span></span></code> </pre> <br><br></div></div><br><h3>  Customer setup </h3><br><h4>  Client Authentication </h4><br><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # –°ustomer authentication # # --------------------------------------------------- # # –°ustomer DB auth. backend $Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::DB'; $Self-&gt;{'Customer::AuthModule::DB::Table'} = 'customer_user'; $Self-&gt;{'Customer::AuthModule::DB::CustomerKey'} = 'login'; $Self-&gt;{'Customer::AuthModule::DB::CustomerPassword'} = 'pw'; # my-it-company.com (–°ustomer) LDAP auth. backend $Self-&gt;{'Customer::AuthModule2'} = 'Kernel::System::CustomerAuth::LDAP'; $Self-&gt;{'Customer::AuthModule::LDAP::Host2'} = 'my-it-company.com'; $Self-&gt;{'Customer::AuthModule::LDAP::BaseDN2'} = 'dc=my-it-company,dc=com'; $Self-&gt;{'Customer::AuthModule::LDAP::UID2'} = 'uid'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN2'} = 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw2'} = 'bot-password!'; $Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter2'} = '(mail=*)'; # pear LDAP auth. backend. $Self-&gt;{'Customer::AuthModule3'} = 'Kernel::System::CustomerAuth::LDAP'; $Self-&gt;{'Customer::AuthModule::LDAP::Host3'} = 'pear.com'; $Self-&gt;{'Customer::AuthModule::LDAP::BaseDN3'} = 'DC=pear,DC=com'; $Self-&gt;{'Customer::AuthModule::LDAP::UID3'} = 'sAMAccountName'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN3'} = 'ldap-bot@pear.com'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw3'} = 'bot-password?'; # –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º: (mail=*) - —É –∫–æ–≥–æ –µ—Å—Ç—å –ø–æ—á—Ç–∞ –∏ (samAccountType=805306368) - —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ (!(userAccountControl:1.2.840.113556.1.4.803:=2)) - –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞ $Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter3'} = '(&amp;(mail=*)(samAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))'; # macrohard LDAP auth. backend. $Self-&gt;{'Customer::AuthModule4'} = 'Kernel::System::CustomerAuth::LDAP'; $Self-&gt;{'Customer::AuthModule::LDAP::Host4'} = 'macrohard.com'; $Self-&gt;{'Customer::AuthModule::LDAP::BaseDN4'} = 'dc=macrohard,dc=com'; $Self-&gt;{'Customer::AuthModule::LDAP::UID4'} = 'sAMAccountName'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN4'} = 'ldap-bot@macrohard.com'; $Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw4'} = 'bot-password!?'; $Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter4'} = '(&amp;(mail=*)(samAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))'; # --------------------------------------------------- # # End customer authentication settings # # --------------------------------------------------- #</span></span></code> </pre> <br><h4>  Client synchronization (obtaining client attributes from LDAP, communication with OTRS companies) </h4><br><pre> <code class="perl hljs"> <span class="hljs-comment"><span class="hljs-comment"># --------------------------------------------------- # # Customer authentication sync # # --------------------------------------------------- # # Customer user DB backend and settings $Self-&gt;{CustomerUser} = { Name =&gt; Translatable('Database Backend'), Module =&gt; 'Kernel::System::CustomerUser::DB', Params =&gt; { Table =&gt; 'customer_user', SearchCaseSensitive =&gt; 0, }, # customer unique id CustomerKey =&gt; 'login', # customer # CustomerID =&gt; 'customer_id', CustomerValid =&gt; 'valid_id', CustomerUserListFields =&gt; [ 'first_name', 'last_name', 'email' ], CustomerUserSearchFields =&gt; [ 'login', 'first_name', 'last_name', 'customer_id' ], CustomerUserSearchPrefix =&gt; '*', CustomerUserSearchSuffix =&gt; '*', CustomerUserSearchListLimit =&gt; 250, CustomerUserPostMasterSearchFields =&gt; ['email'], CustomerUserNameFields =&gt; [ 'title', 'first_name', 'last_name' ], CustomerUserEmailUniqCheck =&gt; 1, CustomerCompanySupport =&gt; 1, CacheTTL =&gt; 60 * 60 * 24, Map =&gt; [ [ 'UserTitle', Translatable('Title or salutation'), 'title', 1, 0, 'var', '', 0, undef, undef ], [ 'UserFirstname', Translatable('Firstname'), 'first_name', 1, 1, 'var', '', 0, undef, undef ], [ 'UserLastname', Translatable('Lastname'), 'last_name', 1, 1, 'var', '', 0, undef, undef ], [ 'UserLogin', Translatable('Username'), 'login', 1, 1, 'var', '', 0, undef, undef ], [ 'UserPassword', Translatable('Password'), 'pw', 0, 0, 'var', '', 0, undef, undef ], [ 'UserEmail', Translatable('Email'), 'email', 1, 1, 'var', '', 0, undef, undef ], [ 'UserCustomerID', Translatable('CustomerID'), 'customer_id', 0, 1, 'var', '', 0, undef, undef ], [ 'UserPhone', Translatable('Phone'), 'phone', 1, 0, 'var', '', 0, undef, undef ], [ 'UserFax', Translatable('Fax'), 'fax', 1, 0, 'var', '', 0, undef, undef ], [ 'UserMobile', Translatable('Mobile'), 'mobile', 1, 0, 'var', '', 0, undef, undef ], [ 'UserStreet', Translatable('Street'), 'street', 1, 0, 'var', '', 0, undef, undef ], [ 'UserZip', Translatable('Zip'), 'zip', 1, 0, 'var', '', 0, undef, undef ], [ 'UserCity', Translatable('City'), 'city', 1, 0, 'var', '', 0, undef, undef ], [ 'UserCountry', Translatable('Country'), 'country', 1, 0, 'var', '', 0, undef, undef ], [ 'UserComment', Translatable('Comment'), 'comments', 1, 0, 'var', '', 0, undef, undef ], [ 'ValidID', Translatable('Valid'), 'valid_id', 0, 1, 'int', '', 0, undef, undef ], ], # default selections Selections =&gt; { # UserTitle =&gt; { # 'Mr.' =&gt; Translatable('Mr.'), # 'Mrs.' =&gt; Translatable('Mrs.'), # }, }, }; # my-it-company.com customer user ldap backend and settings $Self-&gt;{CustomerUser2} = { Name =&gt; 'AD my-it-company.com', Module =&gt; 'Kernel::System::CustomerUser::LDAP', Params =&gt; { # ldap host Host =&gt; 'my-it-company.com', # ldap base dn BaseDN =&gt; 'dc=my-it-company,dc=com', # search scope (one|sub) SSCOPE =&gt; 'sub', UserDN =&gt; 'uid=ldap-bot,cn=users,cn=accounts,dc=my-it-company,dc=com', UserPw =&gt; 'bot-password!', # in case you want to add always one filter to each ldap query, use # this option. eg AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)' AlwaysFilter =&gt; '(mail=*)', SourceCharset =&gt; 'utf-8', Die =&gt; 0, }, # customer unique id CustomerKey =&gt; 'uid', # customer # CustomerID =&gt; 'ou', CustomerUserListFields =&gt; ['uid', 'cn', 'mail'], CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'], CustomerUserSearchPrefix =&gt; '', CustomerUserSearchSuffix =&gt; '*', CustomerUserSearchListLimit =&gt; 250, CustomerUserPostMasterSearchFields =&gt; ['mail'], CustomerUserNameFields =&gt; ['sn', 'givenname'], # Configures the character for joining customer user name parts. Join single space if it is not defined. CustomerUserNameFieldsJoin =&gt; ' ', # show customer user and customer tickets in customer interface CustomerUserExcludePrimaryCustomerID =&gt; 0, # add a ldap filter for valid users (expert setting) # CustomerUserValidFilter =&gt; '(!(description=gesperrt))', # admin can't change customer preferences AdminSetPreferences =&gt; 1, # cache time to live in sec. - cache any ldap queries CacheTTL =&gt; 0, Map =&gt; [ [ 'UserTitle', Translatable('Title or salutation'), 'title', 1, 0, 'var', '', 1, undef, undef ], [ 'UserFirstname', Translatable('Firstname'), 'givenname', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLastname', Translatable('Lastname'), 'sn', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLogin', Translatable('Username'), 'uid', 1, 1, 'var', '', 1, undef, undef ], [ 'UserEmail', Translatable('Email'), 'mail', 1, 1, 'var', '', 1, undef, undef ], [ 'UserCustomerID', Translatable('CustomerID'), 'ou', 0, 1, 'var', '', 1, undef, undef ], [ 'UserPhone', Translatable('Phone'), 'telephonenumber', 1, 0, 'var', '', 1, undef, undef ], [ 'UserMobile', Translatable('Mobile'), 'mobile', 1, 0, 'var', '', 1, undef, undef ], ], }; # pear customer user ldap backend and settings $Self-&gt;{CustomerUser3} = { Name =&gt; 'AD pear', Module =&gt; 'Kernel::System::CustomerUser::LDAP', Params =&gt; { # ldap host Host =&gt; 'pear.com', BaseDN =&gt; 'DC=pear,DC=com', SSCOPE =&gt; 'sub', UserDN =&gt; 'ldap-bot@pear.com', UserPw =&gt; 'bot-password?', AlwaysFilter =&gt; '(&amp;(mail=*)(samAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))', SourceCharset =&gt; 'utf-8', Die =&gt; 0, }, # customer unique id CustomerKey =&gt; 'sAMAccountName', # customer # CustomerID =&gt; 'company', CustomerUserListFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchPrefix =&gt; '', CustomerUserSearchSuffix =&gt; '*', CustomerUserSearchListLimit =&gt; 250, CustomerUserPostMasterSearchFields =&gt; ['mail'], CustomerUserNameFields =&gt; ['sn', 'givenname'], # Configures the character for joining customer user name parts. Join single space if it is not defined. CustomerUserNameFieldsJoin =&gt; ' ', # show customer user and customer tickets in customer interface CustomerUserExcludePrimaryCustomerID =&gt; 0, AdminSetPreferences =&gt; 1, CacheTTL =&gt; 0, Map =&gt; [ # note: Login, Email and CustomerID needed! # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es) [ 'UserTitle', Translatable('Title or salutation'), 'title', 1, 0, 'var', '', 1, undef, undef ], [ 'UserFirstname', Translatable('Firstname'), 'givenname', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLastname', Translatable('Lastname'), 'sn', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLogin', Translatable('Username'), 'sAMAccountName', 1, 1, 'var', '', 1, undef, undef ], [ 'UserFullLogin', Translatable('FullUsername'), 'userPrincipalName', 1, 1, 'var', '', 1, undef, undef ], [ 'UserEmail', Translatable('Email'), 'mail', 1, 1, 'var', '', 1, undef, undef ], [ 'UserCustomerID', Translatable('CustomerID'), 'company', 0, 1, 'var', '', 1, undef, undef ], [ 'UserPhone', Translatable('Phone'), 'telephoneNumber', 1, 0, 'var', '', 1, undef, undef ], [ 'UserMobile', Translatable('Mobile'), 'mobile', 1, 0, 'var', '', 1, undef, undef ], [ 'UserAddress', Translatable('Address'), 'postaladdress', 1, 0, 'var', '', 1, undef, undef ], [ 'UserOffice', Translatable('Office'), 'physicalDeliveryOfficeName', 1, 0, 'var', '', 1, undef, undef ], [ 'UserDepartment', Translatable('Department'), 'department', 1, 0, 'var', '', 1, undef, undef ], [ 'UserComment', Translatable('Comment'), 'description', 1, 0, 'var', '', 1, undef, undef ], ], }; # macrohard customer user ldap backend and settings $Self-&gt;{CustomerUser4} = { Name =&gt; 'AD macrohard', Module =&gt; 'Kernel::System::CustomerUser::LDAP', Params =&gt; { # ldap host Host =&gt; 'macrohard.com', # ldap base dn BaseDN =&gt; 'dc=macrohard,dc=com', # search scope (one|sub) SSCOPE =&gt; 'sub', UserDN =&gt; 'ldap-bot@macrohard.com', UserPw =&gt; 'bot-password!?', AlwaysFilter =&gt; '(&amp;(mail=*)(samAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))', SourceCharset =&gt; 'utf-8', Die =&gt; 0, }, # customer unique id CustomerKey =&gt; 'sAMAccountName', # customer # CustomerID =&gt; 'company', CustomerUserListFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchFields =&gt; ['sAMAccountName', 'cn', 'mail'], CustomerUserSearchPrefix =&gt; '', CustomerUserSearchSuffix =&gt; '*', CustomerUserSearchListLimit =&gt; 250, CustomerUserPostMasterSearchFields =&gt; ['mail'], CustomerUserNameFields =&gt; ['sn', 'givenname'], # Configures the character for joining customer user name parts. Join single space if it is not defined. CustomerUserNameFieldsJoin =&gt; ' ', # show customer user and customer tickets in customer interface CustomerUserExcludePrimaryCustomerID =&gt; 0, AdminSetPreferences =&gt; 1, CacheTTL =&gt; 0, Map =&gt; [ [ 'UserTitle', Translatable('Title or salutation'), 'title', 1, 0, 'var', '', 1, undef, undef ], [ 'UserFirstname', Translatable('Firstname'), 'givenname', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLastname', Translatable('Lastname'), 'sn', 1, 1, 'var', '', 1, undef, undef ], [ 'UserLogin', Translatable('Username'), 'sAMAccountName', 1, 1, 'var', '', 1, undef, undef ], [ 'UserFullLogin', Translatable('FullUsername'), 'userPrincipalName', 1, 1, 'var', '', 1, undef, undef ], [ 'UserEmail', Translatable('Email'), 'mail', 1, 1, 'var', '', 1, undef, undef ], [ 'UserCustomerID', Translatable('CustomerID'), 'company', 0, 1, 'var', '', 1, undef, undef ], [ 'UserPhone', Translatable('Phone'), 'telephoneNumber', 1, 0, 'var', '', 1, undef, undef ], [ 'UserMobile', Translatable('Mobile'), 'mobile', 1, 0, 'var', '', 1, undef, undef ], [ 'UserAddress', Translatable('Address'), 'postaladdress', 1, 0, 'var', '', 1, undef, undef ], [ 'UserOffice', Translatable('Office'), 'physicalDeliveryOfficeName', 1, 0, 'var', '', 1, undef, undef ], [ 'UserDepartment', Translatable('Department'), 'department', 1, 0, 'var', '', 1, undef, undef ], [ 'UserComment', Translatable('Comment'), 'description', 1, 0, 'var', '', 1, undef, undef ], ], };</span></span></code> </pre> <br><h2>  Conclusion </h2><br>  As you have seen, setting up authentication and synchronization of accounts in OTRS is very simple, but still I hope that this article will help those who are just starting to get acquainted with this system. <br><br>  What is left behind this article? <br><br><ul><li>  In parallel with LDAP, you can also run SSO authentication, which will make life easier for customers </li><li>  If there are experts on Perl - you can write your own backend to connect to other information systems. </li><li>  The configuration is consciously simplified, for example, there are no filtering blocks by affiliation to LDAP groups, no domain suffixes, BASE DN, work with additional attributes, work with LDAP on other ports, and much more. </li></ul><br>  Tips and clarifications are welcome comments, information about typos - in drugs. <br><br>  Thanks for attention.  Special thanks to the authors whose materials on OTRS I used many years ago when meeting this system: <a href="https://habr.com/ru/users/turilion/" class="user_link">Turilion</a> , <a href="https://habr.com/ru/users/supersuperoleg/" class="user_link">supersuperoleg</a> , <a href="https://habr.com/ru/users/wmlex/" class="user_link">wmlex</a> </div><p>Source: <a href="https://habr.com/ru/post/437596/">https://habr.com/ru/post/437596/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>