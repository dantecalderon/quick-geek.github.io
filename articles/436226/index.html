<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wireshark Guide and Cheat Sheet</title>
  <meta name="description" content="Even a superficial knowledge of the Wireshark program and its filters will save time by an order of magnitude when troubleshooting network or applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Wireshark Guide and Cheat Sheet</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/475/f07/67c/475f0767c00bad46b12c13dff8cfde7f.png" align="left">  Even a superficial knowledge of the <a href="https://wireshark.org/">Wireshark</a> program and its filters will save time by an order of magnitude when troubleshooting network or application problems.  Wireshark is useful for many tasks in the work of a network engineer, security specialist or system administrator.  Here are some examples of use: <br><br><h4>  Troubleshooting Network Connectivity </h4><br><ul><li>  Visual display of packet loss </li><li>  TCP relay analysis </li><li>  Schedule for packets with a long delay response </li></ul><br><h4>  Study of application-level sessions (even when encrypted using SSL / TLS, see below) </h4><br><ul><li>  Full view of HTTP sessions, including all headers and data for requests and responses </li><li>  View Telnet sessions, view passwords, entered commands and responses </li><li>  View SMTP and POP3 traffic, read emails </li></ul><a name="habracut"></a><br><h4>  Troubleshooting DHCP with packet level data </h4><br><ul><li>  Learning Broadcast DHCP Broadcasts </li><li>  The second step is the exchange of DHCP (DHCP Offer) with the address and parameters </li><li>  Customer request at the proposed address </li><li>  Ack from the server confirming the request </li></ul><br><h4>  Extracting files from HTTP sessions </h4><br><ul><li>  Exporting objects from HTTP, such as javascript, images, or even executable files </li></ul><br><h4>  Extracting files from SMB sessions </h4><br><ul><li>  Same as HTTP export option, but extracting files transferred via SMB, file sharing protocol in Windows </li></ul><br><h4>  Malware Detection and Verification </h4><br><ul><li>  Detection of abnormal behavior that may indicate malware </li><li>  Search for unusual domains or destination IPs </li><li>  I / O plots for detecting persistent connections (beacons) with management servers </li><li>  Filtering "normal" data and identifying unusual </li><li>  Extract large DNS responses and other anomalies that may indicate malware </li></ul><br><h4>  Checking port scans and other types of scans for vulnerabilities </h4><br><ul><li>  Understanding what network traffic comes from scanners </li><li>  Analysis of vulnerability testing procedures to distinguish between false positive and false negative triggers </li></ul><br>  These examples are just the tip of the iceberg.  In the manual, we will explain how to use such a powerful tool. <br><br><h1>  Install Wireshark </h1><br>  Wireshark runs on various operating systems and is easy to install.  We mention only Ubuntu Linux, Centos and Windows. <br><br><h3>  Installing on Ubuntu or Debian </h3><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#apt-get update #apt-get install wireshark tshark</span></span></code> </pre> <br><h3>  Installation on Fedora or CentOS </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#yum install wireshark-gnome</span></span></code> </pre> <br><h3>  Installing on Windows </h3><br>  On <a href="https://www.wireshark.org/download.html">the download page</a> is the executable file for installation.  The packet capture driver is also quite easy to install, with which the network card goes into the ‚Äúillegible‚Äù mode (promiscuous mode allows you to receive all packets regardless of whom they are addressed to). <br><br><h1>  Getting started with filters </h1><br>  With the first interception, you will see in the Wireshark interface a standard template and package details. <br><br>  Once the HTTP session is captured, stop recording and play with the basic filters and settings <b>Analyze |</b>  <b>Follow |</b>  <b>HTTP Stream</b> . <br><br>  The names of the filters speak for themselves.  Just enter the appropriate expressions in the filter string (or in the command line if you use tshark).  The main advantage of filters is in noise removal (traffic that we are not interested in).  You can filter traffic by MAC address, IP address, subnet or protocol.  The simplest filter is to enter <code>http</code> , so only <b>HTTP traffic</b> will be displayed <b>(tcp port 80)</b> . <br><br><h3>  IP Filter Examples </h3><br><pre> <code class="bash hljs">ip.addr == 192.168.0.5 !(ip.addr == 192.168.0.0/24)</code> </pre> <br><h3>  Protocol Filter Examples </h3><br><pre> <code class="bash hljs">tcp udp tcp.port == 80 || udp.port == 80 http not arp and not (udp.port == 53)</code> </pre> <br>  Try to make a combination of filters that shows all outgoing traffic, except HTTP and HTTPS, which is sent outside the <b>local network</b> .  This is a good way to detect software (even malware) that interacts with the Internet through unusual protocols. <br><br><h1>  Follow the flow </h1><br>  Once you have captured several HTTP packets, you can use the <b>Analyze |</b> menu item on one of them.  <b>Follow |</b>  <b>HTTP Stream</b> .  It will show the entire HTTP session.  In this new window you will see an HTTP request from the browser and an HTTP response from the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b0/4c8/1e2/8b04c81e20ad0c060eb4eb6a02803219.png"><br><br><h1>  DNS resolver in Wireshark </h1><br>  By default, Wireshark does not resolve the network addresses in the console.  This can be changed in the settings. <br><br>  <b>Edit |</b>  <b>Preferences |</b>  <b>Name Resolution |</b>  <b>Enable Network Name Resolution</b> <br><br>  As in the case of <code>tcpdump</code> , the rezolving procedure will slow down the display of packets.  It is also important to understand that if you quickly capture packets, DNS requests from your host will become additional traffic that can be intercepted. <br><br><h1>  Command line tshark </h1><br>  If you haven't <code>tshark</code> with <code>tshark</code> , take a look at our <a href="https://hackertarget.com/tshark-tutorial-and-filter-examples/">tutorial with examples of filters</a> .  This program is often ignored, although it is great for capturing sessions on a remote system.  Unlike <code>tcpdump</code> , it allows you to capture and view application-level sessions on the fly: Wireshark protocol decoders are also available for tshark. <br><br><h1>  Making firewall rules </h1><br>  Here's a quick way to create rules from the command line, so as not to search the Internet for specific syntax.  Choose the appropriate rule - and go to <b>Tools |</b>  <b>Firewall ACL Rules</b> .  Various firewalls are supported, such as Cisco IOS, <code>ipfilter</code> , <code>ipfw</code> , <code>iptables</code> , <code>pf</code> and even Windows firewall via <code>netsh</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/682/9d2/f6c/6829d2f6cd2e7305a0411231d1002b36.png"><br><br><h1>  Work with GeoIP geographic base </h1><br>  If Wireshark is compiled with GeoIP support and you have free Maxmind databases, then the program can locate computers by their IP addresses.  Check in <b>About |</b>  <b>Wireshark</b> , that the program is compiled with the version that you have available.  If GeoIP is listed, then check the availability of GeoLite City, Country and ASNum databases.  Specify the location of the bases in the menu <b>Edit |</b>  <b>Preferences |</b>  <b>Name Resolution</b> . <br><br>  Check the system on a traffic dump by selecting the <b>Statistics |</b>  <b>Endpoints |</b>  <b>IPv4</b> .  Information about the location and the ASN for the IP address should appear in the columns on the right. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cf/fb3/c5f/1cffb3c5f8860c21c0bddd0c9df52684.png"><br><br>  Another feature of GeoIP is traffic filtering by location using the <code>ip.geoip</code> filter.  For example, you can exclude traffic from a specific ASN.  The following command excludes packets from the ASN 63949 (Linode) network block. <br><br><pre> <code class="bash hljs">ip and not ip.geoip.asnum == 63949</code> </pre> <br>  Of course, the same filter can be applied <a href="https://www.wireshark.org/docs/dfref/i/ip.html">to individual cities and countries</a> .  Remove the noise and leave only really interesting traffic. <br><br><h1>  SSL / TLS session decryption </h1><br>  One way to decrypt SSL / TLS sessions is to use the private key from the server to which the client is connected. <br><br>  Of course, you do not always have access to a private key.  But there is another option to simply view the SSL / TLS traffic on the local system.  If Firefox or Chrome is loaded using a special environment variable, the symmetric keys of the individual SSL / TLS sessions are written to a file that Wireshark can read.  Using these keys, Wireshark will show a fully decrypted session! <br><br><h3>  1. Setting the environment variable </h3><br>  <b>Linux / Mac</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> SSLKEYLOGFILE=~/sslkeylogfile.log</code> </pre> <br>  <b>Windows</b> <br><br>  On the <b>System Properties |</b>  <b>Advanced,</b> click the <b>Environment Variables</b> button and add the variable name (SSLKEYLOGFILE), and the path to the file as the value. <br><br><h3>  2. Configure Wireshark </h3><br>  From the drop-down menu, select <b>Edit |</b>  <b>Preferences |</b>  <b>Protocols |</b>  <b>SSL |</b>  <b>(Pre) -Master-Secret Log Filename - Browse</b> by specifying the file you specified in the environment variable. <br><br>  Start capturing traffic on the local system. <br><br><h3>  3. Restart Firefox or Chrome </h3><br>  After going to the HTTPS site, the log file will begin to grow in size, since it records the symmetric keys of the session. <br><br>  Take a look at the previously launched Wireshark session.  You should see something similar to the screenshot below with the decoded sessions.  Decrypted packets - on the tab in the bottom panel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/821/ecb/805/821ecb8055373f45c6776ff45eef21ec.png"><br><br>  Another way to view a session is through the <b>Analysis |</b>  <b>Follow |</b>  <b>Stream |</b>  <b>SSL</b>  If the session is successfully decrypted, you will see an option for SSL. <br><br>  Of course, be careful when writing these keys and packets.  If an outsider gets access to the log file, it will easily find your passwords and authentication cookies. <br><br>  Another way to access the basic HTTP traffic is to use the <a href="https://portswigger.net/burp">Burp Suite</a> tool with the loaded CA certificate in the browser.  In this case, the proxy decrypts the connection on the client, and then establishes a new SSL / TLS session on the server.  There are many ways to conduct such a MiTM attack on yourself, these are the two most simple ones. <br><br><h1>  Extracting files from packages using the export feature (HTTP or SMB) </h1><br>  Files are easily retrieved through the export menu. <br><br>  <b>File |</b>  <b>Export Objects |</b>  <b>HTTP</b> <br><br>  All files found will appear in a new window.  From here you can save individual files or all at once.  A similar method is used to extract files from SMB sessions.  As we mentioned, this is the Microsoft Server Message Block protocol, which is used for file sharing under Windows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b1/055/d1f/6b1055d1f51a96ef1e4a1a98fa5f1f23.png"><br><br><h1>  Status bar </h1><br>  The status bar on the right side of the window allows you to quickly go to the desired location of the network dump by clicking on the color indicator.  For example, packets with errors are marked in red in the status bar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/cf8/ab2/6c7cf8ab2f4e05c65a0bb25a02fafef3.png"><br><br><h1>  PCAP Sample </h1><br>  When you first start working with Wireshark, I want to look at some interesting package dumps.  They can be found on the <a href="https://wiki.wireshark.org/SampleCaptures">Wireshark Samples</a> page.  There are enough examples with different protocols for several months of analysis, there are even samples of traffic of worms and exploits. <br><br><h1>  Setting up the environment </h1><br>  The default appearance of the console is fully configurable.  You can add or remove columns, adding even such simple things as the UTC time column, which immediately increases the informational content of the logs if you analyze the packet history. <br><br>  Columns are configured in the <b>Edit |</b>  <b>Preferences |</b>  <b>Appearance |</b>  <b>Columns</b> .  It also changes the overall pattern, font and colors. <br><br>  In the video - useful tips on setting up the environment, including troubleshooting by sequence number TCP. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/U0QABcTD-xc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  capinfos </h1><br>  Included with Wireshark comes a handy <code>capinfos</code> command line <code>capinfos</code> .  This utility generates batch dump statistics, with start / end times and other details.  With the <code>-T</code> option, it produces text with a tab - it is suitable for importing into spreadsheets or analyzing in the console. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">test</span></span>@ubuntu:~$ capinfos test.pcap File name: test.pcap File <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: Wireshark/tcpdump/... - pcap File encapsulation: Ethernet File timestamp precision: microseconds (6) Packet size <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span>: file hdr: 262144 bytes Number of packets: 341 k File size: 449 MB Data size: 444 MB Capture duration: 3673.413779 seconds First packet time: 2018-12-01 11:26:53.521929 Last packet time: 2018-12-01 12:28:06.935708 Data byte rate: 120 kBps Data bit rate: 967 kbps Average packet size: 1300.72 bytes Average packet rate: 93 packets/s SHA256: 989388128d676c329ccdbdec4ed221ab8ecffad81910a16f473ec2c2f54c5d6e RIPEMD160: 0742b6bbc79735e57904008d6064cce7eb95abc9 SHA1: d725b389bea044d6520470c8dab0de1598b01d89 Strict time order: True Number of interfaces <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file: 1</code> </pre> <br><h1>  Conclusion </h1><br>  This article was originally published in 2011, then seriously updated.  If you have any comments, improvements or tips for the cheat sheet, <a href="https://hackertarget.com/contact/">write to me</a> .  Wireshark is one of those indispensable tools that many people use, but very few people own it perfectly.  Here you can go further and further. </div><p>Source: <a href="https://habr.com/ru/post/436226/">https://habr.com/ru/post/436226/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>