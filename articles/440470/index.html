<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build the Python interpreter into a java application using the Panama project</title>
  <meta name="description" content="A couple of days ago I saw Brian Goetz's tweet, but only today my hands reached around to play with examples. 

  

 About this and I want to briefly ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>We build the Python interpreter into a java application using the Panama project</h1><div class="post__text post__text-html js-mediator-article">  A couple of days ago I saw Brian Goetz's tweet, but only today my hands reached around to play with examples. <br><br> <a href="https://twitter.com/BrianGoetz/status/1096050570576703490"><img src="https://habrastorage.org/webt/5c/66/b9/5c66b94c2bab6456801434.png" alt="image"></a> <br><br>  About this and I want to briefly tell. <br><br>  About <a href="https://openjdk.java.net/projects/panama/">the Panama project</a> on Habr√© <a href="https://habr.com/ru/company/jugru/blog/310014/">already wrote</a> , therefore I will just show couple of simple examples of how it is possible to apply <i>native binder</i> . <br><a name="habracut"></a><br>  First of all, you will need a C compiler. If you are using Linux or MacOS, then you already have it.  If Windows, you have to first install <a href="https://visualstudio.microsoft.com/ru/downloads/">Build Tools for Visual Studio 2017</a> .  And, of course, you need OpenJDK with Panama support.  You can get it either by assembling the ‚Äúforeign‚Äù branch of the <a href="http://hg.openjdk.java.net/panama/dev/">corresponding repository</a> , or by downloading an <a href="http://jdk.java.net/panama/">Early-Access build</a> . <br><br>  Let's start with a minimal example - a simple function that adds two numbers: <br><br>  <b>adder.h</b> <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _ADDER_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _ADDER_H __declspec(dllexport) int add(int, int); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  <b>adder.c</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"adder.h"</span></span></span><span class="hljs-meta"> __declspec(dllexport) int add(int a, int b) { return a + b; }</span></span></code> </pre><br>  <b>Example.java</b> <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// –∏–º–ø–æ—Ä—Ç jextract'–Ω—É—Ç—ã—Ö "–∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö" –∫–ª–∞—Å—Å–æ–≤ import static com.example.adder_h.*; public class Example { public static void main(String[] args) { System.out.println(add(3, 5)); } }</span></span></code> </pre><br>  We compile in DLL <br><br><pre> <code class="dos hljs">cl /LD adder.c</code> </pre><br>  We use the <code>jextract</code> utility to generate a java interface based on the header file: <br><br><pre> <code class="dos hljs">jextract -L . -l adder -o adder.jar -t "com.example" adder.h</code> </pre><br>  And we use the resulting jar file to build and run java code: <br><br><pre> <code class="dos hljs">javac -cp adder.jar Example.java java -cp .;adder.jar Example</code> </pre><br>  While not particularly impressive, but allows you to understand the principle.  Now try using python37.dll. <br><br>  <b>PythonMain.java</b> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.foreign.Libraries; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.foreign.Scope; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.foreign.memory.Pointer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.python.Python_h.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.python.pylifecycle_h.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.python.pythonrun_h.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PythonMain</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Py_Initialize(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Scope s = Scope.newNativeScope()) { PyRun_SimpleStringFlags(s.allocateCString( <span class="hljs-string"><span class="hljs-string">"print(sum([33, 55, 66]))\n"</span></span>), Pointer.nullPointer()); } Py_Finalize(); } }</code> </pre><br>  We generate interfaces: <br><br><pre> <code class="dos hljs">jextract -L "C:\Python37" -l python37 -o python.jar -t "org.python" --record-library-<span class="hljs-built_in"><span class="hljs-built_in">path</span></span> C:\Python37\include\Python.h</code> </pre><br>  Compile and run: <br><br><pre> <code class="dos hljs">javac -cp python.jar PythonMain.java java -cp .;python.jar PythonMain</code> </pre><br>  Congratulations, your java-application has just loaded the Python interpreter into itself and executed the script in it! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5c/66/cf/5c66cf32206cd242223020.jpeg" alt="image"></div><br>  More examples can be found in the <a href="https://hg.openjdk.java.net/panama/dev/raw-file/c359a9e944de/doc/panama_foreign.html">instructions for pioneers</a> . </div><p>Source: <a href="https://habr.com/ru/post/440470/">https://habr.com/ru/post/440470/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>