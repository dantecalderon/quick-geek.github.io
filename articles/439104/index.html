<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Redux Simple as a rake</title>
  <meta name="description" content="I have already had the opportunity to look into the redux library repository , but from somewhere there was an idea to go deeper into its implementati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Redux Simple as a rake</h1><div class="post__text post__text-html js-mediator-article">  I have already had the <a href="https://github.com/reduxjs/redux">opportunity to</a> look into the <a href="https://github.com/reduxjs/redux">redux</a> library <a href="https://github.com/reduxjs/redux">repository</a> , but from somewhere there was an idea to go deeper into its implementation.  In a way, I‚Äôd like to share my shocking or even disappointing discovery with the community. <br><br>  <b>TL; DR: the</b> redux basic logic is placed in 7 lines of JS code. <br><br>  About redux in brief (free translation of the github header): <br><blockquote>  Redux is a state management library for applications written in JavaScript. <br><br>  It helps to write applications that behave stably / predictably, work on different environments (client / server / native code) and are easily testable. </blockquote>  I <a href="https://github.com/reduxjs/redux">cloned the redux repository</a> , opened the source folder in the editor (ignoring <u>docs</u> , <u>examples</u> , etc.) and took the Delete key to the <s>scissors</s> : <br><br><ul><li>  <b>Removed all comments from code</b> <br>  Each library method is documented with JSDoc in great detail. <br></li><li>  <b>Removed validation and error logging</b> <br>  In each method, input parameters are tightly controlled with very nice detailed comments to the console. <br></li><li>  <b>Removed <u>bindActionCreators</u> , <u>subscribe</u> , <u>replaceReducer,</u> and <u>observable</u> methods</b> . <br><br>  ... because I could.  Well, or because I was too lazy to write examples for them.  But without corner cases, they are even less interesting than what awaits you ahead. <br></li></ul><br>  And now let's sort out what's left <br><a name="habracut"></a><br><hr><br><h3>  We write redux for 7 lines </h3><br>  All redux basic functionality fits into a tiny file for which hardly anyone will create a github repository :) <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducer, initialState</span></span></span><span class="hljs-function">) </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = initialState
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {
        <span class="hljs-attr"><span class="hljs-attr">dispatch</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { state = reducer(state, action) },
        <span class="hljs-attr"><span class="hljs-attr">getState</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> state,
    }
}
</code></pre><br>
–í—Å—ë. –î–∞, —Å–µ—Ä—å—ë–∑–Ω–æ, <b>–í–°–Å</b>.<br>
<br>
–¢–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω redux. 18 —Å—Ç—Ä–∞–Ω–∏—Ü –≤–∞–∫–∞–Ω—Å–∏–π –Ω–∞ HeadHunter —Å –ø–æ–∏—Å–∫–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º ¬´redux¬ª ‚Äî –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–µ—é—Ç—Å—è, —á—Ç–æ –≤—ã —Ä–∞–∑–±–µ—Ä–µ—Ç–µ—Å—å –≤ 7 —Å—Ç—Ä–æ–∫–∞—Ö –∫–æ–¥–∞. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä.<br>
<br>
–° —ç—Ç–∏–º–∏ 7 —Å—Ç—Ä–æ–∫–∞–º–∏ —É–∂–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å TodoApp. –ò–ª–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ. –ù–æ –º—ã –±—ã—Å—Ç—Ä–µ–Ω—å–∫–æ –ø–µ—Ä–µ–ø–∏—à–µ–º <a href="https://redux.js.org/basics/example">TodoApp</a> –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ redux.<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">todosReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) {
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'ADD_TODO'</span></span>:
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [
        ...state,
        {
          <span class="hljs-attr"><span class="hljs-attr">id</span></span>: action.id,
          <span class="hljs-attr"><span class="hljs-attr">text</span></span>: action.text,
          <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>
        }
      ]
    <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'TOGGLE_TODO'</span></span>:
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todo</span></span></span><span class="hljs-function"> =&gt;</span></span> {
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (todo.id === action.id) {
          <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...todo, <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: !todo.completed }
        }
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> todo
      })
    <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>:
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state
  }
}

<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialTodos = []

<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(todosReducer, initialTodos)

<span class="hljs-comment"><span class="hljs-comment">// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</span></span>
store.dispatch({
  <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ADD_TODO'</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'–ü–æ–Ω—è—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ redux –ø—Ä–æ—Å—Ç'</span></span>
})

store.getState() 
<span class="hljs-comment"><span class="hljs-comment">// [{ id: 1, text: '–ü–æ–Ω—è—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ redux –ø—Ä–æ—Å—Ç', completed: false }]</span></span>

store.dispatch({
  <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'TOGGLE_TODO'</span></span>,
  <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>
})

store.getState() 
<span class="hljs-comment"><span class="hljs-comment">// [{ id: 1, text: '–ü–æ–Ω—è—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ redux –ø—Ä–æ—Å—Ç', completed: true }]</span></span>
</code></pre><br>
–£–∂–µ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —è –¥—É–º–∞–ª –±—Ä–æ—Å–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω —Å–æ —Å—Ü–µ–Ω—ã –∏ —É–π—Ç–∏, –Ω–æ <i>show must go on</i>.<br>
–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –º–µ—Ç–æ–¥.<br>
<br>
<h3>combineReducers</h3><br>
–≠—Ç–æ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω –æ–≥—Ä–æ–º–Ω—ã–π reducer –¥–ª—è –≤—Å–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—Ä–∞–∑—É, —Ä–∞–∑–±–∏–≤–∞—Ç—å –µ–≥–æ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.<br>
<br>
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω —Ç–∞–∫:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// –∑–¥–µ—Å—å –º—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ todosReducer –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞</span></span>

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counterReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'ADD'</span></span>) {
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state + <span class="hljs-number"><span class="hljs-number">1</span></span>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state
  }
}

<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer = combineReducers({
  <span class="hljs-attr"><span class="hljs-attr">todoState</span></span>: todoReducer,
  <span class="hljs-attr"><span class="hljs-attr">counterState</span></span>: counterReducer
})

<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = {
  <span class="hljs-attr"><span class="hljs-attr">todoState</span></span>: [],
  <span class="hljs-attr"><span class="hljs-attr">counterState</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>,
}

<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer, initialState)
</code></pre><br>
–î–∞–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç store –º–æ–∂–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π.<br>
<br>
–†–∞–∑–Ω–∏—Ü–∞ –º–æ–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∏ –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –≤ —Ç–æ–π –∂–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ <a href="https://redux.js.org/basics/example">TodoApp</a> –¥–æ–≤–æ–ª—å–Ω–æ –∑–∞–±–∞–≤–Ω–∞—è.<br>
<br>
–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–¥–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏–∑ ES6 (7/8/‚àû):<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer = combineReducers({ todos, counter })
</code></pre><br>
–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç todoReducer –≤ todos –∏ counterReducer –≤ counter. –ò –º–Ω–æ–≥–∏–µ –≤ —Å–≤–æ—ë–º –∫–æ–¥–µ –¥–µ–ª–∞—é—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ. –í –∏—Ç–æ–≥–µ —Ä–∞–∑–Ω–∏—Ü—ã –Ω–µ—Ç, –Ω–æ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞, –∑–Ω–∞–∫–æ–º—è—â–µ–≥–æ—Å—è —Å redux, —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞ —ç—Ç–∞ —à—Ç—É–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –º–∞–≥–∏–µ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–ª—é—á —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è <i>(state.todos) </i>—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–∞–∑–≤–∞–Ω–Ω–æ–π —Ç–∞–∫–∂–µ —Ç–æ–ª—å–∫–æ –ø–æ –∂–µ–ª–∞–Ω–∏—é —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ <i>(function todos(){})</i>.<br>
<br>
–ï—Å–ª–∏ –±—ã –Ω–∞–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ –Ω–∞—à–µ–º micro-redux, –º—ã –±—ã —Å–¥–µ–ª–∞–ª–∏ —Ç–∞–∫:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {
    <span class="hljs-attr"><span class="hljs-attr">todoState</span></span>: todoReducer(state, action),
    <span class="hljs-attr"><span class="hljs-attr">counterState</span></span>: counterReducer(state, action),
  }
}
</code></pre><br>
–≠—Ç–æ—Ç –∫–æ–¥ –ø–ª–æ—Ö–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è. –ï—Å–ª–∏ —É –Ω–∞—Å 2 ¬´–ø–æ–¥-—Å–æ—Å—Ç–æ—è–Ω–∏—è¬ª, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–≤–∞–∂–¥—ã –Ω–∞–ø–∏—Å–∞—Ç—å <b>(state, action)</b>, –∞ —Ö–æ—Ä–æ—à–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—é—Ç<i>, –ø—Ä–∞–≤–¥–∞?</i><br>
<blockquote>–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –æ—Ç –≤–∞—Å –æ–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –≤—ã –Ω–µ –∏—Å–ø—É–≥–∞–µ—Ç–µ—Å—å –º–µ—Ç–æ–¥–∞ <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries</a> –∏ <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">–î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏</a></blockquote> –û–¥–Ω–∞–∫–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ combineReducers –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è (–Ω–∞–ø–æ–º–∏–Ω–∞—é, —ç—Ç–æ –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫) <sub>–∏ —Å–∞–º—É—é –º–∞–ª–æ—Å—Ç—å –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –Ω–∞ —Å–≤–æ–π –≤–∫—É—Å</sub>:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combineReducers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducersMap</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combinationReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = {}
    <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(reducersMap).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[key, reducer]</span></span></span><span class="hljs-function">) =&gt;</span></span> {
      nextState[key] = reducer(state[key], action)
    })
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nextState
  }
}
</code></pre><br>
–ú—ã –¥–æ–±–∞–≤–∏–ª–∏ –∫ –Ω–∞—à–µ–º—É –¥–µ—Ç—ë–Ω—ã—à—É redux –µ—â—ë 9 —Å—Ç—Ä–æ–∫ –∏ –º–∞—Å—Å—É —É–¥–æ–±—Å—Ç–≤–∞.<br>
<br>
–ü–µ—Ä–µ–π–¥—ë–º –∫ –µ—â—ë –æ–¥–Ω–æ–π –≤–∞–∂–Ω–æ–π —Ñ–∏—á–µ, –∫–æ—Ç–æ—Ä–∞—è –∫–∞–∂–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–π, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –º–∏–º–æ –Ω–µ—ë.<br>
<br>
<h3>applyMiddleware</h3><br>
middleware –≤ —Ä–∞–∑—Ä–µ–∑–µ redux ‚Äî —ç—Ç–æ –∫–∞–∫–∞—è-—Ç–æ —à—Ç—É–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–ª—É—à–∞–µ—Ç –≤—Å–µ dispatch –∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö –¥–µ–ª–∞–µ—Ç <i>—á—Ç–æ-—Ç–æ</i>. –õ–æ–≥–∏—Ä—É–µ—Ç, –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –∑–≤—É–∫–∏, –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É,‚Ä¶ ‚Äî <i>—á—Ç–æ-—Ç–æ</i>.<br>
<br>
–í –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–¥–µ middleware –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ createStore, –Ω–æ –µ—Å–ª–∏ –Ω–µ –∂–∞–ª–µ—Ç—å –ª–∏—à–Ω—é—é —Å—Ç—Ä–æ—á–∫—É –∫–æ–¥–∞, —Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createStoreWithMiddleware = applyMiddleware(someMiddleware)(createStore)
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStoreWithMiddleware(reducer, initialState)
</code></pre><br>
–ü—Ä–∏ —ç—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ applyMiddleware, –∫–æ–≥–¥–∞ —Ç—ã –ø–æ—Ç—Ä–∞—Ç–∏—à—å 10 –º–∏–Ω—É—Ç –Ω–∞ –∫–æ–≤—ã—Ä—è–Ω–∏–µ –≤ —á—É–∂–æ–º –∫–æ–¥–µ, —Å–≤–æ–¥–∏—Ç—Å—è –∫ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π –≤–µ—â–∏: createStore –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º ¬´dispatch¬ª. dispatch, –∫–∞–∫ –º—ã –ø–æ–º–Ω–∏–º (–Ω–µ –ø–æ–º–Ω–∏–º) –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∏–Ω–≥–∞ –∫–æ–¥–∞, ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–æ –ª–∏—à—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–µ–¥—é—Å–µ—Ä –∫ –Ω–∞—à–µ–º—É —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é (newState = reducer(state, action)). <br>
–¢–∞–∫ –≤–æ—Ç applyMiddleware –Ω–µ –±–æ–ª–µ–µ —á–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥ <b>dispatch</b>, –¥–æ–±–∞–≤–ª—è—è –ø–µ—Ä–µ–¥ (–∏–ª–∏ –ø–æ—Å–ª–µ) –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∫—É—é-—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –ª–æ–≥–∏–∫—É. <br>
<br>
–í–æ–∑—å–º—ë–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π middleware –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π redux ‚Äî <a href="https://github.com/reduxjs/redux-thunk">redux-thunk</a><br>
<br>
–ï–≥–æ —Å–º—ã—Å–ª —Å–≤–æ–¥–∏—Ç—Å—è –∫ —Ç–æ–º—É, —á—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ <br>
<br>
<pre><code class="javascript hljs">store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SOME_ACTION_TYPE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">some_useful_data</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> })</code></pre><br>
–Ω–æ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ store.dispatch —Å–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someStrangeAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(getState().counterState % <span class="hljs-number"><span class="hljs-number">2</span></span>) {
       dispatch({
         <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ADD'</span></span>,
       })
    }
    <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout(resolve, <span class="hljs-number"><span class="hljs-number">1000</span></span>))
    dispatch({
      <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'TOGGLE_TODO'</span></span>,
      <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>
    })
  }
}
</code></pre><br>
–ò —Ç–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –≤—ã–ø–æ–ª–Ω–∏–º –∫–æ–º–∞–Ω–¥—É<br>
<br>
<pre><code class="javascript hljs">dispatch(someStrangeAction())
</code></pre><br>
—Ç–æ:<br>
<br>
<ul>
<li>–µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ store.getState().counterState –Ω–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 2, –æ–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –Ω–∞ 1</li>
<li>—á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –Ω–∞—à–µ–≥–æ –º–µ—Ç–æ–¥–∞, todo —Å id=1 –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç completed true –Ω–∞ false –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.</li>
</ul><br>
–ò—Ç–∞–∫, —è –∑–∞–ª–µ–∑ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π redux-thunk, –∏ —Å–¥–µ–ª–∞–ª —Ç–æ –∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ —Å redux ‚Äî —É–¥–∞–ª–∏–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä—è—é—Ç –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –Ω–æ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π<br>
<br>
–ü–æ–ª—É—á–∏–ª–æ—Å—å —Å–ª–µ–¥—É—é—â–µ–µ:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thunk = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> {
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> action === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) {
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action(store.dispatch, store.getState)
  }
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dispatch(action)
}
</code></pre><br>
—è –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è <pre>const thunk = store =&gt; dispatch =&gt; action</pre> –≤—ã–≥–ª—è–¥–∏—Ç –∂—É—Ç–∫–æ–≤–∞—Ç–æ, –Ω–æ –µ—ë —Ç–æ–∂–µ –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –ø–∞—Ä—É —Ä–∞–∑ —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –≤—ã –æ—Å–æ–∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –≤—Å—ë –Ω–µ —Ç–∞–∫ —Å—Ç—Ä–∞—à–Ω–æ, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é (–ª–∞–¥–Ω–æ, —Å–æ–≥–ª–∞—Å–µ–Ω, —Å—Ç—Ä–∞—à–Ω–æ)<br>
<br>
–ù–∞–ø–æ–º–Ω—é, –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ <b>createStore</b> –≤—ã–≥–ª—è–¥–µ–ª —Ç–∞–∫<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducer, initialState</span></span></span><span class="hljs-function">) </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = initialState
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {
        <span class="hljs-attr"><span class="hljs-attr">dispatch</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { state = reducer(state, action) },
        <span class="hljs-attr"><span class="hljs-attr">getState</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> state,
    }
}
</code></pre><br>
–¢–æ –µ—Å—Ç—å –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–ª –∞—Ç—Ä–∏–±—É—Ç—ã (reducer, initialState) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–∞–º–∏ { dispatch, getState }.<br>
<br>
–û–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ <b>applyMiddleware</b> –ø—Ä–æ—â–µ, —á–µ–º –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç.<br>
–ú—ã –±–µ—Ä—ë–º —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ <b>createStore</b> –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:<br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">middleware</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStoreWithMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">createStore</span></span></span><span class="hljs-function">) </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducer, state</span></span></span><span class="hljs-function">) =&gt;</span></span> {
      <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer, state)

      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {
        <span class="hljs-attr"><span class="hljs-attr">dispatch</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> middleware(store)(store.dispatch)(action),
        <span class="hljs-attr"><span class="hljs-attr">getState</span></span>: store.getState,
      }
    }
  }
}</code></pre><br>
<h3>–í—ã–≤–æ–¥</h3><br>
–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º redux —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏. –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ ¬´–ï—Å–ª–∏ –±–µ–Ω–∑–∏–Ω –≤ —Ü–∏–ª–∏–Ω–¥—Ä–µ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è, –¥–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è¬ª. –ê –≤–æ—Ç —Ç–æ, —Å–º–æ–∂–µ—Ç–µ –ª–∏ –≤—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ —ç—Ç–∏—Ö –ø–æ–Ω—è—Ç–∏—è—Ö –±–æ–ª–∏–¥ –§–æ—Ä–º—É–ª—ã 1 ‚Äî —É–∂–µ —Ä–µ—à–∞–π—Ç–µ —Å–∞–º–∏.<br>
<br>
<h3>P.S.</h3><br>
–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–æ–π ¬´micro-redux¬ª —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ store.subscribe –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å 8 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. –ê –≤–∞–º?</div><p>Source: <a href="https://habr.com/ru/post/439104/">https://habr.com/ru/post/439104/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>