<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing Elixir / Phoenix Applications with Docker</title>
  <meta name="description" content="Under the cat is a small and simple guide that shows how to use Docker Compose to configure and launch the Elixir / Phoenix + PostgreSQL application. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Developing Elixir / Phoenix Applications with Docker</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/2-/ty/ok/2-tyokqzevcwzvb59ymi1qlbhfe.png"><br><br>  Under the cat is a small and simple guide that shows how to use Docker Compose to configure and launch the Elixir / Phoenix + PostgreSQL application. <a name="habracut"></a><br><br><h2>  Training </h2><br>  Create an empty &lt;app_dir&gt; directory and go to it: <br><br><pre><code class="bash hljs">mkdir &lt;app_dir&gt; &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> &lt;app_dir&gt;</code> </pre> <br>  Create a <b>Dockerfile</b> and fill it with content. <br><br><div class="spoiler">  <b class="spoiler_title">&lt;app_dir&gt; / dockerfile</b> <div class="spoiler_text"><pre> <code class="bash hljs">FROM elixir:latest RUN apt-get update -qq &amp;&amp; apt-get install -y libpq-dev &amp;&amp; apt-get install -y build-essential inotify-tools erlang-dev erlang-parsetools apt-transport-https ca-certificates &amp;&amp; apt-get update &amp;&amp; curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"deb https://dl.yarnpkg.com/debian/ stable main"</span></span> | tee /etc/apt/sources.list.d/yarn.list &amp;&amp; apt-get update &amp;&amp; apt-get install --no-install-recommends yarn RUN mix local.hex --force &amp;&amp; mix local.rebar --force RUN mix archive.install hex phx_new 1.4.0 --force RUN curl -sL https://deb.nodesource.com/setup_11.x | bash - &amp;&amp; apt-get install -y nodejs WORKDIR /home/app</code> </pre> <br></div></div><br>  Create <b>docker-compose.yml</b> and fill it with content. <br><br><div class="spoiler">  <b class="spoiler_title">&lt;app_dir&gt; /docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="mel hljs">version: <span class="hljs-string"><span class="hljs-string">'3'</span></span> services: web: build: . command: mix phx.server volumes: - .:/home/app ports: - <span class="hljs-string"><span class="hljs-string">"4000:4000"</span></span> links: - db depends_on: - db test: <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: &lt;app_dir&gt;_web command: mix test environment: MIX_ENV: test PORT: <span class="hljs-number"><span class="hljs-number">4001</span></span> volumes: - .:/home/app db: <span class="hljs-keyword"><span class="hljs-keyword">image</span></span>: postgres:latest ports: - <span class="hljs-string"><span class="hljs-string">'5432:5432'</span></span> environment: POSTGRES_USER: &lt;db_user&gt; POSTGRES_PASSWORD: &lt;db_user_password&gt;</code> </pre> <br><br></div></div><br><h2>  Project creation </h2><br>  We generate a new application using docker-compose, where &lt;app_name&gt; is the name of the application: <br><br><pre> <code class="bash hljs">docker-compose run web mix phx.new . --app &lt;app_name&gt;</code> </pre> <br>  If you are using Docker on Linux, then the created files belong to root, since the container is launched on its behalf.  To avoid difficulties in the future, you need to change the owner: <br><br><pre> <code class="bash hljs">sudo chown -R <span class="hljs-variable"><span class="hljs-variable">$USER</span></span>:<span class="hljs-variable"><span class="hljs-variable">$USER</span></span> .</code> </pre> <br><h2>  Database connection </h2><br>  To connect to the database in the settings of our application, you need to change two files: <br><br><div class="spoiler">  <b class="spoiler_title">&lt;app_dir&gt; /config/dev.exs</b> <div class="spoiler_text"><pre> <code class="erlang hljs"># Configure your database config :&lt;app_name&gt;, &lt;App_name&gt;.Repo, username: &lt;db_user&gt;, password: &lt;db_user_password&gt;, database: &lt;app_name&gt;_dev, hostname: <span class="hljs-string"><span class="hljs-string">"db"</span></span>, pool_size: <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">&lt;app_dir&gt; /config/test.exs</b> <div class="spoiler_text"><pre> <code class="erlang hljs"># Configure your database config :&lt;app_name&gt;, &lt;App_name&gt;.Repo, username: &lt;db_user&gt;, password: &lt;db_user_password&gt;, database: &lt;app_name&gt;_test, hostname: <span class="hljs-string"><span class="hljs-string">"db"</span></span>, pool_size: <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br></div></div><br>  After the settings are adjusted, we create a base for each environment: <br><br><pre> <code class="bash hljs">docker-compose run web mix ecto.create</code> </pre> <br><pre> <code class="bash hljs">docker-compose run <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> mix ecto.create</code> </pre> <br><h2>  Application launch </h2><br>  Well, it remains only to run our application: <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  That's all.  Now our application is available at <a href="http://127.0.0.1:4000/">http://127.0.0.1:4000</a> . <br><br><img src="https://habrastorage.org/webt/eb/ue/p_/ebuep_hjtosyti-wkq9b7vhmubi.png"><br><br><h2>  Tests </h2><br>  And in the end about testing. <br><br>  In order to perform all the tests, you need to run: <br><br><pre> <code class="bash hljs">docker-compose run <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  To perform a specific test: <br><br><pre> <code class="bash hljs">docker-compose run <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> mix <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/&lt;app_name&gt;_web/controllers/page_controller_test.exs</code> </pre> <br>  That's all, all good! </div><p>Source: <a href="https://habr.com/ru/post/439718/">https://habr.com/ru/post/439718/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>