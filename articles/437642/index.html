<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>If the windows open, it means - someone needs it.</title>
  <meta name="description" content="Once I needed to open a window from a console application. I wanted to do this using wpf, but the information scattered across the network turned out ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>If the windows open, it means - someone needs it.</h1><div class="post__text post__text-html js-mediator-article">  Once I needed to open a window from a console application.  I wanted to do this using wpf, but the information scattered across the network turned out to be small, so I decided to somehow systematize and present this little tutorial. <br><a name="habracut"></a><br>  Let's create a regular console application on the .net framework. <br><br><img src="https://habrastorage.org/webt/sy/ad/tx/syadtxwz6m-0edun6789erfg0ca.png"><br><br>  Now you need to add dependencies: WindowsBase, PresentationCore, PresentationFramework. <br><br><img src="https://habrastorage.org/webt/8d/lv/o6/8dlvo6xqlrzu_onzlqpjq2js35y.png"><br><br>  Add the class of our window, inheriting it from the standard windows of Windows. <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MyWindow</span></span> : <span class="hljs-selector-tag"><span class="hljs-selector-tag">Window</span></span>{}</code> </pre> <br>  Add the [STAThread] attribute to the main method <br><br><div class="spoiler">  <b class="spoiler_title">What for</b> <div class="spoiler_text">  STAThreadAttribute is essentially a requirement for messaging with a Windows message server with COM components. <br>  <a href="https://stackoverflow.com/questions/1361033/what-does-stathread-do">And more.</a> <br></div></div><br><br><pre> <code class="css hljs"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[STAThread]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Main</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span>){}</code> </pre> <br>  Now create our window: <br><br><pre> <code class="css hljs"> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[STAThread]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Main</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span>) { var win = new MyWindow { Width = 350, Height = 350}; <span class="hljs-selector-tag"><span class="hljs-selector-tag">var</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">var</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TextBox</span></span> {Text = "my text"}; <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Children</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Add</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Content</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span>; }</code> </pre> <br>  If we now call the Show () method on the window, it will immediately collapse, and since we would like to look at it all the time, we need to push this window into a container that supports the entire life cycle. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.MainWindow</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.MainWindow</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Show</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Run</span></span>();</code> </pre> <br>  We have displayed the window, and it feels rather well, but closing it from the code simply won't work: the Run () method is an infinite loop of itself, and Application can only be stopped from the same thread where it was called.  Output: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Task</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Run</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">async</span></span> () =&gt; { await Task.Delay(1000); app.Dispatcher.Invoke((Action) delegate { app.Shutdown(); }); }); ;</code> </pre> <br>  Then the whole method looks like <div class="spoiler">  <b class="spoiler_title">So.</b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[STAThread]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">static</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Main</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span>) { var app = new Application(); var win = new MyWindow { Width = 350, Height = 350}; <span class="hljs-selector-tag"><span class="hljs-selector-tag">var</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grid</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">var</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TextBox</span></span> {Text = "my text"}; <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Children</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Add</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Content</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">grid</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.MainWindow</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.MainWindow</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Show</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">Task</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Run</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">async</span></span> () =&gt; { await Task.Delay(1000); app.Dispatcher.Invoke((Action) delegate { app.Shutdown(); }); }); <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Run</span></span>(); }</code> </pre> <br>  <a href="https://gitlab.com/maindlab/consolewpf">here is the source</a> <br></div></div><br><br>  A pleasant solution would be not to make our window from the code, but to switch to a more familiar xaml. <br><br>  To do this, add the dependency System.Xml. <br>  And compile the xaml document. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:ConsoleApplication1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"800"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Label"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Now load the data from the file. <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">XmlTextReader</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XmlTextReader</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyWin</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xaml</span></span>"); <span class="hljs-selector-tag"><span class="hljs-selector-tag">var</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">win</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">XamlReader</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Load</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">r</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">as</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Window</span></span>;</code> </pre> <br><br>  And in this embodiment, the final Main looks <div class="spoiler">  <b class="spoiler_title">So.</b> <div class="spoiler_text"><pre> <code class="cpp hljs">[STAThread] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ var app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Application(); XmlTextReader r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlTextReader(<span class="hljs-string"><span class="hljs-string">"MyWin.xaml"</span></span>); var win = XamlReader.Load(r) as Window; app.MainWindow = win; app.MainWindow.Show(); Task.Run(async () =&gt; { await Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); app.Dispatcher.Invoke((Action) delegate { app.Shutdown(); }); }); app.Run(); }</code> </pre> <br></div></div><br><br>  PS <br>  Thanks to # chat in <a href="https://t.me/DotNetRuChat">tg</a> and user <a href="https://habr.com/en/users/addewyd/">Yuri</a> . </div><p>Source: <a href="https://habr.com/ru/post/437642/">https://habr.com/ru/post/437642/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>