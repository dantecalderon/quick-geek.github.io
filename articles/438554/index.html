<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Managing state and events between components in a GameObject</title>
  <meta name="description" content="Managing state and events between components in a GameObject 
 Link to the project 

 As is known to everyone more or less familiar with the Unity pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Managing state and events between components in a GameObject</h1><div class="post__text post__text-html js-mediator-article"><h2>  Managing state and events between components in a GameObject </h2><br>  <b><a href="https://github.com/deniskozlov/yunka_sharedstate_exaple">Link to the project</a></b> <br><br>  As is known to everyone more or less familiar with the Unity platform, each <b>GameObject</b> game object consists of components (built-in or custom, which is usually called a ‚Äúscript‚Äù).  Components are inherited from the <b>MonoBehavior</b> base class. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57c/001/3e6/57c0013e6c716c9e8bae072510a1f6e9.jpg"><br><br>  And usually, well or often, a direct connection is made to bind the components. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/86e/3be/011/86e3be0117dbb34634c6b6e6b195acaa.jpg"><br><br>  Those.  in one component, to obtain data of another component, we obtain the latter using the <b>GetComponent &lt;...&gt; ()</b> method, for example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27f/f8a/466/27ff8a466f7b514a44c259a8ec662798.jpg"><br><br>  In this example, a reference to a component of type <b>SomeComponent</b> will be placed in the variable <b>someComponent</b> . <br><br>  With such a ‚Äústrongly connected‚Äù approach, especially if there are a large number of components, it is quite simple to get confused and maintain the integrity of such a connection.  For example, if the name of a property or method changes in one component, you will have to correct it in all components using this one.  And this is hemorrhagic. <br><br>  <i>Under the cut a lot of pictures</i> <br><a name="habracut"></a><br><h3>  Creating a solution based on "strong connectivity" components </h3><br>  Let's create an empty project to reproduce the usual situation, when we have certain components and each of them refers to each other, to receive data or to control. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/580/a1d/24d/580a1d24db1610425d786be6ff6755d1.jpg"><br><br>  I added two scripts <b>FirstComponent</b> and <b>SecondComponent</b> , which will be used as components in the game object: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/829/17f/c7f/82917fc7fead431a659b4198d8be26d4.jpg"><br><br>  Now I will define a simple structure for each of the components needed for the experiments. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/27b/6af/d6827b6af2050750fc6ebd6015676f98.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bcd/00b/f6b/bcd00bf6b5dd87bf25c64084cc80d853.jpg"><br><br>  Now imagine a situation in which we would need to get the values ‚Äã‚Äãof the <b>state1</b> fields from the <b>FirstComponent</b> component and call its <b>ChangeState (...)</b> method in the <b>SecondComponent</b> component.  To do this, get a reference to the component and request the necessary data in the <b>SecondComponent</b> component: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2e3/f71/c70/2e3f71c7018f3f65c930c82c699f2b9b.jpg"><br><br>  After we start the game in the console, it will be seen that we have received data from <b>FisrtComponent</b> from <b>SecondComponent</b> and changed the state of the first <br><br><img src="https://habrastorage.org/getpro/habr/post_images/791/8fb/5f5/7918fb5f55a0585191e16e7dfbf3a428.jpg"><br><br>  Now, just as well, we can get data in the opposite direction from the <b>FirstComponent</b> component <b>and</b> get the data of the <b>SecondComponent</b> component. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad6/f4f/af5/ad6f4faf555d6c7af5e14ad1baa68d82.jpg"><br><br>  After starting the game, it will also be seen that the data is received and we can control the <b>SecondComponent</b> component from <b>FirstComponent</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/52e/4f1/938/52e4f19383874c56b4d715cb6d1b6dc3.jpg"><br><br>  It was a rather simple example, and in order to understand what kind of problem I want to describe, it would take a lot to complicate the structure and connections of all components, but the meaning is clear.  Now the connection between the components is as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5dd/047/275/5dd0472753beeaf2811e569ca49ae240.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/859/0f6/b82/8590f6b82421662793ba28df06e14de1.jpg"><br><br>  Even expanding one game object with new components, if they need to interact with already existing ones, will be rather routine.  And especially if, for example, the name of the field <b>state1</b> in the <b>FirstComponent</b> component changes, for example, to <b>state_1</b> and you have to change the name in all components where it is used.  Or when a component becomes too many fields, then it becomes quite difficult to navigate on them. <br><br><h3>  Creating a solution based on the "General Status" between the components </h3><br>  Now imagine that we would not need to receive a link to each component of interest and receive data from it, but there would be some object that contains the states and data of all components in the game object.  On the diagram, it would look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b9/3bb/ffb/2b93bbffbbeaa2c98e64ad75089792ee.jpg"><br><br>  SharedState or SharedState is also a component that will play the role of a service component and store the state of all components of a game object. <br><br>  I will create a new component and name it SharedState: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/894/b7f/cfd/894b7fcfdbb7ff00f8f41f1b647b0f4b.jpg"><br><br>  And determine the code of this universal component.  It will keep a closed dictionary and an indexer for more convenient work with the component dictionary, also it will be encapsulation and it will not work directly with the dictionary from other components. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/662/0d0/ee9/6620d0ee9590f92ac838fc91a6ddfaaf.jpg"><br><br>  Now this component needs to be placed on the game object so that other components can access it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56e/9a6/832/56e9a683243778dd34dda30d7a3a05f3.jpg"><br><br>  Next, you need to make some edits to the <b>FirstComponent</b> and <b>SecondComponent</b> components so that they use the <b>SharedState</b> component to store their state or data: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81d/a42/9a6/81da429a637ef32290ce7e5d61d7058f.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b69/e92/cd3/b69e92cd3882471ed64b342cc833c150.jpg"><br><br>  As can be seen from the component code, we no longer store the fields, instead we use the general state and have access to its data using the ‚Äústate1‚Äù or ‚Äúcounter‚Äù key.  Now this data is not tied to any component, and if a third component appears, then by accessing the SharedState it can access all this data. <br><br>  Now, to demonstrate the operation of this scheme, you need to change the Update methods in both components.  In <b>FisrtComponent</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/013/a2a/de1/013a2ade149a42ac361f604b3debb482.jpg"><br><br>  And in the <b>SecondComponent</b> component: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/fa5/a61/082fa5a618434e47147ff93bcf03fe2b.jpg"><br><br>  Now the components do not know the origin of these values, that is, they used to access some specific component to obtain them, and now they are simply stored in a common space and any component has access to them. <br><br>  After starting the game, you can see that the components get the necessary values: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/208/5ad/ebb/2085adebb94c05a2d0dd1d906441d375.jpg"><br><br>  Now that you know how it works, you can bring the basic infrastructure to access the overall state of the base class, so as not to do it all in each component separately: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a1/aee/b12/8a1aeeb124f5fb7d550b2f7eb25280b4.jpg"><br><br>  And I will make it abstract in order not to accidentally create an instance of it ... And it is also desirable to add an attribute indicating that this basic component requires the <b>SharedState</b> component: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/042/f97/ca3/042f97ca3a4a8ac31c9173634e6fd406.jpg"><br><br>  Now we need to change the <b>FirstComponent</b> and <b>SecondComponent</b> components so that they inherit from the <b>SharedStateComponent</b> and remove all unnecessary: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ac/51b/d0c/6ac51bd0c64736c30e3d42944eee2762.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/9b0/f53/ec89b0f533fd773de44b572d110dbb31.jpg"><br><br>  OK.  What about calling methods?  It is proposed to do the same not directly, but through the Publisher-Subscriber pattern.  Simplified. <br><br>  To implement this, you need to add another common component, by analogy with the one that contains the data, except that this one will contain only subscriptions and will be called <b>SharedEvents</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/9ab/e69/f0c9abe69b2749783965064a27c9d207.jpg"><br><br>  The principle is as follows.  A component that wants to call some method from another component will not do it directly, but by calling an event, just by name, as we get data from the general state. <br><br>  Each component subscribes to some events that it is ready to track.  And if it catches this event, it executes a handler that is defined in the component itself. <br>  Create the <b>SharedEvents</b> component: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f71/a53/545/f71a53545623eff24411b88a65dd17f6.jpg"><br><br>  And we define the structure necessary to manage subscriptions and publications. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd6/74e/57e/cd674e57ea97a1f1a069edf0e0ee9525.jpg"><br><br>  For the exchange of data between subscriptions, publications, a base class is defined, a specific one will be determined for the author of each event independently, then several will be defined for example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0af/703/e5f/0af703e5feab02ef1f7c5b4d10837188.jpg"><br><br>  Now we need to add a new component to the game object: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e57/0b1/5d0/e570b15d01e04fd801519515aa1baa69.jpg"><br><br>  and slightly expand the base class of <b>SharedStateComponent</b> and add the requirement that the object contain <b>SharedEvents</b> <b><br></b> <br><img src="https://habrastorage.org/getpro/habr/post_images/c13/9cf/b76/c139cfb76f4ad397ea7bd0929bd33375.jpg"><br><br>  As well as the general state object, the general subscriptions object must be obtained from the game object: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edb/50e/cf6/edb50ecf6435a6f9c7711d25cc9e6914.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c20/2ff/7e5/c202ff7e58ad1695473cfe3cf22a54a2.jpg"><br><br>  Now we define the event subscription, which we will process in <b>FisrtComponent</b> and the class for transmitting data through this type of event, and also change the <b>SecondComponent</b> so that the event for this subscription will be published: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c06/ed1/34d/c06ed134d85eb3a9444e53d50cfe909c.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fef/8de/fe3/fef8defe3c3366838a4300243475a6bb.jpg"><br><br>  Now we have subscribed to any event in the name ‚Äúwritesomedata‚Äù in the <b>FirstComponent</b> component and just <b>print the</b> message to the console when it occurs.  And it occurs in this example by calling the publication of an event with the name ‚Äúwritesomedata‚Äù in the <b>SecondComponent</b> component and transmitting some information that can be used in the component that catches events by such a name. <br><br>  After starting the game in 5 seconds we will see the result of processing the event in <b>FirstComponent</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e1/880/1db/1e18801db271b9e651c5e4dfb4cc659b.jpg"><br><br><h3>  Total </h3><br>  Now, if you need to expand the components of this game object, which will also use the general state and general events, you need to add a class and just inherit from <b>SharedStateComponent</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6e/30c/104/b6e30c1040c6bcba3eb3ca788ee499a2.jpg"><br><br>  <a href="https://habr.com/ru/post/438628/">Continuing the theme</a> </div><p>Source: <a href="https://habr.com/ru/post/438554/">https://habr.com/ru/post/438554/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>