<div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/en/ft/z7/enftz7g4vnxktej3zk-18hyoc9o.png" alt="image"><br><br>  Let me tell you about the “Roadmap” project - an interactive map of accidents in Russia.  The map simplifies the analysis of accidents and helps to find the real causes of accidents.  How did you get the idea where they took the data and why they opened the source code. <br><br><h3>  For 2018 in the accident on the roads of Russia killed 19088 people </h3><br><a name="habracut"></a><br>  The figure is decreasing with each passing year, but it still remains much larger than in developed countries, where much more attention is paid to the problem of road mortality.  A great example is the Swedish road safety program Vision Zero. <br><br>  <i>The basic principle of the program is the inadmissibility of fatal traffic accidents.</i>  <i>This principle is also called the principle of "zero tolerance", according to it, it is impossible to treat death on the road as the inevitable evil associated with motorization.</i>  <i>- <a href="https://ru.wikipedia.org/wiki/Vision_Zero">wikipedia</a></i> <br><br>  Last year, the Urban Projects of Ilya Varlamov and Maxim Kats Foundation launched the <a href="https://city4people.ru/blogs/project_53">Zero Deaths</a> campaign in Moscow.  The idea is that in principle no one should die in an accident.  And if people die, it is not the victims, but first of all the designers, the builders, or the city.  It is necessary to understand every accident, find system causes and gradually eliminate them.  While the city departments are not seriously engaged in this. <br><br>  Therefore, last summer, we with city activists and Moscow municipal deputies were puzzled by the creation of a tool that would allow for a detailed spatial analysis of road accidents: find dangerous intersections, study local statistics on streets and cities, identify the main factors and causes of accidents.  At that time, such a public project did not exist. <br><br><h3>  Open data on accidents </h3><br>  We are very lucky with open data.  On Habré already wrote <a href="https://habr.com/ru/post/354782/">good posts</a> to work with them.  Such attention is fully justified - this is one of the most detailed and interesting data that the state now discloses.  Coordinates, weather, brands and years of release cars, breaking the rules, the gender of the participants and much more.  And that's all for each of more than 600 thousand accidents. <br><br>  In this case, we were worried about the <a href="http://stat.gibdd.ru/">stat.gibdd.ru</a> service <a href="http://stat.gibdd.ru/">itself</a> .  Despite the detailed data under the hood, it differs in that it is very inconvenient for use.  It is more like a website for officials: a comparison to the APPG (for the same period last year), the details are only up to the administrative units, the traffic accidents are displayed in a list. <br><br><img src="https://habrastorage.org/webt/9s/fe/8v/9sfe8v_m_akaslkkeir-anhg4vy.jpeg" alt="image"><br><br>  Such an interface and functionality is not at all suitable for people, but rather created for official reports. <br><br><h3>  Creating a portal </h3><br>  An important role in creating the technical assignment was played by people who actually face these problems - deputies, activists, urbanists.  It was thanks to them that they got to understand what was really needed.  We agreed on a small starting budget of 30 thousand rubles and started to do it. <br><br>  Working with data began with the fact that I wrote a simple parser of regions and accidents from the traffic police portal site.  We clung to their API, which gave the data to the service itself, and unloaded it.  As I wrote above, there are posts on this topic on Habré, and the source code of our parser can be found in the <a href="https://github.com/tadata-ru/dtp-stat">repository</a> . <br><br>  The main problem was geocoding, since many of the accidents had incorrect coordinates.  Coordinates are very different from the addresses.  For example, in Makhachkala, 90% of the accidents were generally out of the city, and in Barnaul, part of the accidents simply slid into the woods. <br><br><img src="https://habrastorage.org/webt/js/cn/ad/jscnadtezhpif2gmk8cnosgb4iw.jpeg" alt="image"><br><br>  In the beginning, we used Yandex.Geocoder, but their limitations and the refusal to share the service even for a non-commercial project led to the fact that we had to find another solution.  As a result, we set our task on the hackathon of social projects PublicData, where the guys made their custom solution, which not only finds the nearest address, but also the nearest road. <br><br><img src="https://habrastorage.org/webt/mk/we/kn/mkweknoltwf-q5kio8j804bcr8o.png" alt="image"><br><br>  The guys took the address as the priority coordinate, and if the geotach from the protocol is removed from it by more than 300 meters, the algorithm will not take it into account.  The algorithm is that we take the building's geo-point and project it onto the road, we do the same with the geo-point from the protocol.  Between the two resulting points we draw a segment.  The middle of this segment will be the point we need. <br><br>  Next we used the postgresql + django + djangorestframework stack.  The data was hierarchical, so we had to create additional tables for the values ​​for which we planned filters. <br><br>  On the front-end, we planned an interactive map with filters and automatically calculated statistics.  The main task was to make sure that the map did not hang with so many objects (Moscow has more than 30 thousand).  The result was a ReactJS application with a leaflet add-in.  It loads from the API at once all the accidents of a region or city, but only those that appear on the screen show on the map.  This made the starting page load quite long, but provided quick filtering and recalculation of statistics, and does not allow the map to slow down.  In addition, a little later, we added a heat layer that is activated at a certain scale and with too many accidents.  In the beginning we only had a map of Moscow. <br><br>  We refused the mobile version at the first stage, since it will be hard to put the main functions in there, and the key user histories of working with the map suggest immersion for analysis, and not something that people will do on the go. <br><br>  We selected the filters by their importance for the analysis: types of accidents, dates, streets, traffic violations, surrounding infrastructure. <br><br><img src="https://habrastorage.org/webt/l6/9w/_w/l69w_wh08tr_4odcyjz6cv5bwza.png"><br><br>  We also noticeably simplified and improved the accident card with the help of colors, icons, panoramas. <br><br><img src="https://habrastorage.org/webt/m5/h9/m_/m5h9m_nkla9fvavojhia5asgb1s.png" alt="image"><br><br><h3>  Result </h3><br>  For half a year the project was visited by a little more than <a href="https://metrika.yandex.ru/dashboard%3Fid%3D49130284">30 thousand people</a> who viewed the site about 100 thousand times.  Now the map is developing together with activists in the regions, who talk about road traffic crashes on the example of a map of their city and region.  They communicate with regional media and talk about the problem in their blogs: <a href="https://7x7-journal.ru/item/112683">Kirov on the "Roadmap".</a>  <a href="https://7x7-journal.ru/item/112683">Top-7 streets of the city where most of the accidents occurred</a> , <a href="http://www.prizyv.ru/2018/10/05/vladimir-na-narodnoj-karte-dtp/">Vladimir on the people's road accident map</a> , <a href="https://www.nn.ru/news/more/neobkhodimo_rukovodstvovatsya_bezopasnostyu_lyudey_v_nizhegorodskoy_oblasti_sozdali_kartu_dtp/65631041/">“You must be guided by the safety of people”: an accident map was created in the Nizhny Novgorod region</a> . <br><br>  We receive individual feedback on the project.  For example, the Urban Projects Foundation actively uses our portal to conduct its research on dangerous intersections.  At the “Kirov Urban Forum” our project was mentioned as an argument for revising the urban planning policy.  We are very pleased that we have at least some influence on the problem. <br><br><h3>  Source </h3><br>  If you went to the project site, you should have noticed that the project still has many problems, of which: <br><br><ul><li>  not all regions added </li><li>  no mobile version </li><li>  you can not share a specific site / count statistics on a specific site </li></ul><br>  To get more people involved in the project, we opened the project <a href="https://github.com/tadata-ru/dtp-stat">source code</a> .  There is an instruction on how to raise the project at your place, how to download data and tasks, solving which you can help the project. <br><br>  In the near future we have fixed some small bugs and finalize the project. <br><br>  At the moment on the map: Moscow, St. Petersburg, Kazan, Nizhny Novgorod, Krasnodar, Yaroslavl, Kirov, Vladimir, Cheboksary and their regions. <br><br>  If the project helps to save at least one life out of these 20 thousand, then all this was not in vain.  You also have the opportunity to save several lives.  We will be very happy if you: <br><br><ul><li>  <a href="https://github.com/tadata-ru/dtp-stat">participate with us in project development</a> </li><li> <a href="https://t.me/crash_map">offer your development ideas and join our Telegram community</a> </li></ul><br>  <i>Thanks to everyone who participated in the creation of the project, and especially: Alexey Radchenko, Anastasia Romashkevich, Anton Chernykh <a href="https://habr.com/ru/users/c13/" class="user_link">c13</a> , Alexander Popovtsev, Anna Kirichenko, Konstantin Nabatchikov, Vladislav Prud, Maxim Nikityuk.</i> </div>