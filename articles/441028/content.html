<div class="post__text post__text-html js-mediator-article"><p>  Some time ago, among security researchers, it was very “fashionable” to find improperly configured AWS cloud storages with various kinds of confidential information.  At that time, I even published a <a href="https://www.devicelock.com/ru/blog/kak-obnaruzhivayut-otkrytye-oblachnye-hranilischa-amazon.html">small note</a> about how Amazon S3 open cloud storage is discovered. </p><br><p>  However, time passes and the focus in research has shifted to the search for left in the public domain databases.  More than half of the known cases of large data leaks over the past year are leaks from open bases (an overview of leaks for 2018 <a href="https://habr.com/ru/company/devicelockdlp/blog/434000/">here</a> and <a href="https://habr.com/company/devicelockdlp/blog/432354/">here</a> ). </p><br><p><img src="https://habrastorage.org/webt/qd/5n/0_/qd5n0_zxgdzy8vhi_tgddi8v9ws.jpeg"></p><br><p>  <em>Today we will try to figure out how such databases are discovered by security researchers ...</em> </p><a name="habracut"></a><br><blockquote>  Required disclaimer: this article does not address and does not raise legal and ethical issues related to the search and identification of publicly available databases.  All the information below should be considered solely as educational. <cut></cut></blockquote><p>  I will not discover America if I say that the main search tools for searching open databases are the specialized search engines <a href="https://www.shodan.io/">Shodan</a> and <a href="https://censys.io/">Censys</a> .  I’ll just make a reservation that these are not free services and you have to pay your honestly earned non-rubles for access to the full search results (in the case of Shodan it is $ 59 / month, and for Censys - $ 99 / month, and this is only for the minimum basic packages).  Free versions of search engines severely limit the number of results in the issuance. </p><br><p>  In addition to the classic Google-like search using the search string, these search engines provide the ability to connect to them through the API.  The lucky owner of a paid subscription will receive its API key.  This allows you to significantly facilitate the task of clearing the heap of search rubbish.  I gave a list of useful scripts and search automation programs that use API keys at the end of this article. </p><br><p><code>Кстати говоря, используя небольшую хитрость и опять же поиск, только на этот раз по GitHub, можно найти некоторое количество API-ключей, оставленных в открытых репозитариях их неосторожными владельцами.</code> </p> <br><p>  Let's take a look at the example of the Shodan search engine, how to find open MongoDB and Elasticsearch databases. </p><br><p>  The simplest and most obvious request that begs is “MongoDB”: </p><br><p><img src="https://habrastorage.org/webt/t0/cz/35/t0cz35wov0lcelzqhfxud4sexvm.png"></p><br><p>  Apparently from a screenshot, this request returned us all indexed MongoDB servers (on default port 27017).  Moreover, most of them (in the screenshot these are the first three) will be closed databases requiring account credentials.  And this is not exactly what we are interested in.  More precisely, it is not at all. </p><br><p>  Let's slightly complicate the query using the search filters “all:" mongodb server information "all:" metrics "”: </p><br><p><img src="https://habrastorage.org/webt/ds/al/1h/dsal1h5z6nbodykeozkerdhkoqa.png"></p><br><p>  The result looks much better already.  All found databases were freely available at the time when the search engine indexed them.  It is very likely that they will be able to connect to the specified IP addresses using any manager for MongoDB (for example, NoSQL Manager for MongoDB or Studio 3T for MongoDB). </p><br><p>  You can limit the search to any country.  Let's say let's look for the open MongoDB in China (query “all:" mongodb server information "all:" metrics "country:" cn ""): </p><br><p><img src="https://habrastorage.org/webt/0f/o_/x1/0fo_x1w4f_m2az4l9gzkk5fhrqa.png"></p><br><p>  To search for Elasticsearch open databases, it is convenient to use the query “port:" 9200 "all:" elastic indices "": </p><br><p><img src="https://habrastorage.org/webt/5c/as/wo/5caswon2tfp9hoz9bizzm88zncs.png"></p><br><p>  Unfortunately, I did not find a way how to set the search condition in the search line by the size of the base.  If you know how to do this (set a filter in the search box for the parameters "totalSize" or "sizeOnDisk"), then write in the comments. </p><br><p>  Impose more complex filters (restrictions on the size of the database, the date of the server in the index, etc.) on the search results, you can use specialized scripts and programs.  To do this, you will need paid access and an API key, as I wrote above. </p><br><p>  Here is a small list of things that might come in handy: </p><br><ul><li>  <a href="https://cli.shodan.io/">cli.shodan.io</a> is the official Shodan console.  In Russian about its use can be read <a href="https://xss.is/threads/27959/">here</a> . </li><li>  <a href="https://shodan-manual.com/">shodan-manual.com</a> - guide to Shodan in Russian. </li><li>  <a href="https://github.com/woj-ciech/LeakLooker">github.com/woj-ciech/LeakLooker</a> is a python program for searching open databases (MongoDB, CouchDB, Elasticsearch, etc.). </li><li>  <a href="https://lampyre.io/">lampyre.io</a> is a very powerful (and still very buggy!) graphical interface for searching and visualizing what you find.  It has built-in templates for MongoDB search and much more.  Is in beta testing with all the consequences ... </li><li>  <a href="https://t.me/dataleak">t.me/dataleak</a> (if blocked, <a href="https://tele.click/dataleak">tele.click/dataleak</a> ) is my modest channel in Telegram, in which I review information leaks and, in particular, I write about what security researchers find in open access.  It is interesting. </li></ul></div>