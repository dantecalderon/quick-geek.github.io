<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio for Java</title>
  <meta name="description" content="In the seventh version of the PVS-Studio static analyzer, we added support for the Java language. It's time to tell you a little about how we started ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>PVS-Studio for Java</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/859/2ca/ccd/8592caccdc92ac430645bd487d7b5284.png" alt="PVS-Studio for Java"></div><br>  In the seventh version of the PVS-Studio static analyzer, we added support for the Java language.  It's time to tell you a little about how we started to make support for the Java language, what we did and what further plans.  And, of course, the article will show the first tests of the analyzer on open source projects. <br><a name="habracut"></a><br><h2>  PVS-Studio </h2><br>  For Java developers who have never heard of the PVS-Studio tool, I‚Äôll give a very brief description of it. <br><br>  <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> is a tool for detecting errors and potential vulnerabilities in the source code of programs written in C, C ++, C # and Java.  Works on Windows, Linux and macOS. <br><br>  PVS-Studio performs static code analysis and generates a report that helps the programmer to find and fix defects.  For those who are interested in exactly how PVS-Studio is looking for errors, I suggest you to read the article " <a href="https://www.viva64.com/ru/b/0592/">Technologies used in the PVS-Studio code analyzer to search for errors and potential vulnerabilities</a> ." <br><br><h2>  Start </h2><br>  I could come up with a smart story, as we had been thinking for two years about which next language to support in PVS-Studio.  The fact that Java is a reasonable choice, based on the high popularity of this language and so on. <br><br>  However, as it happens in life, everything was decided not by a deep analysis, but by an experiment :).  Yes, we were thinking in which direction to further develop the PVS-Studio analyzer.  Considered such programming languages ‚Äã‚Äãas: Java, PHP, Python, JavaScript, IBM RPG.  And we were inclined towards the Java language, but the final choice was still not made.  Those whose eyes are stuck on an unfamiliar IBM RPG, refer here to this <a href="https://www.viva64.com/ru/b/0547/">note</a> , from which everything will become clear. <br><br>  At the end of 2017, colleague Yegor Bredikhin looked at what ready-made libraries for parsing code (in other words, parsers) for new directions interesting to us.  And I came across several projects for parsing Java code.  Based on <a href="http://spoon.gforge.inria.fr/">Spoon</a> , he quickly managed to make a prototype analyzer with a pair of diagnostics.  Moreover, it became clear that we could use some C ++ analyzer mechanisms using <a href="https://ru.wikipedia.org/wiki/SWIG">SWIG</a> in a Java analyzer.  We looked at what happened and realized that our next analyzer would be for Java. <br><br>  Thanks to Yegor for his initiative and active work he has done on the Java analyzer.  He described exactly how the development was in the article " <a href="https://www.viva64.com/ru/b/0572/">Development of a new static analyzer: PVS-Studio Java</a> ". <br><br><h2>  Competitors? </h2><br>  There are many free and commercial static code analyzers for Java in the world.  Enumerating them all in the article does not make sense, and I just leave a link to " <a href="https://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis">List of tools for static code analysis</a> " (see section Java and Multi-language). <br><br>  However, I know that first of all we will be asked about IntelliJ IDEA, FindBugs and SonarQube (SonarJava). <br><br>  <b>IntelliJ IDEA</b> <br><br>  IntelliJ IDEA has a very powerful static code analyzer built into it.  Moreover, the analyzer is developing, and its authors are closely <a href="https://habr.com/company/pvs-studio/blog/346128/">monitoring</a> our activities.  With IntelliJ IDEA we will be the hardest.  We will not be able to surpass IntelliJ IDEA in diagnostic capabilities, at least for now.  Therefore, we will try to concentrate on our other advantages. <br><br>  Static analysis in IntelliJ IDEA is, first of all, one of the design environment chips, which imposes certain restrictions on it.  We are free in what we can do with our analyzer.  For example, we can quickly adapt the analyzer to the specific needs of the customer.  Fast and deep support is our competitive advantage.  Our clients directly communicate directly with programmers who are developing a particular part of PVS-Studio. <br><br>  There are many opportunities in PVS-Studio to integrate it into the development cycle of large old projects.  This is an <a href="https://www.viva64.com/ru/m/0037/">integration with SonarQube</a> .  This is a <a href="https://www.viva64.com/ru/m/0032/">mass suppression of</a> analyzer messages, which allows you to immediately start using the analyzer in a large project to track errors only in new or modified code.  PVS-Studio is being <a href="https://www.viva64.com/ru/m/0005/">integrated</a> into the continuous integration process.  I think it is these and other possibilities that will help our analyzer find a place under the sun in the Java world. <br><br>  <b>Findbugs</b> <br><br>  Project FindBugs <a href="https://jug.ru/2016/11/findbugs-future-uncertain/">abandoned</a> .  But it should be remembered for the reason that it is perhaps the most well-known free static analyzer of Java code. <br><br>  The successor to FindBugs is the <a href="https://spotbugs.github.io/">SpotBugs</a> project.  However, it is less popular, and what will happen to it is also not entirely clear. <br><br>  In general, we believe that although FindBugs has been and remains extremely popular, and besides, also a free analyzer, we should not think about it.  This project is just a quiet and calm thing of the past. <br><br>  PS By the way, now PVS-Studio can also be <a href="https://www.viva64.com/ru/b/0600/">used for free</a> when working with open source projects. <br><br>  <b>SonarQube (SonarJava)</b> <br><br>  We believe that we do not compete with SonarQube, but supplement it.  PVS-Studio integrates with SonarQube, which allows developers to find more errors and potential vulnerabilities in their projects.  How to integrate the tool PVS-Studio and other analyzers into SonarQube, we regularly tell at master classes that we hold at various conferences ( <a href="https://youtu.be/JXTNBbOAzjc">example</a> ). <br><br><h2>  How to run PVS-Studio for Java </h2><br>  We have made available to users the most popular ways to integrate the analyzer into the build system: <br><br><ul><li>  Plugin for maven; </li><li>  Plugin for gradle; </li><li>  Plugin for IntelliJ IDEA </li></ul><br>  At the testing stage, we met many users who had self-written assembly systems, especially in mobile development.  They liked the ability to run the analyzer directly, listing the source code and the classpath. <br><br>  You can find detailed information on all methods of launching the analyzer on the " <a href="https://www.viva64.com/ru/m/0044/">How to run PVS-Studio Java</a> " documentation page. <br><br>  We could not ignore the <a href="https://www.sonarqube.org/">SonarQube</a> code quality control platform, which is so popular among Java developers, so we added Java language support to our <a href="https://www.viva64.com/ru/m/0037/">SonarQube plugin</a> . <br><br><h2>  Future plans </h2><br>  We have a lot of ideas that require additional study, but some plans characteristic of any of our analyzers look like this: <br><br><ul><li>  Creation of new diagnostics and refinement of existing ones; </li><li>  The development of dataflow analysis; </li><li>  Increase reliability and ease of use. </li></ul><br>  Perhaps we will find time to adapt IntelliJ IDEA plugin for CLion.  Hello C ++ developers reading about Java analyzer :-) <br><br><h2>  Examples of errors found in open source projects. </h2><br>  I will not be me if I do not show in the article any errors found using the new analyzer.  It would be possible to take some large open Java project and write a classic article with an analysis of errors, as we <a href="https://www.viva64.com/ru/inspections/">usually do</a> . <br><br>  However, I immediately anticipate questions, and can we find something in projects such as IntelliJ IDEA, FindBugs, and so on.  Therefore, I simply have no way out, and I will start with these projects.  So, I decided to quickly check and write out some interesting examples of errors from the following projects: <br><br><ul><li>  <a href="https://github.com/JetBrains/intellij-community">IntelliJ IDEA Community Edition</a> .  I think it is not necessary to explain why this project was chosen :). </li><li>  <a href="https://github.com/spotbugs/spotbugs">SpotBugs</a> .  As I wrote earlier, the FindBugs project does not develop.  Therefore, let's take a look at the SpotBugs project, which is the successor to FindBugs.  SpotBugs is a classic static Java code analyzer. </li><li>  Some of the projects of the company SonarSource, which develops software for continuous code quality control.  Let's look at the <a href="https://github.com/SonarSource/sonarqube">SonarQube</a> and <a href="https://github.com/SonarSource/sonar-java">SonarJava project</a> . </li></ul><br>  To write about bugs in these projects is a difficult task.  The fact is that these projects are very high quality.  Actually, this is not surprising.  As our observations show, the code of static analyzers is always well tested and tested using other tools. <br><br>  Despite all this, I have to start with these projects.  I won't have a second chance to write something about them.  I am sure that after the release of PVS-Studio for Java, the developers of the listed projects will use PVS-Studio and start using it for regular or, at least, for periodic checks of their code.  For example, I know that Tagir Valeev ( <a href="https://habr.com/en/users/lany/" class="user_link">lany</a> ), one of the developers of JetBrains, who is engaged in the static code analyzer IntelliJ IDEA, while I write an article, is already playing with the Beta version of PVS-Studio.  He has already written to us about 15 letters with bug reports and recommendations.  Thank you, Tagir! <br><br>  Fortunately, I do not need to find as many errors as possible in one particular project.  Now my task is to show that the PVS-Studio analyzer for Java did not appear in vain and will be able to replenish the range of other tools designed to improve the quality of the code.  I just skimmed through the analyzer reports and wrote out a few errors that seemed interesting to me.  If possible, I tried to write out errors of different types.  Let's see what happened. <br><br><h3>  IntelliJ IDEA, integer division </h3><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSentenceCapitalization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull String value)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;String&gt; words = StringUtil.split(value, <span class="hljs-string"><span class="hljs-string">" "</span></span>); .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> capitalized = <span class="hljs-number"><span class="hljs-number">1</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> capitalized / words.size() &lt; <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// allow reasonable amount of // capitalized words }</span></span></code> </pre> <br>  PVS-Studio warning: V6011 [CWE-682] The '0.2' literal of the 'double' type is compared to the value of the 'int' type.  TitleCapitalizationInspection.java 169 <br><br>  As intended, the function should return true if less than 20% of words begin with a capital letter.  In fact, verification does not work, since integer division occurs.  As a result of the division, only two values ‚Äã‚Äãcan be obtained: 0 or 1. <br><br>  The function returns a false value only if all words begin with a capital letter.  In all other cases, the division will result in 0, and the function will return the true value. <br><br><h3>  IntelliJ IDEA, suspicious loop </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPreviousIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> current)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = myPainter.getErrorStripeCount(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> foundIndex = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> foundLayer = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= current &amp;&amp; current &lt; count) { current--; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = count - <span class="hljs-number"><span class="hljs-number">1</span></span>; index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; index++) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= int layer = getLayer(index); if (layer &gt; foundLayer) { foundIndex = index; foundLayer = layer; } } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V6007 [CWE-571] Expression 'index&gt; = 0' is always true.  Updater.java 184 <br><br>  First look at the condition <i>(0 &lt;= current &amp;&amp; current &lt;count)</i> .  It is executed only if the value of the variable <i>count is</i> greater than 0. <br><br>  Now look at the cycle: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = count - <span class="hljs-number"><span class="hljs-number">1</span></span>; index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; index++)</code> </pre> <br>  The <i>index</i> variable is initialized by the expression <i>count - 1</i> .  Since the <i>count</i> variable is greater than 0, the initial value of the <i>index</i> variable is always greater than or equal to 0. It turns out that the loop will be executed until the <i>index</i> variable overflows. <br><br>  Most likely, this is just a typo and should be done not increment, but decrement of the variable: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = count - <span class="hljs-number"><span class="hljs-number">1</span></span>; index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; index--)</code> </pre> <br><h3>  IntelliJ IDEA, Copy-Paste </h3><br><pre> <code class="cpp hljs">@NonNls <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final String BEFORE_STR_OLD = <span class="hljs-string"><span class="hljs-string">"before:"</span></span>; @NonNls <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> final String AFTER_STR_OLD = <span class="hljs-string"><span class="hljs-string">"after:"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isBeforeOrAfterKeyword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str, boolean trimKeyword)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (trimKeyword ? LoadingOrder.BEFORE_STR.trim() : LoadingOrder.BEFORE_STR).equalsIgnoreCase(str) || (trimKeyword ? LoadingOrder.AFTER_STR.trim() : LoadingOrder.AFTER_STR).equalsIgnoreCase(str) || LoadingOrder.BEFORE_STR_OLD.equalsIgnoreCase(str) || <span class="hljs-comment"><span class="hljs-comment">// &lt;= LoadingOrder.BEFORE_STR_OLD.equalsIgnoreCase(str); // &lt;= }</span></span></code> </pre> <br>  PVS-Studio Warning: V6001 [CWE-570] There are identical sub-expressions 'LoadingOrder.BEFORE_STR_OLD.equalsIgnoreCase (str)' to the left |  operator.  Check lines: 127, 128. ExtensionOrderConverter.java 127 <br><br>  Good old <a href="https://www.viva64.com/ru/b/0260/">effect of the last line</a> .  The programmer hurried and, having multiplied a line of code, forgot to fix it.  As a result, twice the string <i>str is</i> compared with <i>BEFORE_STR_OLD</i> .  Most likely, one of the comparisons should be with <i>AFTER_STR_OLD</i> . <br><br><h3>  IntelliJ IDEA, typo </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> synchronized boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull String name, final Project project)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!StringUtil.startsWithChar(name,<span class="hljs-string"><span class="hljs-string">'\''</span></span>) &amp;&amp; !StringUtil.startsWithChar(name,<span class="hljs-string"><span class="hljs-string">'\"'</span></span>)) { name = <span class="hljs-string"><span class="hljs-string">"\""</span></span> + name; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!StringUtil.endsWithChar(name,<span class="hljs-string"><span class="hljs-string">'"'</span></span>) &amp;&amp; !StringUtil.endsWithChar(name,<span class="hljs-string"><span class="hljs-string">'\"'</span></span>)) { name += <span class="hljs-string"><span class="hljs-string">"\""</span></span>; } .... }</code> </pre> <br>  PVS-Studio Warning: V6001 [CWE-571] There are identical sub-expressions '! StringUtil.endsWithChar (name,' "')' operator. JsonNamesValidator.java 27 <br><br>  This code snippet verifies that the name is in single or double quotes.  If this is not the case, double quotes are added automatically. <br><br>  Because of a typo, the ending of the name is checked only for the presence of double quotes.  As a result, the name taken in single quotes will be processed incorrectly. <br><br>  Name <br><br><pre> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'Abcd'</span></span></code> </pre> <br>  due to the addition of extra double quotes will turn into: <br><br><pre> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">'Abcd'</span></span><span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br><h3>  IntelliJ IDEA, incorrect protection against array overrun </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = offset; i &lt; endOffset; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = text.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> &amp;&amp; i &lt; endOffset &amp;&amp; text.charAt(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; startTag != null &amp;&amp; CharArrayUtil.regionMatches(text, i + <span class="hljs-number"><span class="hljs-number">2</span></span>, endOffset, startTag)) { endTagStartOffset = i; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } .... }</code> </pre> <br>  PVS-Studio warning: V6007 [CWE-571] Expression 'i &lt;endOffset' is always true.  EnterAfterJavadocTagHandler.java 183 <br><br>  The subexpression <i>i &lt;endOffset</i> in the condition of the <i>if statement</i> does not make sense.  The variable <i>i</i> is always less than <i>endOffset</i> , which follows from the condition of the loop. <br><br>  Most likely, the programmer wanted to protect himself from going over the line boundary when calling functions: <br><br><ul><li>  text.charAt (i + 1) </li><li>  CharArrayUtil.regionMatches (text, i + 2, endOffset, startTag) </li></ul><br>  In this case, the subexpression to check the index should be: <i>i &lt;endOffset - 2</i> . <br><br><h3>  IntelliJ IDEA, duplicate check </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateWarningMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { buffer.append(<span class="hljs-string"><span class="hljs-string">" "</span></span>).append( IdeBundle.message(<span class="hljs-string"><span class="hljs-string">"prompt.delete.and"</span></span>)).append(<span class="hljs-string"><span class="hljs-string">" "</span></span>); } } .... }</code> </pre> <br>  PVS-Studio warning: V6007 [CWE-571] Expression 'buffer.length ()&gt; 0' is always true.  DeleteUtil.java 62 <br><br>  This can be a harmless redundant code, as well as a serious error. <br><br>  If the duplicate check appeared by chance, for example, during refactoring, then there is nothing wrong with that.  The second check can simply be deleted. <br><br>  But another scenario is possible.  The second check should be completely different and the code behaves differently than intended.  Then this is a real mistake. <br><br>  <b>Note.</b>  By the way, there are a lot of different redundant checks.  And often it is clear that this is not a mistake.  However, it is also impossible to call analyzer messages with false positives.  For clarification, here is an example, also taken from IntelliJ IDEA: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isMultiline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ String text = element.getText(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text.contains(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) || text.contains(<span class="hljs-string"><span class="hljs-string">"\r"</span></span>) || text.contains(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); }</code> </pre> <br>  The analyzer says that the <i>text.contains ("\ r \ n")</i> function always returns false.  And indeed, if the symbol "\ n" and "\ r" are not found, then there is no point in searching for "\ r \ n".  This is not an error, and the code is bad only because it works a little slower, performing a meaningless search for a substring. <br><br>  How to deal with such code, in each case, it is up to the programmers to decide.  When writing articles, as a rule, I simply do not pay attention to such code. <br><br><h3>  IntelliJ IDEA, something is wrong </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">satisfiedBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ .... @NonNls final String text = expression.getText().replaceAll(<span class="hljs-string"><span class="hljs-string">"_"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text == null || text.length() &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"0"</span></span>.equals(text) || <span class="hljs-string"><span class="hljs-string">"0L"</span></span>.equals(text) || <span class="hljs-string"><span class="hljs-string">"0l"</span></span>.equals(text)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>) == <span class="hljs-string"><span class="hljs-string">'0'</span></span>; }</code> </pre> <br>  PVS-Studio warning: V6007 [CWE-570] Expression '"0". Equals (text)' is always false.  ConvertIntegerToDecimalPredicate.java 46 <br><br>  This code accurately contains a logical error.  But I find it difficult to say what the programmer wanted to check, and how to correct the flaw.  Therefore, here I just point out the meaningless check. <br><br>  In the beginning, it is checked that the string must contain at least two characters.  If not, the function returns <i>false</i> . <br><br>  Next comes the <i>‚Äú0‚Äù .equals (text)</i> check.  It is meaningless, since a string cannot contain only one character. <br><br>  In general, something is wrong here and the code should be corrected. <br><br><h3>  SpotBugs (FindBugs successor), iteration limit error </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getXMLType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@WillNotClose InputStream in)</span></span></span><span class="hljs-function"> throws IOException </span></span>{ .... String s; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (count &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { s = r.readLine(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s == null) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Matcher m = tag.matcher(s); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Didn't find xml tag"</span></span>); .... }</code> </pre> <br>  PVS-Studio warning: V6007 [CWE-571] Expression 'count &lt;4' is always true.  Util.java 394 <br><br>  As planned, the search for the xml tag should be carried out only in the first four lines of the file.  But because you forgot to increment the <i>count</i> variable, the entire file will be read. <br><br>  Firstly, it can be a very slow operation, and secondly, somewhere in the middle of the file, something can be found that will be perceived as an xml tag, but it will not be one. <br><br><h3>  SpotBugs (FindBugs successor) mashing values </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reportBug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> priority = LOW_PRIORITY; String pattern = <span class="hljs-string"><span class="hljs-string">"NS_NON_SHORT_CIRCUIT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sawDangerOld) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sawNullTestVeryOld) { priority = HIGH_PRIORITY; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } if (sawMethodCallOld || sawNumericTestVeryOld &amp;&amp; sawArrayDangerOld) { priority = HIGH_PRIORITY; // &lt;= pattern = "NS_DANGEROUS_NON_SHORT_CIRCUIT"; } else { priority = NORMAL_PRIORITY; // &lt;= } } bugAccumulator.accumulateBug( new BugInstance(this, pattern, priority).addClassAndMethod(this), this); }</span></span></code> </pre> <br>  PVS-Studio warning: V6021 [CWE-563] The variable is assigned but it is not used.  FindNonShortCircuit.java 197 <br><br>  The value of the <i>priority</i> variable is set depending on the value of the <i>sawNullTestVeryOld</i> variable.  However, this does not play any role.  Next, the <i>priority</i> variable will be assigned a different value in any case.  Explicit error in the logic of the function. <br><br><h3>  SonarQube, Copy-Paste </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuleDto</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final RuleDefinitionDto definition; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final RuleMetadataDto metadata; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUpdatedAtFromDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable Long updatedAt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatedAt != null &amp;&amp; updatedAt &gt; definition.getUpdatedAt()) { setUpdatedAt(updatedAt); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUpdatedAtFromMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable Long updatedAt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatedAt != null &amp;&amp; updatedAt &gt; definition.getUpdatedAt()) { setUpdatedAt(updatedAt); } } .... }</code> </pre> <br>  PVS-Studio: V6032 It is odd that the body of the method 'setUpdatedAtFromDefinition' is fully equivalent to the body of another method 'setUpdatedAtFromMetadata'.  Check lines: 396, 405. RuleDto.java 396 <br><br>  The <i>setUpdatedAtFromMetadata</i> method uses the <i>definition</i> field.  Most likely, the <i>metadata</i> field should be used.  This is very similar to the consequences of an unsuccessful copy-paste. <br><br><h3>  SonarJava, duplicates when initializing a Map </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> final Map&lt;JavaPunctuator, Tree.Kind&gt; assignmentOperators = Maps.newEnumMap(JavaPunctuator.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KindMaps</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... assignmentOperators.put(JavaPunctuator.PLUSEQU, Tree.Kind.PLUS_ASSIGNMENT); .... assignmentOperators.put(JavaPunctuator.PLUSEQU, Tree.Kind.PLUS_ASSIGNMENT); .... }</code> </pre> <br>  PVS-Studio warning: V6033 [CWE-462] An item with the same key 'JavaPunctuator.PLUSEQU' has already been added.  Check lines: 104, 100. KindMaps.java 104 <br><br>  Twice the same key-value pair is placed on the map.  Most likely, this was due to carelessness, and in fact there is no real error.  However, this code needs to be checked in any case, as you may have forgotten to add some other pair. <br><br><h2>  Conclusion </h2><br>  What conclusion can there be?  I invite everyone, without delay, to download PVS-Studio and try to test your work projects in the Java language!  <a href="https://www.viva64.com/ru/pvs-studio-download/">Download PVS-Studio</a> . <br><br>  Thank you all for your attention.  Hopefully, soon we will please readers with a series of articles devoted to testing various open Java projects. <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/436496/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="https://habr.com/en/company/pvs-studio/blog/436496/">PVS-Studio for Java</a> . </div><p>Source: <a href="https://habr.com/ru/post/436434/">https://habr.com/ru/post/436434/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>