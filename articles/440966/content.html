<div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  KELLER manufactures high-precision sensors with digital output that connect to proprietary software for display and accumulation of readings.  Often, the user needs to integrate sensors into their own monitoring and control systems.  In this paper, using the example of the high-precision pressure sensor PR-33X, shows the connection of KELLER sensors to the integrated environment MATLAB, originally developed for the analysis and synthesis of control systems, which has powerful means of processing and displaying signal data. <br><a name="habracut"></a><br><h4>  Brief specification of the pressure transmitter KELLER PR 33X </h4><br>  Standard pressure range (VPI), bar 30 <br>  Accuracy of pressure measurement, total (10 ... 40 ° C) 0.025% VPI <br>  RS 485 output <br>  Baud rate 9600 or 115200 baud <br>  Power supply (U) 8 ... 28 V <br>  Service life 10 million cycles 0 ... 100% VPI <br><br>  The pressure transmitter contains an integrated temperature sensor. <br><br><h4>  Interface </h4><br>  All KELLER products with an X index have a digital interface (RS485 half duplex) that supports MODBUS RTU and Keller Bus protocols. <br><br>  Connecting to a PC via RS485-USB converter.  For best compatibility, the company recommends using a K-114 Keller converter. <br><br><h4>  Software </h4><br>  To set up and record sensor readings, the CCS30 free software is used, the interface of which is shown in Figure 1. <br><br><img src="https://habrastorage.org/webt/qd/ca/ww/qdcawwuuj6n5zteyx9qs_-etfw0.png" alt="image"><br>  <i>Figure 1. The accumulation and display of graphical and tabular data program CCS30 [3].</i> <br><br><h4>  PC connection </h4><br>  The pressure sensor PR-33X was connected to a PC using a USB to RS-232/422/485 MOXA USB Serial Port converter as shown in Figure 2. <br><br><img src="https://habrastorage.org/webt/wj/k2/8k/wjk28kdvauynmdd1mt2bxydhaug.png" alt="image"><br>  <i>Figure 2. Connection diagram of the pressure transmitter PR-33X to a PC and a power source of 12 V. When the power supply is below 5.69 V (up to 4.95 V), the sensor reading increases.</i>  <i>When power is below 4.95V, data is not transmitted (the sensor does not work).</i> <i><br></i> <br>  After installing the driver and attaching the MOXA converter to the PC, the COM port appears in the device manager list <img src="https://habrastorage.org/webt/db/ap/gb/dbapgbkmdsirmyl28bf9id2e_me.png" alt="image">  and adapter <img src="https://habrastorage.org/webt/mp/e7/o9/mpe7o9-ma6cn4t9joga00ad_p4a.png" alt="image">  .  The tab (Figure 3) of the last device for our option is RS-485 interface with a two-wire connection scheme. <br><br><img src="https://habrastorage.org/webt/e9/su/ts/e9sutsxhtioee0cqdw3rpb7sbx8.png" alt="image"><br>  <i>Figure 3. Configuring MOXA converter for RS-485 2W interface.</i> <br><br><h4>  Transmitted Data Formats </h4><br>  Data exchange between the computer (control device) and the sensor (slave device) is carried out via the Modbus protocol with messages containing the following fields [2]. <br><br><img src="https://habrastorage.org/webt/ma/db/p2/madbp2igvgcyyvmssrwpamy5m0o.png" alt="image"><br><br>  First, the computer sends a request-message to the sensor, then the sensor responds with its own message with its own checksum if the requested action is successfully completed or sends a function with code 1 when an error occurs (invalid function or data address, etc.). <br><br>  The response (response) of the sensor is issued only after receiving a request from the control device. <br><br>  The message transmitted to the sensor contains one of the following function codes. <br><br><img src="https://habrastorage.org/webt/sv/sb/6g/svsb6gtzunibtama_gdsekxawmk.png" alt="image"><br><br><img src="https://habrastorage.org/webt/lu/en/tx/luentxuvrnxv2-7qqmxqqeynsv4.png" alt="image"><br>  <i>Figure 4. Format of transmitted and received messages according to the Modbus RTU standard [1].</i> <br><br><h4>  Addresses of the used registers of the PR-33X sensor </h4><br><img src="https://habrastorage.org/webt/8g/q7/9m/8gq79mcfhuhovo-kiv28pqgsnri.png" alt="image"><br><br><h4>  Examples of Modbus messages (reading from the built-in pressure and temperature sensor) [2] </h4><br><img src="https://habrastorage.org/webt/md/xn/8y/mdxn8y7cfqgzcncf4jfqd61sno8.png" alt="image"><br><br><h4>  Converting sensor readings to IEEE754 floating point format </h4><br>  The recommended procedure for converting four received bytes of the sensor to a floating-point number is shown in Figure 5. The example uses the data [2] given in the table above. <br><br><img src="https://habrastorage.org/webt/z5/y8/fr/z5y8frjr3loceltk8uyyxaq0qtk.png" alt="image"><br>  <i>Figure 5. Rules for converting a four-byte sensor reading to a floating point number.</i> <br><br><h4>  The MATLAB program for reading and displaying pressure sensor and temperature sensors of the PR-33X converter </h4><br>  The PR-33X sensor reading and displaying program includes the main module and three subroutines.  The converter operates at a frequency of 115200 baud.  These pressures and temperatures are read by their own requests. <br><br>  The input data of the program are the COM port of your device (variable Com_Port =) and the address of your converter.  If only one converter is connected, then, as a rule, Device_Addr = 1. <br><br>  The number of readings is given by the constant Loop (in the example Loop = 1000;). <br><br>  The main module: <br><br><pre><code class="matlab hljs">clear all; <span class="hljs-comment"><span class="hljs-comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Input data %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Com_Port = 'COM9'; Device_Addr = 1; % Address of Sensor, 8 bit: 1..255 Function = 3; % 3 or 4 is read; Pr_Rg_Addr = 2; % First address of two pressure data registers (4 bytes) Temp_Rg_Addr = 8; % First address of two temperature data registers Address_Range = 2; % Range of data address %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % End of Input data %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Make COM port connection s=serial(Com_Port,'Baudrate',115200); % 9600 115200 fopen (s); pause(0.1); Loop = 1000; pr(1:Loop) = 0; temp(1:Loop) = 0; for i = 1:Loop %%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Read pressure %%%%%%%%%%%%%%%%%%%%%%%%%%%%% RTU_request = RTU_code(Device_Addr,Function,Pr_Rg_Addr,Address_Range); fwrite(s, RTU_request); %pause(0.01); % &gt;=0.001s for PR-33X, for 115200 Baudrate while ~(get(s,'BytesAvailable')&gt;8) end BytesAvailable = get(s,'BytesAvailable'); Rx = fread(s,BytesAvailable)'; pr(i) = sensorOUT_to_float(Rx); % in bar %%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Read temperature %%%%%%%%%%%%%%%%%%%%%%%%%%%%% RTU_request = RTU_code(Device_Addr,Function,Temp_Rg_Addr,Address_Range); fwrite(s, RTU_request); while ~(get(s,'BytesAvailable')&gt;8) end BytesAvailable = get(s,'BytesAvailable'); % if BytesAvailable &gt; 0 Rx = fread(s,BytesAvailable)'; temp(i) = sensorOUT_to_float(Rx); % in bar end % Close COM port fclose (s); delete (s); figure (3) clf('reset'); % Clear current figure window [AX,H1,H2] = plotyy (1:length(pr),pr,1:length(temp),temp); hold(AX(1)); hold(AX(2)); set(H1,'LineWidth',2); grid(AX(2),'on'); xlabel('Sampling, num'); % Y1_max = max(get(AX(1),'ytick')); % set(AX(1),'ytick',[0:Y1_max/10:Y1_max]); % set(AX(2),'ytick',[0:0.2:2]); set(get(AX(1),'Ylabel'),'String','Давление, бар'); set(get(AX(2),'Ylabel'),'String','Температура, град. С'); title(sprintf('Изменение давления и температуры')); % End of m file</span></span></code> </pre> <br><h4>  Subprogramming the Modbus RTU request </h4><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RTU_request</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RTU_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Device_Addr,Function,Data_First_Address,Address_Range)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Device_Addr</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Device</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Address</span></span></span><span class="hljs-function"> 8 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function">: 1..255 % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function</span></span></span><span class="hljs-function"> == % 3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> 4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-function">; 6 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">one</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-function">; 16 - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">two</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registers</span></span></span><span class="hljs-function">, % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Data_First_Address</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Address</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2 bytes)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Addrress_Range</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Range</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Addreses</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Data_First_Address_Bytes</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[floor(Data_First_Address/256) rem(Data_First_Address,256)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Address_Range_Bytes</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[floor(Address_Range/256) rem(Address_Range,256)]</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Master</span></span></span><span class="hljs-function">'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Device_Addr Function Data_First_Address_Bytes Address_Range_Bytes]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2hex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Code)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Code_Char,2)</span></span></span><span class="hljs-function">==1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,2)</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1)</span></span></span><span class="hljs-function">='0'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char_line</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Code)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Code_Char_line</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Code_Char_line Code_Char(I,1:2)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculation</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check_Sum</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crc_calculator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Code_Char_line)</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Master</span></span></span><span class="hljs-function">'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RTU_request</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Code hex2dec(Check_Sum(1:2)) hex2dec(Check_Sum(3:4))]</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">End</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span></span></code> </pre> <br><h4>  The routine for calculating the Modbus RTU checksum sequence </h4><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output_hex_string</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crc_calculator</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input_hex)</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Input_hex</span></span></span><span class="hljs-function"> = '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F70302640008</span></span></span><span class="hljs-function">'; % &lt;= 2 * 16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor_constant</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input_hex)</span></span></span><span class="hljs-function"> / 2; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> ~</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i &gt; length (Input_hex)</span></span></span><span class="hljs-function">/2) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A_hex</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Input_hex</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((i-1)</span></span></span><span class="hljs-function">*2+1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">*2); % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Two</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HEX</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bytes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A_bin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2bin</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hex2dec (A_hex)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length_A_bin</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A_bin)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 0 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length_A_bin</span></span></span><span class="hljs-function"> - 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(16 - j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">str2num</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A_bin (length_A_bin - j)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(F,A)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ii</span></span></span><span class="hljs-function"> = 1 : 8 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(16)</span></span></span><span class="hljs-function"> ==1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor_constant</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> == 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 2 : 16; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xor_constant</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(j)</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(j-1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(j)</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(j)</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">circshift</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(F',1)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">F_shift</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">num2str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(F)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1:3:length(h)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output_hex_string</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">num2str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([dec2hex(bin2dec(h(9:12)</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2hex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bin2dec(h(13:16)</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2hex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bin2dec(h(1:4)</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2hex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bin2dec(h(5:8)</span></span></span><span class="hljs-function">))]); % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">End</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span></span></code> </pre> <br><h4>  Subroutine for converting four bytes of the sensor to a floating point </h4><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% Transmission Sensor's output bytes to float value function val = sensorOUT_to_float(Rx) B(1) = Rx(4); B(2) = Rx(5); B(3) = Rx(6); B(4) = Rx(7); %1 bit of sign + 8 bits of exponent + 23 bits of mantis ( = 32 bits or 4x8 bytes) v_res = []; for i = 1:4 v_bit = dec2bin(B(i)); if length(v_bit)&lt;8 % add zeros to get 8 bits for j = 1:(8-length(v_bit)) v_bit = ['0' v_bit]; end end v_res = [v_res v_bit]; end % Checking % v_res = ['0' '10000010' '01010010000001011011110'] == 10.5631999969482421875 бар s_mnt = bin2dec(v_res(1)); %sign of mantis E = bin2dec(v_res(2:9)); %exponent M = bin2dec(v_res(10:32)); % mantis if s_mnt==0 val = (1+M/8388608)*2^(E-127); % 8388608 = 2^23 else val = -(1+M/8388608)*2^(E-127); end % End of m file</span></span></code> </pre> <br>  Examples of graphical displays of pressure and temperature of the PR-33X converter, read by the above program, are shown in Figure 6. <br><br><img src="https://habrastorage.org/webt/gn/ka/dg/gnkadggonbqacsoh735yjlaiz5m.png" alt="image"><br>  <i>Figure 6. PR-33X converter output data obtained by the program developed in MATLAB.</i>  <i>The program reads 1000 pressure readings at a speed of 115200 baud in 9 seconds.</i>  <i>The program reads 1000 pressure readings and 1000 temperature readings (separately) at a speed of 115200 baud in 17 seconds.</i> <br><br><h4>  Program MATLAB switching speed data transfer converter </h4><br>  To switch to a new frequency, you need to set the program's COM port address of your device (variable Com_Port =) and the required frequency of the converter (BR_Rate = 9600; or BR_Rate = 115200;) <br><br>  ATTENTION.  To switch to the new data transmission frequency after setting the zero bit of the register of the UART converter, you must turn OFF (de-energize) and then turn ON the converter again. <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% ПЕРЕХОД НА НОВУ СКОРОСТЬ ОБМЕНА (9600 ИЛИ 115200 БОД) ВЫПОЛНЯЕТСЯ ПОСЛЕ УСТАНОВКИ UART РЕГИСТРА И ВЫКЛЮЧЕНИЯ-ВКЛЮЧЕНИЯ ПРЕОБРАЗОВАТЕЛЯ clear all; % Input data Com_Port = 'COM9'; BR_Rate = 115200; % 9600 or 115200 % End of Input data % Device_Addr = 1; % Address of Sensor, 8 bit: 1..255 % Function = 6; % Write; % UART_Rg_Addr = 512; % First address of UART Rg (2 bytes) % Data = 0 0; % Rate 9600 bod % Data = 0 1; % Rate 115200 bod % RTU_request = [Device_Addr Function UART_Rg_Addr Data Check_sum] % RTU_request = [ 1 6 2 0 0 0 136 114]; % 9600 bod request in hex % RTU_request = [ 1 6 2 0 0 1 73 178]; % 115200 bod request in hex if BR_Rate == 9600 % 115200 s=serial(Com_Port,'Baudrate',115200); fopen (s); pause(0.1); RTU_request =[ 1 6 2 0 0 0 136 114]; else s=serial(Com_Port,'Baudrate',9600); fopen (s); pause(0.1); RTU_request = [ 1 6 2 0 0 1 73 178]; end fwrite(s, RTU_request); pause(0.004); % &gt;=0.001s for PR-33X, for 115200 Baudrate BytesAvailable = get(s,'BytesAvailable'); if BytesAvailable &gt; 0 Rx = fread(s,BytesAvailable)' end % close COM port fclose (s); delete (s); % End of m file</span></span></code> </pre> <br><h4>  Bibliographic list </h4><br><ol><li>  Dr.  Bob Davidov.  Communication with devices of industrial networks.  <a href="http://portalnp.ru/wp-content/uploads/2013/08/12.02_Discrete-IO-unit_-MK110-_RS-485-ModBus-RTU-_-ASCII-DCON-OVEN__Ed3.pdf">portalnp.ru/wp-content/uploads/2013/08/12.02_Discrete-IO-unit_-MK110-_RS-485-ModBus-RTU-_ASCII-DCON-OVEN__Ed3.pdf</a> </li><li>  Description of communication protocols.  For pressure transducers KELLER 30th and 40th series.  Class.Group = 5.20 Class.Group = 5.21.  Version 3.2 (in Russian).  <a href="http://www.izmerkon.ru/">www.izmerkon.ru</a> . </li><li>  Control Center Series 30. User Guide.  Für CCS30 Version 1.1.  <a href="http://www.izmerkon.ru/">www.izmerkon.ru</a> </li><li>  Dr.  Bob Davidov.  Computer control technologies in <a href="http://portalnp.ru/author/bobdavidov">portalnp.ru/author/bobdavidov</a> technical systems </li></ol></div>