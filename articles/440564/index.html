<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GPT-2 neural network from OpenAI. Fast start</title>
  <meta name="description" content="The news about the BERT neural network from Google, which showed state-of-the-art results on a number of conversational (NLP) tasks in machine learnin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>GPT-2 neural network from OpenAI. Fast start</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/1cf/d63/ae6/1cfd63ae6b68d59325ef90cc4ea93f35.png" alt="image"></p><br><p>  The news about the BERT neural network from Google, which showed state-of-the-art results on a number of conversational (NLP) tasks in machine learning, did not have time to make noises like OpenAI rolled out a new development: GPT-2.  This neural network with a record number of parameters at the moment (1.5 billion, versus 100‚Äì300 million usually used in such cases) was able to generate entire pages of connected text. </p><br><p>  It is so good to generate that in OpenAI they refused to upload the full version, fearing that this neural network will be used to create fake news, comments and reviews that are indistinguishable from the real ones. </p><br><p>  However, in OpenAI, a smaller version of the GPT-2 neural network was shared with 117 million parameters.  That is what we will run through the service of Google Colab and experiment with it. </p><a name="habracut"></a><br><h1 id="nemnogo-predystorii">  A bit of background </h1><br><p>  For those who have not watched the progress in the processing of natural speech (NLP). </p><br><p>  In the summer of 2018, OpenAI pre-trained on a large amount of text the <a href="https://blog.openai.com/language-unsupervised/">GPT</a> neural network built on the Transformer architecture.  It turned out that if you replace a couple of the last layers and train it for a specific task (this approach is called Fine Tuning and is widely used in machine learning), then it beats previous records at once in a wide range of conversational tasks. </p><br><p>  Based on this development, at the end of 2018, Google created its own <a href="https://ai.googleblog.com/2018/11/open-sourcing-bert-state-of-art-pre.html">BERT</a> neural network.  They seriously improved the result by making the neural network bidirectional, unlike GPT. </p><br><p>  Not wanting to give up, in February 2019 at OpenAI they increased their GPT 10 times at once and trained it on an even larger amount of text - on 8 million web pages (totaling 40 GB of text).  The resulting <a href="https://blog.openai.com/better-language-models/">GPT-2</a> network is currently the largest neural network, with an unprecedented number of parameters of 1.5 billion (the BERT in the largest model was 340 million, and the standard BERT 110 million). </p><br><p>  As a result, GPT-2 was able to generate entire pages of connected text.  With repeated references to the names of the characters in the course of the story, quotes, references to related events, and so on.  I will not give examples here, but referring those wishing to the original article on the OpenAI blog: <a href="https://blog.openai.com/better-language-models/">Better Language Models and Their Implications</a> . </p><br><p>  Generating a coherent text of this quality is impressive in itself, but the most interesting thing here is different.  GPT-2 without any additional training immediately showed results close to state-of-the-art on a number of conversational tasks.  I repeat, who missed the importance of the moment - without any additional training for the concrete task! </p><br><p>  How did they do it?  Just asking the neural network the right questions. </p><br><h1 id="arhitektura-gpt-2">  GPT-2 architecture </h1><br><p>  GPT-2 is trained to predict the next word in a sentence.  This is a classic approach for generating text.  First, the palm in this area was held by recurrent (RNN) networks, in particular, LSTM.  But after the invention of the <a href="https://arxiv.org/abs/1706.03762">Transformer</a> architecture in the summer of 2017, it gradually became prevalent in conversational tasks.  Although the original Transformer has a problem with remembering long sequences (LSTM remember longer ones), but the speed of learning and the depth of the network more than compensated for this.  By the way, a number of modifications of the transformer have already appeared - with the introduction of recurrence into it ( <a href="https://arxiv.org/abs/1807.03819">Universal Transformers</a> ), modification for longer sequences ( <a href="https://arxiv.org/abs/1901.02860">Transformer-XL</a> ) and others, but so far only slightly tuned original Transformer is used in Google and OpenAI. </p><br><p>  BERT from Google, I remind you, was learning a little differently: to predict not the next word in the sentence, but the missing (masked) words in the sentence.  And also to determine whether two consecutive sentences are a logical continuation of each other, or they are in no way related to each other in meaning.  This allowed BERT to be a language model that understands the meaning of words depending on their environment (context).  Which determined the success of BERT in NPL tasks.  But only after training (Fine Tuning) for a specific task.  Just the prediction of words in the basic model does not work very well.  You can play with BERT in the browser (via Google Colab): <a href="https://habr.com/ru/post/436878/">https://habr.com/ru/post/436878</a> . </p><br><p>  GPT-2 do not need additional training.  This is not just a language model like BERT, it is a text generator.  Just give her the beginning of the phrase to the input, and then she will add her word by word. </p><br><p>  An interesting detail: OpenAI research has shown that the arrays of Wikipedia texts and literary books (in which BERT studied, in particular) have a biased style.  Therefore, neural networks trained only on them do not generate text very well.  To diversify the input data and styles, OpenAI used regular web pages for learning GPT-2, collected from 8 million sites (a total of 40 GB of text).  And in order to discard advertising and spam sites, they included in the sample sites, links to which in the reddit have a good rating.  That is, sites that live users found contain some useful information. </p><br><h1 id="pravilnyy-vopros-soderzhit-polovinu-otveta">  The correct question contains half the answer. </h1><br><p>  So, GPT-2, due to its unprecedented size, was able to generate pages of connected text.  But the most surprising thing is that by asking her the right question (that is, the correct beginning of the phrase), she was able to answer various questions!  Just because the continuation of this beginning is the most natural. </p><br><p>  For example, to get an answer to the question "What is Earth?", You can apply the beginning of the phrase: "Earth is ..." to the input of this neural network.  And she will add this phrase to the end.  Because the answer will be a natural continuation of such a beginning. </p><br><p>  Moreover, forming the beginning of the phrase in the right way, you can get explanations for different target audiences, taking into account their intelligence, age and education.  Imagine continuing the phrases: "I, as a scientist, believe that the Earth is ...".  Or "I, as a landowner, claim that the Earth is ...".  Or: "I, being a kindergarten teacher, now I will explain to you, children, that the Earth is ...". </p><br><p>  As you can see, by forming the right questions (the right beginning of a phrase), you can get answers of completely different levels and different details.  In some ways, the same happens in humans.  The doctor must explain to the patient the course of the disease so that he understands.  At the patient level.  If a five-year-old child is asked why he did this, then he cannot immediately answer (and naturally, children live with feelings and emotions).  But to give the answer that is expected of him, the child begins to invent it - to generate the text.  Proceeding from the fact that the answer gave the parent and that at least somehow corresponded to what happened.  At first, as many parents know, these will be absurd answers.  But by encouraging and punishing (‚Äútell me more‚Äù, ‚Äúdo not invent excuses‚Äù), the child will learn to give detailed and complete answers. </p><br><p>  This development of OpenAI and the ability of the GPT-2 network to provide answers to conversational tasks without special training for a specific task open two interesting questions: </p><br><p>  1) Can the interpretability of neural networks be achieved by such an elementary text generator and the correct beginning of a phrase?  Where the answer will be a natural continuation.  Let, for example, a neural network indicates the seals in a photograph not by coordinate numbers x and y, but explains its position in plain text.  Then in the course of clarifying asking her the right question, for example: "I came to this conclusion, because ...", you can theoretically get an explanation of how she found the cat in the photo.  And this explanation in the limiting case can be no worse than a human one.  What solves the global problem of interpretability of neural networks. </p><br><p> 2) Can a pre-trained neural network on large volumes of text be universal, have general common sense and not require additional training for specific tasks.  Here it means that trying to imitate human speech (human answers to questions), the neural network must inevitably learn common sense in order to give these very similar to human answers.  Giving monosyllabic bogus responses is generally not typical of people.  Most of the people give detailed answers, which means the network must learn to do the same. </p><br><p>  Both of these questions remain open, but the first step in their approval is definitely made. </p><br><h1 id="a-tochnee">  Or rather? </h1><br><p>  If you are standing now, you better sit down.  Because here‚Äôs how OpenAI uses the GPT-2 neural network to get its results in conversational tasks for different domains: </p><br><p>  <strong>Answers to questions on the text</strong> </p><br><p>  Well, it's simple.  Either the networks were fed several paragraphs with a description that includes somewhere in the middle, for example, an "apple is on the table", and at the end it was attributed: "the apple is on ..." and the network added the "table".  Because it is able to remember the context of several paragraphs. </p><br><p>  Or they fed the networks as an initial phrase several examples of the form "Question: some question, Answer: some answer", and at the end after the real question they added: "Answer:".  And the neural network added the answer!  As revealed the structure of the document on the previous Question-Answer.  It's amazing. </p><br><p>  <strong>Summarization text</strong> </p><br><p>  At the entrance a long text of several paragraphs or even pages is submitted, and the neural network should write a short content.  How did this behavior get from GPT-2?  Just after the text added "TL; DR".  And that's it!  That was enough for GPT-2 to add a summary of the article after these symbols!  Because such symbols on the Internet often denote the multiple content of a post. </p><br><p>  <strong>Text translation</strong> </p><br><p>  At the entrance of GPT-2, the text was submitted in the form: "hello = hello, dog = dog, wind = wind, cat = ...".  And the neural network added a translation of the last word: "cat" (originally in French).  Because it revealed the structure of the document and simply supplemented it with the most logical continuation.  If you still have not opened your jaw from all this, then I have two news for you, and both are bad =). </p><br><h1 id="zapusk-gpt-2-cherez-google-colab">  Running GPT-2 through Google Colab </h1><br><p>  Unfortunately, the full version of GPT-2 in OpenAI refused to share.  Motivating this by using this neural network it will be too easy to generate fake news and reviews in stores.  Judging by their statement, the discussion of the feasibility of laying out this model will continue for the next 6 months, after which OpenAI will finally decide whether to lay out or not.  However, it is not difficult for a large organization to repeat the model (it looks like they trained it for 256 TPU for several days, and according to preliminary calculations it cost them about $ 45,000) </p><br><p>  However, they posted a smaller version of GPT-2 with 117 million parameters (and not 1.5 billion, as in the full model): <a href="https://github.com/openai/gpt-2">https://github.com/openai/gpt-2</a> .  Let's try to run it and play with this model. </p><br><p>  The easiest way to do this is through Google Colab: </p><br><ol><li>  Open link </li></ol><br><p>  <a href="http://colab.research.google.com/github/blade1780/bert/blob/master/Gpt-2.ipynb">http://colab.research.google.com/github/blade1780/bert/blob/master/Gpt-2.ipynb</a> </p><br><ol><li>  In the <strong>Runtime</strong> menu, select <strong>Run All</strong> , so that all cells start for the first time, download the model and connect the necessary libraries.  Agree to reset all runtime, if required.  Type the text after the "Model prompt &gt;&gt;&gt;" appears and press Enter. </li></ol><br><div class="spoiler">  <b class="spoiler_title">If something went wrong ...</b> <div class="spoiler_text"><p>  Make sure GPU and Python 3 are selected in the Runtime -&gt; Change runtime type menu </p><br><p>  If the connect button is not active, click it to become Connected. </p></div></div><br><p>  Or create all the code manually: </p><br><ol><li>  Go to <a href="https://colab.research.google.com/">https://colab.research.google.com</a> </li><li>  Click on the blue NEW PYTHON 3 NOTEBOOK button </li><li>  In the menu Runtime -&gt; Change runtime type, select Python 3 and GPU (the last one to run the neural network on the GPU) </li><li>  In the first cell, enter: </li></ol><br><pre><code class="python hljs">!git clone https://github.com/openai/gpt<span class="hljs-number"><span class="hljs-number">-2</span></span> %cd gpt<span class="hljs-number"><span class="hljs-number">-2</span></span> !sh download_model.sh <span class="hljs-number"><span class="hljs-number">117</span></span>M !pip3 install -r requirements.txt</code> </pre> <br><p>  And click the black Play icon to the left of the cell.  This will load the GPT-2 neural network and install the necessary dependencies. </p><br><p>  In the second cell (you can add it through the menu Insert -&gt; Code cell or by hovering the mouse under the center of the current cell, the add buttons will pop up): </p><br><pre> <code class="python hljs">!python3 src/interactive_conditional_samples.py</code> </pre> <br><p>  This will launch an interactive mode.  Wait until the neural network is loaded and a window for entering text appears below, with the inscription "Model prompt &gt;&gt;&gt;". Enter the beginning of the phrase and press Enter. After a while, the generated text will appear under the heading SAMPLE. </p><br><p>  You can also run the generation of completely random text.  The text will be generated for infinite time in small chunks of SAMPLE 1, SAMPLE 2, and so on, until you press the Stop button on the cell.  To do this, create a new cell with the code: </p><br><pre> <code class="python hljs">!python3 src/generate_unconditional_samples.py | tee samples.txt</code> </pre> <br><p>  The result will be saved to the samples.txt file.  You can download it with the following commands (again create a new cell and start it after generating the text): </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files files.download(<span class="hljs-string"><span class="hljs-string">'samples.txt'</span></span>)</code> </pre> <br><p>  You can change the parameters for generating text (odds, randomness, etc., for a description, see the <a href="https://d4mucfpksywv.cloudfront.net/better-language-models/language_models_are_unsupervised_multitask_learners.pdf">original work</a> ): </p><br><pre> <code class="python hljs">!python3 src/generate_unconditional_samples.py --top_k <span class="hljs-number"><span class="hljs-number">40</span></span> --temperature <span class="hljs-number"><span class="hljs-number">0.7</span></span> | tee samples.txt</code> </pre> <br><p>  Since this is a <strong>greatly</strong> reduced model, do not expect miracles from it.  Most of the generated samples will be nonsense.  But come across and meaningful areas.  The text should be in English; GPT-2 cannot work with other languages ‚Äã‚Äãyet. </p><br><h1 id="ssylki">  Links </h1><br><p>  Original OpenAI blog article: <a href="https://blog.openai.com/better-language-models/">Better Language Models and Their Implications</a> <br>  Github with 117M model laid out: <a href="https://github.com/openai/gpt-2">https://github.com/openai/gpt-2</a> <br>  Talk on reddit <a href="https://www.reddit.com/r/MachineLearning/comments/aqlzde/r_openai_better_language_models_and_their/">main news</a> <br>  Talk on reddit failure to lay out the full model: <a href="https://www.reddit.com/r/MachineLearning/comments/aqwcyx/discussion_openai_should_now_change_their_name_to/">It's time for OpenAI to be renamed CloseAI</a> <br>  Google Colab notebook to run GPT-2 (117M) in a browser: <a href="http://colab.research.google.com/github/blade1780/bert/blob/master/Gpt-2.ipynb">http://colab.research.google.com/github/blade1780/bert/blob/master/Gpt-2.ipynb</a> </p></div><p>Source: <a href="https://habr.com/ru/post/440564/">https://habr.com/ru/post/440564/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>