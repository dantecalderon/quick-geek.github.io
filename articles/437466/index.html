<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Byte-machine for the fort (and not only) in Indian (Part 4)</title>
  <meta name="description" content="And again I overestimated the volume of the article! Planned that this will be the final article, where we will make the compiler and perform testing....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Byte-machine for the fort (and not only) in Indian (Part 4)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/dbb/a59/e93/dbba59e932ecdb4b0c28896a7e6fc3e3.jpg" alt="Byte machine in indian"><br><br>  And again I overestimated the volume of the article!  Planned that this will be the final article, where we will make the compiler and perform testing.  But the volume was great, and I decided to split the article into two. <br><br>  In this article we will do almost all the basic functions of the compiler.  It will come to life already, and it will be possible to write, compile and execute quite serious code.  And we will do the testing in the next part.  (By the way, the previous parts: <a href="https://habr.com/post/431932/">one</a> , <a href="https://habr.com/post/433836/">two</a> , <a href="https://habr.com/ru/post/435236/">three</a> ). <br><br>  I write for the first time on Habr√©, perhaps it‚Äôs not always good.  In my opinion, articles 2, 3 turned out pretty dry, a lot of code, a little description.  This time I will try to do differently, focus on the description of the ideas themselves.  Well, the code ... the code, of course, will be!  Who wants to understand thoroughly, such an opportunity will be.  In many cases, I will put the code under the spoiler.  And, of course, you can always look at the full source on github. <br><br>  The compiler will continue to write some time in assembler, but then we will go to the fort and continue to write the compiler on itself.  This will resemble Baron Munchausen, who pulled himself by the hair out of the swamp.  But, to begin with, I will tell in general how the compiler works on the fort.  Welcome under the cut! <br><a name="habracut"></a><br><h4>  How the compiler works </h4><br>  The memory in the fort consists of a continuous fragment in which the dictionary entries are sequentially arranged.  After they are finished, there is a free area of ‚Äã‚Äãmemory.  The first free byte is indicated by the variable h.  There is also the frequently used word here, which pushes onto the stack the address of the first free byte, it is determined very simply: <br><br><pre><code class="cpp hljs">: here h @ ;</code> </pre> <br><img src="https://habrastorage.org/webt/bd/eg/sq/bdegsqg7t06egwbvxoib9lqk_nc.png"><br><br>  It is worth mentioning the word allot, which reserves the specified number of bytes by moving the pointer h.  The word allot can be defined as: <br><br><pre> <code class="cpp hljs">: allot h +! ;</code> </pre> <br>  In fact, the compiler uses a special interpreter mode plus some special words.  So, in one sentence, you can describe the whole principle of the compiler in the forte.  In which mode the interpreter is running, the state variable determines.  If it is equal to zero, then the execution mode is set, otherwise - the compilation mode.  We are already familiar with the execution mode, in it the words from the input buffer are simply executed one after another.  And in compilation mode, they are not executed, but compiled into memory at the pointer h.  Accordingly, the pointer moves forward. <br><br>  In the classical forte, the word "," is used to compile an integer value, and the word "c," is used to compile a byte.  In our system, values ‚Äã‚Äãof different widths are used (8, 16, 32, 64), therefore, we will additionally make the words ‚Äúw,‚Äù and ‚Äúi,‚Äù.  Let's also make the word ‚Äústr,‚Äù which will compile the string, taking two values ‚Äã‚Äãfrom the stack ‚Äî the address and the length of the string. <br><br>  Special words of the compiler are used to form control structures.  These are the words if, then, do, loop, and others.  These words are executed even in compilation mode.  For example, the word if at execution compiles a byte conditional jump command (? Nbranch).  To let the system know which words need to be executed in compilation mode, and not to compile, the immediate flag (attribute) is used.  We already have it in the flags field of the dictionary entry.  In source code in assembler, it is called f_immediate.  To set this flag, use the word immediate.  It has no parameters, the immediate flag is set on the last word in the dictionary. <br><br>  And now let's move from theory to practice! <br><br><h4>  Training </h4><br>  In the beginning, you need to do some simple byte commands that we need.  Here they are: move (copy a memory area), fill (fill a memory area), bit operations (and, or, xor, invert), bit shift commands (rshift, lshift).  Let's do the same rpick (this is the same as pick, only works with the return stack, not the data stack). <br><br><div class="spoiler">  <b class="spoiler_title">These commands are very simple, here is their code.</b> <div class="spoiler_text"><pre> <code class="cpp hljs">b_move = <span class="hljs-number"><span class="hljs-number">0x66</span></span> bcmd_move: pop rcx pop rdi pop rsi repz movsb jmp _next b_fill = <span class="hljs-number"><span class="hljs-number">0x67</span></span> bcmd_fill: pop rax pop rcx pop rdi repz stosb jmp _next b_rpick = <span class="hljs-number"><span class="hljs-number">0x63</span></span> bcmd_rpick: pop rcx push [rbp + rcx * <span class="hljs-number"><span class="hljs-number">8</span></span>] jmp _next b_and = <span class="hljs-number"><span class="hljs-number">0x58</span></span> bcmd_and: pop rax <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> [rsp], rax jmp _next b_or = <span class="hljs-number"><span class="hljs-number">0x59</span></span> bcmd_or: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [rsp], rax jmp _next b_xor = <span class="hljs-number"><span class="hljs-number">0x5A</span></span> bcmd_xor: pop rax xor [rsp], rax jmp _next b_invert = <span class="hljs-number"><span class="hljs-number">0x5B</span></span> bcmd_invert: notq [rsp] jmp _next b_rshift = <span class="hljs-number"><span class="hljs-number">0x5C</span></span> bcmd_rshift: pop rcx <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rcx, rcx jz _next <span class="hljs-number"><span class="hljs-number">1</span></span>: shrq [rsp] dec rcx jnz <span class="hljs-number"><span class="hljs-number">1b</span></span> jmp _next b_lshift = <span class="hljs-number"><span class="hljs-number">0x5D</span></span> bcmd_lshift: pop rcx <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rcx, rcx jz _next <span class="hljs-number"><span class="hljs-number">1</span></span>: shlq [rsp] dec rcx jnz <span class="hljs-number"><span class="hljs-number">1b</span></span> jmp _next</code> </pre> </div></div><br>  Still need to make the word word.  This is the same as blword, but a specific separator is indicated on the stack.  I do not give the code, it can be found in the source code.  I copied / paste the words blworld and replaced the comparison commands. <br><br>  Finally we make the word syscall.  With it you can do the missing system operations, for example, work with files.  This solution will not work if platform independence is required.  But this system is used now for tests, so let it be for now.  If necessary, all operations can be redone to byte commands, it is not at all difficult.  The syscall command will take from the stack 6 parameters for the system call and the call number.  It will return one parameter.  Parameter assignments and return values ‚Äã‚Äãare determined by the system call number. <br><br><pre> <code class="cpp hljs">b_syscall = <span class="hljs-number"><span class="hljs-number">0xFF</span></span> bcmd_syscall: sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> mov [rbp], r8 pop rax pop r9 pop r8 pop r10 pop rdx pop rsi pop rdi syscall push rax mov r8, [rbp] add rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> jmp _next</code> </pre><br>  Now let's proceed directly to the compiler. <br><br><h4>  Compiler </h4><br>  Create a variable h, everything is simple. <br><br><pre> <code class="cpp hljs"> item h h: .byte b_var0 .quad <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre>  We initialize its initialization in the starting line: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta"># forth last_item context @ ! h dup 8 + swap ! quit start: .byte b_call16 .word forth - . - 2 .byte b_call16 .word last_item - . - 2 .byte b_call16 .word context - . - 2 .byte b_get .byte b_set .byte b_call16 .word h - . - 2 .byte b_dup, b_num8, b_add, b_swap, b_set .byte b_quit</span></span></code> </pre><br>  Let's make the word here: <br><br><pre> <code class="cpp hljs"> item here .byte b_call8, h - . - <span class="hljs-number"><span class="hljs-number">1</span></span> .byte b_get .byte b_exit</code> </pre><br><div class="spoiler">  <b class="spoiler_title">And also the words to compile the values: "allot" and "c,", "w,", "i,", ",", "str,"</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># : allot h +! ; item allot allot: .byte b_call8, h - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_setp, b_exit # : , here ! <span class="hljs-number"><span class="hljs-number">8</span></span> allot ; item <span class="hljs-string"><span class="hljs-string">","</span></span> .byte b_call8, here - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_set, b_num8, b_call8, allot - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_exit # : i, here i! <span class="hljs-number"><span class="hljs-number">4</span></span> allot ; item <span class="hljs-string"><span class="hljs-string">"i,"</span></span> .byte b_call8, here - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_set32, b_num4, b_call8, allot - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_exit # : w, here w! <span class="hljs-number"><span class="hljs-number">2</span></span> allot ; item <span class="hljs-string"><span class="hljs-string">"w,"</span></span> .byte b_call8, here - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_set16, b_num2, b_call8, allot - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_exit # : c, here c! <span class="hljs-number"><span class="hljs-number">1</span></span> allot ; item <span class="hljs-string"><span class="hljs-string">"c,"</span></span> .byte b_call8, here - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_set8, b_num1, b_call8, allot - . - <span class="hljs-number"><span class="hljs-number">1</span></span>, b_exit # : str, dup -rot dup c, here swap move <span class="hljs-number"><span class="hljs-number">1</span></span>+ h +!; item <span class="hljs-string"><span class="hljs-string">"str,"</span></span> c_str: .byte b_dup, b_mrot, b_dup callb c_8 callb here .byte b_swap, b_move callb h .byte b_setp .byte b_exit</code> </pre></div></div><br>  And now let's make a state variable and two words to control its value: "[" and "]".  Usually these words are used to accomplish something at the time of compilation.  Therefore, the word "[" turns off the compilation mode, and the word "]" includes.  But nothing prevents them from being used in other cases when it is necessary to turn on or turn off the compilation mode.  The word "[" will be with us the first word that has the sign immediate.  Otherwise, it will not be able to turn off the compilation mode, since it will be compiled and not executed. <br><br><pre> <code class="cpp hljs"> item state .byte b_var0 .quad <span class="hljs-number"><span class="hljs-number">0</span></span> item <span class="hljs-string"><span class="hljs-string">"]"</span></span> .byte b_num1 callb state .byte b_set, b_exit item <span class="hljs-string"><span class="hljs-string">"["</span></span>, f_immediate .byte b_num0 callb state .byte b_set, b_exit</code> </pre><br>  The turn has come for the word $ compile.  It will take from the stack the address of the dictionary entry and compile the specified word.  In order to compile the word in the usual implementations of the fort, it is enough to apply the word "," to the address of the execution.  We are much more complicated.  First, there are two types of words - bytecode and machine code.  The first are compiled byte, and the second - byte-command call.  And secondly - we have as many as four options for the call: call8, call16, call32 and call64 command.  Four?  Not!  When I wrote the compiler, I added 16 more to these four!  :) <br><br>  How did this happen?  We'll have to make a small digression. <br><br><h4>  Improving the call team </h4><br>  When the compiler started working, I found that in many cases (but not all) the call8 command was enough.  This is when the called word is within 128 bytes.  I wondered - how to make it happen in almost all cases?  How to put in bytes more than 256 values? <br>  The first point I paid attention to is that in a fort the call always goes in the direction of smaller addresses.  This means that you can remake the call command in such a way that it can call only smaller addresses, but by 256 bytes, not 128. It is already better. <br><br>  But if I had to put a few bits somewhere ... It turns out that there is where!  We have two bytes: one byte is the command, the second is the offset.  But nothing interferes with a few lower bits of the command to place the higher bits of the parameter (offset).  For a byte-machine, it looks as if instead of one command, there are several call commands.  Yes, this way we occupy several cells of the byte-command code table with one command, but sometimes it is worth doing.  The call command is one of the most used commands, so I decided to put 4 bits of offset into the command.  Thus, you can make a call at a distance of 4095 bytes!  This means that such a short call command will be used almost always.  I placed these commands from code 0xA0 and the following lines appeared in the command table: <br><br><pre> <code class="cpp hljs">.quad bcmd_call8b0, bcmd_call8b1, bcmd_call8b2, bcmd_call8b3, bcmd_call8b4, bcmd_call8b5, bcmd_call8b6, bcmd_call8b7 # <span class="hljs-number"><span class="hljs-number">0xA0</span></span> .quad bcmd_call8b8, bcmd_call8b9, bcmd_call8b10, bcmd_call8b11, bcmd_call8b12, bcmd_call8b13, bcmd_call8b14, bcmd_call8b15</code> </pre> <br>  The first of these byte commands simply makes a call to smaller addresses by the offset specified in the parameter (up to 255).  The rest add to the parameter the corresponding offset.  bcmd_call8b1 adds 256, bcmd_call8b2 adds 512, and so on.  I made the first call command separately, the rest with a macro. <br><br>  First team: <br><br><pre> <code class="cpp hljs">b_call8b0 = <span class="hljs-number"><span class="hljs-number">0xA0</span></span> bcmd_call8b0: movzx rax, byte ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> inc r8 mov [rbp], r8 sub r8, rax jmp _next</code> </pre><br>  Macros and creation of other call commands: <br><br><pre> <code class="cpp hljs">.macro call8b N b_call8b\N = <span class="hljs-number"><span class="hljs-number">0xA</span></span>\N bcmd_call8b\N: movzx rax, byte ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> inc r8 add rax, \N * <span class="hljs-number"><span class="hljs-number">256</span></span> mov [rbp], r8 sub r8, rax jmp _next .endm call8b <span class="hljs-number"><span class="hljs-number">1</span></span> call8b <span class="hljs-number"><span class="hljs-number">2</span></span> call8b <span class="hljs-number"><span class="hljs-number">3</span></span> call8b <span class="hljs-number"><span class="hljs-number">4</span></span> call8b <span class="hljs-number"><span class="hljs-number">5</span></span> call8b <span class="hljs-number"><span class="hljs-number">6</span></span> call8b <span class="hljs-number"><span class="hljs-number">7</span></span> call8b <span class="hljs-number"><span class="hljs-number">8</span></span> call8b <span class="hljs-number"><span class="hljs-number">9</span></span> call8b <span class="hljs-number"><span class="hljs-number">10</span></span> call8b <span class="hljs-number"><span class="hljs-number">11</span></span> call8b <span class="hljs-number"><span class="hljs-number">12</span></span> call8b <span class="hljs-number"><span class="hljs-number">13</span></span> call8b <span class="hljs-number"><span class="hljs-number">14</span></span> call8b <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre><br>  Well, I redid the old command call8 into a call ahead, since we already make as many as 16 teams backward.  To avoid confusion, I renamed it b_call8f: <br><br><pre> <code class="cpp hljs">b_call8f = <span class="hljs-number"><span class="hljs-number">0x0C</span></span> bcmd_call8f: movzx rax, byte ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> inc r8 mov [rbp], r8 add r8, rax jmp _next</code> </pre><br>  By the way, for convenience, I made a macro, which in an assembler automatically compiles the corresponding call to the call back within 4095. And then I never needed :) <br><br><pre> <code class="cpp hljs">.macro callb adr .<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \adr &gt; . .error <span class="hljs-string"><span class="hljs-string">"callb do not for forward!"</span></span> .endif .byte b_call8b0 + (. - \adr + <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> .byte (. - \adr + <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">255</span></span> .endm</code> </pre> <br>  And now‚Ä¶ <br><br><h4>  Compiling a command </h4><br>  So, we have a rather complicated command compilation algorithm.  If this is a byte command, we simply compile a byte (byte command code).  And if this word is already written in bytecode, you need to compile it with the call command, choosing one of the twenty.  More precisely 19, so we do not have a call forward, and the call8f for the fort will not be used. <br><br>  So the choice is this.  If the offset is in the range of 0 ...- 4095, select the bcmd_call8b command with the 0xA0 code, placing the four high-order bits of the offset in the lower-order bits of the command.  In this case, for the byte-machine to get the code of one of the commands bcmd_call8b0 - bcmd_call8b15. <br><br>  If the back offset is greater than or equal to 4095, then we determine in which dimension the offset is placed, and use the appropriate command from call16 / 32/64.  It should be borne in mind that the offset for these teams with a sign.  They can trigger both forward and backward.  For example, call16 can call to a distance of 32767 in both directions. <br><br>  Here is the implementation as a result: <br><br>  <b>$ compile</b> <br><br>  Compiles the word.  As the parameter takes the address of the dictionary entry of the compiled word.  In fact, it checks the f_code flag, calculates the code address (cfa) and calls compile_b or compile_c (if the flag is set). <br><br>  <b>compile_c</b> <br><br>  Compiles a byte command.  The simplest word here, on the fort is described as: <br><br><pre> <code class="cpp hljs">: compile_c c@ c, ;</code> </pre> <br>  <b>compile_b</b> <br>  Takes the bytecode address on the stack and compiles its call. <br><br>  <b>test_bv</b> <br><br>  It accepts an offset from the stack (with a sign) and determines which digit capacity to use (1, 2, 4 or 8 bytes).  Returns the value 0, 1, 2, or 3. With the help of this word, you can determine which one to use from the call16 / 32/64 commands.  This word will also be useful when compiling numbers (choose from lit8 / 16/32/64). <br><br>  By the way, you can start the system and "play" in the fort console with any of these words.  For example: <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; 222 test_bv ( 2 ): 222 1 &gt; drop drop ( 0 ): &gt; 1000000 test_bv ( 2 ): 1000000 2 &gt; drop drop ( 0 ): &gt; -33 test_bv ( 2 ): -33 0 &gt;</code> </pre> <br>  <b>test_bvc</b> <br><br>  Accepts an offset from the stack (signed) and determines which call command to use.  In fact, it checks if the offset does not lie within 0 ... -4095, and returns 0. In this case, if there is no hit in this interval, it calls test_bv. <br><br><div class="spoiler">  <b class="spoiler_title">That's all you need to compile a command.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># : test_bvc dup <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;= over FFF &lt;= <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ... item test_bvc test_bvc: .byte b_dup, b_neg .byte b_num0 .byte b_gteq .byte b_over, b_neg .byte b_lit16 .word <span class="hljs-number"><span class="hljs-number">0xFFF</span></span> .byte b_lteq .byte b_and .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_num0 .byte b_exit item test_bv test_bv: .byte b_dup, b_lit8, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, b_gteq, b_over, b_lit8, <span class="hljs-number"><span class="hljs-number">0x7f</span></span>, b_lteq, b_and, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - ., b_num0 .byte b_exit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_dup .byte b_lit16 .word <span class="hljs-number"><span class="hljs-number">0x8001</span></span> .byte b_gteq .byte b_over .byte b_lit16 .word <span class="hljs-number"><span class="hljs-number">0x7ffe</span></span> .byte b_lteq, b_and, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - ., b_num1, b_exit <span class="hljs-number"><span class="hljs-number">2</span></span>: .byte b_dup .byte b_lit32 .<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80000002</span></span> .byte b_gteq .byte b_over .byte b_lit32 .<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x7ffffffd</span></span> .byte b_lteq, b_and, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">3f</span></span> - ., b_num2, b_exit <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_num3 .byte b_exit # –∫–æ–º–ø–∏–ª—è—Ü–∏—è –±–∞–π—Ç-–∫–æ–¥–∞ item compile_c compile_c: .byte b_get8 callb c_8 .byte b_exit # –∫–æ–º–ø–∏–ª—è—Ü–∏—è –≤—ã–∑–æ–≤–∞ –±–∞–π—Ç-–∫–æ–¥–∞ item compile_b compile_b: callb here .byte b_num2, b_add .byte b_sub callb test_bvc .byte b_dup .byte b_zeq .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_drop .byte b_neg .byte b_dup .byte b_lit8, <span class="hljs-number"><span class="hljs-number">8</span></span> .byte b_rshift .byte b_lit8, b_call8b0 .byte b_or callb c_8 callb c_8 .byte b_exit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_dup, b_num1, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - ., b_drop, b_lit8, b_call16 callb c_8 .byte b_wm callb c_16 .byte b_exit <span class="hljs-number"><span class="hljs-number">2</span></span>: .byte b_num2, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">3f</span></span> - ., b_lit8, b_call32 callb c_8 .byte b_num3, b_sub callb c_32 .byte b_exit <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_lit8, b_call64 callb c_8 .byte b_lit8, <span class="hljs-number"><span class="hljs-number">7</span></span>, b_sub callb c_64 .byte b_exit #: $compile dup c@ <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cfa compile_c <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cfa compile_b then ; item <span class="hljs-string"><span class="hljs-string">"$compile"</span></span> _compile: .byte b_dup, b_get8, b_lit8, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, b_and, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - ., b_cfa callb compile_c .byte b_exit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_cfa callb compile_b .byte b_exit</code> </pre><br></div></div><br>  And now we need to compile the numbers. <br><br><h4>  Compilation of number (literal) </h4><br>  Wrote a whole subtitle, prepared to specifically describe the literal compilation, but it turns out there is nothing special to describe :) <br><br>  We have already done half of the work in the word test_bv.  It remains only to call test_bv, and, depending on the result, to compile lit8 / 16/32/64, and then the corresponding value of 1, 2, 4 or 8 bytes. <br><br><div class="spoiler">  <b class="spoiler_title">We do this by defining the word compile_n</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># –∫–æ–º–ø–∏–ª—è—Ü–∏—è —á–∏—Å–ª–∞ item compile_n compile_n: callb test_bv .byte b_dup .byte b_zeq .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_drop, b_lit8, b_lit8 callb c_8 callb c_8 .byte b_exit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_dup, b_num1, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - ., b_drop, b_lit8, b_lit16 callb c_8 callb c_16 .byte b_exit <span class="hljs-number"><span class="hljs-number">2</span></span>: .byte b_num2, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">3f</span></span> - ., b_lit8, b_lit32 callb c_8 callb c_32 .byte b_exit <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_lit8, b_lit64 callb c_8 callb c_64 .byte b_exit</code> </pre></div></div><br><h4>  Modifying the interpreter </h4><br>  To compile the command and literals everything is ready.  Now it needs to be embedded in the interpreter.  This modification is simple.  Where the command was executed, you must add a state check.  If state is not null and the word does not contain an immediate flag, you need to call $ compile instead of execution.  And about the same thing to do where the number is received from the input stream.  If state is zero, we simply leave the number on the stack, and if not, we call compile_n. <br><br><div class="spoiler">  <b class="spoiler_title">This is the interpreter.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> item interpret interpret: .byte b_blword .byte b_dup .byte b_qnbranch8 .byte <span class="hljs-number"><span class="hljs-number">0f</span></span> - . .byte b_over .byte b_over .byte b_find .byte b_dup .byte b_qnbranch8 .byte <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_mrot .byte b_drop .byte b_drop callb state .byte b_get .byte b_qnbranch8, irpt_execute - . # –µ—Å–ª–∏ <span class="hljs-number"><span class="hljs-number">0</span></span>, –ø–æ–µ—Ö–∞–ª–∏ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ .byte b_dup, b_get8, b_lit8, f_immediate, b_and # –≤—ã—Ç–∞—â–∏–ª–∏ immediate –∏–∑ —Ñ–ª–∞–≥–æ–≤ —Å–ª–æ–≤–∞ .byte b_qbranch8, irpt_execute - . # –µ—Å–ª–∏ —Ñ–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ # –≤—Å–µ —Å–ª–æ–∂–∏–ª–æ—Å—å–± –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º! callb _compile .byte b_branch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - . irpt_execute: .byte b_cfa # —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞–µ–º, –∫–æ–≥–¥–∞ –Ω–∞–¥–æ –∏—Å–ø–æ–ª–Ω—è—Ç—å (state = <span class="hljs-number"><span class="hljs-number">0</span></span> –∏–ª–∏ immediate —Å–ª–æ–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω) .byte b_execute .byte b_branch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - . <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_drop .byte b_over, b_over .byte b_numberq # –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —á–∏—Å–ª–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–æ—Å—å .byte b_qbranch8, <span class="hljs-number"><span class="hljs-number">3f</span></span> - . # –µ—Å–ª–∏ –Ω–∞ —Å—Ç–µ–∫–µ –Ω–µ <span class="hljs-number"><span class="hljs-number">0</span></span>, –∑–Ω–∞—á–∏—Ç, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–æ—Å—å –∏ –∏–¥–µ–º –Ω–∞ –º–µ—Ç–∫—É <span class="hljs-number"><span class="hljs-number">3</span></span> .byte b_type # –∏–Ω–∞—á–µ –ø–µ—á–∞—Ç–∞–µ–º —Å–ª–æ–≤–æ .byte b_strp # –ø–æ—Ç–æ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É .byte <span class="hljs-number"><span class="hljs-number">19</span></span> # —ç—Ç–æ –¥–ª–∏–Ω–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–Ø –Ω–∏–∂–µ .ascii <span class="hljs-string"><span class="hljs-string">" : word not found!\n"</span></span> .byte b_quit # –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_nip, b_nip # —É–¥–∞–ª–∏–º –∑–Ω–∞—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—á–∞—Ç–∏ —Å–ª–æ–≤–∞ (–∫–æ–º–∞–Ω–¥—ã b_over, b_over) # –≤ —Å—Ç–µ–∫–µ - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ callb state # –ø—Ä–æ–≤–µ—Ä–∏–º, –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ .byte b_get .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - . # –µ—Å–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ - –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ; –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É - –∏ –≤—ã—Ö–æ–¥ # –∫–æ–º–ø–∏–ª—è—Ü–∏—è —á–∏—Å–ª–∞ callb compile_n <span class="hljs-number"><span class="hljs-number">2</span></span>: # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É .byte b_depth # –ø–æ–ª—É—á–∞–µ–º –≥–ª—É–±–∏–Ω—É —Å—Ç–µ–∫–∞ .byte b_zlt # —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º, —á—Ç–æ –º–µ–Ω—å—à–µ <span class="hljs-number"><span class="hljs-number">0</span></span> (–∫–æ–º–∞–Ω–¥–∞ <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;) .byte b_qnbranch8, interpret_ok - . # –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ, —Ç–æ –≤—Å–µ –≤ –ø–æ—Ä–Ø–¥–∫–µ, –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ .byte b_strp # –∏–Ω–∞—á–µ –≤—ã–≤–æ–¥–∏–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É .byte <span class="hljs-number"><span class="hljs-number">14</span></span> .ascii <span class="hljs-string"><span class="hljs-string">"\nstack fault!\n"</span></span> .byte b_quit # –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é interpret_ok: .byte b_branch8 .byte interpret - . <span class="hljs-number"><span class="hljs-number">0</span></span>: .byte b_drop .byte b_exit</code> </pre></div></div><br>  Now we are one step away from the compiler ... <br><br><h4>  Definition of new words (the word ":") </h4><br>  Now, if we set the state variable to a non-zero value, the compilation process begins.  But the result will be useless, we can neither execute it, nor even find it in memory.  To be able to do all this, it is necessary to issue the result of the compilation in the form of a dictionary entry.  To do this, before turning on the compilation mode, you need to create a word header. <br><br>  The header should contain flags, a link field and a name.  Here we have a familiar story - the communication field can be 1, 2, 4, or 8 bytes.  Let's make the word compile_1248, which will help us form such a field of communication.  It will take two numbers on the stack - the offset and the value generated by the test_bv command. <br><br><div class="spoiler">  <b class="spoiler_title">compile_1248</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–¥–∏–Ω, –¥–≤–∞, —á–µ—Ç—ã—Ä–µ –∏–ª–∏ –≤–æ—Å–µ–º—å –±–∞–π—Ç # –Ω–∞ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –±–∞–π—Ç, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π test_dv item compile_1248 compile_1248: .byte b_dup .byte b_zeq .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_drop callb c_8 .byte b_exit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_dup, b_num1, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - . .byte b_drop callb c_16 .byte b_exit <span class="hljs-number"><span class="hljs-number">2</span></span>: .byte b_num2, b_eq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">3f</span></span> - . callb c_32 .byte b_exit <span class="hljs-number"><span class="hljs-number">3</span></span>: callb c_64 .byte b_exit</code> </pre></div></div><br>  Now make the word $ create.  It will come in handy again and again.  You can use it whenever you need to create a dictionary entry title.  It will take two values ‚Äã‚Äãfrom the stack - the address of the name of the word being created and its length.  After the execution of this word on the stack will be the address of the dictionary entry. <br><br><div class="spoiler">  <b class="spoiler_title">$ create</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># : $create here current @ @ here - test_bv dup c, compile_1248 -rot str, current @ ! <span class="hljs-string"><span class="hljs-string">' var0 here c!; item "$create" create: callb here callb current .byte b_get, b_get callb here .byte b_sub callb test_bv .byte b_dup callb c_8 callb compile_1248 .byte b_mrot callb c_str # –æ–±–Ω–æ–≤–∏–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–ª–æ–≤–æ —Å–ª–æ–≤–∞—Ä—è callb current .byte b_get, b_set # –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±–∞–π—Ç-–∫–æ–¥ var0, –Ω–æ –æ–Ω –±—É–¥–µ—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π here # —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —ç—Ç–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ, —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —É–ø–∞–¥–µ—Ç # –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞, –∏ —ç—Ç–æ—Ç –±–∞–π—Ç –∑–∞—Ç—Ä–µ—Ç—Å—è # –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å 1 allot –∏ –ø–æ–ª—É—á–∏—Ç—å—Å—è —Å–ª–æ–≤–æ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ –¥–∞–Ω–Ω—ã–µ .byte b_lit8, b_var0 callb here .byte b_set8 .byte b_exit</span></span></code> </pre> </div></div><br>  The next word will take the name of the new word from the input stream using the word blword and call $ create, creating a new word with the specified name. <br><br><div class="spoiler">  <b class="spoiler_title">create_in</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> item <span class="hljs-string"><span class="hljs-string">"create_in"</span></span> create_in: .byte b_blword .byte b_dup .byte b_qbranch8 .byte <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_strp # –≤—ã–≤–æ–¥–∏–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (–Ω–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–ª–æ–≤–æ –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞) .byte <span class="hljs-number"><span class="hljs-number">3f</span></span> - <span class="hljs-number"><span class="hljs-number">2f</span></span> # —ç—Ç–æ –¥–ª–∏–Ω–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–Ø –Ω–∏–∂–µ <span class="hljs-number"><span class="hljs-number">2</span></span>: .ascii <span class="hljs-string"><span class="hljs-string">"\ncreate_in - name not found!\n"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_quit <span class="hljs-number"><span class="hljs-number">1</span></span>: callb create .byte b_exit</code> </pre></div></div><br>  And finally, let's make the word ":".  It will create a new word with create_in and set the compilation mode; it is not set.  And if installed, it gives an error.  The word ":" will have an immediate indication. <br><br><div class="spoiler">  <b class="spoiler_title">word:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"># : : create_in <span class="hljs-number"><span class="hljs-number">1</span></span> state dup @ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .<span class="hljs-string"><span class="hljs-string">" : - no execute state!"</span></span> then ! <span class="hljs-number"><span class="hljs-number">110</span></span> ; immediate item <span class="hljs-string"><span class="hljs-string">":"</span></span>, f_immediate colon: callb create_in .byte b_num1 callb state .byte b_dup .byte b_get .byte b_qnbranch8, <span class="hljs-number"><span class="hljs-number">2f</span></span> - . .byte b_strp # –≤—ã–≤–æ–¥–∏–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (–Ω–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–ª–æ–≤–æ –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞) .byte <span class="hljs-number"><span class="hljs-number">4f</span></span> - <span class="hljs-number"><span class="hljs-number">3f</span></span> # —ç—Ç–æ –¥–ª–∏–Ω–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∏–∂–µ <span class="hljs-number"><span class="hljs-number">3</span></span>: .ascii <span class="hljs-string"><span class="hljs-string">"\n: - no execute state!\n"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: .byte b_quit <span class="hljs-number"><span class="hljs-number">2</span></span>: .byte b_set .byte b_lit8, <span class="hljs-number"><span class="hljs-number">110</span></span> .byte b_exit</code> </pre></div></div><br>  If someone looked into the code, he saw that this word does something else :) <br><br>  And here 110 ??? <br><br>  Yes, this word also puts the number 110 on the stack, and that's why.  When compiling, the various constructs must be integrated.  For example, after if must be then.  And the word created using ":" must end with ";".  To check these conditions, the special words of the compiler put certain values ‚Äã‚Äãon the stack and check their presence.  For example, the word ":" puts the value 110, and the word ";"  checks that 110 is at the top of the stack. If not, then this is an error.  Hence, the control structures were not paired. <br><br>  Such a check is carried out in all similar words of the compiler, so we will make for this a special word - "? Pairs".  It will take two values ‚Äã‚Äãfrom the stack, and give an error if they are not equal. <br><br>  Also in such words it is often necessary to check whether the compilation mode is set.  Let's do for this the word "? State". <br><br><div class="spoiler">  <b class="spoiler_title">? pairs? state</b> <div class="spoiler_text"><pre> <code class="cpp hljs">#: ?pairs = ifnot <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> then .<span class="hljs-string"><span class="hljs-string">" \nerror: no pairs operators"</span></span> quit then ; item <span class="hljs-string"><span class="hljs-string">"?pairs"</span></span> .byte b_eq, b_qbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_strp .byte <span class="hljs-number"><span class="hljs-number">3f</span></span> - <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: .ascii <span class="hljs-string"><span class="hljs-string">"\nerror: no pairs operators"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_quit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_exit #: ?state state @ <span class="hljs-number"><span class="hljs-number">0</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">abort</span></span><span class="hljs-string"><span class="hljs-string">" error: no compile state"</span></span> then ; item <span class="hljs-string"><span class="hljs-string">"?state"</span></span> callb state .byte b_get, b_zeq, b_qnbranch8, <span class="hljs-number"><span class="hljs-number">1f</span></span> - . .byte b_strp .byte <span class="hljs-number"><span class="hljs-number">3f</span></span> - <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: .ascii <span class="hljs-string"><span class="hljs-string">"\nerror: no compile state"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: .byte b_quit <span class="hljs-number"><span class="hljs-number">1</span></span>: .byte b_exit</code> </pre></div></div><br>  Everything!  We‚Äôre not going to compile anything to assembler manually anymore :) <br><br>  But until the end the compiler is not written yet, therefore at the beginning it is necessary to use several not usual methods ... <br><br><h4>  Prepare to compile the generated compiler by the created compiler. </h4><br>  For starters, you can check how the word ":" works by compiling something simple.  We make, for example, such a word <br><br><pre> <code class="cpp hljs">: ^<span class="hljs-number"><span class="hljs-number">2</span></span> dup * ;</code> </pre> <br>  This word is squared.  But we do not have the word ";" how to be? –ù–∞–ø–∏—à–µ–º –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–ª–æ–≤–æ exit, –∏ –æ–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –ê –ø–æ—Ç–æ–º –≤—ã–∫–ª—é—á–∏–º —Ä–µ–∂–∏–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–ª–æ–≤–æ–º "[" –∏ –¥—Ä–æ–ø–Ω–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ 110: <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; : ^2 dup * exit [ drop ( 0 ): &gt; 4 ^2 ( 1 ): 16 &gt;</code> </pre><br>  Works! <br><br> –ü—Ä–æ–¥–æ–ª–∂–∏–º‚Ä¶ <br><br> –ü–æ—Å–∫–æ–ª—å–∫—É –¥–∞–ª—å—à–µ –º—ã –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å —Ñ–æ—Ä—Ç –Ω–∞ —Ñ–æ—Ä—Ç–µ, –Ω–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å, –≥–¥–µ –±—É–¥–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ñ–æ—Ä—Ç–∞, –∏ –∫–æ–≥–¥–∞ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è. –°–¥–µ–ª–∞–µ–º —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ñ–æ—Ä—Ç–∞ —Ä–∞–∑–º–µ—Å—Ç–∏–º –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ, –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏. –ê —á—Ç–æ –±—ã –æ–Ω –Ω–µ –∑–∞–Ω–∏–º–∞–ª –ª–∏—à–Ω–µ–≥–æ –º–µ—Å—Ç–∞, —Ä–∞–∑–º–µ—Å—Ç–∏–º –µ–≥–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∞–¥—Ä–µ—Å–∞ here, –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏. –ö–æ–Ω–µ—á–Ω–æ, –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —ç—Ç–∞ –æ–±–ª–∞—Å—Ç—å –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –Ω–æ —Å–∫–æ—Ä–æ—Å—Ç—å ¬´—É–±–µ–≥–∞–Ω–∏—è¬ª –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ, —á–µ–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –Ω–æ–≤–æ–π –ø–∞–º—è—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–π –∫–æ–¥ –Ω–∞—á–Ω–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫ –Ω–∞ —Ñ–æ—Ä—Ç–µ, –Ω–∞—á–∏–Ω–∞—è —Å –Ω–∞—á–∞–ª–∞, –Ω–æ –æ–Ω –Ω–∞–º –±—É–¥–µ—Ç —É–∂–µ –Ω–µ –Ω—É–∂–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –º—ã —É–∂–µ —ç—Ç–æ—Ç —É—á–∞—Å—Ç–æ–∫ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏. <br><br><pre> <code class="cpp hljs">fcode: .ascii <span class="hljs-string"><span class="hljs-string">" 2 2 + . quit"</span></span></code> </pre> <br> –ù–æ, –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –≤—Å–µ –∂–µ —Å—Ç–æ–∏—Ç –ø–æ–º–µ—Å—Ç–∏—Ç—å –¥–µ—Å—è—Ç–æ–∫ –ø—Ä–æ–±–µ–ª–æ–≤. <br><br> –ß—Ç–æ –±—ã –≤—Å–µ —ç—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ, –∏–∑–º–µ–Ω–∏–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–π—Ç-–∫–æ–¥ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ –±—ã tib, #tib —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ —ç—Ç—É —Å—Ç—Ä–æ–∫—É. –í –∫–æ–Ω—Ü–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è quit –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –æ–±—ã—á–Ω—É—é –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å–∏—Å—Ç–µ–º—ã. <br><br><div class="spoiler"> <b class="spoiler_title">–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–π—Ç-–∫–æ–¥ —Å—Ç–∞–ª —Ç–∞–∫–∏–º</b> <div class="spoiler_text"><pre> <code class="cpp hljs">start: .byte b_call16 .word forth - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_call16 .word last_item - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_call16 .word context - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_get .byte b_set .byte b_call16 .word vhere - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_dup .byte b_call16 .word h - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_set .byte b_call16 .word definitions - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_call16 .word tib - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_set .byte b_lit16 .word fcode_end - fcode .byte b_call16 .word ntib - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_set .byte b_call16 .word interpret - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_quit</code> </pre></div></div><br> –ó–∞–ø—É—Å–∫–∞–µ–º! <br><br><pre> <code class="plaintext hljs">$ ./forth 4 ( 0 ): &gt;</code> </pre><br>  Fine! <br><br> –ê —Ç–µ–ø–µ—Ä—å‚Ä¶ <br><br><h4> –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º </h4><br> –î–∞–ª—å—à–µ –ø–∏—à–µ–º –∫–æ–¥ –≤ —Å—Ç—Ä–æ–∫—É fcode. –ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å–¥–µ–ª–∞–µ–º, –∫–æ–Ω–µ—á–Ω–æ, —Å–ª–æ–≤–æ ";". <br><br><pre> <code class="cpp hljs">: ; ?state <span class="hljs-number"><span class="hljs-number">110</span></span> ?pairs lit8 [ blword <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> find cfa c@ c, ] c, <span class="hljs-number"><span class="hljs-number">0</span></span> state ! <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> [ current @ @ dup c@ <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> swap c! drop</code> </pre><br> –°–¥–µ–ª–∞—é –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è. <br><br><pre> <code class="plaintext hljs">?state 110 ?pairs</code> </pre> <br> –¢—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∏ –Ω–∞ —Å—Ç–µ–∫–µ –ª–µ–∂–∏—Ç 110. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –±—É–¥–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ –æ—à–∏–±–∫–µ. <br><br><pre> <code class="plaintext hljs">lit8 [ blword exit find cfa c@ c, ]</code> </pre> <br> –≠—Ç–æ –º—ã –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É lit —Å –±–∞–π—Ç-–∫–æ–¥–æ–º –∫–æ–º–∞–Ω–¥—ã exit. –ü—Ä–∏—à–ª–æ—Å—å –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–∞–π—Ç–∏ —Å–ª–æ–≤–æ exit, –ø–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –∏ –≤–∑—è—Ç—å –æ—Ç—Ç—É–¥–∞ –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã. –í—Å–µ —ç—Ç–æ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å –Ω–µ—Ç –ø–æ–∫–∞ –µ—â–µ —Å–ª–æ–≤–∞ compile. –ï—Å–ª–∏ –±—ã –æ–Ω–æ –±—ã–ª–æ, –≤–º–µ—Å—Ç–æ –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã–ª–æ –±—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å ¬´compile exit¬ª :) <br><br><pre> <code class="plaintext hljs">c, 0 state !</code> </pre> <br> –≠—Ç–æ –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–∞ exit –≤ –º–æ–º–µ–Ω—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–≤–∞ ";", –∞ –ø–æ—Ç–æ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è —Ä–µ–∂–∏–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏. –°–ª–æ–≤–æ "[" —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –∏–º–µ–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ immediate –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è <b>—Å–µ–π—á–∞—Å</b> , –∞ –Ω–∞–º –Ω–∞–¥–æ <b>—Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å</b> —Ç–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ —Å–ª–æ–≤–æ ";", —á—Ç–æ –±—ã –æ–Ω–∏ –≤—ã–∫–ª—é—á–∏–ª–∏ —Ä–µ–∂–∏–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. <br><br><pre> <code class="plaintext hljs">exit [</code> </pre> <br> –≠—Ç–æ —É–∂–µ –º—ã –∏—Å–ø—ã—Ç—ã–≤–∞–ª–∏. –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è —Å–ª–æ–≤–æ exit –∏ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è —Ä–µ–∂–∏–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í—Å–µ, —Å–ª–æ–≤–æ ";" —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–æ. –ê —á—Ç–æ –∂–µ —Ç–∞–º –µ—â–µ –Ω–∞–ø–∏—Å–∞–Ω–æ –¥–∞–ª—å—à–µ? <br><br><pre> <code class="plaintext hljs">current @ @ dup c@ 96 or swap c! drop</code> </pre> <br> –ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ immediate –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞. –ò–º–µ–Ω–Ω–æ —ç—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∫—Ä–æ–º–µ —Å–ª–æ–≤–∞ drop. –°–ª–æ–≤–æ drop —É–¥–∞–ª—è–µ—Ç –∑–∞–±—ã—Ç–æ–µ 110, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–º–µ—Å—Ç–∏–ª–æ —Å–ª–æ–≤–æ ":" –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è. <br><br> –í–æ—Ç —Ç–µ–ø–µ—Ä—å –≤—Å–µ! <br><br> –ó–∞–ø—É—Å–∫–∞–µ–º –∏ –ø—Ä–æ–±—É–µ–º. <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; : ^3 dup dup * * ; ( 0 ): &gt; 6 ^3 . 216 ( 0 ): &gt;</code> </pre><br>  There is! –í–æ—Ç –∏ –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª –Ω–∞—à –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä ¬´–ø–æ –Ω–∞—Å—Ç–æ—è—â–µ–º—É¬ª. <br><br> –ù–æ —É –Ω–∞—Å –µ—â–µ –Ω–µ—Ç –Ω–∏ —É—Å–ª–æ–≤–∏–π, –Ω–∏ —Ü–∏–∫–ª–æ–≤, –Ω–∏ –º–Ω–æ–≥–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ‚Ä¶ –ù–∞—á–Ω–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–≥–æ, –Ω–æ –æ—á–µ–Ω—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ —Å–ª–æ–≤–∞: immediate. –û–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ immediate —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞: <br><br><pre> <code class="cpp hljs">: immediate current @ @ dup c@ <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> swap c! ;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A familiar sequence :) Recently, it was written by hand, no longer required. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we‚Äôll do some small but useful words:</font></font><br><br><pre> <code class="cpp hljs">: hex <span class="hljs-number"><span class="hljs-number">16</span></span> base ! ; : decimal <span class="hljs-number"><span class="hljs-number">10</span></span> base ! ; : bl <span class="hljs-number"><span class="hljs-number">32</span></span> ; : tab <span class="hljs-number"><span class="hljs-number">9</span></span> ; : lf <span class="hljs-number"><span class="hljs-number">10</span></span> ;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hex and decimal set the corresponding number system. </font><font style="vertical-align: inherit;">The rest are constants for obtaining the corresponding character codes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will also make a word to copy the line with the counter </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:: cmove over c @ 1 + move; </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now let's deal with the conditions. </font><font style="vertical-align: inherit;">In general, if there was a word compile, it would look like this:</font></font><br><br><pre> <code class="cpp hljs">: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ?state compile ?nbranch8 here <span class="hljs-number"><span class="hljs-number">0</span></span> c, <span class="hljs-number"><span class="hljs-number">111</span></span> ; immediate : then ?state <span class="hljs-number"><span class="hljs-number">111</span></span> ?pairs dup here swap - swap c! ; immediate</code> </pre> <br> –í—Å–µ —ç—Ç–∏ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–µ–∂–∏–º –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫. <br><br> –°–ª–æ–≤–æ if –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —É—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥, —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –±–∞–π—Ç –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–º–∞–Ω–¥—ã —É—Å–ª–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∏ –∫–ª–∞–¥–µ—Ç –Ω–∞ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å —ç—Ç–æ–≥–æ –±–∞–π—Ç–∞. –ó–∞—Ç–µ–º –∫–ª–∞–¥–µ—Ç –Ω–∞ —Å—Ç–µ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 111. <br><br> –°–ª–æ–≤–æ then –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è 111, –∏ –∑–∞—Ç–µ–º –ø–æ –∞–¥—Ä–µ—Å—É –Ω–∞ —Å—Ç–µ–∫–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–º–µ—â–µ–Ω–∏–µ. <br><br> –ò —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞–µ–º —Å–ª–æ–≤–æ else. –û–Ω–æ –≤ –Ω–∞—á–∞–ª–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—É –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞, –¥–ª—è –æ–±—Ö–æ–¥–∞ –≤–µ—Ç–∫–∏ else. –¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ —É if, —Å–º–µ—â–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –µ—â–µ –Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–æ, –æ–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è, –∏ –µ–≥–æ –∞–¥—Ä–µ—Å –∫–ª–∞–¥–µ—Ç—Å—è –Ω–∞ —Å—Ç–µ–∫. –ù—É –∞ –ø–æ—Å–ª–µ –¥–µ–ª–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –≤—Å–µ —Ç–æ –∂–µ, —á—Ç–æ –∏ –ø—Ä–∏ then: –∞–¥—Ä–µ—Å —É–ª–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ—Ç–∫—É else. –ß—Ç–æ-—Ç–æ —ç—Ç–æ –æ–ø–∏—Å–∞—Ç—å —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º —Å–∞–º –∫–æ–¥ :) –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ö–æ—á–µ—Ç –¥–æ—Å–∫–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –ª—É—á—à–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤–æ—Ç —Ç–∞–∫–æ–≥–æ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞: <br><br><pre> <code class="cpp hljs">: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> compile ?nbranch8 here <span class="hljs-number"><span class="hljs-number">0</span></span> c, ; immediate : then dup here swap - swap c! ; immediate</code> </pre> <br> –ù—É –∞ —Ç–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥. –ü–æ—Å–∫–æ–ª—å–∫—É —É –Ω–∞—Å –Ω–µ—Ç —Å–ª–æ–≤–∞ compile, –ø—Ä–∏–º–µ–Ω–∏–º —Ç–æ—Ç –∂–µ —Ç—Ä—é–∫, —á—Ç–æ –∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–ª–æ–≤–∞ ";": <br><br><pre> <code class="cpp hljs">: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ?state lit8 [ blword ?nbranch8 find cfa c@ c, ] c, here <span class="hljs-number"><span class="hljs-number">0</span></span> c, <span class="hljs-number"><span class="hljs-number">111</span></span> ; immediate : then ?state <span class="hljs-number"><span class="hljs-number">111</span></span> ?pairs dup here swap - swap c! ; immediate : <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ?state <span class="hljs-number"><span class="hljs-number">111</span></span> ?pairs lit8 [ blword branch8 find cfa c@ c, ] c, here <span class="hljs-number"><span class="hljs-number">0</span></span> c, swap dup here swap - swap c! <span class="hljs-number"><span class="hljs-number">111</span></span> ; immediate</code> </pre><br> –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–∏–µ. –°–¥–µ–ª–∞–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–≤–æ–¥–∏—Ç 1000, –µ—Å–ª–∏ –Ω–∞ —Å—Ç–µ–∫–µ —á–∏—Å–ª–æ 5, –∏ 0 –≤ –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞—è—Ö: <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; : test 5 = if 1000 . else 0 . then ; ( 0 ): &gt; 22 test 0 ( 0 ): &gt; 3 test 0 ( 0 ): &gt; 5 test 1000 ( 0 ): &gt;</code> </pre><br> –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Ç–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–∏–ª—Å—è –Ω–µ —Å—Ä–∞–∑—É, –±—ã–ª–∏ –æ—à–∏–±–∫–∏, –±—ã–ª–∞ –æ—Ç–ª–∞–¥–∫–∞. –ù–æ, –≤ –∫–æ–Ω—Ü–µ-–∫–æ–Ω—Ü–æ–≤, —É—Å–ª–æ–≤–∏—è –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏! <br><br><div class="spoiler"> <b class="spoiler_title">–ù–µ–±–æ–ª—å—à–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ –ø—Ä–æ —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ –ø–µ—Ä–µ—Ö–æ–¥–∞</b> <div class="spoiler_text"> –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥—ã —Å –≤–æ—Å—å–º–∏—Ä–∞–∑—Ä—è–¥–Ω—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 127 –±–∞–π—Ç. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—ä–µ–º –∫–æ–¥–∞ –≤ –≤–µ—Ç–∫–∞—Ö —É—Å–ª–æ–≤–∏—è. –ù–æ, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –º–æ–∂–µ–º –≤—ã–±–∏—Ä–∞—Ç—å —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Ñ–æ—Ä—Ç–∞ –æ–¥–Ω–æ–ø—Ä–æ—Ö–æ–¥–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥—ã –≤–ø–µ—Ä–µ–¥, –∏ –Ω–∞–¥–æ —Å—Ä–∞–∑—É —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ –∫–æ–º–∞–Ω–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞. –î–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ 8 –±–∏—Ç –Ω–∞–º —Ö–≤–∞—Ç–∏—Ç, —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç 40 –¥–æ 127 –∫–æ–º–∞–Ω–¥ –≤ –≤–µ—Ç–∫–µ —É—Å–ª–æ–≤–∏—è. –ê –∫–∞–∫ –±—ã—Ç—å, –µ—Å–ª–∏ –±—ã –º—ã –¥–µ–ª–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω? <br><br> –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç—É—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π ‚Äî —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã 16 –±–∏—Ç. <br><br> –ù–æ —è –±—ã —Å–¥–µ–ª–∞–ª –ø–æ –¥—Ä—É–≥–æ–º—É. 16 –±–∏—Ç –Ω–∞ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —É—Å–ª–æ–≤–∏—è–º ‚Äî —ç—Ç–æ —Å –æ–≥—Ä–æ–º–Ω—ã–º –∏–∑–±—ã—Ç–∫–æ–º. –ü–æ—ç—Ç–æ–º—É, —è –±—ã –ø—Ä–∏–º–µ–Ω–∏–ª —Ç–æ—Ç –∂–µ —Ç—Ä—é–∫, —á—Ç–æ –∏ —Å –∫–æ–º–∞–Ω–¥–æ–π call, –ø–æ–º–µ—Å—Ç–∏–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∏—Ç —Å–º–µ—â–µ–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥—É. –î—É–º–∞—é, 11 –±–∏—Ç –Ω–∞ —Å–º–µ—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (–ø–æ 1023 –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ –≤–µ—Ç–∫–∏ —É—Å–ª–æ–≤–∏—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç 300 –¥–æ 1000 —Ñ–æ—Ä—Ç–æ–≤—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥. –û–±—ã—á–Ω–æ –±—ã–≤–∞–µ—Ç –Ω–µ –±–æ–ª—å—à–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–µ—Å—è—Ç–∫–æ–≤, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –∫–æ–¥ –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ —á–∏—Ç–∞–µ–º. –¢–æ–≥–¥–∞ –≤ –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã —É—Ö–æ–¥–∏—Ç 3 –±–∏—Ç–∞ —Å–º–µ—â–µ–Ω–∏—è, –∏ –∫–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∑–∞–π–º–µ—Ç 8 —è—á–µ–µ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –∫–æ–¥–æ–≤. –ö–æ–º–∞–Ω–¥ —É –Ω–∞—Å —Ç—Ä–∏: –ø–æ –Ω—É–ª—é (?nbranch), –ø–æ –Ω–µ –Ω—É–ª—é (?branch) –∏ –±–µ–∑—É—Å–ª–æ–≤–Ω—ã–π (branch). –ò—Ç–æ–≥–æ ‚Äî 24 —è—á–µ–π–∫–∏. <br></div></div><br> –£—Å–ª–æ–≤–∏—è —É –Ω–∞—Å –ø–æ—è–≤–∏–ª–∏—Å—å, –∂–∏–∑–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—â–µ :) <br><br> –°–¥–µ–ª–∞–µ–º —Å–ª–æ–≤–æ ." (—Ç–æ—á–∫–∞-–∫–∞–≤—ã—á–∫–∞). –û–Ω–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–∏—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º: <br><br><pre> <code class="cpp hljs">.<span class="hljs-string"><span class="hljs-string">" —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω"</span></span></code> </pre> <br> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ —Å—Ç–∞–Ω–µ—Ç –æ—á–µ–≤–∏–¥–Ω–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–∑–±–µ—Ä–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞: <br><br><pre> <code class="cpp hljs">: .<span class="hljs-string"><span class="hljs-string">" ?state 34 word dup if lit8 [ blword (."</span></span>) find cfa c@ c, ] c, str, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> drop then ; immediate</code> </pre> <br> –≠—Ç–æ —Å–ª–æ–≤–æ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –û–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å—Ç—Ä–æ–∫—É –¥–æ –∫–∞–≤—ã—á–∫–∏ (34 word). –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫—É –ø–æ–ª—É—á–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, –Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ. –•–æ—Ç—è, —Ç—É—Ç –ª—É—á—à–µ –±—ã –≤—ã–≤–µ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É. –ù–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ —Ä–∞–∑ –∏ –Ω—É–∂–Ω–æ —ç—Ç–æ —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –¥–µ–ª–∞–µ–º :) –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ –µ—â–µ —Ä–∞–∑, —É–∂–µ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π. <br><br> –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫—É –ø–æ–ª—É—á–∏—Ç—å —É–¥–∞–ª–æ—Å—å, –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–∞–π-–∫–æ–º–∞–Ω–¥–∞ (."), –∞ –∑–∞—Ç–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞. –≠—Ç–∞ –±–∞–π—Ç-–∫–æ–º–∞–Ω–¥–∞ (—Ç–æ—á–∫–∞-–∫–∞–≤—ã—á–∫–∞ –≤ —Å–∫–æ–±–∫–∞—Ö) –ø—Ä–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞ –±–∞–π—Ç–æ–º –∫–æ–º–∞–Ω–¥—ã. <br><br>  Check it out. <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; : test ." —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω" ; ( 0 ): &gt; test —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω ( 0 ): &gt;</code> </pre><br> –ò, –Ω–∞–∫–æ–Ω–µ—Ü, —Å–¥–µ–ª–∞–µ–º —Å–ª–æ–≤–æ compile. <br><br> –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —ç—Ç–æ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ –ø–æ—Ç–æ–∫–∞ –∏–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ–≤–∞, –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ —Å–ª–æ–≤–∞—Ä–µ. –ê –¥–∞–ª—å—à–µ –±—É–¥—É—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã: —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–π—Ç-–∫–æ–º–∞–Ω–¥–∞, –∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–≤–æ, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –Ω–∞ –±–∞–π—Ç-–∫–æ–¥–µ. –≠—Ç–∏ —Å–ª–æ–≤–∞ –Ω–∞–¥–æ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ä–∞–∑–Ω–æ–º—É. –ü–æ—ç—Ç–æ–º—É —Å–¥–µ–ª–∞–µ–º –¥–≤–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤–∞: "(compile_b)" –∏ "(compile_c)". <br><br> (compile_b) –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É call –¥–ª—è –≤—ã–∑–æ–≤–∞ –±–∞–π—Ç-–∫–æ–¥–∞. –í –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –±—É–¥–µ—Ç 64-—Ä–∞–∑—Ä—è–¥–Ω–æ–µ —Å–ª–æ–≤–æ ‚Äî –∞–¥—Ä–µ—Å –≤—ã–∑—ã–≤–∞–µ–º–æ–≥–æ –±–∞–π—Ç-–∫–æ–¥–∞. <br><br> (compile_c) –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –±–∞–π—Ç-–∫–æ–º–∞–Ω–¥—É. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –ø–∞—Ä–∞–º–µ—Ç—Ä —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –±—É–¥–µ—Ç –æ–¥–∏–Ω –±–∞–π—Ç ‚Äî –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã. <br><br> –ù—É –∞ —Å–∞–º–æ —Å–ª–æ–≤–æ compile –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏–±–æ (compile_b), –ª–∏–±–æ (compile_c) —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. <br><br> –ù–∞—á–Ω–µ–º —Å (compile_c), –∫–∞–∫ —Å –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π: <br><br><pre> <code class="cpp hljs">: (compile_c) r&gt; dup c@ swap <span class="hljs-number"><span class="hljs-number">1</span></span>+ &gt;rc, ;</code> </pre> <br> –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É, –º—ã –≤–ø–µ—Ä–≤—ã–µ –ø–∏—à–µ–º —Å–ª–æ–≤–æ –Ω–∞ –±–∞–π—Ç-–∫–æ–¥–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–∞–º–æ –ø–æ —Å–µ–±–µ –∏–º–µ–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –ü–æ—ç—Ç–æ–º—É –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É—é. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ (compile_—Å) –Ω–∞ —Å—Ç–µ–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è, –∫–∞–∫ —ç—Ç–æ –Ω–µ –±–∞–Ω–∞–ª—å–Ω–æ, –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞. –≠—Ç–æ –∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∞–π—Ç–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã call. –ù–∏–∂–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞. A0 ‚Äî –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã call, XX ‚Äî —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–º–∞–Ω–¥—ã call ‚Äî –∞–¥—Ä–µ—Å –≤—ã–∑–æ–≤–∞ (—Å–º–µ—â–µ–Ω–∏–µ) –±–∞–π—Ç-–∫–æ–¥–∞ —Å–ª–æ–≤–∞ (compile_c). <br><br><img src="https://habrastorage.org/webt/vj/jh/kh/vjjhkhqa7e35ygxdzclv0lf4-pw.png"><br><br> –ê–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –±–∞–π—Ç NN. –û–±—ã—á–Ω–æ —Ç–∞–º –∫–æ–¥ —Å–ª–µ–¥—É—é—â–µ–π –±–∞–π—Ç –∫–æ–º–∞–Ω–¥—ã. –ù–æ —É –Ω–∞—Å —Å–ª–æ–≤–æ –∏–º–µ–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ—ç—Ç–æ–º—É NN ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–æ–≤–∞ "(compile_c)", –∞ –∏–º–µ–Ω–Ω–æ, –±–∞–π—Ç-–∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º–æ–π –∫–æ–º–∞–Ω–¥—ã. –ù—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –±–∞–π—Ç –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø–µ—Ä–µ–¥–≤–∏–Ω—É–≤ –µ–≥–æ –≤–ø–µ—Ä–µ–¥, –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –±–∞–π—Ç-–∫–æ–º–∞–Ω–¥—É. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é ¬´r&gt; dup c@ swap 1+ &gt;r¬ª. –≠—Ç–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ —Å—Ç–µ–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –≤ –æ–±—ã—á–Ω—ã–π —Å—Ç–µ–∫, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ –Ω–µ–º—É –±–∞–π—Ç, –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç –∫ –Ω–µ–º—É –∂–µ (–∞–¥—Ä–µ—Å—É –≤–æ–∑–≤—Ä–∞—Ç–∞) –µ–¥–∏–Ω–∏—Ü—É, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç–µ–∫ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤. –û—Å—Ç–∞–≤—à–∞—è—Å—è –∫–æ–º–∞–Ω–¥–∞ ¬´c,¬ª –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–¥ –±–∞–π—Ç-–∫–æ–º–∞–Ω–¥—ã. <br><br> (compile_b) –Ω–µ –Ω–∞–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ: <br><br><pre> <code class="cpp hljs">: (compile_b) r&gt; dup @ swap <span class="hljs-number"><span class="hljs-number">8</span></span> + &gt;r compile_b ;</code> </pre> <br> –ó–¥–µ—Å—å –≤—Å–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è 64—Ö —Ä–∞–∑—Ä—è–¥–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∏ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–ª–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–æ compile_b, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —É–∂–µ —Å–æ–∑–¥–∞–ª–∏ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞. <br><br> –ê —Ç–µ–ø–µ—Ä—å —Å–∞–º–æ —Å–ª–æ–≤–æ compile. –ö–∞–∫ —É–∂–µ —Ä–∞–∑–±–∏—Ä–∞–ª–∏, –æ–Ω–æ —á–∏—Ç–∞–µ—Ç –∏–º—è —Å–ª–æ–≤–∞, –Ω–∞—Ö–æ–¥–∏—Ç –µ–≥–æ –∏ —Å–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –æ–¥–Ω—É –∏–∑ –¥–≤—É—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∫–æ–º–∞–Ω–¥. –ï–≥–æ —è –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –±—É–¥—É, –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º—ã —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–ª–∏ –∏ —Ä–∞–∑–±–∏—Ä–∞–ª–∏. <br><br><div class="spoiler"> <b class="spoiler_title">–°–ª–æ–≤–æ compile</b> <div class="spoiler_text"><pre> <code class="cpp hljs">: compile blword over over find dup <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dup c@ <span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cfa c@ (compile_b) [ blword (compile_c) find cfa , ] c, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cfa (compile_b) [ blword (compile_b) find cfa , ] , then drop drop <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> drop .<span class="hljs-string"><span class="hljs-string">" compile: "</span></span> type .<span class="hljs-string"><span class="hljs-string">" - not found"</span></span> then ; immediate</code> </pre> </div></div><br> –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ —Å–¥–µ–ª–∞–µ–º, —Å –µ–≥–æ –ø–æ–º–æ—â—å—é, —Å–ª–æ–≤–æ ifnot. <br><br><pre> <code class="cpp hljs">: ifnot ?state compile ?branch8 here <span class="hljs-number"><span class="hljs-number">0</span></span> c, <span class="hljs-number"><span class="hljs-number">111</span></span> ; immediate</code> </pre> <br> –ü—Ä–æ–≤–µ—Ä–∏–º! <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; : test 5 = ifnot 1000 . else 0 . then ; ( 0 ): &gt; 22 test 1000 ( 0 ): &gt; 3 test 1000 ( 0 ): &gt; 5 test 0 ( 0 ): &gt;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is good! And it's time to do cycles ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article we will make cycles with a condition. In the fort two variants of the cycle with the condition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first option is begin ... until. The word until removes the value from the stack, and if it is not zero, the loop ends. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second option is begin ... while ... repeat. In this case, the test occurs when the word while is executed. The exit from the loop occurs if the value on the stack is zero. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The cycles on the fort are made in the same way as the conditions on conditional and unconditional transitions. I give the code, comments, I think, are not needed.</font></font><br><br><pre> <code class="cpp hljs">: begin ?state here <span class="hljs-number"><span class="hljs-number">112</span></span> ; immediate : until ?state <span class="hljs-number"><span class="hljs-number">112</span></span> ?pairs compile ?nbranch8 here - c, ; immediate : <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ?state <span class="hljs-number"><span class="hljs-number">112</span></span> ?pairs compile ?nbranch8 here <span class="hljs-number"><span class="hljs-number">0</span></span> c, <span class="hljs-number"><span class="hljs-number">113</span></span> ; immediate : repeat ?state <span class="hljs-number"><span class="hljs-number">113</span></span> ?pairs swap compile branch8 here - c, dup here swap - swap c! ; immediate</code> </pre><br> –ù–∞ —Å–µ–≥–æ–¥–Ω—è —Å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º –∑–∞–∫–æ–Ω—á–∏–º. –û—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º –Ω–µ–º–Ω–æ–≥–æ. –ò–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ —Ü–∏–∫–ª—ã —Å–æ —Å—á–µ—Ç—á–∏–∫–æ–º. –ò –µ—â–µ —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–æ–≤ leave. –≠—Ç–æ —Å–¥–µ–ª–∞–µ–º –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑. <br><br> –ù–æ –º—ã –Ω–µ –∏—Å–ø—ã—Ç–∞–ª–∏ –∫–æ–º–∞–Ω–¥—ã —Ü–∏–∫–ª–∞! <br><br> –°–¥–µ–ª–∞–µ–º —ç—Ç–æ, –Ω–∞–ø–∏—Å–∞–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–ª–æ–≤–æ words. –ù–∞–¥–æ –∂–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –Ω–∞–∫–æ–Ω–µ—Ü, –Ω–∞—à —Å–ª–æ–≤–∞—Ä—å. <br> –î–ª—è —ç—Ç–æ–≥–æ, –≤ –Ω–∞—á–∞–ª–µ, —Å–¥–µ–ª–∞–µ–º —Å–ª–æ–≤–æ link@. –û–Ω–æ –±—É–¥–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–∑ —Å–ª–æ–≤–∞—Ä–Ω–æ–π —Å—Ç–∞—Ç—å–∏ –ø–æ–ª–µ —Å–≤—è–∑–∏ (—Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç–∞—Ç—å—é). –ö–∞–∫ –º—ã –ø–æ–º–Ω–∏–º, –ø–æ–ª–µ —Å–≤—è–∑–∏ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1, 2, 4 –∏–ª–∏ 8 –±–∞–π—Ç. –≠—Ç–æ —Å–ª–æ–≤–æ –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤ —Å—Ç–µ–∫–µ –∞–¥—Ä–µ—Å —Å–ª–æ–≤–∞—Ä–Ω–æ–π —Å—Ç–∞—Ç—å–∏, –∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è: –∞–¥—Ä–µ—Å –ø–æ–ª—è –∏–º–µ–Ω–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è —Å–≤—è–∑–∏. <br><br><pre> <code class="cpp hljs">: link@ dup c@ <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> swap <span class="hljs-number"><span class="hljs-number">1</span></span>+ swap dup <span class="hljs-number"><span class="hljs-number">0</span></span>= <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> drop dup <span class="hljs-number"><span class="hljs-number">1</span></span>+ swap c@ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> dup <span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> drop dup <span class="hljs-number"><span class="hljs-number">2</span></span> + swap w@ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> drop dup <span class="hljs-number"><span class="hljs-number">4</span></span> + swap i@ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> drop dup <span class="hljs-number"><span class="hljs-number">8</span></span> + swap @ then then then ;</code> </pre><br> –ê —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏ —Å–ª–æ–≤–æ words: <br><br><pre> <code class="cpp hljs">: words context @ @ <span class="hljs-number"><span class="hljs-number">0</span></span> begin + dup link@ swap count type tab emit dup <span class="hljs-number"><span class="hljs-number">0</span></span>= until drop drop ;</code> </pre> <br> –ó–∞–ø—É—Å–∫–∞–µ–º‚Ä¶ <br><br><pre> <code class="plaintext hljs">$ ./forth ( 0 ): &gt; words words link@ repeat while until begin ifnot compile (compile_b) (compile_c) ." else then if cmove tab bl decimal hex immediate ; bye ?state ?pairs : str, interpret $compile compile_b compile_n compile_1248 compile_c c, w, i, , allot here h test_bv test_bvc [ ] state .s &gt;in #tib tib . #&gt; #s 60 # hold span holdpoint holdbuf base quit execute cfa find word blword var16 var8 (.") (") count emit expect type lshift rshift invert xor or and &gt;= &lt;= &gt; &lt; = 0&gt; 0&lt; 0= bfind compare syscall fill move rpick r@ r&gt; &gt;r -! +! i! i@ w! w@ c! c@ ! @ depth roll pick over -rot rot swap drop dup abs /mod mod / * - + 1+ 1- exit ?nbranch16 ?nbranch8 ?branch16 ?branch8 branch16 branch8 call8b0 call64 call32 call16 call8f lit64 lit32 lit16 lit8 8 4 3 2 1 0 context definitions current forth ( 0 ): &gt;</code> </pre> <br> –í–æ—Ç –æ–Ω–æ, –Ω–∞—à–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ :) <br><br> –•–æ—Ç–µ–ª —Å–∫–∞–∑–∞—Ç—å –≤—Å–µ‚Ä¶ –Ω–µ—Ç, –¥–∞–≤–∞–π—Ç–µ, –≤—Å–µ –∂–µ, —Å–¥–µ–ª–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ñ–∞–π–ª —Å —Ñ–æ—Ä—Ç-–ø—Ä–æ–≥—Ä–∞–º–º–æ–π –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. <br><br> –°–¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ syscall –∫–æ–º–∞–Ω–¥—ã –æ—Ç–∫—Ä—ã—Ç–∏—è, –∑–∞–∫—Ä—ã—Ç–∏—è –∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –û–ø—Ä–µ–¥–µ–ª–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –Ω–∏—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã. <br><br><pre> <code class="cpp hljs">: file_open <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> syscall ; : file_close <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> syscall ; : file_read <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> syscall ; : file_O_RDONLY <span class="hljs-number"><span class="hljs-number">0</span></span> ; : file_O_WRONLY <span class="hljs-number"><span class="hljs-number">1</span></span> ; : file_O_RDWR <span class="hljs-number"><span class="hljs-number">3</span></span> ;</code> </pre><br> –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–ª–æ–≤–æ _start: <br><br><pre> <code class="cpp hljs">: _start <span class="hljs-number"><span class="hljs-number">0</span></span> pick <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> pick file_O_RDONLY <span class="hljs-number"><span class="hljs-number">0</span></span> file_open dup <span class="hljs-number"><span class="hljs-number">0</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .\<span class="hljs-string"><span class="hljs-string">" error: \" . quit then dup here 32 + 32768 file_read dup 0&lt; if .\" error: \" . quit then swap file_close drop #tib ! here 32 + tib ! 0 &gt;in ! interpret then ;</span></span></code> </pre><br> –≠—Ç–æ —Å–ª–æ–≤–æ –∑–∞–≥—Ä—É–∑–∏—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –ª—é–±—É—é —Ñ–æ—Ä—Ç-–ø—Ä–æ–≥—Ä–∞–º–º—É. –¢–æ—á–Ω–µ–µ —Å–∫–∞–∑–∞—Ç—å, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç –≤—Å–µ, —á—Ç–æ –±—É–¥–µ—Ç –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ. –ê —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –∏ –∏—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ. –ò–º—è —Ñ–∞–π–ª–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ. –ù–µ –±—É–¥—É —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏, –Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ –≤ –õ–∏–Ω—É–∫—Å–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–µ–∫. C–ª–æ–≤–æ _start –¥–æ—Å—Ç–∞–Ω–µ—Ç –∏—Ö –∫–æ–º–∞–Ω–¥–∞–º–∏ 0 pick (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) –∏ 2 pick (—É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä). –î–ª—è —Ñ–æ—Ä—Ç-—Å–∏—Å—Ç–µ–º—ã —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ª–µ–∂–∞—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π —Å—Ç–µ–∫–∞, –Ω–æ –∫–æ–º–∞–Ω–¥–æ–π pick –∏—Ö –¥–æ—Å—Ç–∞—Ç—å –º–æ–∂–Ω–æ. –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–º —Ä–∞–∑–º–µ—Ä–æ–º 32 –ö–±, –ø–æ–∫–∞ –Ω–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é. <br><br> –¢–µ–ø–µ—Ä—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å –≤ —Å—Ç—Ä–æ–∫–µ fcode –≤ –∫–æ–Ω—Ü–µ: <br><br><pre> <code class="cpp hljs">_start quit</code> </pre><br> –°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª test.f –∏ –Ω–∞–ø–∏—à–µ–º —Ç–∞–º —á—Ç–æ-–Ω–∏–±—É–¥—å –Ω–∞ —Ñ–æ—Ä—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –∞–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª–∏–¥–∞ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞–∏–±–æ–ª—å—à–µ–≥–æ –æ–±—â–µ–≥–æ –¥–µ–ª–∏—Ç–µ–ª—è: <br><br><pre> <code class="cpp hljs">: NOD begin over over &lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> over over &gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> swap over - swap <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> over - then repeat drop ; <span class="hljs-number"><span class="hljs-number">23101</span></span> <span class="hljs-number"><span class="hljs-number">44425</span></span> NOD . bye</code> </pre><br>  We start. <br><br><pre> <code class="plaintext hljs">$ ./forth test.f 1777 Bye! $</code> </pre> <br> –û—Ç–≤–µ—Ç –≤–µ—Ä–Ω—ã–π. –°–ª–æ–≤–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏–ª–æ—Å—å. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≤–µ–¥–µ–Ω, –¥–∞–ª–µ–µ –∏—Å–ø–æ–ª–Ω–∏–ª–∞—Å—å –∫–æ–º–∞–Ω–¥–∞ bye. –ï—Å–ª–∏ —É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏, —Å–ª–æ–≤–æ NOD –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–æ–≤–∞—Ä—å –∏ —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –≤ —Å–≤–æ—é –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É. –£–∂–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã :-) <br><br>  That's all. –ö–æ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫ –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ –¥–ª—è –õ–∏–Ω—É–∫—Å–∞ –Ω–∞ x86-64 —Å –ì–∏—Ç—Ö–∞–±–∞: <a href="https://github.com/hal9000cc/forth64">https://github.com/hal9000cc/forth64</a> <br><br> –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π <s>GNU GPL v2</s> –î–ß–• v1 ‚Äî –î–µ–ª–∞–π—Ç–µ –ß—Ç–æ –•–æ—Ç–∏—Ç–µ :-) </div><p>Source: <a href="https://habr.com/ru/post/437466/">https://habr.com/ru/post/437466/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>