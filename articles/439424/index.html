<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I Fought Free Hosting and Composer</title>
  <meta name="description" content="No one will deny that Composer is quite a handy tool, and that there are free or cheap hosting services that do not provide any console or built-in to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>How I Fought Free Hosting and Composer</h1><div class="post__text post__text-html js-mediator-article">  No one will deny that Composer is quite a handy tool, and that there are free or cheap hosting services that do not provide any console or built-in tool for working with Composer.  That's exactly the kind of stack I encountered.  Well, as the Jedi bequeathed, <b>vendor is</b> immediately added to <b>.gitignore</b> so as not to clutter up the repository and not to drive libraries to and from there. <br><br>  The first thing that came to mind was to make the script available from the Web, which can be pulled at the right time and it will update the dependencies or install them. <br><a name="habracut"></a><br>  For this we need to carry out some manipulations. <br><br>  1. To install the composer locally, we <a href="">need to download <b>composer.phar</b></a> . <br><br>  2. Create a folder where it will be unpacked (let it be <b>var</b> ). <br><br>  3. Create <b>composer.json</b> (well, I think about this you already know if you worked with composer). <br><br>  4. Well, create the script itself to work with the composer from the Web (let it be <b>composer.php</b> ). <br><br>  So we have the structure of our future site: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/484/127/544/484127544170fe43a28a9e3b4dde854b.png" alt="Site structure"><br><br>  <b>Composer.phar itself</b> will be as follows: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Composer</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Input</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayInput</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Output</span></span>\<span class="hljs-title"><span class="hljs-title">StreamOutput</span></span>; <span class="hljs-comment"><span class="hljs-comment">//–£–±–µ—Ä—ë–º –ª–∏–º–∏—Ç—ã, —á—Ç–æ–± —Å–∫—Ä–∏–ø—Ç –Ω–µ –æ—Ç–≤–∞–ª–∏–ª—Å—è —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ ini_set("memory_limit", -1); ini_set("max_execution_time", 0); //–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ $root = __DIR__ . "/../"; //–ü–∞–ø–∫–∞ –¥–ª—è —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è $dir = "{$root}/var"; //–°–º–æ—Ç—Ä–∏–º –µ—Å–ª–∏ Phar –∞—Ä—Ö–∏–≤ –µ—â–µ –Ω–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω, —Ç–æ —Ä–∞—Å–ø–∞–∫—É–µ–º –µ–≥–æ if (file_exists("{$dir}/vendor/autoload.php") === false) { $composerPhar = new Phar("{$root}/composer.phar"); $composerPhar-&gt;extractTo($dir); } //–ü–æ–¥–∫–ª—é—á–∏–º –∞–≤—Ç–æ–ª–æ–∞–¥–µ—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –∫–æ–º–ø–æ–∑–µ—Ä–∞ require_once("{$dir}/vendor/autoload.php" . ''); //–û–±—å—è–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è —á—Ç–æ–± –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–∞–º –∫–æ–º–ø–æ–∑–µ—Ä putenv("COMPOSER_HOME={$dir}/bin/composer"); //–ò–∑–º–µ–Ω–∏–º –ø–∞–ø–∫—É –Ω–∞ –∫–æ—Ä–µ–Ω—å —á—Ç–æ–± vendor —Ö—Ä–∞–Ω–∏–ª—Å—è –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ —á—Ç–æ –∏ WebRoot chdir($root); //–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–º–∞–Ω–¥—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ $input = new ArrayInput(['command' =&gt; 'install']); //–°–æ–∑–¥–∞–µ–º –≤—ã–≤–æ–¥ –≤ —Å—Ç—Ä–∏–º $stream = fopen('php://temp', 'w+'); $output = new StreamOutput($stream); //–ó–∞–ø—É—Å–∫–∞–µ–º "–∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ $application = new Application(); $application-&gt;setAutoExit(false); $application-&gt;run($input, $output); //–ê —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–≤–æ–¥ echo stream_get_contents($stream);</span></span></code> </pre> <br><br>  And if you are a thrill.  Then after calling the script, it will expand the <b>vendor</b> folder. <br><br>  But I didn‚Äôt <b>turn</b> out to be this way) The first thing that broke my plans was setting <b>phar.readonly = On</b> in <b>php.ini</b> , and you guessed it on free hosting, you usually don‚Äôt edit it.  Then I started looking for workarounds. <br><br>  The first thing I tried was to create a <b>user.ini</b> which would override the settings in <b>php.ini</b> , on the local machine worked) But on the hosting this functionality was stabbed. <br><br>  Then I tried to use another trick.  Rename <b>composer.phar</b> to just <b>composer</b> , the result is the same.  On LAN worked, on the hosting - no. <br><br>  Then I had to unpack the <b>var</b> files locally instead of the script and upload them to the server. <br><br>  Also it is necessary to close the script by authorization, so that any person will not call it.  Also in the final version of the script I added the choice of the command through the parameters. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Composer</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Input</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayInput</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Output</span></span>\<span class="hljs-title"><span class="hljs-title">BufferedOutput</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Output</span></span>\<span class="hljs-title"><span class="hljs-title">OutputInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">//–£–±–µ—Ä—ë–º –ª–∏–º–∏—Ç—ã, —á—Ç–æ–± —Å–∫—Ä–∏–ø—Ç –Ω–µ –æ—Ç–≤–∞–ª–∏–ª—Å—è —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ ini_set("memory_limit", -1); ini_set("max_execution_time", 0); //–ù–µ–≥–æ–∂–µ –≤ Web —Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–æ–ª–µ–º, —á—Ç–æ–± –∫—Ç–æ-—Ç–æ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –º–æ–≥ –∏—Ö –≤—ã–∑–≤–∞—Ç—å if (isset($_SERVER['HTTP_AUTHORIZATION']) AND !empty($_SERVER['HTTP_AUTHORIZATION'])) { list($_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW']) = explode(':', base64_decode(substr($_SERVER['HTTP_AUTHORIZATION'], 6)), 2); } elseif (isset($_SERVER['REDIRECT_HTTP_AUTHORIZATION']) AND !empty($_SERVER['REDIRECT_HTTP_AUTHORIZATION'])) { list($_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW']) = explode(':', base64_decode(substr($_SERVER['REDIRECT_HTTP_AUTHORIZATION'], 6)), 2); } //–î–µ—Ç–∞–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ —á—Ç–æ-—Ç–æ –±–æ–ª–µ–µ —Å–µ–∫—å—é—Ä–Ω–æ–µ $config = [ 'user' =&gt; 'admin', 'password' =&gt; 'admin', ]; //–ü—É—Å–∫–∞–µ–º –∏–ª–∏ –Ω–µ –ø—É—Å–∫–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–∞–ª—å—à–µ if ((isset($_SERVER['PHP_AUTH_USER']) &amp;&amp; $_SERVER['PHP_AUTH_USER'] == $config['user'] &amp;&amp; isset($_SERVER['PHP_AUTH_PW']) &amp;&amp; $_SERVER['PHP_AUTH_PW'] == $config['password'])) { unset($_SERVER['PHP_AUTH_USER']); unset($_SERVER['PHP_AUTH_PW']); } else { $uniqueID = uniqid(); header("WWW-Authenticate: Basic realm='{$uniqueID}'"); header('HTTP/1.0 401 Unauthorized'); exit(); } //–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ $root = realpath(__DIR__ . "/../"); //–ü–∞–ø–∫–∞ –¥–ª—è —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è $dir = "{$root}/var"; //–°–º–æ—Ç—Ä–∏–º –µ—Å–ª–∏ Phar –∞—Ä—Ö–∏–≤ –µ—â–µ –Ω–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω, —Ç–æ —Ä–∞—Å–ø–∞–∫—É–µ–º –µ–≥–æ if (file_exists("{$dir}/vendor/autoload.php") === false) { $composerPhar = new Phar("{$root}/composer.phar"); $composerPhar-&gt;extractTo($dir); } //–ü–æ–¥–∫–ª—é—á–∏–º –∞–≤—Ç–æ–ª–æ–∞–¥–µ—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –∫–æ–º–ø–æ–∑–µ—Ä–∞ require_once("{$dir}/vendor/autoload.php" . ''); //–û–±—å—è–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è —á—Ç–æ–± –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–∞–º –∫–æ–º–ø–æ–∑–µ—Ä putenv("COMPOSER_HOME={$dir}/bin/composer"); //–ò–∑–º–µ–Ω–∏–º –ø–∞–ø–∫—É –Ω–∞ –∫–æ—Ä–µ–Ω—å —á—Ç–æ–± vendor —Ö—Ä–∞–Ω–∏–ª—Å—è –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ —á—Ç–æ –∏ WebRoot chdir($root); //–ù–µ –æ—á–µ–Ω—å —Ç–æ —Ö–æ—Ä–æ—à–æ, –Ω–æ –±—É–¥–µ–º –Ω–∞–¥–µ—è—Ç—Å—è —á—Ç–æ –ø–∞—Ä–æ–ª—å –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç, –∏ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –≤–æ –∏–º—è –¥–æ–±—Ä–∞) //–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é composer update, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∞—â–µ —á–µ–º ?command=install $params = !empty($_GET) ? $_GET : ['command' =&gt; 'update']; //–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–º–∞–Ω–¥—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏. $input = new ArrayInput($params); //–°–æ–∑–¥–∞–µ–º –≤—ã–≤–æ–¥ –≤ —Å—Ç—Ä–∏–º $output = new BufferedOutput( OutputInterface::VERBOSITY_NORMAL //true ); //–ó–∞–ø—É—Å–∫–∞–µ–º "–∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ $application = new Application(); $application-&gt;setAutoExit(false); $application-&gt;run($input, $output); $content = $output-&gt;fetch(); echo "&lt;pre&gt;"; //–ê —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–≤–æ–¥ echo $content; echo "&lt;br&gt;"; echo (file_exists("{$root}/vendor/autoload.php")) ? 'Autoload &lt;b&gt;installed&lt;/b&gt;' : 'Autoload &lt;b&gt;Missing&lt;/b&gt;';</span></span></code> </pre> <br>  It also does not hurt to add a rule to <b>.htaccess</b> for forwarding an authorization header (in the case of CGI) and a redirect to HTTPS, since the authorization goes in clear text. <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> #–ï—Å–ª–∏ —É –≤–∞—Å CGI, —Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –µ–≥–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å RewriteRule .* -<span class="hljs-meta"><span class="hljs-meta"> [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}] #–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –Ω–∞ HTTPS, —Ç–∞–∫ –∫–∞–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Ö–æ–¥–∏—Ç –≤ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ RewriteCond %{HTTPS} off RewriteCond %{HTTP:SSL} !=1 [NC] RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [R=302,L]</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/439424/">https://habr.com/ru/post/439424/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>