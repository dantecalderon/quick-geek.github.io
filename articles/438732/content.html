<div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9d6/512/d5a/9d6512d5a8bbea73ff0cbdf18361c8d4.png"><br><br>  As I have repeatedly mentioned in my publications, amateur projects are funded from the family budget, and a radio amateur usually cannot afford to buy expensive measuring equipment.  We have to be content with what we have.  Or the fact that it is possible to take advantage of the use "for a while."  And sometimes, out of despair, the radio amateur has to “drill with a saw and cut with a gimlet.” <br><br>  Recently, I experienced the need to find out what is actually transmitted in the device I am developing on the I2C bus.  It was that happy moment when one could afford to “saw with a saw”. <br><a name="habracut"></a><br>  How data is exchanged between devices using the I2C protocol can be found <a href="https://ru.wikipedia.org/wiki/I%25C2%25B2C">here</a> .  To analyze the signals on the I2C bus, you can use both a digital dual-channel oscilloscope with memory and a logic analyzer. <br><br><h1>  Digital dual channel oscilloscope with memory </h1><br>  When working with electronic equipment, the oscilloscope is the most versatile tool.  Modern digital oscilloscopes have a number of useful properties that allow, among other things, the analysis of I2C bus signals. <br><br>  In this case, I got "for a while" a digital dual-channel oscilloscope with Rigol DS1102 memory (price on the manufacturer's website is $ 461).  This device has two measurement channels with a bandwidth of up to 100 MHz and a signal sampling rate of 1 GSa / s. <br><br>  CH1 was connected to the SCL signal.  CH2 was connected to the SDA signal.  Both channels had a scale of 1.00 V / div.  Scanning scale - 10 us / cases.  For clarity, the beam of the first channel is shifted to the upper half of the screen, and the beam of the second channel is shifted to the lower. <br><br>  In the Trigger menu, the oscilloscope was tuned to a single measurement with the launch of the front edge in channel CH1 of 1.00 V: <br><br><img src="https://habrastorage.org/webt/w5/rh/6f/w5rh6fc6t7ylim2soe16el1y-su.jpeg"><br><br>  After switching on the tested equipment, a large red Run / Stop button was pressed.  The oscilloscope went into standby mode, then it started.  After a few seconds, the recording was stopped manually. <br><br>  The resulting waveform was recorded on external media on the screen: <br><br><img src="https://habrastorage.org/webt/jj/w-/uj/jjw-uj7azfuajleysvkjytbkqza.png"><br><br>  We will analyze the recorded signals.  On the first screen, we see the display of the instrument settings and the oscillogram of the SCL signals (upper part) and SDA (lower part of the screen), on which we read from left to right: <br><br><ul><li>  <b>START signal</b> : the master device sets the low level first on the SDA bus and then on the SCL bus; </li><li>  <b>7-bit address</b> : read 0x60 (1100000) on the SDA bus on the front fronts of SCL; </li><li>  <b>Record mode flag</b> : read SDA bus low on the next leading edge of SCL; </li><li>  <b>ACK signal</b> : the master device switches to SDA bus after the transfer of a byte, the SDA is set to high level, the slave device on the falling edge of the SCL sets the SDA to a low level (the ACK signal itself), which the master reads on the leading edge of SCL; </li><li>  <b>STOP signal</b> : the master device sets the high level first on the SCL bus and then on the SDA bus </li></ul><br>  Similarly, slowly but surely, you can manually decrypt the rest of the recording. <br><br><h1>  Digital Signal Analyzer </h1><br>  Protocol decryption can be done more easily using a logic analyzer and appropriate software. <br><br>  For use as a logic analyzer, I was kindly provided by colleagues at Saleae Logic 8 (price on the manufacturer’s website is $ 399).  The demo version of Saleae Logic 1.2.18, taken from the <a href="https://www.saleae.com/downloads/">official site, was</a> used as software.  By installing this software, I have accepted the <a href="https://trello-attachments.s3.amazonaws.com/55f0a61a10f9f592573a4205/5697d62ba03bdba21581dc15/429ff3e09adc4067ec9984092759897d/License.txt">license agreement</a> with the condition, including not to use this software with third-party equipment. <br><br>  The program included the protocol analyzer I2C.  For the SCL signal, the channel CH0 was assigned, and for the SDA signal - channel CH1.  The sampling rate of the signal is 24 MSa / s. <br><br><img src="https://habrastorage.org/webt/pj/fx/jm/pjfxjmkkdap8oto_qytml1pwuco.png"><br><br>  The launch was set up on the “fore” front of CH0.  To display the data was selected in hexadecimal format. <br><br><img src="https://habrastorage.org/webt/g3/dq/kk/g3dqkkhyebti856uuvvri6qb1iw.png"><br><br>  After turning on the tested equipment, a large green Start button was pressed, and after a few seconds, a diagram appeared on the screen: <br><br><img src="https://habrastorage.org/webt/hj/ud/wi/hjudwij6fp19tjsbila6ryky11o.png"><br><br>  I see the maximum benefit in using a logic analyzer in that the program itself decrypts the data obtained.  The decryption results are entered line by line into the Decoded Protocols window.  When you select a row of data in the window, the program shows the location of this data in the chart. <br><br><h1>  Digital oscilloscope vs logic analyzer </h1><br>  To compare the options, I “glued together” in the graphical editor four screen shots of the oscilloscope and a fragment of the logic analyzer diagram: <br><br><img src="https://habrastorage.org/webt/go/y8/-k/goy8-kswvkuwhlpepxz2bcp-s8u.png"><br><br>  Start is indicated by a green circle, Stop - a red circle.  The diagram first checks for the presence of a device on the bus with the address 0x60, and then writes the value 0x80 to the 0xB7 register of this device. <br><br>  If we compare the variants with “predilection”, we can see that on the logic analyzer diagram (sampling rate 24 MSa / s) there is “jitter” of the SCL signal, which is not present on the oscillogram with sampling frequency 1 GSa / s.  The rest of the picture is the same, and the logical analyzer also performs the correct data decoding in automatic mode. <br><br>  When choosing "or-or" in the "dry residue" we have, in the case of an oscilloscope, an expensive universal device, which is not so convenient for bus analysis as a logic analyzer, but for money comparable to it.  Under these conditions, I personally, as an engineer of the “old school”, would have acquired a digital oscilloscope. <br><br>  However, if there were software with a license agreement allowing the use of inexpensive clones of popular logic analyzers, such as Saleae Logic 8 or DSLogic Plus ... <br><br><h1>  And such software exists </h1><br>  Inexpensive clones of popular logic analyzers, and not only them, are supported by the open source software <a href="https://sigrok.org/wiki/Downloads">of the sigrok project</a> . <br><br>  The workplace was collected: <br><br><img src="https://habrastorage.org/webt/jv/b7/ui/jvb7uib7vtfwnq7h4z0_gpkc-xm.jpeg"><br><br>  After that, "dancing with a tambourine" began.  On Windows 10, only the 32-bit version of PulseView was launched.  The presence of inexpensive Chinese clone Saleae Logic in the system (price on the seller’s website is $ 7) was not determined. <br><br>  After that, the WinUSB drivers were installed for the <b>Logic</b> device in Zadig, and after re-scanning it was defined in Zadig as a <b>fx2latw</b> device: <br><br><img src="https://habrastorage.org/webt/lx/t5/1c/lxt51c1hie09kwg5gxcco8uf8ay.png"><br><br>  After that, WinUSB drivers were installed again for the <b>fx2latw</b> device in Zadig, and only after that PulseView saw the “Saleae Logic” device in the list.  The device has been connected. <br><br>  After connecting the device, the following program settings were made (from left to right in the toolbar, starting with the inscription “Saleae Logic”): <br><br><ul><li>  Pre-trigger capture ratio = 2% is set by pressing a button with a key and a screwdriver; </li><li>  extra inputs are disabled at the touch of a button with a red probe; </li><li>  set the recording volume to 100 K samples; </li><li>  sampling frequency 24 MHz is set; </li><li>  I2C protocol analyzer is enabled by pressing a button with a yellow-green icon. </li></ul><br>  Further in the panel to the left of the channels: <br><br><ul><li>  Channels are assigned text labels corresponding to signals; </li><li>  trigger condition assigned to the falling edge of the SDA signal; </li><li>  I2C signals are assigned to the appropriate channels. </li></ul><br>  After switching on the tested equipment, the Run button was pressed.  The result is already familiar: <br><br><img src="https://habrastorage.org/webt/k-/66/xd/k-66xd9p6bqrbfd6efb57rift58.png"><br><br>  It seems that the "dancing with a tambourine" was worth it! <br><br>  <b>UPD</b> : After manual installation of the <a href="https://sourceforge.net/projects/libusb-win32/">libusb-win32</a> driver in the Device Manager for the USB <b>Logic</b> device, the PulseView program began to stably detect the presence in the Saleae Logic system without any manipulations with Zadig. <br><br><h4>  Brief conclusions: </h4><br>  The article described the method of analyzing I2C bus signals using a digital oscilloscope with memory and logic analyzers with application software packages. <br><br>  A universal method of analyzing signals, but not cheap and slow, is the use of a digital oscilloscope with memory. <br><br>  A quick and cost-effective method of analyzing signals, but with the non-trivial task of connecting equipment, is the use of an inexpensive logic analyzer clone in conjunction with PulseView. <br><br>  I would be glad if my publication helped save readers time and money. <br><br>  In the next publication I will tell you how I measured the frequency at which the quartz resonator started in a frequency synthesizer, without a frequency meter.  But that's another story… </div>