<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cowrie Hanipot Attack Analysis</title>
  <meta name="description" content="Statistics for 24 hours after installing a hanipot at the Digital Ocean site in Singapore 

 Pew Pew! Let's start right away with the attack map. 
 Ou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Cowrie Hanipot Attack Analysis</h1><div class="post__text post__text-html js-mediator-article">  <b>Statistics for 24 hours after installing a hanipot at the Digital Ocean site in Singapore</b> <br><br><h1>  Pew Pew!  Let's start right away with the attack map. </h1><br>  Our super class map shows unique ASNs that have been connected to our Cowrie handheld in 24 hours.  <font color="orange">Yellow</font> corresponds to SSH connections, and <font color="red">red</font> to Telnet.  Such animations often impress a company's board of directors, which allows them to knock out more funding for safety and resources.  Nevertheless, the map has some value, clearly demonstrating the geographical and organizational distribution of the sources of attack on our host in just 24 hours.  The animation does not reflect the amount of traffic from each source. <br><a name="habracut"></a><br><h3>  What is a Pew Pew Card? </h3><br>  <i>The Pew Pew card</i> is a <a href="https://krebsonsecurity.com/2015/01/whos-attacking-whom-realtime-attack-trackers/">cyber attack visualization</a> , usually animated and very beautiful.  This is a fashionable way to sell your product, notorious for being used by Norse Corp.  The company ended badly: it turned out that beautiful animashki were their only merit, and for analysis they used fragmentary data. <br><br><h3>  Made with Leafletjs </h3><br>  For those who want to develop an attack map for a large screen in the operations center (your boss will like it), there is a <a href="https://leafletjs.com/">leafletjs</a> library.  We combine it with the <a href="https://github.com/lit-forest/leaflet.migrationLayer">leaflet migration layer</a> plugin, the Maxmind GeoIP service - <a href="https://hackertarget.com/pewpew/map.html">and that's it</a> . <br><br> <a href="https://hackertarget.com/pewpew/map.html"><img src="https://habrastorage.org/webt/ep/4i/nf/ep4infkfydwq1bq0w9qllkshgys.png"></a> <br><br><h1>  WTF: what is Cowrie hanipot? </h1><br>  Hanipot is a system that is placed on the network specifically to lure intruders.  Connections to the system are usually illegal and allow an intruder to be detected using detailed logs.  Logs retain not only the usual information about the connection, but also session information, revealing the attacker's <b>technique, tactics and procedures (TTP)</b> . <br><br>  <a href="https://github.com/micheloosterhof/cowrie">Cowrie Hanipot is</a> designed to <b>record SSH and Telnet connections</b> .  Such hanipots are often put on the Internet to track the tools, scripts and hosts of attackers. <br><br><blockquote>  My message is for companies that think they are not attacking: ‚ÄúYou are not looking well.‚Äù <br>  <i>- James Snook</i> </blockquote><br><img src="https://habrastorage.org/getpro/habr/post_images/b6d/51f/054/b6d51f054d5d6e844819d6a4ae52ec4a.jpg"><br><br><h1>  What is in the logs? </h1><br><h3>  Total number of connections </h3><br>  Many hosts received repeated connection attempts.  This is normal, since the attacking scripts are filled with the list of credentials and they try several combinations.  Cowrie hanipot is configured to accept certain username and password combinations.  This is configured in the <b>user.db file</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/baa/53b/95a/baa53b95a17508d61d6fc90f138ded6c.png"><br><br><h3>  Attack geography </h3><br>  According to Maxmind's geolocation, I calculated the number of connections from each country.  Brazil and China lead by a wide margin, from these countries there is often a lot of noise from scanners. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e5/00d/15b/8e500d15bb9b18fa0e0d09ea4920693c.png"><br><br><h3>  Network unit owner </h3><br>  A study of the owners of network blocks (ASN) can reveal organizations with a large number of attacking hosts.  Of course, and in such cases, you should always remember that many attacks come from infected hosts.  It is reasonable to assume that most intruders are not so stupid as to scan the Net from a home computer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed2/f4d/a08/ed2f4da086d9540231d850cff7a8a40b.png"><br><br><h3>  Open ports on attacking systems (data Shodan.io) </h3><br>  Running an IP list through the excellent <a href="https://developer.shodan.io/">Shodan API</a> quickly identifies <b>open port systems</b> and what the ports are.  The figure below shows the concentration of open ports by country and organization.  It would be possible to identify blocks of compromised systems, but within the <b>small sample</b> nothing is visible, except for a large number of <b>open ports of 500 in China</b> . <br><br>  An interesting find is a large number of systems in Brazil that do <b>not have 22, 23</b> or <b>other ports</b> <b>open</b> , according to Censys and Shodan.  Apparently, these are connections from end-user computers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cb/72c/b3a/0cb72cb3a213c3808906fd2becd3179b.png"><br><br><h3>  Bots?  Not necessary </h3><br>  <a href="https://censys.io/">Censys</a> data for ports 22 and 23 for that day showed strange.  I assumed that most scans and password attacks come from bots.  The script spreads through open ports, picks up passwords, and from the new system copies itself and continues to spread using the same method. <br><br>  But here it can be seen that only a small number of hosts scanning telnet open port 23 to the outside. This means that the systems are either compromised in another way, or the attackers run scripts manually. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e01/cca/89b/e01cca89b6f93be94d69ced873ebc3c4.png"><br><br><h3>  Home connections </h3><br>  Another interesting discovery was a large number of home users in the sample.  Using <b>reverse lookup,</b> I identified 105 connections from specific home computers.  For many home connections, when you reverse DNS lookup, the host name is displayed with the words dsl, home, cable, fiber, and so on. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64f/ddc/ed6/64fddced6a4b65050eeacf128da6821a.png"><br><br><h1>  Learn and explore: raise your own hanipot </h1><br>  Recently, I wrote a short manual on how to <a href="https://hackertarget.com/cowrie-honeypot-ubuntu/">install Cowrie hanipot on my system</a> .  As already mentioned, in our case Digital Ocean VPS was used in Singapore.  For 24 hours of analysis, the cost was literally a few cents, and the time to build the system was 30 minutes. <br><br>  Instead of running Cowrie on the Internet and catching all the noise, you can benefit from the hanipot on the local network.  Stand by notification if requests go to certain ports.  This is either an intruder within the network, or a curious employee, or a vulnerability scan. <br><br><h1>  findings </h1><br>  After watching the actions of the attackers for a day, it becomes clear that it is impossible to isolate an obvious source of attacks in some organization, country, or even the operating system. <br><br>  A wide distribution of sources indicates that scanning noise is constant and not associated with a particular source.  Anyone who works on the Internet should make sure that his system has <b>several levels of security</b> .  A common and effective solution for <b>SSH</b> is to move the service to a random high port.  This does not eliminate the need for strict password protection and monitoring, but at least ensures that the logs are not clogged by constant scanning.  High port connections are more likely to target attacks that might interest you. <br><br>  Often, open telnet ports are on routers or other devices, so they cannot be easily moved to a high port.  <a href="https://hackertarget.com/nmap-online-port-scanner/">Information about all open ports</a> and <a href="https://hackertarget.com/domain-profiler/">attack surfaces</a> is the only way to ensure that these services are firewall-protected or disabled.  If possible, you do not need to use Telnet at all, this protocol is not encrypted.  If you need it without it, then carefully monitor it and use strong passwords. </div><p>Source: <a href="https://habr.com/ru/post/436076/">https://habr.com/ru/post/436076/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>