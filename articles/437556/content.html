<div class="post__text post__text-html js-mediator-article">  Earlier this month, Qualys security experts <a href="https://www.bleepingcomputer.com/news/security/linux-systemd-affected-by-memory-corruption-vulnerabilities-no-patches-yet/">discovered</a> three vulnerabilities in <a href="https://ru.wikipedia.org/wiki/Systemd">systemd</a> — the Linux initialization subsystem — that allow an attacker to obtain superuser rights.  We tell what their essence is and what distributions are susceptible to them. <br><br> <a href="https://habr.com/ru/company/1cloud/blog/437556/"><img src="https://habrastorage.org/webt/-h/8y/9s/-h8y9s4jodyusgu8r6wgfcm5kby.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://www.flickr.com/photos/carbonnyc/9086437706">David Goehring</a> / <a href="https://creativecommons.org/licenses/by/2.0/">CC BY</a> / Photo changed</i></font> <br><br><h2>  Old new vulnerabilities </h2><br>  All three vulnerabilities are related to the systemd logging service - journald.  In the CVE database, they were assigned the following identifiers: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3D2018-16864">CVE-2018-16864</a> , <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3D2018-16865">CVE-2018-16865,</a> and <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3D2018-16866">CVE-2018-16866</a> .  These vulnerabilities give an attacker the opportunity to get root-rights on the attacked system. <br><br>  All distributions without user space protection ( <a href="https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html">-fstack-check</a> ) - Debian, Ubuntu, Fedora, CentOS, Mageia, and others are at risk. Exceptions include SUSE Linux Enterprise 15 and openSUSE Leap 15.0, as well as Fedora versions 28 and 29. <br><br>  Interestingly, all three vulnerabilities <a href="https://www.securitylab.ru/news/497385.php">have been</a> around <a href="https://www.securitylab.ru/news/497385.php">for several years</a> , just nothing was known about them.  CVE-2018-16864 appeared in 2013, but it became possible to exploit it in 2016, when systemd was updated to version 230.  CVE-2018-16865 appeared in the operating system in 2011, but became critical only two years after the release of systemd version 201. <br><br>  As for the third vulnerability (CVE-2018-16866), it has existed since 2015.  However, it was accidentally closed with a systemd v240 update several years later.  Machines without this patch are still under threat. <br><br><h2>  What is the essence of the detected "holes" </h2><br>  Vulnerability CVE-2018-16864 allows an attacker to manipulate the command line and send multiple arguments (weighing several megabytes) to systemd-journald, thereby causing the process to crash.  Next, the hacker has the opportunity to take control of the extended command index (EIP). <br><br>  The issue with CVE-2018-16864 is related to writing a large message to / run / systemd / journal / socket.  As a result, part of this message goes out of the stack and goes to the <a href="https://ru.wikipedia.org/wiki/Mmap">mmap</a> region.  After that, the attacker can rewrite the <a href="https://en.wikipedia.org/wiki/Read-write_memory">read-write</a> segment of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B0%25D0%25BD%25D0%25B4%25D0%25B0%25D1%2580%25D1%2582%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25B8%25D0%25B1%25D0%25BB%25D0%25B8%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BA%25D0%25B0_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA%25D0%25B0_%25D0%25A1%25D0%25B8">libc</a> and replace the function pointer and run any desired program chain in the system. <br><br>  As for the CVE-2018-16866, it is associated with a string parsing error.  If you send a special message to the logging system (ending with a colon) in syslog format, the system will ignore the end of the line and write to the log the next part of the stack. <br><br>  The second and third vulnerabilities allow you to implement a so-called <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2582%25D0%25B0%25D0%25BA%25D0%25B0_%25D0%25B2%25D0%25BE%25D0%25B7%25D0%25B2%25D1%2580%25D0%25B0%25D1%2582%25D0%25B0_%25D0%25B2_%25D0%25B1%25D0%25B8%25D0%25B1%25D0%25BB%25D0%25B8%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BA%25D1%2583">back-to-library attack</a> and launch any functions on the victim's machine.  According <a href="https://www.openwall.com/lists/oss-security/2019/01/09/3">to</a> experts from Qualys, they managed to create an exploit and get superuser rights on computers with i386 and amd64 architecture in 10 and 70 minutes, respectively. <br><br><blockquote>  “These vulnerabilities are quite serious, given that they allow to increase access rights in the system.  The authors still keep the code of their exploit secret, since there are a lot of distributions in there, ”commented Sergey Belkin, head of the <a href="https://1cloud.ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dlinuxbug%26utm_content%3Dblog">IaaS provider</a> development department at <a href="https://1cloud.ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dlinuxbug%26utm_content%3Dblog">1cloud.ru</a> .  - They will publish it when visibility is closed.  Some developers, for example from <a href="https://usn.ubuntu.com/3855-1/">Ubuntu</a> and <a href="https://github.com/systemd/systemd/commit/084eeb865ca63887098e0945fb4e93c852b91b0f">Red Hat</a> , have already posted the necessary patches.  They can be found in official repositories. ” </blockquote><br><img src="https://habrastorage.org/webt/f3/_n/ev/f3_nevg6oj62dvro42zlokg682a.jpeg"><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://www.flickr.com/photos/bradleypjohnson/5663414458/">bradleypjohnson</a> / CC BY</i></font> <br><br><h2>  What other vulnerabilities were found in systemd </h2><br>  The last time a vulnerability in systemd was <a href="https://www.securitylab.ru/news/496192.php">discovered</a> in October 2018.  The DHCPv6 client service manager automatically started when a message was received from any DHCP server on the local network or Internet service provider.  Using this message in systemd, you could <a href="https://www.theregister.co.uk/2018/10/26/systemd_dhcpv6_rce/">cause</a> a memory failure and gain control of the computer. <br><br>  Prior to this, several bugs in the code of the service manager were found in 2017.  One of them <a href="https://xakep.ru/2017/06/29/systemd-bug/">allowed</a> attackers to use TCP packets to execute any code on the system.  TCP packets "forced" systemd to allocate too small a buffer for a message.  This made it possible to write arbitrary data outside the buffer into the main memory. <br><br>  Another vulnerability in 2017 <a href="https://www.theregister.co.uk/2017/07/05/linux_systemd_grants_root_to_invalid_user_accounts/">was related</a> to the unauthorized acquisition of superuser rights.  In some distributions, such as CentOS and RHEL7, in systemd it was possible to create a profile with a user name that starts with a digit.  Although usually in Linux this feature is not provided.  But if such a user appeared in the system, the service manager gave him administrator rights. <br><br>  All these vulnerabilities were closed in a short time.  “Patches” for new “holes” discovered in January are also gradually appearing.  We can expect that soon the vulnerabilities will be closed in most distributions, and administrators of Linux servers and computers will only need to install a system update. <br><br><h5>  Posts from the corporate blog 1cloud: </h5><br><ul><li>  <a href="https://1cloud.ru/blog/personalnye-dannye-chast-2%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dlinuxbug%26utm_content%3Dblog">How to protect personal data, and from what to protect them</a> </li><li>  <a href="https://1cloud.ru/blog/oblachnyj-server-dlja-praktiki-sysadmina%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dlinuxbug%26utm_content%3Dblog">Training stand for admins: how not to break wood on the combat infrastructure</a> </li><li>  <a href="https://1cloud.ru/blog/personalnye-dannye-chast-3%3Futm_source%3Dhabrahabr%26utm_medium%3Dcpm%26utm_campaign%3Dlinuxbug%26utm_content%3Dblog">Personal data: features of a public cloud</a> </li></ul></div>