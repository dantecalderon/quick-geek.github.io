<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting FPGA to Python</title>
  <meta name="description" content="FPGA technology (FPGA) is currently gaining great popularity. A growing number of applications: in addition to digital signal processing, FPGAs are us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Getting FPGA to Python</h1><div class="post__text post__text-html js-mediator-article">  FPGA technology (FPGA) is currently gaining great popularity.  A growing number of applications: in addition to digital signal processing, FPGAs are used to accelerate machine learning, in blockchain technology, video processing, and IoT. <br><br>  This technology has one significant drawback: for programming, quite complex and specific languages ‚Äã‚Äãfor describing digital equipment Verilog and VHDL are used.  This makes it difficult for a newcomer to enter the FPGA and it is difficult for an employer to find a specialist with this specific knowledge of the labor market.  On the other hand, the popular high-level Python programming language with the <a href="http://www.myhdl.org/">MyHDL</a> framework makes FPGA programming simple and enjoyable.  Moreover, people who know Python are an order of magnitude more specialists who own Verilog / VHDL.  With a series of articles I want to show how easy it is to get into the FPGA area, knowing Python and start doing real complex FPGA projects in this language.  I note that python FPGA is not executed directly, but is a tool for generating firmware. <br><a name="habracut"></a><br>  First of all, we need python version 3.6 itself (hereinafter, all operations are performed in Ubuntu 18.04 OS). <br><br>  Install myhdl: <br><br><pre><code class="bash hljs">pip3 install myhdl</code> </pre> <br>  As ‚ÄúHello World!‚Äù, We will write a simple program that causes the LEDs to light up by pressing a button.  In the microprocessor world, ‚ÄúHello World!‚Äù Is a program that flashes with a single LED, while in the FPGA world, Hello World is the blinking of a thousand LEDs.  There are only four LEDs on the board, so only they will blink depending on the button press.  It is important to note that all the code in the FPGA, unlike microcontrollers, is executed simultaneously, all the diodes are lit and extinguished simultaneously.  And not consistently in the case of microcontrollers.  In the role of the experimental one, the WaveShare OpenEPM1270 board with Altera Max II EPM1270T144C5 plis is used on board. <br><br><img src="https://habrastorage.org/webt/-l/lk/c8/-llkc88kifaz0umesq_pctqoim4.jpeg"><br><br>  Create a new python file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myhdl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randrange <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">led_blinker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(input1, led1, led2, led3, led4)</span></span></span><span class="hljs-function">:</span></span> @always_comb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_off_led</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> input1 == <span class="hljs-number"><span class="hljs-number">1</span></span>: led1.next = <span class="hljs-number"><span class="hljs-number">1</span></span> led2.next = <span class="hljs-number"><span class="hljs-number">1</span></span> led3.next = <span class="hljs-number"><span class="hljs-number">0</span></span> led4.next = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: led1.next = <span class="hljs-number"><span class="hljs-number">0</span></span> led2.next = <span class="hljs-number"><span class="hljs-number">0</span></span> led3.next = <span class="hljs-number"><span class="hljs-number">1</span></span> led4.next = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> on_off_led</code> </pre><br>  To find out if our code works correctly, you need a verification tool.  In fact, any program for FPGA is a digital signal processor, respectively, the developer needs to make sure that he has correctly indicated what to do with the chip.  This is done through a simulation, for this you need to install a program that will display the processed signals.  There are quite a few such programs, but in my opinion, the best so far is free GTKWave.  Put from the terminal: <br><br><pre> <code class="bash hljs">sudo apt-get install gtkwave</code> </pre> <br>  Next, in the file with the firmware, you should describe the test environment.  This is also a Python function: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> input1, led1, led2, led3, led4 = [Signal(bool(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">5</span></span>)] test = led_blinker(input1, led1, led2, led3, led4) @always(delay(<span class="hljs-number"><span class="hljs-number">10</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> input1.next = randrange(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> test, gen</code> </pre><br>  Here the test environment generates a random sequence of zeros and ones (using the Python module random). <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simulate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(timesteps)</span></span></span><span class="hljs-function">:</span></span> tb = traceSignals(test) sim = Simulation(tb) sim.run(timesteps)</code> </pre><br>  And we initialize the simulator, dragging the environment function test_inverter there.  Thus, the result is the nested doll inverter ‚Üí test_inverter ‚Üí simulate (time in arbitrary units). <br><br>  After running the script in the working folder, create a .vcd file and skip it through gtkwave, in the terminal: gtkwave test_invereter.vcd. <br><br><img src="https://habrastorage.org/webt/fr/qf/lv/frqflvkzfgc2s_7s2ct4bsr6lem.png"><br><br>  As a result, a random sequence of input1 input signals was generated, and how the led_blinker function processed these signals. <br><br>  After we made sure that the logic worked exactly as we wanted, then this function should be thrown into the FPGA.  I‚Äôm used to working with Intel (previously Altera) microcircuits, this sequence of actions is similar for other manufacturers' microcircuits with corresponding CAD systems.  On the FPGA chip, a binary file is created that the compiler of the chip manufacturer creates, for Intel it is Quartus, for Xilinx Vivado.  Compilers can only work with code in VHDL / Verilog, so Python code should be translated into any of these languages ‚Äã‚Äã(it doesn‚Äôt matter to which). <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> input1, led1, led2, led3, led4 = [Signal(bool(<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">5</span></span>)] toVerilog(led_blinker, input1, led1, led2, led3, led4) convert()</code> </pre><br>  In this example, the code is translated to Verilog.  The result is in the file led_blinker.v, and it will have to be given to Quartus to generate the FPGA firmware: <br><br><pre> <code class="vhdl hljs">module led_blinker ( input1, led1, led2, led3, led4 ); input input1; output led1; reg led1; output led2; reg led2; output led3; reg led3; output led4; reg led4; always @(input1) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>: LED_BLINKER_ON_OFF_LED <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((input1 == <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> led1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; led2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; led3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; led4 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> led1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; led2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; led3 = <span class="hljs-number"><span class="hljs-number">1</span></span>; led4 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre> <br>  In this approach to the development of FPGA firmware, you can ignore this file and simply throw it into Quartus. <br><br>  You can download Quartus from <a href="http://fpgasoftware.intel.com/">fpgasoftware.intel.com</a> , you need a free Lite version, which will be enough for us.  We download the basic version of the size of 9 GB. <br><br>  Installing Quartus should be easy for a regular Linux user.  After installation, you need to set some parameters in the system so that you can use the device for sewing the program FPGA - programmer: <br><br>  1. Create a udev rule.  To do this, create a new file /etc/udev/rules.d/51-altera-usb-blaster.rules with the following content: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># USB-Blaster SUBSYSTEM=="usb", ATTR{idVendor}=="09fb", ATTR{idProduct}=="6001", MODE="0666" SUBSYSTEM=="usb", ATTR{idVendor}=="09fb", ATTR{idProduct}=="6002", MODE="0666" SUBSYSTEM=="usb", ATTR{idVendor}=="09fb", ATTR{idProduct}=="6003", MODE="0666" # USB-Blaster II SUBSYSTEM=="usb", ATTR{idVendor}=="09fb", ATTR{idProduct}=="6010", MODE="0666" SUBSYSTEM=="usb", ATTR{idVendor}=="09fb", ATTR{idProduct}=="6810", MODE="0666"</span></span></code> </pre><br>  Reboot udev using udevadm: <br><br><pre> <code class="bash hljs">sudo udevadm control --reload</code> </pre> <br>  2. We allow non-root access to the USB-Blaster device.  To do this, create the file /etc/udev/rules.d/altera-usb-blaster.rules with the line: <br><br><pre> <code class="bash hljs">ATTR{idVendor}==<span class="hljs-string"><span class="hljs-string">"09fb"</span></span>, ATTR{idProduct}==<span class="hljs-string"><span class="hljs-string">"6001"</span></span>, MODE=<span class="hljs-string"><span class="hljs-string">"666"</span></span></code> </pre> <br>  This gives rw-rw-rw- access to the programmer. <br><br>  3. Configure jtagd.  Quartus uses the jtagd daemon, which connects software to a programmer device, to work.  Copy the description from your Quartus directory: <br><br><pre> <code class="bash hljs">sudo mkdir /etc/jtagd sudo cp &lt;Quartus install path&gt;/quartus/linux64/pgm_parts.txt /etc/jtagd/jtagd.pgm_parts</code> </pre> <br>  Launch Quartus and create a new project ‚ÄúFile‚Äù - ‚ÄúNew project wizard‚Äù, type the name of the project. <br><br>  Next, click Next.  And in the Add Files menu, we connect the generated verilog file with the .v extension.  Thus, if the verilog file is edited from the python file, it will automatically be picked up by Quartus, Next we get to the device selection menu, in our case it is MAX II EMP1270T144C5 and a couple more times next.  Project created. <br><br>  In Project Navigator, go to the file menu and right-click to set our verilog file "Set as top-level entity". <br><br>  Compile the project.  Now in the ‚ÄúAssignments-Pin Planner‚Äù menu we configure the pins on the microcircuit: <br><br><img src="https://habrastorage.org/webt/j1/tq/2x/j1tq2xs2vmum49hubukjqbamibs.png"><br><br>  Compile again.  Now everything is ready for programming: Tools-Programmer.  We connect the programmer and power to the board, in the Hardware Setup we select our USB-Blaster, set the checkboxes as shown in the figure and Start. <br><br><img src="https://habrastorage.org/webt/9i/ge/t2/9iget2ugm70gdnp1rt1w5egwbii.png"><br><br>  After the Programmer reported Successful.  You can see the result on the board: <br><br><img src="https://habrastorage.org/webt/7c/z5/9j/7cz59jrtezjl8jku1jzol5sjfhm.gif"><br><br><h4>  Conclusion </h4><br>  This lesson describes how to create a working environment and the first simple FPGA project in the Python programming language. <br><br>  Reviewed by: <br><br><ul><li>  How to install: <ul><li>  myHDL; </li><li>  GTKWave; </li><li>  Quartus; </li></ul></li><li>  Configured USB Blaster programmer in Ubuntu; </li><li>  Developed a project for FPGA in python; </li><li>  Produced testing and verification of the project; </li><li>  Compiled project for FPGA; </li><li>  Loaded project on FPGA. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/439638/">https://habr.com/ru/post/439638/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>