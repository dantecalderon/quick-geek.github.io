<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I helped Alice not to respond to other names. Internship in Yandex</title>
  <meta name="description" content="Hi, Habr. My name is Alexey Rak, I am the developer of voice assistant Alice in the Minsk office of Yandex. I received this position, having passed he...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>As I helped Alice not to respond to other names. Internship in Yandex</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr.  My name is Alexey Rak, I am the developer of voice assistant Alice in the Minsk office of Yandex.  I received this position, having passed here, in the same team, a three-month internship last year.  About her I am going to tell you.  If you want to try it yourself - here is a <a href="https://ya.cc/55GID">link to the internship of 2019</a> . <br><br><img src="https://habrastorage.org/webt/4b/9m/2c/4b9m2c6ys4-cfjxicgd3-2kc2fw.jpeg"><br><br><a name="habracut"></a><h4>  How I arranged </h4><br>  I study at the 4th year of BSU, in 2018 I graduated from the School of Data Analysis, I lived and live in Minsk. <br><br>  At first, I, like other ShAD graduates, received a link to the internship in 2018.  Within a week after sending the questionnaire, it was required to allocate time, 6 hours in a row, for the online contest.  It contained problems about probability theory, the ability to code, invent algorithms.  It was possible to write the code in the language in which you know how.  I wrote several tasks in C ++, several in Python, I chose a language depending on the ease of use for a particular task. <br><br>  When you send a solution, a verdict immediately comes to it, after which the problem can be solved anew in order to get a more correct answer.  It took me a couple of hours out of 6 for all the tasks. I did not solve some of the problems on the first attempt. <br><br>  A few days later, recruiters contacted me and called me for the first full-time interview in the Minsk office.  It was with Alexei Kolesov, the head of the acoustic models and biometrics team, where I had to work.  The interview consisted in solving problems on a piece of paper or on a blackboard and answering questions on probability theory, algorithms, machine learning.  I think that the background of the Olympiad programming would allow me to cope with the online contest, even if I had not studied at the SAD, but on the interview I had the experience of the SAD really useful. <br><br>  A few days later, the second meeting took place, where I was assigned two more tasks on the knowledge of the algorithms: warm-up and basic.  With each task it was like this: I offered a solution, answered a few questions about this solution, and then wrote the code on a piece of paper. <br><br>  A few days later I was informed that I was accepted for an internship.  It was supposed to last three full months (as it eventually turned out).  The transition to a permanent position was not promised, but they said that such an option was possible. <br><br><h4>  Beginning of work </h4><br>  On the first day, after sorting out the organizational questions and getting a laptop, I went to have lunch with my colleagues.  We talked, then I put together a team repository and took up the first task - creating a simple Python script to start running a ready-made program in several threads and thereby speed up its execution.  In the process of creating the script, I became acquainted with the code review system - when other guys in the team verify your code.  Knowing that your closest colleagues will deal with him first, and other developers in the future, you try to write more clearly.  In Olympiad programming, everything is somewhat different: the speed with which you program is important, and it‚Äôs likely that you‚Äôll no longer need to look through what you‚Äôve written.  On the other hand, when I had to face the situation before Yandex, that the code would still have to be read, I also tried to make it more or less understandable. <br><br>  In the course of the internship, I solved several tasks similar to this script, but my main time was occupied by a much larger project - a new decoder for Alice‚Äôs spotter. <br><br>  In order for devices and applications in Yandex, where the assistant can be called up with a voice, everything works as the user expects, we need a quality spotter - a voice activation mechanism.  Most often, the activation phrase (which needs to be pronounced to launch Alice) contains the very word Alice. <br><br>  Spotter includes the preparation of features (signs for machine learning), a neural network and a decoder. <br><br><h4>  Previous decoder </h4><br>  The previous version of the decoder worked by processing probability vectors.  There is an acoustic model - the neural network, which for each frame (a fragment of speech with a duration of 10‚Äì20 milliseconds) returns the probability that it has now been spoken.  Frames can overlap each other.  The decoder contained a matrix with probabilities for the last 100 frames ‚Äúheard‚Äù by the device.  The sound of each letter corresponds to a certain vector of probabilities.  The algorithm found the element with the highest probability in the vector for the letter A, after which it considered only the right part of the matrix with respect to this element.  Then the operation was repeated for the letters L, I, C and A - every time the matrix was ‚Äúcut off‚Äù by the found element.  Sounds A at the beginning and end of the word are actually different - the second of them is called Shwa, it is similar to A, E and O at the same time. <br><br>  If the final probability turned out to be greater than the threshold value, then the algorithm considered that the word was indeed pronounced, and activated Alice for the user. <br><br><img src="https://habrastorage.org/webt/wd/iu/ko/wdiukoij45gbcg83m_cmsvuqy0m.jpeg"><br><br>  Such a scheme led to the fact that the assistant sometimes spontaneously turned on not only when people said ‚ÄúAlice‚Äù, but also when he heard other words, for example, ‚ÄúAlexander‚Äù.  The sounds in the first part of this word (‚ÄúAlex‚Äù) follow in the same order and mostly coincide with the sounds in the word ‚ÄúAlice‚Äù.  The difference is only in the letters E and K, but E in its sound is very close to AND, and the algorithm did not take into account the presence of the letter K. <br><br><img src="https://habrastorage.org/webt/nv/pr/ur/nvprurwxlaaatkavmzq3cwvhp8k.jpeg"><br><br>  In theory, it is possible to search in spoken speech not only the word ‚ÄúAlice‚Äù, but also similar words.  There are not so many of them: ‚ÄúAlexander‚Äù, ‚ÄúAlex‚Äù, ‚Äúarrested‚Äù, ‚Äúladder‚Äù, ‚Äúaristarkh‚Äù.  If the algorithm believed that the user would most likely say one of them, then it would be possible to prohibit activation, regardless of the result of the main decoder. <br><br>  However, voice activation must operate even without the Internet.  Therefore, the decoder is a local mechanism.  It works thanks to the neural network, which each time runs directly on the user's device (for example, on the phone), without contacting Yandex servers.  And since everything happens locally, the performance (of the same phone as compared to the whole data center) leaves much to be desired.  To recognize not only the word "Alice" would mean significantly complicating the work of this small neural network and exceed the performance limits.  Activation would become slower, the assistant would respond with a long delay. <br><br>  We needed a completely different decoder.  My colleagues suggested that I implement the idea of ‚Äã‚Äãthe Hidden Markov Model, HMM: at the time of the beginning of my internship, it was already well described by the community, and also found use in the Alexa assistant from Amazon. <br><br><h4>  New HMM Decoder </h4><br>  The HMM decoder builds a graph of 6 vertices: one for each sound in the word ‚ÄúAlice‚Äù, plus one more for all other sounds ‚Äî another speech or noise.  The probabilities of transitions between vertices are estimated on a sample of recorded and proannototed speech.  For each sound heard, there are 6 probabilities: a coincidence with each of the five letters and with the sixth peak (that is, with any sound besides those found in the word ‚ÄúAlice‚Äù).  If the user says ‚ÄúAlexander‚Äù, the decoder will fail on K: the probability that the spoken sound is not part of the activation phrase will be too big and the helper will not work. <br><br><img src="https://habrastorage.org/webt/ds/np/r3/dsnpr3vxuxavi5e_14wnnakigiq.jpeg"><br><br>  In the near future, these changes will be available to all users of Alice and the SpeechKit library. <br><br><h4>  Completion of the internship and the transition to a permanent job </h4><br>  Of the three months of internship, I spent one and a half writing a HMM decoder.  At the end of the month and a half, the manager told me that the transition to a permanent position and an open-ended contract would be possible (although not guaranteed) if I continue to work as productively.  At about the same time, I took a two-week vacation to go to Olympiad programming fees.  When I returned, I started a new task - training spotters for various devices: Yandex.Telephone, on-board computer with Yandex.Auto and others. <br><br>  A couple of weeks later, about a month before the end of the internship, I had my first interview about a permanent position, and a few days later - the second, final one.  I spoke with the leaders of related teams.  At the first interview I was asked theoretical questions: about machine learning, neural networks, logistic regression, optimization methods.  In addition, they asked about regularization, that is, about reducing the degree of retraining of a given algorithm and about which algorithms which regularization methods are applied to.  The second interview was practical: we communicated via Skype with a colleague from Moscow, and in the process I dialed the code in a simple online editor. <br><br>  On my own initiative, I didn‚Äôt get a full-time job, but ¬æ - the fact is that my studies at BSU are not over yet.  At the permanent position, I, among other things, do automatic selection of threshold values ‚Äã‚Äãand other hyperparameters.  At each time, the system gets the likelihood that the keyword "Alice" was uttered.  The final classifier compares this probability with a threshold value and, if the threshold is exceeded, activates Alice.  Previously, the threshold was chosen by the developers, the current task is to learn how to do it automatically. <br><br>  So I got to Yandex, keeping my place in the Alice team. </div><p>Source: <a href="https://habr.com/ru/post/438768/">https://habr.com/ru/post/438768/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>