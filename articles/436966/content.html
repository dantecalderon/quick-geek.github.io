<div class="post__text post__text-html js-mediator-article">  This article will be interesting, who faced all sorts of problems after updating Google PageSpeed ​​and claims from customers or the boss, why a ball fell or there were so many comments.  As well as those who optimize sites. <br>  First of all, it is worth mentioning that <a href="https://habr.com/post/429668/">in this article</a> , in my opinion, everything is very competently and reasonably written. <br><br>  I will add more <i>practical</i> advice from myself, and it will also be interesting to listen to your point of view and see your achievements. <a name="habracut"></a><br><br>  I will list what I will talk about in this article: <br><br><ol><li>  CSS and JS <br><ul><li>  file connection </li><li>  library loading </li><li>  tricks </li></ul><br></li><li>  Fonts <br><ul><li>  font connection </li><li>  display fonts during page loading </li></ul><br></li><li>  Images <br><ul><li>  different formats (jpg, png, webp, base64) </li><li>  sprite </li></ul></li></ol><br>  And if you have stayed on this article up to this point, then you are most likely interested (or you have the back button on it). Below is more detailed about each item. <br><br><h3>  CSS and JS </h3><br>  <b>Js</b> <br><br><ol><li>  Mandatory will be the <b>async</b> property for connected scripts (except jQuery).  This will relieve you from GPSpeed ​​comments on asynchronous script downloads. </li><li>  The advice is banal, but it is very sensible - try to use complex and massive libraries to a minimum. </li><li>  Your js library settings (slick, fancybox) or small code snippets that perform different tasks are best uploaded to the server with one file.  In my case, and a script for sending mail, and a mask for input and animation, and everything is all in the same build.js file (which I also specify <b>async</b> . </li><li>  This advice is situational, that is, under the situation, see.  If you have a script running right after opening the page on its first screen, then it will be more correct to connect it separately and not give it <b>async</b> </li></ol><br>  <b>CSS</b> <br><br><ol><li>  It's a little more complicated here.  You will need to add this property to the <b>link</b> tag. <br><br><pre><code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">media</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">none</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">onload</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">if</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">media</span></span>!="<span class="hljs-selector-tag"><span class="hljs-selector-tag">all</span></span>") <span class="hljs-selector-tag"><span class="hljs-selector-tag">media</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">all</span></span>"" <span class="hljs-selector-tag"><span class="hljs-selector-tag">rel</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">stylesheet</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">type</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">css</span></span>", <span class="hljs-selector-tag"><span class="hljs-selector-tag">href</span></span>= <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.css</span></span>&gt;</code> </pre> <br>  In this form, your css files will be connected only after the DOM tree.  Roughly speaking, this is the same <b>async</b> only for .css </li><li>  Very important and effective advice!  It adds 5 to 10 points guaranteed.  You need to <b>split your main.css into two files</b> .  In the first there will be only those styles that are loaded for the content that is visible immediately after opening the page.  This is the top bar, header, first picture, first form, and so on.  In general, what you put on the "face" of your site.  In the second, everything else. </li></ol><br><h3>  Fonts </h3><br>  I discovered a new css property for fonts <br><br><pre> <code class="xml hljs">font-display</code> </pre> <br>  Specifically, its <b>swap</b> parameter, which, without waiting for your beautiful and heavy font to load, shows the text in the browser using the font built into the same browser (for example, sans-serif).  This immediately removes one of the errors in GPSpeed. <br><br>  It will look like this <br><br><pre> <code class="xml hljs"> @font-face { font-family: 'FontName'; src: local('FontName'), url('FontName.woff') format('woff'); font-weight: normal; font-style: normal; font-display: swap; }</code> </pre> <br>  There is also such a script (for its work you need to connect fontfaceobserver.js): <br><br><pre> <code class="javascript hljs">&lt;script&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sessionStorage.fontsLoaded) { html.classList.add(<span class="hljs-string"><span class="hljs-string">"fonts-loaded"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>); script.src = <span class="hljs-string"><span class="hljs-string">"../js/fontfaceobserver.js"</span></span>; script.async = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; script.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> regular = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FontFaceObserver(<span class="hljs-string"><span class="hljs-string">"FontName"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bold = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FontFaceObserver(<span class="hljs-string"><span class="hljs-string">"FontName"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">weight</span></span>: <span class="hljs-string"><span class="hljs-string">"bold"</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FontFaceObserver(<span class="hljs-string"><span class="hljs-string">"FontName"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">weight</span></span>: <span class="hljs-string"><span class="hljs-string">"300"</span></span> }); <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([ regular.load(), bold.load(), light.load() ]).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ html.classList.add(<span class="hljs-string"><span class="hljs-string">"fonts-loaded"</span></span>); sessionStorage.fontsLoaded = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }); }; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(script); } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre> <br>  Personally, I did not really help, but you try it, maybe you can better manage it.  After all, I found it in the open spaces, and people said that it really helps. <br><br><h3>  Connection fonts </h3><br><ol><li>  There are basically two types of connection - using a link (for example, google fonts, or locally, on a server. So, regarding the second method, it can also be divided into 2: a separate css file (using link we connect fonts.css ) and directly through the code (via your style.css). <br>  And since now we are talking about optimizing the site for GPSpeed, I was convinced that it is better to connect the fonts through your main css file. </li><li>  And one more tip that helps - put the font files (woff, ttf, etc.) next to your css file that requests it.  Previously, I had a separate folder on the server for fonts, but then I moved their font loading speed increased by 2 times.  (according to GPSpeed, the connection of the Muller font used to take 180ms, now 70-90ms) </li></ol><br><h3>  Images, pictures, etc. </h3><br>  Over the next 2 councils I vouch, they helped not only me, but the entire office and even friends working remotely. <br><br>  1. Download absolutely all <b>&lt;img</b> &gt; images using lazyloading.  It will look like this <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yourClass lazy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../images/image.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Описание"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  And do not forget to connect <b>lazyload.min.js</b> <br><br>  2. If you have a lot of <b>sv</b> g elements on the page, then it is better to add them <b>with clean code</b> , without unnecessary reference to the img tag.  In addition, svg must be squeezed, for example, using this site <a href="https://jakearchibald.github.io/svgomg/">jakearchibald.github.io/svgomg</a> (not advertising). <br><br>  3. Trite, but do not forget to squeeze ALL the pictures on the site.  Even those that weigh 5kb.  Although these 3 KB which you win will not affect the download speed in any way, you will get rid of the error on GPSpeed, and add yourself up to 10 points. <br><br>  <b>!</b>  Now the problem point - image formats.  Namely, we care about <i>webp, jpeg 2000, jpeg xr</i> .  After all, this is now one of the recommended GPSpeed ​​fonts.  As you know, they are still not supported by some browsers, among which is quite popular Mozila Firefox.  Even though they announced that <b>in March there will be full support for</b> this format, we still have to wait another year until all the users of this browser are updated to the latest version ... I rummaged through a bunch of websites, a bunch of scripts, but found nothing sensible.  So now it's my time to ask you: do you use webp format or any other new image formats?  And how do you do it? </div>