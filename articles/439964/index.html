<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerability CVE-2019-5736 in runc, allowing to get root privileges on the host</title>
  <meta name="description" content="Note trans. : Last night, Aleksa Sarai, senior container engineer from SUSE Linux, reported in the mailing list oss-sec about the critical runc / LXC ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Vulnerability CVE-2019-5736 in runc, allowing to get root privileges on the host</h1><div class="post__text post__text-html js-mediator-article">  <i><b>Note</b></i>  <i><b>trans.</b></i>  <i>: Last night, Aleksa Sarai, senior container engineer from SUSE Linux, reported in the mailing list oss-sec about the critical runc / LXC security vulnerability that allows an attacker who has access to an isolated container to get root privileges on the host system.</i>  <i>Since the problem has been identified in the reference implementation of the executable environment for containers, runc, it affects numerous container systems including Docker / Moby, <a href="https://habr.com/ru/company/flant/blog/426141/">Podman</a> , <a href="https://habr.com/ru/company/flant/blog/340010/">cri-o</a> (and Kubernetes itself).</i>  <i>Below are the details in the form of translation of the message engineer in the mailing list.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/lb/bt/fdlbbt-2izekxvte6pqe0bhmoss.jpeg"></div><br>  I am one of the runc maintainers (the underlying container execution environment used in Docker, cri-o, containerd, Kubernetes, etc.).  Recently it became known about the vulnerability, which we checked and patched. <a name="habracut"></a><br><br>  Researchers who discovered the vulnerability: <br><br><ul><li>  Adam Iwaniuk; </li><li>  Borys Pop≈Çawski. </li></ul><br>  In addition, Aleksa Sarai (i.e., I) discovered that a more sophisticated version of this vulnerability is affected by LXC. <br><br><h2>  Short review </h2><br>  Vulnerability allows a malicious container (with minimal user interaction) to rewrite the runc binary binary and thus be able to execute code with root privileges on the host.  The degree of user interaction is such that it allows you to run any commands (no matter if the attacker controls the command) with root rights within the container in any of these contexts: <br><br><ul><li>  Creating a new container from the image controlled by the attacker; </li><li>  Connect ( <code>docker exec</code> ) to an existing container that the attacker previously had write access to. </li></ul><br>  This vulnerability is <b>not blocked by</b> either the AppArmor default policy or the SELinux default policy in Fedora * (because container processes appear to be running with <code>container_runtime_t</code> ).  However, it is <b>blocked by the</b> correct use of user-defined namespaces (where the root of the host is not the map in the user namespace of the container). <br><br>  The CVSSv3 vector (with a rating of 7.2) is: <br><br> <code>AV:L/AC:H/PR:L/UI:R/S:C/C:N/I:H/A:H</code> <br> <br>  The <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-5736">issue has been</a> assigned <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-5736">CVE-2019-5736</a> . <br><br>  <i>* The problem only applies to the <code>moby-engine</code> package in Fedora.</i>  <i>The <code>docker</code> package, like <code>podman</code> , is protected from its operation, since it starts container processes as <code>container_t</code> .</i> <br><br><h2>  Patches </h2><br>  I attach the appropriate patch that fixes the problem ( <a href="https://seclists.org/oss-sec/2019/q1/att-119/0001-nsenter-clone-proc-self-exe-to-avoid-exposing-host-b.patch"><code>0001-nsenter-clone-proc-self-exe-to-avoid-exposing-host-b.patch</code></a> ).  It is based on the <code>HEAD</code> branch, although the code in <code>libcontainer/nsenter/</code> changes so rarely that the patch most likely applies to almost any old version of the runc codebase you are dealing with. <br><br>  Please note that the <a href="https://github.com/opencontainers/runc/commit/0a8e4117e7f715d5fbeef398405813ce8e88558b">patch</a> that I push to the runc master branch is a modified version of this patch, although they are functionally identical (if you have not patched your files with the attached patch, we recommend using the upstream version). <br><br><h2>  Minor Exploit Code </h2><br>  Some vendors requested an exploit code to make sure the patches solved the problem.  Since the problem is very serious (especially for vendors of public clouds), we decided to provide such a code.  The exploit is written by me, is more general than the original code provided by researchers, and works for LXC (does not require strong modifications to be able to apply to other vulnerable executable environments).  Details on how to use the exploit code are provided in the <code>README</code> . <br><br>  In accordance with the rules of OpenWall, the exploit code will be <b>publicly</b> announced 7 days after CRD (i.e. February 18, 2019).  <b>If you have an executable environment for containers, please make sure that it is not affected by this vulnerability.</b> <br><br><h2>  Impact on other projects </h2><br>  It should be noted that in the course of further investigation of the problem, I discovered that LXC has a similar vulnerability, and they already push a similar <a href="https://github.com/lxc/lxc/commit/6400238d08cdf1ca20d49bafb85f4e224348bf9d">patch of</a> our joint development.  LXC is a little harder to exploit, but the problem itself is the same. <br><br>  Discussion with representatives of systemd-nspawn led to the conclusion that they are not vulnerable (since they have a different method of connecting to the container for LXC and runc). <br><br>  I was also contacted by representatives of Apache Mesos, who reported that they were also vulnerable (I think that they simply used the exploit code that will be published).  It seems very likely that most executable environments for containers are vulnerable if they have not previously taken some very unusual actions to mitigate its potential impact. <br><br><h2>  Other news </h2><br>  We set up an announcement mailing for future security vulnerabilities: the process for joining it is described <a href="">here</a> (it is based on the Kubernetes security-announce mailing list).  Please join if you distribute any executable environments for containers that depend on runc (or other OCI projects). <br><br><h2>  PS From the translator </h2><br>  Problem CVE-2019-5736 in trackers of popular Linux distributions: <br><br><ul><li>  <a href="https://security-tracker.debian.org/tracker/CVE-2019-5736">Debian</a> , <a href="https://people.canonical.com/~ubuntu-security/cve/2019/CVE-2019-5736.html">Ubuntu</a> ; </li><li>  <a href="https://bugzilla.redhat.com/show_bug.cgi%3Fid%3DCVE-2019-5736">RHEL</a> , <a href="https://bugzilla.redhat.com/show_bug.cgi%3Fid%3D1674489">Fedora</a> ; </li><li>  <a href="https://bugzilla.novell.com/show_bug.cgi%3Fid%3DCVE-2019-5736">SUSE</a> . </li></ul><br>  ... and the <a href="https://kubernetes.io/blog/2019/02/11/runc-and-cve-2019-5736/">Kubernetes blog entry</a> (pay attention to the ‚ÄúWhat should I do?‚Äù Section). </div><p>Source: <a href="https://habr.com/ru/post/439964/">https://habr.com/ru/post/439964/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>