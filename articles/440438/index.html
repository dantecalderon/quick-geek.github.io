<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MQTT / UDP, Pre-Spring Results: Remote Configuration and Digital Signature</title>
  <meta name="description" content="Winter is ending, and this is a reason to draw another line and tell what's new in MQTT / UDP. 

 For starters, links to previous intro and article . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>MQTT / UDP, Pre-Spring Results: Remote Configuration and Digital Signature</h1><div class="post__text post__text-html js-mediator-article">  Winter is ending, and this is a reason to draw another line and tell what's new in MQTT / UDP. <br><br>  For starters, links to previous <a href="https://habr.com/ru/post/429714/">intro</a> and <a href="https://habr.com/ru/post/435450/">article</a> . <br><br>  Thanks to everyone who responded with interest and separately to those who shared their thoughts.  You helped me a lot with the digital signature approach.  So, what has changed in a big way: <br><br><ul><li>  A flexible protocol extension mechanism appeared: Tagged Tail Records, TTRs </li><li>  On its basis, a digital signature package was made. </li><li>  The mechanism of remote component configuration is made. </li><li>  Raised the full CI cycle: assembly, unit tests, end-to-end protocol tests (4 * 4 programming languages) </li><li>  The C implementation now supports different architectures and can integrate with different operating systems and monitors. </li><li>  There are public packages for Python and Lois, although, of course, they are already outdated. </li></ul><br>  Well, a lot of the little things: integration with OpenHAB, config files and logging, checking compatibility with the cloud MQTT service, made a test case for Wemos D1 (NodeMCU), made a test case for atmega128 + ethernet (not arduino), made an example of a protocol connector on Java (CCU825), made an example of a controller informer in the desktop tray (at last I can turn on the light in the room with two mouse clicks :), and more. <br><br>  Now in order. <br><a name="habracut"></a><br><h2>  Tagged Tail Entries </h2><br>  I felt cramped in the MQTT package.  I added tailing additives to the package in the form of tag-length-content, in which you can now put the necessary data.  Today it is the package id, the package id to which we respond (for QoS, this is still in operation) and the digital signature, if enabled.  The date-time is also planned in milliseconds of the moment of measuring the magnitude and the moment of sending the packet (as a palliative of the moment of measurement), and then arbitrary extensions are possible within the framework of the UDP packet size. <br><br>  (SVG is not inserted, the <a href="https://github.com/dzavalishin/mqtt_udp/wiki/Tagged-Tail">illustration is here</a> ) <br><br>  It already works everywhere except Lua.  (Actually, Lua disappointed me, and only NodeMCU keeps it, and then I will try to go to Python there). <br><br><h2>  Digital signature </h2><br>  I was afraid to approach this weight, but after the appearance of tag extensions everything became quite simple.  The sent package is signed according to the HMAC MD5 standard (I considered others too long for short UDP packets), a check is made at the entrance.  Whether or not to accept the package without a signature is left to the application code.  True, in Java there is a switch "reject all unsigned", but this seems to be maximalism. <br><br><h2>  Remote configuration </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/61a/0d8/f2f/61a0d8f2fde91bc44a63e0256024b5db.png" alt="image"><br><br>  In fact, everything is simple again: there is a desktop program (Java, it works everywhere), which makes a request (SUBSCRIBE package) for a topic of a certain type ( <code>$SYS/conf/#</code> ).  All nodes that can be remotely configured respond to the current values ‚Äã‚Äãof the configurable parameters.  The program from this synthesizes a simple UI with names and input fields, the user changes the settings, the commands for updating fly back.  The entire infrastructure in the libraries, from the side of the application code, you only need to give a list of parameters and be able to write / read them to a file or NVRAM. <br><br><h2>  Architecture and system-dependent code for C </h2><br>  Now you can add settings for the architecture (toolchain) and glue code for the target OS or monitor.  This is tested on three configurations ‚Äî unix / cygwin (./configure), mingw, and NUT / OS (without configure). <br><br>  Well, and probably for today.  There is no time for details, but if there is interest, I will write in more detail. <br><br>  <a href="https://mqtt-udp.readthedocs.io/en/latest/">Documentation for the project</a> , more than aspirations, is still quite relevant, and it is decently written there.  Sorry for the lack of the Russian language, but I don‚Äôt have much time for this, I would like to translate based on the infrastructure, but I haven‚Äôt found any acceptable public service (online editor) for translating the paragraph into a paragraph. <br><br>  Well, <a href="https://github.com/dzavalishin/mqtt_udp">the repository itself</a> . </div><p>Source: <a href="https://habr.com/ru/post/440438/">https://habr.com/ru/post/440438/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>