<div class="post__text post__text-html js-mediator-article">  The data storage systems on the market, for the most part, do not differ much from each other, because many vendors order equipment from almost the same ODM manufacturers.  We have almost everything of our own, starting from the chassis and ending with controllers, technologies like RAID 2.0+ and software. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/322/998/10b/32299810bc9bd9ada307791b87ed4399.jpg"><br><br>  Under the cut there are a few details about what is so unusual in each of the nodes of the storage system. <br><a name="habracut"></a><br><h2>  What is interesting at the module level </h2><br>  Structurally, all modern storage systems from any manufacturer look the same: controllers are installed in the front part of the steel box chassis, and interface modules are installed in the rear part of the steel box chassis.  There are also power supplies and ventilation.  It would seem that everything is familiar and standard.  But in fact, we have introduced many interesting things into this paradigm. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba1/c23/fa6/ba1c23fa68f9c8598b0834d1ccddeeb4.png"><br><br>  Let's start with the installation of the elements of the storage system in the chassis.  Magnetic 3.5-inch disks in the storage system becomes smaller, hybrid systems and all-flash are beginning to dominate.  But even a few disk drives with a spindle speed of up to 15 thousand revolutions per minute create a vibration that cannot be ignored.  We have a whole set of recommendations for this case - how to distribute magnetic drives with different parameters across disk shelves. <br><br>  Even if some fraction of a percentage, but it affects the reliability.  And on the scale of a large data center, the percentage of one storage drive turns into tangible indicators of failures and failures.  To reduce the vibration of individual discs to a lesser degree through a rigid chassis structure, we equip the drive sled with rubber or metal dampers.  To neutralize another source of vibration in the storage system - ventilation modules - we put bidirectional fans, and isolate all the rotating elements from the chassis housing. <br><br>  For spindle drives, minimal shaking is already a problem: the heads start to stray, performance drops significantly.  SSD is another matter, they are not afraid of vibrations.  But reliable fixing of the components is still important.  Take the delivery process: the box can be dropped or casually thrown, put sideways or upside down.  Therefore, all of our storage components are fixed strictly in three dimensions.  This eliminates the possibility of their displacement during transportation, prevents the connectors from jumping out of the sockets in case of accidental impact. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/222/452/b71/222452b713906c3b059a782df1df8778.png"><br><br>  Once upon a time we started with the development of computing equipment for the telecom industry, where the standards of performance in terms of temperature and humidity are traditionally high.  And we transferred them to other areas: the metal parts of the storage system do not oxidize even at high humidity - due to the use of nickel plating and galvanizing. <br><br>  The thermal design of our storage systems was developed with a focus on the uniform distribution of temperature across the chassis - in order to prevent either overheating or too much cooling of any corner of the disk shelf.  Otherwise, it is impossible to avoid physical deformation - even if it is insignificant, but still violates the geometry and can lead to a reduction in the lifetime of the equipment.  Thus, some fractions of a percent are won, but this still affects the overall reliability of the system. <br><br><h2>  Semiconductor subtleties </h2><br>  We duplicate important storage components: if something fails, there is always a safety net.  For example, the power supply modules for the younger models work according to the 1 + 1 scheme, for the more solid ones - 2 + 1 or even 3 + 1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a6/205/63c/6a620563cf83f69d7107cf71c734045a.png"><br><br>  Controllers that are at least two in the storage system (we do not supply single-controller systems) are also reserved.  In the storage system of the 6800th and older series, the reservation is made according to the 3 + 1 scheme, in the younger models - 1 + 1. <br><br>  Even the management board is reserved, which does not affect the operation of the system directly, but is only needed for configuration changes and monitoring.  In addition, any interface storage expansion cards for us are sold only in pairs, so that the client has a reserve. <br><br>  All components - BP, fans, controllers, management modules, etc.  - equipped with microcontrollers capable of responding to certain situations.  For example, if the fan starts to slow down by itself, an alarm is sent to the control module.  As a result, the customer has a complete picture of the state of the storage system - and, if necessary, can replace some of the components on their own, without waiting for the arrival of our service engineer.  And if the customer's security policy allows, we set up the controllers so that they transmit information about the state of iron to our technical support. <br><br><h2>  Your chips are better and clearer </h2><br>  We are the only company developing our own processors, chips and controllers for solid-state drives for our storage systems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b7/4b5/cd7/3b74b5cd764590f64381ddedac4e61f4.png"><br><br>  So, in some models, we use not the classic Intel x86, but the ARM processor of HiSilicon, our subsidiary, as the main processor of the storage system (Storage Controller Chip).  The fact is that the ARM architecture in the storage system - for calculating the same RAID and deduplication - does better than the standard x86. <br><br>  Our special pride is chips for SSD controllers.  And if our servers can be equipped with third-party semiconductor drives (Intel, Samsung, Toshiba, etc.), then we install only our own developed SSDs in data storage systems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d0/50d/072/3d050d0726471a2fd88d4bb12df5d001.png"><br><br>  The microcontroller of the input-output module (smart I / O chip) in storage systems is also a HiSilicon development, as well as a Smart Management Chip for remote storage management.  Using our own microchips helps us better understand what happens at each moment in time with each memory cell.  This is what allowed us to minimize delays when accessing data in the same Dorado storage systems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc4/d92/d3e/bc4d92d3ecad08047aff3dff031ecdab.png"><br><br>  For magnetic disks, constant monitoring is extremely important in terms of reliability.  The DHA system (Disk Health Analyzer) is supported in our storage systems: the disk itself continuously records what is happening to it, how well it feels.  Due to the accumulation of statistics and the construction of smart predictive models, it is possible to predict the transition of the drive to a critical state in 2-3 months, and not in 5-10 days.  The disk is still “alive”, the data on it is completely safe - but the customer is ready to replace it at the first signs of a possible failure. <br><br><h2>  RAID 2.0+ </h2><br>  Fail-safe design in the storage system, we have thought through and at the system level.  Our Smart Matrix technology is an add-on over PCIe - this bus, on the basis of which intercontroller connections are implemented, is particularly well suited for SSDs. <br><img src="https://habrastorage.org/getpro/habr/post_images/698/6b6/77b/6986b677b32270689efb4227ac50c0ba.png"><br><br>  Smart Matrix provides, in particular, 4-controller full mesh in our Ocean Store 6800 v5 storage system.  In order for each controller to have access to all disks in the system, we have developed a special SAS backend.  The cache, of course, is mirrored between all currently active controllers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65c/8d3/02d/65c8d302d80df3ddb29db0875e6df968.png"><br><br>  When a controller fails, services from it quickly switch to the mirror controller, and the remaining controllers restore the interconnection to mirror each other.  At the same time, the data recorded in the cache memory has a mirror reserve to ensure the reliability of the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/584/b22/f68/584b22f687f063043728ab0db9ed8392.png"><br><br>  The system withstands the failure of three controllers.  As shown in the figure, if control A fails, the cache data of controller B will select controller C or D for cache mirroring.  When controller D fails, controllers B and C mirror the cache. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/e1d/cdc/a93e1dcdc50efd90618de7857e1d7583.png"><br><br>  The RAID 2.0 data distribution system is a standard for our storage systems: disk-level virtualization has long replaced the unsophisticated block copying of content from one medium to another.  All disks are grouped into blocks, those are combined into larger conglomerates of a two-tier structure, and logical volumes are built up above its top level, from which RAID arrays are composed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e66/080/8bf/e660808bfa5e8e4599fecf7e8ad99dcd.png"><br><br>  The main advantage of this approach is the shortened rebuild time.  In addition, in the event of a disk failure, the rebuilding is performed not on the hot spare disk, but on the free space in all used disks.  The figure below shows nine RAID5 hard drives as an example.  When hard disk 1 has failed, data CKG0 and CKG1 are damaged.  The system selects CK for random reconstruction. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0fb/fe1/675/0fbfe16756f70b8249910219069942fe.png"><br><br>  The normal RAID recovery speed is 30 MB / s, so it takes 10 hours to restore 1 TB of data.  RAID 2.0+ reduces this time to 30 minutes. <img src="https://habrastorage.org/getpro/habr/post_images/1bb/3c2/84f/1bb3c284f588667973debf1fe2713093.png"><br><br>  Our developers managed to achieve a uniform load distribution between all spindle drives and SSDs as part of the system.  This allows you to unlock the potential of hybrid storage systems much better than the usual use of solid-state drives as a cache. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44c/e59/06e/44ce5906eb4c867c8fed0db763df36f5.png"><br><br>  In Dorado class systems, we implemented the so-called RAID-TP, a triple parity array.  Such a system will continue to work with the simultaneous failure of any three disks.  This improves reliability compared to RAID 6 by two decimal orders, with RAID 5 by three. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/624/59d/618/62459d61809ed563a11e0d8fbd7ec173.png"><br><br>  We recommend RAID-TP for especially critical data, especially since, due to RAID 2.0 and high-speed flash drives, this does not have a special effect on performance.  Just need more free space to reserve. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/0f1/5c1/f090f15c1b0772e6145a8a2be38a9b30.png"><br><br>  As a rule, all-flash systems are used for DBMS with small data blocks and high IOPS.  The latter is not very good for SSD: the safety margin of NAND memory cells is quickly exhausted.  In our implementation, the system first collects a relatively large block of data in the cache of the drive, and then writes it entirely into cells.  This allows you to reduce the load on the disks, as well as in a more sparing mode, to conduct "garbage collection" and freeing up space on the SSD. <br><br><h2>  Six nines </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/176/aef/c41/176aefc417106ccbc2320bd0cb7e7fcd.png"><br><br>  The above allows you to talk about the resiliency of our systems at the level of the entire solution.  The check is implemented at the application level (for example, Oracle DBMS), operating system, adapter, storage system - and so on up to the disk.  This approach ensures that exactly the block of data that came to the external ports, without any damage and loss will be recorded on the internal disks of the system.  This implies an enterprise level. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e94/ffb/4d8/e94ffb4d8afa053872de75a76ff78861.png"><br><br>  For reliable data storage, protection and recovery, as well as quick access to them, we have developed a number of proprietary technologies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d6/84f/78a/5d684f78a76b0210bfc47eaa1cf933c8.png"><br><br>  HyperMetro is probably the most interesting development of the last one and a half years.  A ready-made solution based on our storage systems for building a resilient metro cluster is implemented at the controller level; it does not require any additional gateways or servers except an arbitrator.  It is implemented simply by a license: two Huawei storage systems plus a license - and it works. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27b/034/cd0/27b034cd082f3275da66b2444c0e57fb.png"><br><br>  HyperSnap technology provides continuous data protection without loss of performance.  The system supports RoW.  To prevent data loss on the storage system at any given moment uses a variety of technologies: various snapshots, clones, copies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a13/880/a78/a13880a7899505127f17c3d5184372ce.png"><br><br>  Based on our storage systems, at least four disaster recovery solutions have been developed and tested in practice. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a3e/ffc/cbf/a3effccbfe265b951f2d154285156e29.png"><br><br>  We also have a solution for three 3DC Ring DR Solution data centers: two data centers in a cluster, the third is being replicated.  We can organize organized asynchronous replication or migration from third-party arrays.  There is a smart virtualization license, so you can use volumes from most standard arrays with access by FC: Hitachi, DELL EMC, HPE, etc.  The solution is really worked out, there are analogues on the market, but they are more expensive.  There are examples of use in Russia. <br><br>  As a result, at the level of the entire solution, you can get the reliability of six nines, and at the level of the local storage system, five nines.  In general, we tried. <br><br>  <i>Author: Vladimir Svinarenko, Senior Manager for IT Solutions, Huawei Enterprise in Russia</i> </div>