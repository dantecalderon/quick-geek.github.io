<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We audit bugs</title>
  <meta name="description" content="A frequently used contract for functions that return an interface type error value is that the caller should not know in advance about the state of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>We audit bugs</h1><div class="post__text post__text-html js-mediator-article"><p>  A frequently used contract for functions that return an interface type error value is that the caller should not know in advance about the state of the other values ‚Äã‚Äãreturned by this call without first checking the error. </p><br><p>  In most cases, the error values ‚Äã‚Äãreturned by functions must be opaque to the caller.  That is, a test in which the error is nil indicates whether the call was successful or unsuccessful, and that is all that needs to be done. </p><br><p><img src="https://habrastorage.org/webt/jb/xv/la/jbxvlaijfvce8_omekhvomevlci.jpeg"><br>  <em>picture <a href="">from here</a></em> </p><a name="habracut"></a><br><p>  A small number of cases usually associated with interaction with the outside world, such as network activity, require the caller to study the nature of the error in order to decide whether it is advisable to repeat the operation. </p><br><p>  A common requirement for package authors is to return errors of a known open type so that the caller can use type assert and examine them in detail.  I believe that this practice leads to a number of undesirable results: </p><br><ul><li>  Open error types increase the "contact area" of the package API. </li><li>  New implementations should return only the types specified in the interface declaration, even if they are poorly suited. </li><li>  The type of error, after being added to the code, cannot be changed or declared obsolete without violating compatibility, making the API fragile. </li></ul><br><h3 id="podtverzhdayte-ozhidaemoe-povedenie-a-ne-tip-oshibok">  Confirm the expected behavior, not the type of error </h3><br><p>  Do not claim that the error value is a specific type, but rather state that the value implements a specific behavior. </p><br><p>  This sentence corresponds to the nature of implicit Go interfaces, and is not a [subtype] of the nature of languages ‚Äã‚Äãbased on inheritance.  Consider this example: </p><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTimeout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err error)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> timeout <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Timeout() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> } te, ok := err.(timeout) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ok &amp;&amp; te.Timeout() }</code> </pre> <br><p>  The caller can use isTimeout () to determine if the error is due to a timeout, by implementing a timeout interface, and then confirm if the error was due to a timeout ‚Äî all without knowing the type or source. error values. </p><br><p>  This method makes it possible to wrap errors, as a rule, with libraries that add explanations to the path of the error;  provided that the wrapped error types also implement the error interfaces that they wrap. </p><br><p>  This may seem an intractable problem, but in practice there are quite a few generally accepted interface methods, so the Timeout () bool and Temporary () bool will cover a large set of use cases. </p><br><h3 id="v-zaklyuchenie">  Finally </h3><br><p>  Confirm the expected behavior, not the type of error </p><br><h4 id="dlya-avtorov-paketov">  For package authors </h4><br><p>  If your package generates temporary errors, make sure you return the types of errors that implement the appropriate interface methods.  If you wrap error values ‚Äã‚Äãat the output, make sure that your wrappers support the interface (s) with which the original error value is implemented. </p><br><h4 id="dlya-polzovateley-paketa">  For package users </h4><br><p>  If you need to check the error, use the interfaces to confirm the expected behavior, not the type of error.  Do not ask the authors of the packages about open types of errors;  Ask them to customize their types to common interfaces by specifying the Timeout () or Temporary () methods, depending on the situation. </p><br><h2 id="ob-avtore">  about the author </h2><br><p>  The author of this article, <a href="https://github.com/davecheney">Dave Cheney</a> , is the author of many popular Go packages, for example, <a href="https://github.com/pkg/errors">https://github.com/pkg/errors</a> and <a href="httpstat">https://github.com/davecheney/httpstat</a> . </p><br><h2 id="ot-perevodchika">  From translator </h2><br><p>  Although the original article dates from the end of 2014, it seems to me that it has not lost its relevance.  The described approach is found in few packages, while the rest use the usual approach for errors. </p><br><p>  <em>Edits to the text to improve the comprehensibility of the material are welcome!</em> </p></div><p>Source: <a href="https://habr.com/ru/post/440818/">https://habr.com/ru/post/440818/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>