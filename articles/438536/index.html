<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Under the hood of the chat bot: what can and how does RocketBot work</title>
  <meta name="description" content="RocketBot is a programmable chat bot that integrates with VK, Telegram and Bitrix24. Today we will talk about the infrastructure and other technologie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Under the hood of the chat bot: what can and how does RocketBot work</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://rocketaction.ru/">RocketBot</a> is a programmable chat bot that integrates with VK, Telegram and Bitrix24.  Today we will talk about the infrastructure and other technologies on which it is built. <br><br> <a href="https://habr.com/ru/company/it-grad/blog/438536/"><img src="https://habrastorage.org/webt/vf/t_/jn/vft_jnhxmkcnqm19hug1qohxzpy.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9">/ photo <a href="https://www.flickr.com/photos/dbraaten/323401934/">Darryl Braaten</a> <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA</a></font> <br><br><h2>  Tools </h2><br>  When developing RocketBot, we focused on the speed of development and prototyping.  For this reason, the system is written in Python, and MySQL is selected as the database. <br><br>  Today, Python <a href="https://www.tiobe.com/tiobe-index/">ranks third</a> in the TIOBE ranking in popularity.  This means that the language has a large community and an endless amount of reference books: books, websites, courses, and source codes.  For example, on GitHub, you can find <a href="https://github.com/realpython/python-guide">collections of best practices for developing in Python</a> , and <a href="https://ru.stackoverflow.com/questions/tagged/python">a large number of threads are open</a> on StackOverflow.  A lot of books are dedicated to this language by O'Reilly, you can highlight ‚Äú <a href="https://www.amazon.com/Hitchhikers-Guide-Python-Practices-Development/dp/1491933178">Hitchhiker</a> 's <a href="https://www.amazon.com/Hitchhikers-Guide-Python-Practices-Development/dp/1491933178">Guide to Python</a> ‚Äù and ‚Äú <a href="https://www.amazon.com/Machine-Learning-Python-Cookbook-Preprocessing/dp/1491989386">Machine Learning with Python</a> ‚Äù. <br><br>  In addition to a large number of sources, one of the main advantages of Python is a variety of libraries and functional ML-frameworks.  Examples include <a href="https://pytorch.org/">PyTorch</a> and <a href="https://scikit-learn.org/">SciKit-learn</a> - these are powerful tools that simplify the processing of natural speech, dialogs and scripts. <br><br><blockquote>  In particular, we used PyTorch to develop learning models, since it has ample opportunities for prototyping.  Additionally, we implemented scikit-learn, which performs preliminary data processing, as well as pymorth2 and gensim (for working with morphology and textualization of texts, respectively).  We also experience <a href="https://deeppavlov.ai/">DeepPavlov</a> - we evaluate its capabilities. </blockquote><br>  As for the database, we chose it for reasons of ‚Äúnot complicating‚Äù.  MySQL also remains the most popular of the powerful server databases.  For this reason, a large amount of information can be found on the Internet (for example, there is a detailed <a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html">manual from the developers</a> ), and an extensive community will always prompt a solution to the problem, if any.  Plus, MySQL offers extensive functionality, although it does not follow all SQL standards. <br><br><h2>  What can our chat bot </h2><br>  Our chat bot allows you to customize automatic answers to user questions (for example, to implement the FAQ), as well as automate routine operations (for example, polls) using scripts. <br><br>  The system is able to work with two types of questions: custom and standard.  In the first case, the administrator independently registers the essence of the question and the keywords to which the bot will respond.  List all keywords is optional.  RocketBot algorithms will appreciate the meaning of the phrase and find the answer by semantic proximity. <br><br>  To assess semantic proximity, a vector representation of the query is used.  It highlights the main components ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25B3%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25BD%25D1%258B%25D1%2585_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25BE%25D0%25BD%25D0%25B5%25D0%25BD%25D1%2582">PCA</a> ) and searches for the closest option in the database.  In our case, the cosine_similarity (sciki-learn) metric best showed itself. <br><br>  In the second case, the bot owner does not need to configure anything.  He simply chooses a standard question from the list - then the bot itself understands what it will be asked of.  Now for the selection of standard themes we use the Dialogflow service, but we will change it to our own implementation.  We are not satisfied with the dependence on the Google service, which introduces a delay in data synchronization.  Note that the user can change the standard template at any time by creating his own variant of phrases and assigning an appropriate action. <br><br>  In both cases, the chat bot can respond either with a text message or with a script.  A text message is just a standard response to a situation.  As for the script, it implies a tree-like structure of the dialogue.  In fact, these are full-fledged communication scenarios in which a chat bot performs the programmed actions depending on the user's responses.  For example, this feature can be used to conduct surveys or collect feedback. <br><br><blockquote>  <i>Three types of blocks are used to compile the script:</i> <i><br><br></i> <ol><li>  Question block - asks a question to the user and writes an answer to the variable in the variable. </li><li>  Condition block - implements the script branching. </li><li>  Block of checking variables - manages the user's route according to the script. </li></ol></blockquote><br>  The bot owner fills all the blocks independently in the script editor.  So far, the editor has no visualization tools (but they will appear in the near future).  In our experience, the presence of a visual designer in a chat bot application does not help in creating a scheme of its work.  Most of the users do not think over the algorithms in advance, so there is simply nothing to transfer to the editor. <br><br><img src="https://habrastorage.org/webt/tj/7n/ps/tj7nps4s0rfvjsk8oa3sug_ipl4.png"><br>  <font color="#A9A9A9">An example of settings with exit from the script when you answer "No" to the question "Are you 18 years old?"</font> <br><br>  But with all this, we can help the client customize his scripts according to the flowchart, which he draws in a graphics editor like xmind or draw.io.  We will independently carry out the verification of the algorithm and carry out the initial setup - it usually takes several hours. <br><br>  In addition to answering questions and implementing scripts, a bot can work with natural language processing systems.  However, while they perform a very narrow range of tasks: they search for an answer to a question in the knowledge base and determine the user's intentions (the same Dialogflow is used for this). <br><br>  We have limited the range of intellectual decision tasks due to potential difficulties with unpredictable behavior.  Modern AI systems are still subject to errors, and when creating business services, it is impossible for a bot to respond to 80% of the questions in one way, and to the remaining 20% ‚Äã‚Äã- to others. <br><br>  To implement the natural speech processing system, a very simple search algorithm is used so far.  Over time, we want to implement a new version based on LSTM networks, using reinforced learning.  Most likely, the new implementation will be based on the DeepPavlov framework already mentioned. <br><br>  Another feature of our bot is the integration with CRM-systems.  RocketBot is able to automatically create a lead and a task in CRM (Bitrix24) after running scripts.  The bot sends everything that the user has written, plus information about him from the messenger or social network.  Everything works according to standard protocols and through the main API of CRM systems in the form of HTTP requests and data in JSON. <br><br>  In future releases, we plan to add the bot the ability to create car-stoppers.  This will allow the business to familiarize the potential customer with the product and close the transaction directly in the chat.  The system will independently add the necessary entities to CRM - leads, transactions, tasks - based on the entered answers and questions. <br><br><img src="https://habrastorage.org/webt/qm/fa/il/qmfailfzjrk_v_2gqw0rg_akhqu.jpeg"><br>  <font color="#A9A9A9">/ photo <a href="https://www.flickr.com/photos/spenceyc/7481166880/">spencer cooper</a> <a href="https://creativecommons.org/licenses/by-nd/2.0/">CC BY-ND</a></font> <br><br><h2>  The infrastructure on which the chat bot is built </h2><br>  All our services operate <a href="https://www.it-grad.ru/services/iaas/iaas-vmware-virtual-infrastructure/">in the IT-GRAD cloud</a> - frontend servers, databases and application servers are located there.  In general, the cloud infrastructure helps us to scale our services quickly, to cope with the increasing load and sudden jumps in traffic.  For this reason, in the future we only plan to expand our presence in the cloud. <br><br>  The bot itself is a set of five microservices that interact with each other via HTTP ‚Äì JSON (all internal communications between services are carried out in a protected segment).  Although this leads to delays in answering a question in one to two seconds, this architecture has great potential for scaling and allows us to modify individual blocks without affecting others.  For example, updating the microservice search in the FAQ will not affect the microservice integration with CRM. <br><br><blockquote>  We use the Nvidia Tesla M40 16GB to test and create machine learning models and neural networks.  But even on her learning is not very fast.  The data sets that we use for natural language processing tasks are tens of gigabytes.  For this reason, in some cases (for example, for vectoring datasets) we used virtual machines with 64 CPUs. </blockquote><br><hr><br>  Additional reading - posts from the First Corporate IaaS blog: <br><br><ul><li>  <a href="https://iaas-blog.it-grad.ru/tendencii/zscaler-novaya-zashhita-dorozhnogo-voina/">Zscaler - how this tool works to ensure web security</a> </li><li>  <a href="https://iaas-blog.it-grad.ru/kejsy/onlajn-uslugi-dlya-b2cb2b-iz-oblaka/">How to place 100% of the infrastructure in the cloud IaaS-provider and not regret it</a> </li><li>  <a href="https://iaas-blog.it-grad.ru/seti/raspredelennyj-brandmauer-v-vcloud-director-8-20-osobennosti-resheniya/">Distributed firewall in vCloud Director 8.20: solution features</a> </li></ul><br>  From our Telegram channel: <br><br><ul><li>  <a href="https://t.me/iaasblog/191">Where cloud infrastructure moves in 2019: 5 trends</a> </li><li>  <a href="https://t.me/iaasblog/190">Why did VMware vSphere need an HTML5 client?</a> </li><li>  <a href="https://t.me/iaasblog/188">What controls the cloud: automation tools from VMware</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/438536/">https://habr.com/ru/post/438536/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>