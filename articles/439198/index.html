<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generation of barrier islands</title>
  <meta name="description" content="The December news on Hurricane Florence often referred to the External Shoals - a series of barrier islands on the coast of North Carolina: 


 Barrie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Generation of barrier islands</h1><div class="post__text post__text-html js-mediator-article">  The December news on <a href="https://en.wikipedia.org/wiki/Hurricane_Florence">Hurricane Florence</a> often referred to the <a href="https://en.wikipedia.org/wiki/Outer_Banks">External Shoals</a> - a series of barrier islands on the coast of North Carolina: <br><br><div style="text-align:center;"><img width="50%" height="50%" src="https://habrastorage.org/getpro/habr/post_images/a00/e8c/eef/a00e8ceef5bfbae53ac9a95a42a7cf5e.png"></div><br>  Barrier islands are flat or clumpy patches of sand formed by waves and surf parallel to the coast of the mainland.  They often have the appearance of long chains that can stretch for many tens of miles.  Barrier islands are usually separated by small tidal channels, and can form lagoons between the islands and the mainland. <br><br>  According to <a href="https://en.wikipedia.org/wiki/Barrier_island">Wikipedia</a> , barrier islands can cover up to 15% of the coast, so you can expect to see them on most fantasy cards, but in fact they are quite rare.  And because of the nature of the noise, they almost never occur on procedurally generated maps that use noise to create the relief. <br><br>  To understand why this is so, let's take a look at the "vanilla" map of the island: <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb8/342/f10/cb8342f1095276e3e7ced43ed57bf688.png"></div><br>  In essence, it is a circle distorted by a small amount of low-frequency noise added to split a circular shape.  Let's now try to use noise to break up the coast and form coastal islands.  Here is the same island with the addition of low-frequency noise: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e18/658/5b7/e186585b7a15a9287ad56bc13ac61f6d.png"></div><br>  It has bays and capes.  The terrain elements are quite large, because I used low-frequency noise, which changes slowly.  However, the noise is not strong enough to create islands.  Let's strengthen it a little: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9a/e78/c4a/f9ae78c4a84f5e99b2f58821ccade3b0.png"></div><br>  Now we have created several islands, but they are essentially round spots, not necessarily stretching along the coast.  You can add high frequency noise: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cab/89f/834/cab89f83445965bbad12d0f95bba1d94.png"></div><br>  This can give us very broken coastlines and small islands along the coast, but nothing like a barrier island. <br><br>  The only reason for this is that the noise is not consistent in x and y, so although in general the noise is not accidental, the forms it creates are random: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2e/4b4/ef6/d2e4b4ef6005d2675d2557f71eb0ce7b.png"></div><br>  This is good for some things, but not suitable for creating a specific form, for example, an island along the coast. <br><br>  As in other cases, when I needed to generate a specific shape or area, I needed to create a mask of the required shape, and then use noise inside the mask.  (You can also use noise to distort the mask and make it more natural.) Barrier islands are, in fact, long, thin areas that are offset from the coast.  So let's create a mask for this form. <br><br>  To begin with, we will define the part of the coast where the barrier island will be located.  This can be done by selecting a random point on the coast, and a second point below, which are marked in the figure with a red line in the upper right corner: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b45/e88/a41/b45e88a410c47b6832350b02b3215525.png"></div><br>  To start creating a barrier island, I can simply take a straight line between these two points and project it slightly out into the water.  This will give me a very straight and unnatural looking island, but you can distort its shape to hide it.  The real problem is that the island will not follow the coastline.  It will probably look normal for most of the direct coastal areas, but will seem strange on winding coasts.  It is better to replicate the coastline and make it the basis of the island form. <br><br>  For this, I need to create a copy of the coastline, and then project it into the ocean perpendicular to the coastline.  I already have a procedure for calculating perpendiculars (normals) to broken lines since I implemented <a href="https://heredragonsabound.blogspot.com/2016/11/this-is-where-i-draw-line.html">handwritten lines</a> , and my coastlines always run in the same direction, so everything is pretty simple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b3/9f1/b1e/0b39f1b1e868bb43d98839614109a3f5.png"></div><br>  Or <i>it seems</i> simple.  Let's see what happens if I project the coastline a little further out (to create the other side of the island mask) on the less flowing part of the coastline: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3e/99f/5b8/a3e99f5b8bed9f6a0ffd74f5ae7e864a.png"></div><br>  The two segments of the projected line intersect with each other and create an awesome ‚Äúeight‚Äù on the range.  This is the so-called <a href="https://en.wikipedia.org/wiki/Parallel_curve">problem of parallel curves</a> .  We can not just shift the coast to a certain distance, it is also necessary to solve the problems arising from the acute internal and external angles. <br><br>  I looked up the Javascript code to solve this problem, but the only example found ( <a href="https://github.com/bbecquet/Leaflet.PolylineOffset">from here</a> ) crashed amazingly even on fairly simple samples.  So I wrote my own.  In general, the solution is to displace each point along the normal, but then check whether the new point creates a segment that intersects one of the already existing segments.  If so, then we cut the loop and insert a new segment consisting of the intersection point and the new point.  In the test examples I tested, this system worked quite well for my requirements. <br><br>  So, now I can generate simple masks (without loops) for the islands: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/599/060/e89/599060e8909fb0d5dda3f01b7ca82806.png"></div><br>  This is too even, so I distort the contours: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b00/420/8a9/b004208a92018017e000669848f991ad.png"></div><br>  Contours may touch the coast at some points, but this is normal, this is often the case near barrier islands. <br><br>  The next stage is to fill the contour with land, but before I do this, I want to make the islands longer and add the logic of avoiding intersecting islands in case several barrier islands are created on one coastline. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cee/654/659/cee6546597a3c9a4552344298e07e2ca.png"></div><br>  Now let's try adding land.  To do this, I will raise the height of any land location (which are Delone triangles) above sea level: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf7/206/5d4/bf72065d44a8acc8247d2a1895c5db72.png"></div><br>  Here it is worth noting a couple of aspects.  First, in the upper left corner there is a rather successful barrier island.  However, it is unlikely that the island fills the landfill well.  Many land triangles are ‚Äúincluded‚Äù due to their centers inside the polygon.  This adds randomness to the shape of the island.  Secondly, it can be seen that the other two islands were so close to the coast that they just merged with it.  Since I want to create islands here, I don‚Äôt need this to happen too often, so I‚Äôll set up generation to get a larger water gap between the coastline and the island.  (I'll add a check later to prevent this from happening.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ca/150/ba5/6ca150ba54c211d1da8fdf4470401a02.png"></div><br>  One of the nice features of land-forming irregular triangles is that they naturally create tidal channels typical of barrier islands.  What is bad about them is that they usually create island spots that look like distorted pearls on a string.  They are not very similar to barrier islands, and if you take a lot of individual triangles, then they look very unnatural. <br><br>  If I increase the width of the islands, both effects disappear, and I get more natural islands, but without tidal ducts: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/153/005/e17/153005e17c9d6bf4e464e2e27b77c1c7.png"></div><br>  But I would like to learn how to generate very narrow islands.  Another approach is to (significantly) increase the number of locations in the world to increase the resolution: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b6/57c/f04/3b657cf0414f8bcc8cc21da0921d25e6.png"></div><br>  So we can get impressively thin and detailed islands, but this greatly increases the time and memory required to create a map. <br><br>  In both of these methods, there is a good chance that some parts of the island will be very uneven: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a75/32a/edd/a7532aedd16eeeba152ab0ee2e213f4b.png"></div><br>  This happens because the contour intersects the two sides (and sometimes all three sides) of the underlying Delone triangles.  This is an inherent problem of using the Delaunay triangulation in the generation of maps, but for some reason they rarely discuss it!  This happens on the coastlines in my game is not very often, because to reduce the number of such cases, I deliberately added a smoothing step, but this step tends to destroy the narrow islands.  A potential solution is to create slightly wider islands and to use anti-aliasing ‚Äî if properly configured, thinner islands can be obtained without many triangle artifacts: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52d/558/3f3/52d5583f3b04c85ddd7f504c3679cc01.png"></div><br>  However, with this approach, there are still restrictions on how narrow the islands can be.  In addition, this means that we will never get truly fractal coastlines. <br><br>  Sometimes the smoothing algorithm splits a long barrier island into several smaller ones (as in the lower left corner of the image above), but it would be convenient to have an option that allows you to do this forcibly: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/863/e5f/489/863e5f4893bdb0069219c761308b2ff7.png"></div><br>  The only thing that remains is to give the islands names and map them.  The only subtle aspect here is that I do not want to give names to all the islands in the chain of barrier islands.  In the real chains of barrier islands, individual islands often have names, which leads to chaos on the map: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e15/8b4/b27/e158b4b272c4b55b1d3b128e5e1b9d4c.png"></div><br>  Therefore, when creating a barrier island, I take into account the whole arc and attach one name to it, even if, as a result, the generation breaks the arc into several islands: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fd/797/070/6fd797070e48a48856b4862892ff3b66.png"></div><br>  Usually, barrier islands are called ‚Äúshoals‚Äù (Banks) or ‚Äúramparts‚Äù (Bars), therefore these words are found in variants of names. <br><br>  This example shows a potential problem with barrier islands: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/028/cee/b56/028ceeb56ebe1c5c83ea7e56f02c3a2f.png"></div><br>  Here the barrier island was created inside the bay.  This is illogical (besides, leads to the intersection of names).  To avoid this, I can use my own <a href="https://heredragonsabound.blogspot.com/2017/11/labeling-coast-part-five.html">bay recognition logic</a> and skip these sections of the shoreline.  This method probably has no fool protection, but it works well for this card: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/086/180/a33/086180a3377f856a818fd9097925a998.png"></div></div><p>Source: <a href="https://habr.com/ru/post/439198/">https://habr.com/ru/post/439198/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>