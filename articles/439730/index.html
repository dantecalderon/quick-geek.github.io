<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Organizing reducer through standard class</title>
  <meta name="description" content="Greetings, today I am going to talk to you about how Reducer is organized. And to tell where I started and what I came to. 


 So, there is a certain ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Organizing reducer through standard class</h1><div class="post__text post__text-html js-mediator-article"><p>  Greetings, today I am going to talk to you about how Reducer is organized.  And to tell where I started and what I came to. </p><br><p>  So, there is a certain standard on the organization of the Reducer and it looks like this: </p><br><pre><code class="plaintext hljs">export default function someReducer(state = initialState, action) { switch (action.type) { case 'SOME_REDUCER_LABEL': return action.data || {}; default: return state; } }</code> </pre> <br><p>  Everything is simple and clear, but having worked with such constructions a little, I realized that this method has a number of difficulties. </p><br><ul><li>  Labels need to be stored somehow, because they began to creep away on the project and creep away far beyond the controllers. </li><li>  Labels needed to be made unique, because otherwise there could be intersection with other reducer'ami </li><li>  Most of the time when working with such a structure was spent on the organization of the code, rather than on the processing of incoming data </li><li>  And when the labels in the reducer are typed a lot - the code becomes untidy and difficult to read, well, and the general namespace is frankly not pleasing to me. <a name="habracut"></a><br>  At about the same time, we began to use sagas for processing side effects.  This allowed us to significantly facilitate communication with the server part without the use of callbacks. </li></ul><br><p>  Now we had to let the saga know what kind of reducer needed to be called after running the side effect. </p><br><p>  The most sensible option I have found is to make the action creator. </p><br><p>  And our previous code began to look like this: </p><br><pre> <code class="plaintext hljs"> import { FetchSaga } from '../../helpers/sagasHelpers'; const SOME_REDUCER_LABEL = 'SOME_REDUCER_LABEL'; export const someReducerLabelActionCreator = FetchSaga.bind(this, SOME_REDUCER_LABEL); export default function someReducer(state = initialState, action) { switch (action.type) { case SOME_REDUCER_LABEL: return action.data || {}; default: return state; } }</code> </pre> <br><p>  FetchSaga is the action generator function (hereafter action creator) for the saga, which requests data from the server and dispatches it to the reducer, the label of which was transferred to the function at the initialization stage (SOME_REDUCER_LABEL). </p><br><p>  Now, the reducer labels were either exported from the reducer, or the action creator was exported from the reducer for both the saga and the standard saga.  And such a handler was created for each tag.  This only added a headache, because once I opened the reducer, I counted 10 constants defining labels, then several calls for different action creators for the sagas and then another function for processing the state of the reducer, it looked like this </p><br><pre> <code class="plaintext hljs">import { FetchSaga } from '../../helpers/sagasHelpers'; const SOME_REDUCER_LABEL1 = 'SOME_REDUCER_LABEL1'; –∏—Ç–¥ .... const SOME_REDUCER_LABEL10 = 'SOME_REDUCER_LABEL10'; export const someReducerLabelActionCreator1 = FetchSaga.bind(this, SOME_REDUCER_LABEL1); –∏ —Ç–¥ ..... export const someReducerLabelActionCreator10 = FetchSaga.bind(this, SOME_REDUCER_LABEL10); export default function someReducer(state = initialState, action) { switch (action.type) { case SOME_REDUCER_LABEL: return action.data || {}; case SOME_REDUCER_LABEL1: return action.data || {}; case SOME_REDUCER_LABEL2: return action.data || {}; case SOME_REDUCER_LABEL3: return action.data || {}; .... default: return state; } }</code> </pre> <br><p>  When importing all these actions into the controller, that one was also so bloated.  And it hurt. </p><br><p>  After reviewing a few reducer'ov, I figured that we write a lot of service code, which never changes.  Plus, we must ensure that we send the cloned state to the component. </p><br><p>  Then I had the idea to standardize the reducer.  The tasks before him were not complicated. </p><br><ol><li>  Check incoming action and return the old state if action is not for the current reducer or automatically clone the state and return to the handler method, which will change state and return to the component. </li><li>  You should stop using labels, instead the controller should receive an object containing all the action creators for the reducer of interest to us. <br>  Thus, by importing such a set once, I can pass through it any number of action creators for the dispatch functions from the reducer to the controller without having to re-import </li><li>  instead of using a clumsy switch-case with a common namespace, on which the linter is obscene, I want to have a separate method, for each action to which the cloned state of the reducer and the action itself will be passed </li><li>  It would be nice to be able to inherit a new reducer from a reducer.  In case of repetition of logic, but for example for a different set of labels. </li></ol><br><p>  The idea seemed viable to me and I decided to try to implement it. </p><br><p>  This is how the average reducer now looks </p><br><pre> <code class="plaintext hljs"> // —ç—Ç–æ –Ω–∞—à —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å, –ø–æ—Ç–æ–º–æ–∫ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ –¥–∞–Ω–Ω–æ–º reducer'–µ import stdReducerClass from '../../../helpers/reducer_helpers/stdReducer'; class SomeReducer extends stdReducerClass { constructor() { super(); /** –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∞–∫—Ç–æ—Ä reducer'–∞. –ü–æ –∫–æ—Ç–æ—Ä–æ–º—É reducer –±—É–¥–µ—Ç —É–∑–Ω–∞—á–∞—Ç—å —Å–≤–æ–∏ action—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –∂–µ –ø–æ—Ä–æ–¥–∏–ª */ this.prefix = 'SOME_REDUCER__'; } /** –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –Ω–∞–±–æ—Ä–∞ –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–µ—Ç –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π reducer - type - —Ç–∏–ø, –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–æ–π–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. –í–æ-–ø–µ—Ä–≤—ã—Ö –ø—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º –º—ã –ø–æ–ª—É—á–∏–º –∫–æ–Ω–µ—á–Ω—É—é –º–µ—Ç–∫—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ action creator, –Ω–∞–ø—Ä–∏–º–µ—Ä SOME_REDUCE__FETCH. –¢–∞–∫ –∂–µ type —è–≤–ª—è—Ç—å—Å—è –∫–ª—é—á–æ–º –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –æ—Ç—ã—Å–∫–∞—Ç—å –Ω—É–∂–Ω—ã–π action creator –≤ someReduceInstActions - method - –ú–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ action, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∫–∏–µ —Ç–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –Ω–∏–º –∏ –≤–µ—Ä–Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç - sagas - —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å—É, –∫–∞–∫–æ–π —Ç–∏–ø —Å–∞–π–¥ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å–ª–µ–¥—É–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–Ω–∞—á–∞–ª–∞. –í —Å–ª—É—á–∞–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º –Ω–∏–∂–µ, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω action creator –¥–ª—è —Å–∞–≥–∏, –∫—É–¥–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–µ—Ç–∫–∞ SOME_REDUCE__FETCH, –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å–∞–≥–∞ –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ reducer –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ä–∞–Ω–µ–µ –º–µ—Ç–∫—É. */ config = () =&gt; [ { type: 'fetch', method: this.fetch, saga: 'fetch' }, { type: 'update', method: this.update }, ]; // –ø–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º action creators init = () =&gt; this.subscribeReduceOnActions(this.config()); // —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç —Å–∞–≥–∏ fetch = (clone, action) =&gt; { // –∫–∞–∫–∏–µ —Ç–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º return clone; }; // —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ —Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º update = (clone, action) =&gt; { // –∫–∞–∫–∏–µ —Ç–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º return clone; }; } const someReducerInst = new SomeReducer(); someReducerInst.init(); // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ action creators –Ω–∞ –æ—Å–Ω–æ–≤–µ config // –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö action creator –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö export const someReducerInstActions = someReducerInst.getActionCreators(); // –≤–µ—à–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ö–∞–∂–¥—ã–π —Ä–∞–∑ checkActionForState –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ö–æ–¥—è—â–∏–π Action –∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ –æ–Ω –∫ –¥–∞–Ω–Ω–æ–º—É reducer'—É –∏–ª–∏ –Ω–µ—Ç export default someReducerInst.checkActionForState;</code> </pre> <br><p>  stdReducerClass from the inside looks like this </p><br><pre> <code class="plaintext hljs">import { cloneDeep } from 'lodash'; //–¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å lodash // —Ç–∞–∫ –∂–µ —è –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é —Å–∞–≥–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ä–æ–¥–∏—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ç–∏–ø–æ–≤—ã–µ –∏ –Ω–µ—Ç —Å–º—ã—Å–ª–∞ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑ import { FetchSaga } from '../helpers/sagasHelpers/actions'; export default class StdReducer { _actions = {}; actionCreators = {}; /** UNIQUE PREFIX BLOCK START */ /** –ø—Ä–µ—Ñ–∏–∫—Å –º—ã —Ö—Ä–∞–Ω–∏–º –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è. –ö–∞–∫ —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª–æ—Å—å, —ç—Ç–æ –≤–∞–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –Ω–µ–≥–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å, —Ç–æ reducer –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å–≤–æ–∏ action—ã –∏–ª–∏ –≤—Å–µ –æ–Ω–∏ –±—É–¥—É—Ç –µ–º—É —Ä–æ–¥–Ω—ã–º–∏ */ uniquePrefix = ''; set prefix(value) { const lowedValue = value ? value.toLowerCase() : ''; this.uniquePrefix = lowedValue; } get prefix() { return this.uniquePrefix; } /** INITIAL STATE BLOCK START */ /** –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ç—Ç–µ—Ä initialState –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è reducer'–∞. */ initialStateValues = {}; set initialState(value) { this.initialStateValues = value; } get initialState() { return this.initialStateValues; } /** PUBLIC BLOCK START */ /** * –¢–æ—Ç —Å–∞–º—ã–π –º–µ—Ç–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤ init() –ø–æ—Ç–æ–º–∫–∞. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç, –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –≤ –º–∞—Å—Å–∏–≤–µ Config, action creator –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ _subscribeAction * actionsConfig - —Å–ø–∏—Å–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ –ø–æ—Ç–æ–º–∫–µ, –≥–¥–µ –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç {type, method, saga?} –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä —Å–∞–≥–∞, —Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π action creator –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–∂–∏–¥–∞—Ç—å –Ω–∞ –≤—Ö–æ–¥ –æ–±—ä–µ–∫—Ç —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ */ subscribeReducerOnActions = actionsConfig =&gt; actionsConfig.forEach(this._subscribeAction); /** –î–ª—è –∫–∞–∂–¥–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ _subscribeAction, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –¥–≤–∞ –Ω–∞–±–æ—Ä–∞, –≥–¥–µ –∫–ª—é—á–æ–º —è–≤–ª—è–µ—Ç—Å—è –∏–º—è –º–µ—Ç–∫–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –≤ type. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, reducer –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫–æ–π –º–µ—Ç–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ action–∞. */ _subscribeAction = (action) =&gt; { const type = action.type.toLowerCase(); this._actions[type] = action.method; // –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –≤ –Ω–∞–±–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π this.actionCreators[type] = this._subscribeActionCreator(type, action.saga); // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π action creator –≤ –Ω–∞–±–æ—Ä } /** _subscribeActionCreator - –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, action creator –∫–∞–∫–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä saga –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω fetch —Ç–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Å–∞–≥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–µ—Ä–Ω–µ—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –º–µ—Ç–∫–µ –ú–µ—Ç–æ–¥ —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –µ–º—É type –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º, –∏ –ø–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∫—É, –∫–æ—Ç–æ—Ä—É—é –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ action creator, —Ç–æ –µ—Å—Ç—å, –µ—Å–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å –∏–º–µ–ª –≤–∏–¥ SOME_Reducer__, –∞ —Ç–∏–ø –≤ –∫–æ–Ω—Ñ–∏–≥–µ —Å–æ–¥–µ—Ä–∂–∞–ª FETCH, —Ç–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –ø–æ–ª—É—á–∏–º SOME_Reducer__FETCH, —ç—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ action creator */ _subscribeActionCreator = (type, creatorType) =&gt; { const label = (this.prefix + type).toUpperCase(); switch (creatorType) { case 'fetch': return this._getFetchSaga(label); default: return this._getActionCreator(label); } } /** _getFetchSaga - –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞—à—É –º–µ—Ç–∫—É –∫ —Å–∞–≥–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ–Ω–∏–º–∞–ª–∞ –ø–æ –∫–∞–∫–æ–º—É –∞–¥—Ä–µ—Å—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω–µ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */ _getFetchSaga = label =&gt; FetchSaga.bind(this, label); /** _getActionCreator - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π action creator, —Å —É–∂–µ –∑–∞—à–∏—Ç–æ–π –≤ –Ω–µ–≥–æ –º–µ—Ç–∫–æ–π, –≤—Å–µ —á—Ç–æ –Ω—É–∂–Ω–æ, —ç—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É. */ _getActionCreator = label =&gt; (params = {}) =&gt; ({ type: label, ...params }); /** –≠—Ç–æ —Å–∞–º–∞—è –≥–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ playload. –û–Ω–∞ –∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å–≤–æ–∏ action—ã –∏ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ */ checkActionForState = (state = this.initialState || {}, action) =&gt; { if (!action.type) return state; const type = action.type.toLowerCase(); const prefix = this.prefix; –ò–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–∏–ø–∞ –º—ã –ø—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–¥–æ –≤—ã–∑–≤–∞—Ç—å. const internalType = type.replace(prefix, ''); // –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É –∫–ª—é—á—É –∏—â–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö if (this._actions[internalType]) { // –ï—Å–ª–∏ —Ç–∞–∫–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å—Ç—å - —Å–æ–∑–¥–∞–µ–º –∫–ª–æ–Ω —Å–æ—Å—Ç–æ—è–Ω–∏—è const clone = cloneDeep(state); // –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≤—Ö–æ–¥—è—â–∏–π action –∫–∞–∫ –µ—Å—Ç—å, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞—Ä—É–∂—É // —Ç–∞–∫ –∫–∞–∫ –º—ã –æ–±—è–∑–∞–Ω—ã —á—Ç–æ —Ç–æ –≤–µ—Ä–Ω—É—Ç—å return this._actions[internalType](clone, action); } // –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–µ—Ç, —Ç–æ —ç—Ç–æ—Ç action –Ω–µ –¥–ª—è –Ω–∞—Å. –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ return state; } /** –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –≥–µ—Ç—Ç–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö action creator, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è reducer */ getActionCreators = () =&gt; this.actionCreators; }</code> </pre><br><p>  How does it look in the controller?  That's how </p><br><pre> <code class="plaintext hljs">import { someReducerInstActions } from '../../../SomeReducer.js' const mapDispatchToProps = dispatch =&gt; ({ doSoAction: (params) =&gt; dispatch(someReducerInstActions.fetch(url, params)), doSoAction1: (value, block) =&gt; dispatch(someReducerInstActions.update({value, block})), });</code> </pre><br><p>  So, what we have in the end: </p><br><ol><li>  got rid of a bunch of tags </li><li>  got rid of heaps of imports in the controller </li><li>  removed the switch-case </li><li>  nailed the saga once and now we can expand their set in one place, being sure that all the heirs will automatically receive additional side effects handlers </li><li>  Got the opportunity to inherit from reducer'ov, if there is an adjacent logic (at the moment it did not come in handy to me =)) </li><li>  Shifted responsibility for cloning from the developer to the class, who will not forget to do it. </li><li>  there is less routine when creating a reducer </li><li>  Each method has an isolated namespace. </li></ol><br><p>  I tried to describe everything as detailed as possible =) Sorry, if confused, the Chukchi is not a writer.  I hope that my experience will be useful to someone. </p><br><p>  ‚Üí <a href="https://github.com/Neffes1987/std-classes-for-react">The actual example can be found here.</a> </p><br><p>  Thank you for reading! </p><br><p>  UPD: corrected errors.  He wrote at night, poorly read.  Thank you so delicately pointed at them =) </p></div><p>Source: <a href="https://habr.com/ru/post/439730/">https://habr.com/ru/post/439730/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>