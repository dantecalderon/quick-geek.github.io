<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ACS my LCD - security on two bolts</title>
  <meta name="description" content="I hasten to warn readers: This article is written only for information, and in no case does not call for any unlawful action. The author is not respon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>ACS my LCD - security on two bolts</h1><div class="post__text post__text-html js-mediator-article">  I hasten to warn readers: This article is written only for information, and in no case does not call for any unlawful action.  The author is not responsible for any illegal actions committed by people using the information from this article. <br><br><img src="https://habrastorage.org/webt/yk/fs/p-/ykfsp-giznlsydndwjjukl8hzyw.png"><br><br>  Greetings reader.  Today I want to talk about security access control systems (ACS) in general and the example of my LCD.  The main vulnerabilities will be considered, and a successful attempt to copy keys will be made.  All manipulations will be mostly hardware. <br><a name="habracut"></a><br>  In my residential complex installed intercom system Sinthesi S2, as well as access system yard / porch / floor production of Urmet Group.  That was how cool the street panel looked. <br><br><img src="https://habrastorage.org/webt/fm/mr/b1/fmmrb1xbkfetetbxhurozddrtfi.png"><br><br>  until one day it looked like this: <br><br><img src="https://habrastorage.org/webt/fv/7q/hq/fv7qhqsdztc7j5h9la_ww4k38sw.png"><br><br>  She hung for a couple of days, and then moved to a dumpster nearby.  It contained only a reader and a keypad.  Because one of the areas in my company is the development of HF readers, I could not resist and decided to study this RFID reader in more detail.  From the documentation, I found only a huge <a href="http://www.urmet.no/wp-content/download/FDI.pdf">catalog</a> from which it was possible to conclude that this is FD-020-017 - 13.56 MHz reader with a Wiegand26 interface.  Inside there was a sandwich from reader boards ( <a href="https://www.nxp.com/docs/en/data-sheet/MFRC531.pdf">MFRC531</a> ) and MK with BLE ( <a href="https://www.ti.com/lit/ds/symlink/cc2541.pdf">CC2541</a> ) glued with hot glue to the case, which was clearly not designed for this board. <br><br><img src="https://habrastorage.org/webt/-l/qq/yt/-lqqyti00ujmciyzmppzpkzcbn8.png"><br><br>  The MK board is flooded with a soft compound apparently to protect the radio part from moisture.  Having twirled the fee, I put it off. <br><br>  Until recently, I was not interested in the work of the system, since it was partially started (only access locks worked, but they had an access code, which I knew and did not use the key).  After the system was fully started and the access codes were canceled, I began to study it in more detail.  It began one of the nights when I returned home and found that the tambour door was already working and the wife was already sleeping.  I had only pocket-sized items with me, but as it turned out this was quite enough to bypass all the elite security (as Urmet assures). <br><br><img src="https://habrastorage.org/webt/ip/9o/av/ip9oavphdqdmspjusi-wbwkvlsy.png"><br><br>  All I needed was to unscrew the 2 carving screws holding the panel frame with the car key, remove the 2 blocks and close the relay channel using the same key that goes to the lock of the vestibule door.  Everything‚Ä¶ <br>  After this incident, when I watch another Hollywood film (‚ÄúPassengers‚Äù (2016) at KDPV) and see how the super secret doors are opened by removing the code panel and sticking a pin into the board (always with sparks and a spectacular opening of the door), I see real situation. <br><br>  In my memory, most of the access control systems I have seen have access to the lock directly from the code panel, and this is precisely the main vulnerability.  All security is provided by several bolts holding this panel, and on faith that this system is reliable.  But at the same time, it is possible to significantly increase the entry threshold (let's call it protection from a person with a screwdriver) by using locks with brains that are controlled by the interface - even the simplest.  This measure will dramatically reduce the likelihood of spontaneous penetration. <br><br><h3>  Initial data </h3><br>  ACS LCD as a whole, its work, the reaction to other keys, as well as a way to add keys: <br><br><ul><li>  One free key is given to the apartment, each following - 300r, is registered in the personal account of the ACS.  You can only buy from the Criminal Code.  In the chat LCD wrote that market copiers could not make a duplicate - it means the system is steeper than just reading the UID. </li><li>  When you present any other mifare card, the reader does not even give signs that he sees it. </li><li>  When you bring the key to another entrance / floor, the reader peaks in reading, but nothing happens. </li><li>  When reading the contents of the key fob 8 and 12, the blocks are hidden and have an access key different from Mifare well-known keys.  So the secret is somewhere there. </li></ul><br><img src="https://habrastorage.org/webt/nr/1k/xl/nr1kxljcz-vzxdgknnfcmyz0jh0.png"><br><br><h3>  Beginning of work </h3><br>  First of all, I copied Block0 (the one that contains the UID and the Manufacturer information) to the Mifare Zero disc and checked that it was not enough - the key fob did not work.  The reader did not even respond to the presentation of such a clone.  It became clear that you need to look for the key from sectors 8 and 12. After reading all the available trinkets, I saw that only one of them locked 12 block, in the rest it is zero, therefore it is obvious that the magic is contained in block 8. <br><br>  It's time to get a gift reader and consider it more closely.  So we have FD-020-017 - 13.56 MHz, Wiegand26 interface.  The MFRC531 and CC2541 are connected by a 10-pin comb.  And he earned great money on the table - without the rest of the system.  I reacted to the keys in the same way as the other readers.  First, let's see what comes out: <br><br><img src="https://habrastorage.org/webt/kf/sy/wm/kfsywm6pgxzqcggydxffit8-nnw.png"><br><br>  Silence until the presentation of a valid key fob.  After reading the interface leaves the message in full accordance with <a href="http://ccdesignworks.com/wiegand_calc.htm">Wiegand26</a> .  So I decoded the package my key sends.  Using a multimeter, I restored the pinout, it turned out that the chips communicate via SPI.  We connect the analyzer, <br><br><img src="https://habrastorage.org/webt/2s/z6/pu/2sz6pu-h8fykc157m8vbc3xgfyy.png"><br><br>  bring a valid key chain and watch the exchange on SPI: <br><br><img src="https://habrastorage.org/webt/j3/gd/ui/j3gduiwafbqwrjznhpjmvlq3p2u.png"><br><br>  Next, I began to look at the documentation on the <a href="https://www.nxp.com/docs/en/data-sheet/MFRC531.pdf">MFRC531</a> microchip and almost gave up seeing that it has a special EEPROM for storing keys.  I found the commands to load the key: <br><br><img src="https://habrastorage.org/webt/gm/zb/x6/gmzbx6c4cu4de6ut89jbkfxkwbe.png"><br><br>  The command 0x0B loads from the EEPROM, the command 0x19 from the FIFO, which in turn receives the key via SPI.  It would seem that if I load the key from the EEPROM, then I have no chance to reverse this way, but to my surprise, the 0x0B command is not exchanged, but there is a 0x19 command <br><br><img src="https://habrastorage.org/webt/qj/wi/zk/qjwizk-mxiizgq5kgafox6puguu.png"><br><br>  It remains only to collect the key according to the format <br><br><img src="https://habrastorage.org/webt/rh/ef/ak/rhefak-ucxfeotu8c5_aps6xm0k.png"><br><br>  And add to the key list. <br><br><img src="https://habrastorage.org/webt/tt/ga/nz/ttganzuuekb2ntx4xwjeucldgbm.png"><br><br>  Bingo!!!  It turned out that block 8 starts with 3 non-zero bytes, which just go to Wiegand with matching key and reader keys.  This data has nothing to do with the UID - most likely it is just a sequence number when issued to the Criminal Code.  My trinkets had 3 numbers in a row + one very different.  Record blanks was successful, I combined the key from the LCD with the key from the office, which works on UID. <br><br><h3>  Conclusion </h3><br>  For a successful hacking system, I need to thank the programmer from the Urmet Group, who frankly flipped while writing software for the reader, because if you have hardware that can eliminate such a hacking method (generally simple enough), you cannot call it anything. <br><br>  Most people working with RFID technology know that the <a href="https://ru.wikipedia.org/wiki/Crypto-1">Crypto-1</a> encryption algorithm used in Mifare (Classic) cards has been cracked long ago and it was possible to get the key from the unit in a ‚Äúcleaner‚Äù way, but I went head-on. <br><br>  In our own projects we use programmable readers with one time password dictionaries for encryption.  This allows you to protect against cloning if the original card is attached to the reader before the clone, otherwise it will allow to detect the fact of duplication (the original card will stop working). </div><p>Source: <a href="https://habr.com/ru/post/439278/">https://habr.com/ru/post/439278/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>