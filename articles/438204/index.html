<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Swift compiler device. Part 1</title>
  <meta name="description" content="Swift is not just a programming language. This is a project that, in addition to the compiler, includes many other components. And the compiler itself...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Swift compiler device. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/-n/j6/ot/-nj6ottc75qfwwp1doueskrlwca.png"><br><p>  Swift is not just a programming language.  This is a project that, in addition to the compiler, includes many other components.  And the compiler itself is not a big and scary box, which with the help of magic turns your code into a set of machine-friendly instructions.  It can also be broken down into components.  If you are interested in which ones - welcome under cat. </p><a name="habracut"></a><br><p>  I am not a compiler expert and have no experience in this area.  But I wondered how it works, and I began to learn the Swift compiler.  Since the article turned out too big, we had to divide it into 4 parts: </p><br><ul><li>  general overview of components </li><li>  parsing the source file </li><li>  Swift intermediate language, </li><li>  LLVM IR and code generation. </li></ul><br><h1 id="swift">  Swift </h1><br><p>  Swift has been an open source project for more than two years.  During this time, many community improvements have been added to it.  You can follow them on a special <a href="https://apple.github.io/swift-evolution">site</a> , as well as on the <a href="https://forums.swift.org/">forum</a> .  You can also discuss suggestions for improving the language or posting your ideas.  But to do this, you must first understand how the project works. </p><br><h1 id="swift-standard-library">  Swift Standard Library </h1><br><img src="https://habrastorage.org/webt/ew/cl/bk/ewclbkueutefh4lzrof1hgme5wy.png" width="500" align="left"><br><p><br clear="all"></p><br><p>  The main parts of Swift, of course, are the compiler and the standard library of functions.  They develop in parallel and are practically inseparable from each other. </p><br><p>  The compiler is written in C ++, and the main part of stdlib is in Swift.  However, the language used in it has several features: </p><br><ul><li>  The standard library through the module Builtin has direct access to the functions of the compiler.  This allows it to access low-level language representations and "raw" pointers. </li><li>  The standard library does not use the private access modifier.  Instead, entity names that are not public begin with an underscore.  Read more <a href="">here</a> . </li><li>  <a href="https://github.com/apple/swift/blob/master/utils/gyb.py">Code</a> generation is used using the <a href="https://github.com/apple/swift/blob/master/utils/gyb.py">Generate Your Boilerplate</a> (GYB) utility to reduce repetitions in the standard library code. </li></ul><br><p>  A standard library is usually associated with containers and useful functions that simplify the life of a developer, but this is only one of the parts.  In total, there are 3 most interesting components: </p><br><ul><li>  Core.  The kernel with all its protocols, data types and functions.  <a href="https://github.com/apple/swift/tree/master/stdlib/public/core">Sources</a> </li><li>  Runtime  The intermediate layer between the standard library and the compiler.  He is responsible for type casting, working with memory, reflection and other dynamic capabilities of the language.  Written in C ++ and Objective-C.  <a href="https://github.com/apple/swift/tree/master/stdlib/public/runtime">Sources</a> </li><li>  SDK Overlays.  Wrappers over Foundation and other system frameworks that make Swift more convenient to access them.  <a href="https://github.com/apple/swift/tree/master/stdlib/public/Darwin">Sources</a> </li></ul><br><h1 id="drugie-podproekty">  Other subprojects </h1><br><img src="https://habrastorage.org/webt/du/om/cn/duomcnan-0gsq2nxfmkudjtksgu.png" width="500" align="left"><br><p><br clear="all"></p><br><p>  In addition to the compiler and the standard library, there are many other subprojects in open access.  Some of them are listed below. </p><br><h3 id="sourcekit">  Sourcekit </h3><br><p>  <a href="https://github.com/apple/swift/tree/master/tools/SourceKit">IDE support framework</a> : indexing, syntax highlighting, code completion, and so on. </p><br><h3 id="sourcekit-lsp">  SourceKit-LSP </h3><br><p>  <a href="https://github.com/apple/sourcekit-lsp">Swift LSP implementation</a> based on SourceKit.  About what it is, you can read <a href="https://microsoft.github.io/language-server-protocol/">here</a> . </p><br><h3 id="swift-package-manager">  Swift Package Manager </h3><br><p>  <a href="https://github.com/apple/swift-package-manager">Package manager</a> for Swift projects. </p><br><h3 id="foundation">  Foundation </h3><br><p>  <a href="https://github.com/apple/swift-corelibs-foundation">Port of the Foundation library</a> , which is one of the cores of Apple‚Äôs OS for third-party platforms. </p><br><h3 id="libdispatch-gcd">  libdispatch (GCD) </h3><br><p>  <a href="https://github.com/apple/swift-corelibs-libdispatch">GCD</a> for third-party platforms. </p><br><h3 id="xctest">  Xctest </h3><br><p>  <a href="https://github.com/apple/swift-corelibs-xctest">XCTest</a> for third-party platforms. </p><br><h3 id="lldb">  Lldb </h3><br><p>  <a href="https://github.com/apple/swift-lldb">LLDB</a> with Swift and REPL support. </p><br><h3 id="playground-support">  Playground support </h3><br><p>  The <a href="https://github.com/apple/swift-xcode-playground-support">project</a> includes two frameworks - PlaygroundSupport and PlaygroundLogger.  They provide interaction with Xcode and beautiful data mapping, respectively. </p><br><h3 id="llbuild">  llbuild </h3><br><p>  <a href="https://github.com/apple/swift-llbuild">Build system</a> . </p><br><h3 id="gyb">  gyb </h3><br><p>  <a href="https://github.com/apple/swift/blob/master/utils/gyb.py">Utility</a> for code generation. </p><br><h3 id="libcxx">  libcxx </h3><br><p>  <a href="https://github.com/apple/swift-libcxx">Implementation of the</a> standard C ++ library. </p><br><h1 id="kompilyator-swift">  Swift compiler </h1><br><img src="https://habrastorage.org/webt/in/-j/nl/in-jnl0ritpgkknpeqrlhj2fjjc.png" width="500" align="left"><br><p><br clear="all"></p><br><p>  Compiler in a broad sense - a program that converts code from one language to another.  But more often, compilation refers to the transformation of the source code into a machine (or another low-level representation), which can then be used to create an executable file. </p><br><p>  The compiler is often divided into three parts: frontend, middlend, backend.  The first is responsible for transforming the source code into an intermediate representation, which is convenient for the compiler to work with.  Middlend performs the optimization, and the backend generates the machine code from the optimized intermediate representation. </p><br><p>  However, in Swift, optimization is performed in the frontend, and (most) in the backend.  Therefore, the intermediate step is not shown in the diagram. </p><br><h1 id="llvm">  Llvm </h1><br><img src="https://habrastorage.org/webt/kx/rn/8k/kxrn8kpusx2doqo3jpajqa12eju.png" width="500" align="left"><br><p><br clear="all"></p><br><p>  The Swift compiler uses LLVM as a backend.  LLVM is a big project that includes many technologies.  It is based on intermediate representation (IR).  This is a universal intermediate code representation that can be converted to executable code on any platform supported by LLVM. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ll/yj/wk/llyjwkcnzj-gym8tt1rgfx7u_-w.png" width="500"></div><br><p>  If a new architecture appears, it will be enough to add to LLVM the generation of machine code from IR for this platform.  After that, all languages ‚Äã‚Äãfor which there is a compiler with IR generation will support this architecture. </p><br><p>  On the other hand, to create a compiler for a new programming language, it is enough to write the translation of the source code in IR, and LLVM will take over the support of various architectures. </p><br><p>  Another advantage of such a system is that LLVM is able to optimize the intermediate representation, and the frontend may not be engaged in optimization.  This greatly simplifies compiler development. </p><br><p>  IR has three types of display: </p><br><ul><li>  Object tree in memory.  Each object corresponds to a specific entity in the source code: a function, an operator, a string, a pointer, and so on.  This tree is created by the frontend at the IR generation stage. </li><li>  Text view.  IR can be output as low-level source code.  It can be saved to a file and executed using an interpreter. </li><li>  Serialized bitcode format (not to be confused with bytecode, which is used, for example, in Java).  It can be used as the end result of the backend and transferred to the linker for optimization at the link level.  The conversion to machine code in this case will be carried out by the linker. </li></ul><br><p>  <a href="https://en.wikipedia.org/wiki/Linker_(computing)">Linker</a> is a program that generates an executable file.  Her description is beyond the scope of the article. </p><br><p>  The source code for the LLVM version used in Swift can be found <a href="https://github.com/apple/swift-llvm">here</a> , and the documentation on the official <a href="http://llvm.org/">website</a> . </p><br><p>  As you can see, Apple posted in the open access a lot of interesting projects.  In the <a href="https://habr.com/ru/company/e-Legion/blog/438664/">next part</a> I will talk about parsing the source file and generating AST. </p></div><p>Source: <a href="https://habr.com/ru/post/438204/">https://habr.com/ru/post/438204/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>