<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP for beginners. Session</title>
  <meta name="description" content="Have a nice day, everyone. Here is the first article in the PHP series for novice developers. This will be an unusual series of articles, there will b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>PHP for beginners. Session</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0a/389/8cf/c0a3898cf539ad6a3dc7ffb833d9715d.png" alt="ElePHPant. PHP for beginners. Session"></div><br>  Have a nice day, everyone.  Here is the first article in the PHP series for novice developers.  This will be an unusual series of articles, there will be no <code>echo "Hello World"</code> , there will be a hardcore from the life of PHP programmers with a small touch of "homework" to consolidate the material. <br><br>  I'll start with the sessions - this is one of the most important components with which you have to work.  Not understanding the principles of his work - bloat up business.  So in order to avoid problems, I will try to tell you about all the possible nuances. <br><a name="habracut"></a><br>  But for a start, in order to understand why we need a session, let us turn to the sources - to the HTTP protocol. <br><br><h3>  HTTP Protocol </h3><br>  The HTTP protocol is the HyperText Transfer Protocol - the ‚Äúhypertext transfer protocol‚Äù ‚Äîthat is  in fact, a text protocol, and it is easy to understand. <br><blockquote>  Initially it was meant that under this protocol only HTML would be transmitted, the name and the title, and now they just don‚Äôt send and = ^. ^ = And Ôºà‚Ä¢ _ „ÖÖ _ ‚Ä¢Ôºâ </blockquote><br>  In order not to beat around the bush, let me give you an example of communication over the HTTP protocol. <br>  Here is an example of the request your browser sends it when you request the page <code>http://example.com</code> : <br><br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html &lt;–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞&gt;</code> </pre> <br>  Here is an example answer: <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Length: 1983 Content-Type: text/html; charset=utf-8 &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre><br>  These are very simplified examples, but even here you can see what the HTTP request and response consist of: <br><br><ol><li>  <strong>the starting line</strong> - for the request contains the method and path of the requested page, for the response - the protocol version and the response code </li><li>  <strong>headers</strong> - have a key-value format separated by a colon, each new header is written on a new line </li><li>  <strong>body of the message</strong> - directly HTML or data is separated from the headers by two line breaks, may be absent, as in the above request </li></ol><br>  So, sort of dealt with the protocol - it is simple, it has its history since 1992, so you can‚Äôt call it ideal, but what is - send a request - get an answer, and that's all, the server and the client are not connected in any way.  But such a scenario is by no means the only possible one, we can have authorization, the server should somehow understand that this request came from a specific user, i.e.  client and server must communicate within a certain session.  And yes, for this, they came up with the following mechanism: <br><br><ol><li>  When authorizing a user, the server generates and remembers a unique key - the session identifier, and informs its browser </li><li>  The browser saves this key, and with each subsequent request, it is sent </li></ol><br>  To implement this mechanism, <a href="https://en.wikipedia.org/wiki/HTTP_cookie">cookies</a> were created (cookies, cookies) - simple text files on your computer, by file for each domain (although some browsers are more advanced, and use SQLite to store the database), while the browser imposes a limit on the number of records and the size of the stored data (for most browsers it is 4096 bytes, see <a href="http://www.ietf.org/rfc/rfc2109.txt">RFC 2109</a> from 1997) <br><blockquote>  Those.  If you steal a cookie from your browser, then you can go to your facebook page on your behalf?  Do not worry, you can‚Äôt do that, at least from facebook, and then I'll show you one of the possible ways to protect against this type of attack on your users. </blockquote><br>  Let's now see how our request-response changes, be there authorization: <br><br>  <b>Request</b> <br><pre> <code class="plaintext hljs">POST /login/ HTTP/1.1 Host: example.com Accept: text/html login=Username&amp;password=Userpass</code> </pre> <br><br>  Our method has changed to POST, and in the request body we have passed the login and password.  If you use the GET method, the query string will contain a login and password, which is not very correct from an ideological point of view, and has a number of side effects in the form of logging (for example, in the same <code>access.log</code> ) and caching of passwords in open form. <br><br>  <b>Response</b> <br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: text/html; charset=utf-8 Set-Cookie: KEY=VerySecretUniqueKey &lt;html&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt;...&lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  The server‚Äôs response will contain the <code>Set-Cookie: KEY=VerySecretUniqueKey</code> header <code>Set-Cookie: KEY=VerySecretUniqueKey</code> , which will force the browser to save this data into cookies, and the next time you access the server, they will be sent and recognized by the server: <br><br>  <b>Request</b> <br><pre> <code class="plaintext hljs">GET / HTTP/1.1 Host: example.com Accept: text/html Cookie: KEY=VerySecretUniqueKey &lt;–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞&gt;</code> </pre> <br><blockquote>  As you can see, the headers sent by the browser (Request Headers) and the server (Response Headers) are different, although there are also common ones for both requests and answers (General Headers) </blockquote><br>  The server has recognized our user by the sent cookies, and will further provide him with access to personal information.  So, well, sort of dealt with HTTP and sessions, you can now return to PHP and its features. <br><br><h3>  PHP and session </h3><br><blockquote>  I hope you already have PHP installed on your computer, because  then I will give examples, and they will need to run </blockquote><br>  PHP language was created to become the HTTP protocol - i.e.  Its main task is to respond to an HTTP request and "die" by freeing memory and resources.  Consequently, the session mechanism works in PHP not in automatic mode, but in manual mode, and you need to know what to call, and in what order. <br><blockquote>  Here you have an article on the topic of <a href="http://software-gunslinger.tumblr.com/post/47131406821/php-is-meant-to-die">PHP is meant to die</a> , or here it is <a href="https://habrahabr.ru/post/179399/">in Russian</a> , but it is better to set it aside for ‚Äúlater‚Äù. </blockquote><br>  First of all, you need to "start" the session - for this we use the function <a href="http://php.net/function.session-start">session_start ()</a> , create a file <em>session.start.php</em> with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> session_start();</code> </pre> <br>  Run the PHP built-in <a href="http://php.net/features.commandline.webserver">web server</a> in the folder with your script: <br><br><pre> <code class="bash hljs">php -S 127.0.0.1:8080</code> </pre> <br>  Launch the browser and open the Developer Tools (or <a href="https://en.wikipedia.org/wiki/Web_development_tools">whatever you have</a> ) in it, then go to <a href="http://127.0.0.1:8080/session.start.php">http://127.0.0.1:8080/session.start.php</a> - you should see only a blank page, but don‚Äôt rush to close it - look on the headers that the server sent us: <br><br> <a href="" rel="attachment"><img src="https://habrastorage.org/getpro/habr/post_images/3e8/b2d/145/3e8b2d145c8f29ce0fe30664dcc36119.png" alt="Cookie" width="460" height="222"></a> <br><br>  There will be a lot of things, we are only interested in this line in the server‚Äôs response (clean the cookies, if there is no such line, and refresh the page): <br><br><pre> <code class="plaintext hljs">Set-Cookie: PHPSESSID=dap83arr6r3b56e0q7t5i0qf91; path=/</code> </pre> <br>  After seeing this, the browser will retain a cookie with the name `PHPSESSID`: <br><br> <a href="" rel="attachment wp-att-2816"><img src="https://habrastorage.org/getpro/habr/post_images/f06/d02/09e/f06d0209e68ccac4b99570758c23a2ad.png" alt="Browser session cookie" width="460" height="410"></a> <br><br><blockquote>  <code>PHPSESSID</code> is the default session name, regulated from the php.ini config by <a href="http://php.net/session.configuration">session.name</a> directive, if necessary, the name can be changed in the configuration file itself or using the <a href="http://php.net/function.session-name">session_name ()</a> function </blockquote><br>  And now - we are updating the page, and we see that the browser sends this cookie to the server, you can try to refresh the page a couple of times, the result will be identical: <br><br> <a href="" rel="attachment wp-att-2817"><img src="https://habrastorage.org/getpro/habr/post_images/272/4e6/001/2724e60013b929e3e9e7f1bfa9212ef1.png" alt="Browser request with cookie" width="460" height="87"></a> <br><br>  Total, what we have - the theory coincided with practice, and this is just fine. <br><br>  The next step is to save an arbitrary value in the session, for this PHP uses the super-global variable <code>$_SESSION</code> , we will save the current time - for this we call the <a href="">date ()</a> function: <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  Update the page and see the server time, update again - and the time is updated.  Let's now make sure that the set time does not change with each page refresh: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  Update - time does not change, what you need.  But at the same time, we remember that PHP is dying, which means that it stores this session somewhere, and we will find this place ... <br><br><h3>  All secret becomes clear </h3><br>  By default, PHP stores the session in files - the <a href="http://php.net/session.configuration">session.save_handler</a> directive is responsible for this, the path by which the files are saved look for in the <a href="http://php.net/session.configuration">session.save_path</a> directive, or use the <a href="http://php.net/function.session-save-path">session_save_path ()</a> function to get the required path. <br><blockquote>  In your configuration, the path to the files may not be specified, then the session files will be stored in temporary files of your system - call the <a href="http://php.net/sys_get_temp_dir">sys_get_temp_dir ()</a> function and find out where this hidden place is. </blockquote><br>  So, go along this path and find your session file (I have this file <code>sess_dap83arr6r3b56e0q7t5i0qf91</code> ), open it in a text editor: <br><br><pre> <code class="bash hljs">time|s:8:<span class="hljs-string"><span class="hljs-string">"16:19:51"</span></span>;</code> </pre> <br>  As you can see, this is our time, this is how tricky our session is stored, but we can make edits, change time, or we can simply enter any string, why not: <br><br><pre> <code class="bash hljs">time|s:13:<span class="hljs-string"><span class="hljs-string">"\m/ (@.@) \m/"</span></span>;</code> </pre> <br>  To convert this string to an array, you need to use the <a href="http://php.net/function.session-decode">session_decode ()</a> function, for the inverse transformation - <a href="http://php.net/function.session-encode">session_encode ()</a> - this is called serialization, that's just in PHP for sessions - it has its own - special, although you can use standard <a href="http://php.net/function.serialize">PHP serialization</a> - write in the <a href="http://php.net/session.configuration">session</a> configuration directive <a href="http://php.net/session.configuration">.serialize_handler</a> value is <code>php_serialize</code> and you will be happy, and <code>$_SESSION</code> can be used without restrictions - now you can use numbers and special characters as an index <code>|</code>  and <code>!</code>  in the name (for all 10+ years of work, I never had to :) <br><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Write your function similar to the function <code>session_decode()</code> , here's a test data set for the session (to solve the knowledge of regular expressions is not required), take the text for conversion from the file of your current session: <br><br><pre> <code class="php hljs">$_SESSION[<span class="hljs-string"><span class="hljs-string">'integer var'</span></span>] = <span class="hljs-number"><span class="hljs-number">123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'float var'</span></span>] = <span class="hljs-number"><span class="hljs-number">1.23</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'octal var'</span></span>] = <span class="hljs-number"><span class="hljs-number">0x123</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'string var'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>; $_SESSION[<span class="hljs-string"><span class="hljs-string">'array var'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'one'</span></span>, <span class="hljs-string"><span class="hljs-string">'two'</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]); $object = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdClass(); $object-&gt;foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; $object-&gt;arr = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>); $_SESSION[<span class="hljs-string"><span class="hljs-string">'object var'</span></span>] = $object; $_SESSION[<span class="hljs-string"><span class="hljs-string">'integer again'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br></div></div><br>  So that we have not tried?  That's right - to steal cookies, let's launch another browser and add the same cookie to it.  I wrote you a simple javascript for this, copy it into the browser console and run it, just do not forget to change the session ID to your own: <br><br><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=<span class="hljs-string"><span class="hljs-string">'PHPSESSID=dap83arr6r3b56e0q7t5i0qf91;path=/;'</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.reload();})()</code> </pre> <br>  Now you have both browsers looking at the same session.  I mentioned above that I will talk about the ways of protection, consider the easiest way - we will tie the session to the browser, or rather to how the browser is presented to the server - we will memorize the <a href="https://en.wikipedia.org/wiki/User_agent">User-Agent</a> and check it every time: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>])) { $_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] = $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]; $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>] = date(<span class="hljs-string"><span class="hljs-string">"H:i:s"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_SESSION[<span class="hljs-string"><span class="hljs-string">'ua'</span></span>] != $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Wrong browser'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESSION[<span class="hljs-string"><span class="hljs-string">'time'</span></span>];</code> </pre> <br>  It is more difficult to fake, but it is still possible, add <code>$_SERVER['REMOTE_ADDR']</code> and <code>$_SERVER['HTTP_X_FORWARDED_FOR']</code> save and check here, and this will more or less be like protection from intruders encroaching on our cookies. <br><br><blockquote>  The keyword in the previous paragraph <b>seems to be</b> running in HTTPS protocol in real projects for a long time, so no one can steal them without physical access to your computer or smartphone </blockquote><br><br>  It is worth mentioning the <a href="&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjdIynJbwr9zLa1RLSgzuzGF3LVXw#ini.session.cookie-">session.cookie-httponly directive</a> , thanks to it the session cookie will be inaccessible from JavaScript.  In addition, if you look at the manual of the <a href="http://php.net/function.setcookie">setcookie ()</a> function, you will notice that the last parameter is also responsible for HttpOnly.  Keep this in mind - this setting allows you to effectively deal with XSS attacks in almost <a href="http://www.browserscope.org/%3Fcategory%3Dsecurity">all browsers</a> . <br><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Add to the code a check on the user's IP; if the check fails, delete the compromised session. <br></div></div><br><h3>  Steps </h3><br>  And now I will explain step by step the algorithm, how the session works in PHP, using the example of the following code (default settings): <br><br><pre> <code class="php hljs">session_start(); $_SESSION[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre> <br><ol><li>  after calling <code>session_start()</code> PHP looks for a session identifier in the cookie by the name specified in <code>session.name</code> - this is <code>PHPSESSID</code> </li><li>  if there is no identifier, then it is created (see <a href="http://php.net/function.session-id">session_id ()</a> ), and creates an empty session file on the path <code>session.save_path</code> named <code>sess_{session_id()}</code> , headers will be added to the server‚Äôs response, to set the cookie <code>{session_name()}={session_id()}</code> </li><li>  if the identifier is present, then look for the session file in the folder <code>session.save_path</code> : <br><ul><li>  don't find - create an empty file with the name <code>sess_{$_COOKIE[session_name()]}</code> (the identifier can contain only characters from the ranges <code>az</code> , <code>AZ</code> , <code>0-9</code> , a comma and a minus sign) </li><li>  we find, read the file and unpack the data (see <a href="http://php.net/function.session-decode">session_decode ()</a> ) into the super-global variable <code>$_SESSION</code> (the file is locked for reading / writing) </li></ul></li><li>  when the script has finished its work, all the data from <code>$_SESSION</code> packed using <code>session_encode()</code> in a file by the path <code>session.save_path</code> named <code>sess_{session_id()}</code> (the lock is released) </li></ol><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Set in your browser an arbitrary cookie value with the name <code>PHPSESSID</code> , let it be <code>1234567890</code> , refresh the page, check that you have created a new file <code>sess_1234567890</code> <br></div></div><br><h3>  Is there life without cookies? </h3><br>  PHP can work with the session even if cookies in the browser are disabled, but then all the URLs on the site will contain a parameter with the ID of your session, and yes - do you need to configure this, but do you need it?  I did not have to use it, but if I really want to - I‚Äôll just say where to dig: <br><br><ul><li>  <a href="http://php.net/session.configuration">session.use_cookies</a> </li><li>  <a href="http://php.net/session.configuration">session.use_only_cookies</a> </li></ul><br><h3>  And if you need to store the session in the database? </h3><br>  To store the session in the database, you will need to change the session repository and tell PHP how to use it, the <a href="http://php.net/class.sessionhandlerinterface">SessionHandlerInterface</a> interface and the <a href="http://php.net/function.session-set-save-handler">session_set_save_handler</a> function have been created for this purpose. <br><blockquote>  Separately, I note that you do not need to write your own session handlers for redis and memcache - when you install these extensions, the corresponding handlers go along with them, so RTFM is our everything.  Well, yes, the handler must be specified before calling <code>session_start()</code> ;) </blockquote><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Implement <code>SessionHandlerInterface</code> to store session in MySQL, check if it works. <br>  This task with an asterisk, for those who have already met with databases. <br></div></div><br><br><h3>  When does a session die? </h3><br>  During the session lifetime, the <a href="http://php.net/manual/session.configuration.php">session.gc_maxlifetime</a> directive is responsible.  By default, this directive is equal to 1440 seconds (24 minutes), it should be understood so that if the session was not addressed within a specified time, the session will be considered ‚Äúspoiled‚Äù and will wait for its turn for deletion. <br><br>  Another question is interesting, can you ask it to the hardcore developers - when does PHP delete the files of expired sessions?  The answer is in the official manual, but not in an explicit form - so remember: <br><br>  The garbage collection can be started when the <code>session_start()</code> function is called, the launch probability depends on two <a href="http://php.net/session.configuration">session.gc_probability</a> and <a href="http://php.net/session.configuration">session.gc_divisor</a> directives, the first acts as a dividend, the second is the divisor, and by default these values ‚Äã‚Äãare 1 and 100, tons. e.  the probability that the collector will be launched and the session files will be deleted - approximately 1%. <br><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Change the value of the <code>session.gc_divisor</code> directive so that the garbage collector runs every time, check that this is the case. <br></div></div><br><br><h3>  The most trivial error </h3><br>  Error with more than half a million results in the issuance of Google: <br><br><blockquote>  Cannot send session cookie - <strong>headers already sent</strong> by <br>  Cannot send session cache limiter - <strong>headers already sent</strong> </blockquote><br>  To get one, create a file <em>session.error.php</em> with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> str_pad(<span class="hljs-string"><span class="hljs-string">' '</span></span>, ini_get(<span class="hljs-string"><span class="hljs-string">'output_buffering'</span></span>)); session_start();</code> </pre> <br><blockquote>  In the second line, the strange "magic" is the focus with the output buffer, I will tell about it in one of the following articles, so far consider it only a string of 4096 characters long, in this case - these are all spaces </blockquote><br>  Start by deleting the cookie and get the errors, though the error text is different, but the essence is the same - the train is gone - the server has already sent the page contents to the browser, and sending the headers is too late, it will not work, and the coveted session identifier does not appear in the cookies.  If you stumbled with this error - look for a place where the text is displayed ahead of time, it can be a space before the characters <code>&lt;?php</code> , or after <code>?&gt;</code> In one of the included files, and it‚Äôs okay if it is a space, there can be a thread non-printing character like <a href="https://en.wikipedia.org/wiki/Byte_order_mark">BOM</a> , so be careful, and this contagion will not touch you (as ... homeric laughter). <br><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  To test the knowledge gained, I want you to implement your own session mechanism and make the above code work: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'include/sess.php'</span></span>; sess_start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_SESS[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-number"><span class="hljs-number">42</span></span>; }</code> </pre> <br><blockquote>  To accomplish this, you will need the <a href="http://php.net/function.register-shutdown-function">register_shutdown_function ()</a> function. </blockquote><br></div></div><br><br><h3>  Lock </h3><br>  Another common mistake for newbies is an attempt to read the session file while it is blocked by another script.  Actually, this is not quite a mistake, this is a misunderstanding of the principle of blocking :) <br><br>  But let's take another step: <br><br><ol><li>  <code>session_start()</code> not only creates / reads a file, but also blocks it, so that no one can make edits at the time of the script execution, or read non-consistent data from the session file </li><li>  blocking is removed at the end of the script </li></ol><br><br>  ‚ÄúSticking‚Äù into this error is very easy, create two files: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// start.php session_start(); echo "OK";</span></span></code> </pre><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// lock.php session_start(); sleep(10); echo "OK";</span></span></code> </pre><br><br>  Now, if you open the <code>lock.php</code> page in the browser, and then open <code>start.php</code> in a new tab, you will see that the second page will open only after the first script, which blocks the session file for 10 seconds, runs. <br><br>  There are a couple of options for how to avoid this phenomenon - ‚Äúclumsy‚Äù and ‚Äúthoughtful‚Äù. <br><br>  <b>"Clumsy"</b> <br>  Use a self-written session handler in which to ‚Äúforget‚Äù to implement the lock :) <br>  A slightly better option is to take ready and disable the lock (for example, memcached has this option - <a href="http://php.net/manual/memcached.configuration.php">memcached.sess_locking</a> ) O_o <br>  Spending hours debugging the code in search of a rarely pop-up error ... <br><br>  <b>"Thoughtful"</b> <br>  It‚Äôs much better to follow the session lock yourself and take it off when it is not needed: <br><br>  - If you are sure that you do not need to make changes to the session data, use the <code>read_and_close</code> option when starting the session: <br><br><pre> <code class="php hljs">session_start([ <span class="hljs-string"><span class="hljs-string">'read_and_close'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ]);</code> </pre><br><br>  Thus, the lock will be released immediately after reading the session data. <br><br>  - If you still need to make changes to the session, after making these, close the session from the recording: <br><br><pre> <code class="php hljs">session_start(); <span class="hljs-comment"><span class="hljs-comment">// some changes session_write_close();</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">The task</b> <div class="spoiler_text">  Just above was a listing of two files <code>start.php</code> and <code>lock.php</code> , create more files <code>read-close.php</code> and <code>write-close.php</code> , in which you will control the blocking in these ways.  Check how the lock works (or does not work). <br></div></div><br><br><h3>  Finally </h3><br>  In this article, you are given seven tasks, while they concern not only working with <a href="http://php.net/ref.session">sessions</a> , but also introduce you to <a href="http://php.net/book.mysqli">MySQL</a> and the <a href="http://php.net/ref.strings">functions of working with strings</a> .  To assimilate this material - a separate article is not needed, the manual on the links provided is enough - no one will read it for you.  Dare! <br><br>  <b>PS</b> If you have learned something new from the article - thank the author - zasharte article in the social networks;) <br>  <b>PPS</b> Yes, this is a cross-post article from my <a href="http://anton.shevchuk.name/php/php-for-beginners-session/">blog</a> , but it is still relevant today :) <br><br>  <b>A series of articles "PHP for beginners":</b> <br><br><ul><li>  <b>Session</b> </li><li>  <a href="https://habr.com/ru/post/439618/">File attachment</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/437972/">https://habr.com/ru/post/437972/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>