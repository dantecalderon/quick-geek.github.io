<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lazarus - simple animation using the TImageFragment component</title>
  <meta name="description" content="Instead of the preface 
 In my recent article, Lazarus - writing a component for animating sprites, I described the process of creating a simple TImag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <section class="page js-page"><h1>Lazarus - simple animation using the TImageFragment component</h1><div class="post__text post__text-html js-mediator-article"><h6>  Instead of the preface </h6><br>  In my recent article, <a href="https://habr.com/ru/post/438828/">Lazarus - writing a component for animating sprites,</a> I described the process of creating a simple <b>TImageFragment</b> component that allows you to display a given image fragment. <br><br>  Continuing the chosen theme, in this article I want to show how you can easily make the animation of sprites in the development environment of <b>Lazarus</b> ( <a href="http://www.lazarus-ide.org/">official website</a> ) using this component. <br><br>  With this approach, separate animation frames in different projections are placed on one image, and the component for displaying the sprite shows only one selected fragment of this image using the <b>OffsetX</b> and <b>OffsetY</b> properties (offset of the upper left corner of the image fragment horizontally and vertically). <br><br>  Many such ready-made images can be found on the Web - for example, <a href="http://untamed.wild-refuge.net/rmxpresources.php%3Fcharacters">on this site</a> . <a name="habracut"></a><br><br><h6>  Select (and prepare) the image </h6><br>  For my example, I chose this image: <br><img src="https://habrastorage.org/getpro/habr/post_images/909/e6e/661/909e6e661a0a47541735e88ce1adcb00.png"><br>  - very much this bird Phoenix expressively flaps its wings. <br><br>  As you can see, each row contains 4 frames for each of the 4 projections.  Changing only <b>OffsetX</b> , you can make the bird flap its wings, and to change the projection, you only need to change <b>OffsetY</b> .  This separation of frames by rows greatly simplifies animation programming. <br><br>  The size of this image is 384x384, and the size of each frame is 96x96.  Unfortunately, the direct use of this image has grieved us with artifacts: some image frames are placed so that their edges fall on adjacent frames, and during the animation, yellow strokes flash on the edges of the sprite. <br><br>  To eliminate these defects, I used the free <b>GIMP</b> cross-platform image editor ( <a href="http://www.gimp.org/">official website</a> ).  All that had to be done was to remove the protruding pixels of the images in the places where they fall on the next frame. <br><br>  The corrected file looks like this: <br><br><img src="https://habrastorage.org/webt/vw/_a/44/vw_a44kabb9dlcz4ituzz2zumdi.png"><br><br>  - differences with the naked eye are not noticeable, but the second option works without artifacts. <br><br><h6>  Create a new project </h6><br>  1. Create a new project such as "Application". <br><br>  By default, the IDE creates a project with the name “project1”, in which a single software module with the name “unit1” is immediately created, describing the class with the name “TForm1” and declaring its instance with the name “Form1”. <br><br>  In general, when creating new objects, the IDE assigns them similar names, consisting of the name of the object type and the sequence number.  I consider it a good style to rename all such objects, giving them meaningful names, reflecting the role or purpose of the object. <br><br>  So, our project will not be called “project1”, but “Phoenix” - by the name of the selected sprite. <br><br>  2. Save our new project. <br><br>  It is advisable to save each project in a separate directory with the same name as the project.  In the process of saving, we specify the directory to save (if necessary, create it right there), then the name of the project file and the file name of the program module.  I created the “Phoenix” folder and saved the project file (“Phoenix.lpi” instead of the proposed “project1.lpi”) and the program module file (“UnitMain.pas” instead of the proposed “unit1.pas”). <br><br><div class="spoiler">  <b class="spoiler_title">Nuance with the case of characters</b> <div class="spoiler_text">  The Windows version of Lazarus cites the name of the program module file in lower case: “unitmain.pas”, but the program name of the module retains the original case of characters: “unit UnitMain;”.  This does not happen with the project file, the file name retains the original case of characters. </div></div><br>  3. Rename the form and change its title. <br><br>  The newly created form is called “Form1” (the <b>Name</b> property), is an instance of the “TForm1” class and contains the “Form1” header (the <b>Caption</b> property).  Change the <b>Name</b> property of the form to “FormMain”, and the class name will change to “TFormMain”. <br><br>  The <b>Caption</b> property is changed to “Phoenix” so that the title of the project is displayed in the window title. <br><br>  4. As a result, I got the following text of the module unitmain.pas: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  5. Compile, run the project (&lt;F9&gt; key): <br><br><img src="https://habrastorage.org/webt/v_/el/0s/v_el0s_ntalmovtpfkso3j-gqau.png"><br><br><h6>  Put the sprite on the form </h6><br>  Assuming that you have already installed the <b>TImageFragment</b> component described in my previous <a href="https://habr.com/ru/post/438828/">Lazarus</a> article <a href="https://habr.com/ru/post/438828/">, we write the component for sprite animation</a> , select the Game tab from the component palette and add the TImageFragment component to the form. <br><br>  Using the <b>Picture</b> property, we load an image into the component (a corrected version of the Phoenix bird).  In addition, we also change the following properties of the new object: <br><br><ul><li>  set the <b>Height</b> and <b>Width</b> properties to 96 </li><li>  <b>Left</b> and <b>Top</b> properties are set to 0 (convenient for matching with my screenshots) </li><li>  <b>Name</b> property is changed from the inconvenient “ImageFragment1” to the simple and clear “Sprite” </li></ul><br>  If done correctly, the component will show the first frame of the image: <br><img src="https://habrastorage.org/webt/br/zp/g2/brzpg25qbgjlrsoy20akjhdeox4.png"><br><br>  In the text of the <b>UnitMain</b> module, there will be slight changes: <br>  - the module <b>ImageFragment</b> will be added to the <b>uses</b> section <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ImageFragment;</code> </pre><br>  - a new object will appear in the class declaration <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><h6>  Adding animation - flapping wings </h6><br>  1. Add a new <b>TTimer</b> component to the form. <br><br>  This component is located on the System tab of the component palette.  You can post it in any convenient place on the form, since it is not displayed in the running application. <br><br>  2. Rename the added object. <br><br>  The new object is automatically named Timer1, but we rename it to TimerLive.  It is often convenient to give objects such two-part names: the first reflects the class of the object, and the second its purpose. <br><br>  3. Change the Interval property from 1000 to 100. <br><br>  Let the frames of this animation replace each other every 100 milliseconds, that is, 10 times per second.  In the future, this property can be changed to slow down or speed up the wing's wing - at the discretion of the programmer. <br><br>  4. Add an OnTimer event handler. <br><br>  The easiest way to do this is to double-click on the icon of a new <b>TimerLive</b> object.  As a result of this action, the IDE itself adds a new procedure to the form class declaration, a link to this procedure to the object properties, and the body of the new procedure will be added to the <b>implementation</b> section (and the cursor will be placed inside this new procedure, between the <b>begin</b> and <b>end keywords</b> ). <br><br>  5. Add one line of code to the new procedure. <br><br><pre> <code class="delphi hljs"> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>;</code> </pre><br>  As a result of these actions, the class declaration should look something like this: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  And the new procedure - the <b>OnTimer</b> event <b>handler</b> should look like this: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  After compiling and running the application, you can watch the Phoenix bird flapping its wings. <br><br>  This happens because the timer event handler every 100 milliseconds cyclically changes the offset of the displayed fragment, and the selected frame is shifted horizontally, sequentially displaying 4 frames of the top line of the loaded image.  The <b>mod</b> operation — getting the remainder of the division — prevents the bias from moving beyond the image size, and as a result, the 4th frame again follows the 1st frame. <br><br><h6>  Add sprite moving around the window </h6><br>  1. Add the <b>Math</b> module to the <b>uses</b> section <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math;</code> </pre><br>  2. Add a new variable and a constant to the class declaration. <br><br>  To save the vector of movement of the sprite around the window, add a variable of type <b>TPoint</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint;</code> </pre><br>  3. In the same place, we declare a constant for setting the velocity of the motion <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  4. Add another <b>TTimer</b> class component to the <b>form</b> . <br><br>  I remind you: this component is located on the “System” tab of the component palette. <br><br>  5. Rename the added object. <br><br>  The new object again automatically gets the name "Timer1", and we rename it - this time to "TimerMove".  The purpose of the second timer is to control the movement of the sprite.  I didn’t bind both processes (animation and movement) to the same timer so that each of the timers could be adjusted separately - for example, slowing the frequency of wing flies without slowing down the movement, and so on. <br><br>  6. Change the Interval property from 1000 to 100. <br><br>  Let this timer also work every 100 milliseconds, that is, 10 times per second.  In the future, this property can also be changed to slow down or speed up the frequency of drawing the fact of moving the sprite. <br><br>  7. Add an <b>OnTimer</b> event <b>handler</b> . <br><br>  For a change, this time I propose to do this by double-clicking the opposite of the <b>OnTimer</b> event on the “Events” tab of the new <b>TimerMove</b> object.  Like last time, as a result of this action, the IDE will add a new procedure to the form class declaration, a link to this procedure to the object properties, and the body of the new procedure will be added to the <b>implementation</b> section (and the cursor will be placed inside this new procedure, between the key words <b>begin</b> and <b>end</b> ). <br><br>  8. Add two lines of code to the new procedure. <br><br><pre> <code class="delphi hljs"> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y));</code> </pre><br>  Using the Max () and Min () functions prevents the sprite from leaving the form (the main application window). <br>  It is for the use of these functions that we connected the <b>Math</b> module to the <b>uses</b> clause. <br><br>  9. Add an <b>OnKeyPress</b> event <b>handler</b> . <br><br>  Select the form (click the gray rectangle of the window layout outside of all added components) and in the Events tab we find the <b>OnKeyPress</b> event.  Double-click the empty value of the event handler to create and assign a new procedure - the event handler. <br><br>  10. Add a few lines of code to the new procedure. <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  As a result of these actions, the class declaration should look something like this: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  And the new procedures — the <b>OnTimer</b> and <b>OnKeyPress</b> event handlers should look like this: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  After compiling and launching the application, you can move the Phoenix bird around the screen using the “a”, “w”, “s”, “d” keys and stop it with the space bar. <br><br><h6>  We use different projections of the sprite </h6><br>  1. Add the following code to the end of the <b>TFormMain.FormKeyPress</b> procedure <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Changing the <b>OffsetY</b> property depending on the displacement vector causes the image to rotate in the direction of movement. <br><br><div class="spoiler">  <b class="spoiler_title">All text of the UnitMain module</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre></div></div><br><h6>  Instead of an afterword </h6><br>  This simple example does not claim high speed or usability ratings.  If someone, like in the <a href="https://habr.com/ru/post/438828/">last article</a> , wants to tell in the comments that the animation should be done wrong - welcome, write your article.  And the topic of this article is how to make animation in several lines of code, without using any special libraries, practically “on the knee”.  This method has been tested in practice, it really works, so before you criticize and “minus”, please re-read what the article is about and why. </div><p>Source: <a href="https://habr.com/ru/post/439732/">https://habr.com/ru/post/439732/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>