<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tetris games, or what is capacity management in the data center</title>
  <meta name="description" content="Hall of the NORD-4 data center in 2016. 

 Here is an empty machine room in the data center. Think rack can be put in any place? If only it were that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Tetris games, or what is capacity management in the data center</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/pq/hk/dg/pqhkdgdihz_mtivpfyvvqxsxz2g.jpeg"><br>  <i>Hall of the NORD-4 data center in 2016.</i> <br><br>  Here is an empty machine room in the data center.  Think rack can be put in any place?  If only it were that simple! <br><br>  My name is Alexey, I do capacity management in DataLine data centers.  Today I will tell you that it is an entire science, and sometimes art, to properly arrange the stands in the hall. <br><br><h3>  What is capacity management? </h3><br>  The machine room in the data center has three main resources: space, power supply and cold. <br>  All three of these resources should be spent evenly and end at the same time.  Actually, this is followed by a person engaged in capacity management. <br><br>  If the equipment is placed at random, we may end up in the following unpleasant situations: <br><a name="habracut"></a><br><ul><li>  electricity in the hall is fully selected, and half of the hall is empty; </li><li>  the hall is packed with racks to the eyeballs, barely enough electricity or cold. </li></ul><br>  Why is everything so difficult?  The data center is designed for racks of a certain capacity, size and cooling schemes.  If we place in the halls of the rack with the design parameters, then there is no problem.  But in life it does not happen, especially in a commercial data center.  The equipment comes in very different ways: some customers want to place a pair of racks of 20 kW each, others 100 for 5 kW, some third 20 wide racks 800 mm each, and for the fourth, the equipment throws warm air from the side.  So each request for placement turns into a small optimization problem with three variables: location, electricity and cold.  About them and talk further. <br><br><h3>  About the place </h3><br>  This is perhaps the most inflexible parameter, so every centimeter counts.  When I say this, it means that I measure all the new halls with a tape measure in order to verify the reality with the drawings.  He began to do so when somehow when installing the racks it turned out that the distance between the supporting pillars turned out to be 1 centimeter less than on the plan.  Then, in order to squeeze, I had to disassemble the pillar trim. <br><br>  On the plans of the halls, I additionally designate all objects under the raised floor, on the walls and network trays.  This information is useful if the client wants to stay with a fence that goes from the base floor to the ceiling itself. <br><br>  On the plans, I also note the service areas of engineering equipment.  This is a reserved space near the air conditioner, switchboard and other equipment for its repair.  Racks should not climb and, especially, be completely in the service area. <br><br>  Usually the service area is registered on the equipment passport, but we take as a guideline the size of the object itself.  For example, for an air conditioner 900 mm deep, the service area in front of it will be at least 900 mm.  So if necessary, we can pull this equipment out of the hall.  And <a href="https://habr.com/post/431434/">so really had to do</a> . <br><br><img src="https://habrastorage.org/webt/ep/6e/dq/ep6edqqlstwfzhq_8ydsggsc3c0.jpeg"><br>  <i>The rack, marked in red, is already superfluous in a row and climbs onto the air conditioner service area.</i>  <i>Disorder.</i> <br><br><h3>  About electricity </h3><br>  The most important thing in this part is not to overload the available capacities.  To track the load, you need to know what we have on the project, and keep records of installed racks.  This is in theory, in practice, you will not always have all the input.  Here are some of these situations: <br><br>  The hall is empty, there is a design capacity of the data center / hall / rack on hand, and we push off from it.  We fill the hall on the basis of these data, keep records of occupied and free capacity, do not allow their overload. <br><br>  If you already got a partially filled hall and there is no information on the occupied capacities, we first deal with the installed racks.  We find out how much they consume at the moment and how much they are allowed to eat.  For example, the rack can now consume 2 kW, but when installed under it reserved 5 kW, for growth.  Next, we check with the project documentation: we look at how much power we have in principle.  After some simple calculations, we understand whether we can put the racks on;  if so, how much and how much power. <br><br>  It‚Äôs quite bad when there are racks with equipment in the hall, there is no documentation, no one takes into account.  Here again it is better to start with an inventory of installed racks.  Next, we need to understand what we have on the project.  We go to the UPS, we look at its power according to the passport and what feeds this UPS.  For simplicity in the example I will consider 1 UPS. <br><br>  Suppose its power is 450 kW.  Subtract from this power 10% of the reserve and work on with the figure of 405 kW.  On the switchboard comes 405 kW.  There are 4 automata in the shield, each automaton is 1 row with 19 racks.  On a row - 101.25 kW.  Additionally, we check the settings on the input machines of the row and the switchboard of the UPS.  The settings may be down, and instead of 101.25 kW there may be 90 kW.  If the settings did not do anything, it turns out that the rack has 5.3 kW.  This does not mean that now we can put racks on 5.3 kW only.  It is possible more or less, the main thing every time to recalculate the remaining power. <br><br>  <i>Important: 5.3 kW is the power of one beam.</i>  <i>The same to the rack is suitable from the second.</i>  <i>Each beam should be loaded only half the rated power.</i>  <i>If one beam falls off, the second will be able to take on a double load.</i> <i><br><br></i>  <i>Together with the pair load on the rays must be observed and the pair load on the phases in switchboards.</i>  <i>When one or two phases are overloaded, the so-called phase distortion occurs.</i>  <i>This will, at a minimum, mean that the available power is not optimally used.</i>  <i>More about this, colleagues wrote in the articles about the <a href="https://habr.com/post/310356/">device</a> and power supply <a href="https://habr.com/ru/company/dataline/blog/324610/">monitoring</a> in the data center.</i> <br><br><h3>  About cold </h3><br>  Cold is closely related to electricity.  If the rack consumes 5 kW, then, roughly, it emits 5 kW of heat.  We usually believe that if the hall is designed for 500 kW, then the cooling capacity of all air conditioners in this room should also be 500 kW (plus the capacity of one backup air conditioner).  That is, stocks of cold and electricity must fight with each other. <br><br><h3>  Custom racks and equipment </h3><br>  When you need to place a standard rack (width 600 mm, 42 units, 5 kW), you can put it in any place where we have electricity and cold.  Nuances arise when high-loaded racks need to be installed in the hall (8‚Äì30 kW). <br><br>  For example, you need to put a rack of 30 kW.  We have an empty room, put it at the very beginning of the room, next to the air conditioner. <br><br>  Now imagine that the air conditioner turned off next to it.  Calmly, we have a backup.  If it were the usual racks of 5 kW, then working air conditioners would quietly pull away the hot air and the equipment would not notice anything.  But a 30 kW rack generates a whole cloud of heat, which simply does not disperse along the hot corridor.  It is important that the closest air conditioner works.  If it breaks, the hot air begins to fall into the cold corridor, again falls into the equipment.  After minutes, the equipment in this rack will become very difficult, monitoring will work, the rack will run to help with the help of drive-through fans.  Equipment will save, but the problem with the unsuccessful location of the rack will remain. <br><br>  Empirically, we found in the hall a zone in which you can put such powerful racks.  If some conditioner dies, then the rest will be able to draw hot air from this rack (see diagram). <br><br><img src="https://habrastorage.org/webt/93/jc/yp/93jcyp6rioi8tad1xqw0sfr3eie.png"><br>  <i>The red stands are places where you can not put a high-loaded rack.</i>  <i>Green - wherever possible.</i>  <i>Yellow - permissible, but only if absolutely necessary.</i> <br><br>  To help the cooling system in racks of 8 kW, we use ventilation doors, air tiles, insulation of cold corridors.  They do not provide additional cold and will not save if the cold power is already selected, but help to control air flow and improve the efficiency of the air conditioning system. <br><br>  Ventdveri are installed on the rear wall of the racks 8-11 kW.  They do not release hot air into the hot corridor and direct it upwards with the help of fans. <br><br><img src="https://habrastorage.org/webt/f3/cl/ez/f3clezdul9dv5xvi6iunzjzut28.jpeg"><br>  <i>Vertical door</i> <br><br>  In racks from 11 kW, active ventilation tiles (perforated tile with a fan) are added to the ventilation doors.  They additionally direct the flow of cold air to the equipment.  Ventilation tiles are smart: read the indicators from the sensors on the rack and adjust the fan speed. <br><br><img src="https://habrastorage.org/webt/ru/7h/uf/ru7hufwttfdu1ywjgmioxknejyw.jpeg"><br>  <i>This is a ventilation tile.</i>  <i>This even has a small display</i> <br><br>  If a client has two rows of powerful racks, for example, 15 kW each, it is reasonable to isolate it. <br><br><img src="https://habrastorage.org/webt/_t/fa/rn/_tfarnwwyktkhsmp2vvw8smnlxc.jpeg"><br>  <i>Isolated cold corridor</i> <br><br>  Often customers bring three phase racks.  Not that this is highly non-standard, we just designed our first data centers mainly for single-phase racks with a small margin for three-phase load (10‚Äì15% of the total capacity).  If the client needed a three-phase rack, then simply put a three-phase automatic switch in the backup section of the switchboard.  As the name suggests, a three-phase automatic machine is three times as large as a single-phase one, takes up more space, and you will not put a lot of these.  Sometimes the client had so many three-phase racks that the reserve in the switchboard was chosen, and it was necessary to install additional boards. <br><br>  In our newest data center NORD-4, we have foreseen this moment.  There, the power supply is distributed through the busbar under the raised floor, and this allows you to put a rack of any phase. <br><br><img src="https://habrastorage.org/webt/vm/rr/sb/vmrrsbpxuvy6vyaa85sv0wmefzm.jpeg"><br>  <i>Both single-phase and three-phase circuit breakers can be installed on the busbar</i> <br><br>  Usually the equipment takes the air from the front, from the cold corridor, and throws it from behind, into the hot corridor.  But it is different.  For example, the equipment sucks in cold air from the front and rear, and the hot air issues upwards.  For such a rack with the help of isolation they organized a branch of the cold corridor in the hot.  This is not exactly feng shui, but it works. <br><br><img src="https://habrastorage.org/webt/lw/41/p-/lw41p-6uh2dm4sipmtrt6niyxpe.jpeg"><br>  <i>For ‚Äúnon-standard‚Äù equipment in racks 030 and 040, they made insulation in the middle of a hot corridor</i> <br><br>  There is equipment that takes air from one side and throws hot air into the other side.  We installed this equipment on a 800 mm rack so that the cold and hot air could have a place to circulate.  On the side of the cold corridor in front of the counter, a side air blower unit was placed: it takes the cold air from the front and leads it to the side and up.  The space on the sides of the rack is insulated so that there is no parasitic air exchange. <br><br><img src="https://habrastorage.org/webt/jv/c1/ms/jvc1msd3xwca3fzm2l98giqu5ya.png"><br>  <i>The lower unit occupies the same block of the organization of the side blowing</i> <br><br><img src="https://habrastorage.org/webt/eu/cr/lk/eucrlk4gl2soibtvu6l95ohqcjq.jpeg"><br>  <i>From this side, cold air enters the equipment.</i>  <i>In the background is visible insulation from the hot corridor.</i> <br><br> <i><img src="https://habrastorage.org/webt/i0/9c/b0/i09cb0rejrovx7wllkf724ann3c.jpeg"><br></i>  <i>To the left of the equipment is visible insulation, which does not release the waste hot air into the cold corridor.</i> <br><br><h3>  Fences </h3><br>  Together with racks, customers often order fences for racks, especially banks.  They need to be positioned so that they do not eat up a lot of usable space, and therefore the racks must be positioned compactly, so that in the end something will turn out even remotely resembling a rectangle.  But sometimes it turns out, as in the diagram below). <br><br><img src="https://habrastorage.org/webt/y-/ta/tz/y-tatz-f4o45lqxqeiwf66ujpgu.png"><br><br>  Usually, a fence is built from the main floor (i.e., there is also a fence under the raised floor) and up to the ceiling, closing the network trays. <br><br><img src="https://habrastorage.org/webt/ve/g9/0m/veg90mwd58q1exdtdqzpmbakneg.png"><br>  <i>To get to the fence, you need to attach a pass to the access control sensor or a finger to the biometric scanner</i> <br><br><img src="https://habrastorage.org/webt/y7/md/vl/y7mdvlfge-7bn5-qynmj83shrzo.png"><br>  <i>Fence times</i> <br><br><img src="https://habrastorage.org/webt/yd/dm/ql/yddmqlawmdccat7yj2ndos2zkrg.jpeg"><br>  <i>Fence two</i> <br><br><img src="https://habrastorage.org/webt/gz/kn/-d/gzkn-dggzvxik1ves9frqcdmxo4.png"><br>  <i>Additional surveillance cameras and sometimes volume sensors are placed inside the fence.</i> <br><br><img src="https://habrastorage.org/webt/mz/8c/dt/mz8cdt2jb8iajdfwmez28mdjjwq.jpeg"><br>  But the fence with integrated insulation of the cold corridor, 2 in 1 so to speak <br><br><h3>  Capacity management tools </h3><br>  To monitor the consumption of space, electricity in the machine rooms it is not necessary to use expensive and trendy DCIM (Data Center Infrastructure Management) systems.  Statistics on the occupancy of the hall can be maintained in the usual excel.  Collect there information on the current state of the hall (the location of the racks, their power, size) and discipline make there information on the changes: which racks were added, which moved. <br><br>  The output will be quite a working tool that will help you understand where, how many and what racks you can install in this room. <br><br>  This concludes my brief excursion into capacity management.  Ask questions if something you are interested in is left out of the post. <br><br>  Finally, here is a pictorial picture of how the room was filled in the OST-3 data center from the moment it was commissioned in 2014 until today. <br><br><img src="https://habrastorage.org/webt/xe/lp/1j/xelp1ja041f-hu2bd8qtghz0_xo.gif"></div><p>Source: <a href="https://habr.com/ru/post/440264/">https://habr.com/ru/post/440264/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>