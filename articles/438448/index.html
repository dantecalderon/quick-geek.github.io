<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is PC Speaker capable of?</title>
  <meta name="description" content="Now known as the ‚Äúsystem speaker‚Äù, or simply ‚Äúsqueaker‚Äù, PC Speaker was born in 1981 with the first IBM personal computer. Heir to several generations...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>What is PC Speaker capable of?</h1><div class="post__text post__text-html js-mediator-article">  Now known as the ‚Äúsystem speaker‚Äù, or simply ‚Äúsqueaker‚Äù, <i>PC Speaker</i> was born in 1981 with the first <i>IBM</i> personal computer.  Heir to several generations of large computers for serious business, he was from birth was intended only for the filing of the simplest system signals, and could not adequately prove himself in voicing the entertainment programs that dominate the home market.  Strongly inferior to sound chips of specialized gaming systems, disappearing into the shadows of soon emerged advanced sound cards, it was supported by many developers on the residual principle - as an option, giving at least some sound in the absence of the best alternatives.  With infrequent exceptions, the speaker played through roughly simplified, completely monophonic versions of melodies, originally composed for much more powerful devices. <br><br>  The musical album ‚ÄúSystem Beeps‚Äù was written for <i>PC Speaker</i> using the same basic technique from the old games, and according to the typical formula of retro-computer near-demoscene creativity, it is intended to uncover many years of unexplored potential of this simplest sound device.  Actually, you can listen to the result and form your opinion on the success of this event at <a href="https://shiru8bit.bandcamp.com/album/system-beeps">Bandcamp</a> or in the video below, and further text goes deeper into the speaker‚Äôs device, the project‚Äôs history and ways of achieving a similar result for those who want to know more. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tUy1MEpqbvk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h3>  PC Speaker Device </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/47a/2a1/54c/47a2a154c9c7f619b16f77c702f1216b.jpg" align="right" width="33%" height="33%">  Technically, the speaker is a small speaker or piezo emitter, directly controlled by one of the channels of the system timer 8253, which divides the input clock frequency of 1.19 MHz into a 16-bit value specified by the program.  For sound, the counting mode is used, in which the timer produces a square wave, that is, a square wave.  This is a small, but still a step forward compared to the sound of earlier or lower-end computers such as the <i>Apple II</i> and <i>ZX Spectrum</i> , where the speaker was simply connected to a one-bit I / O port, and the processor was obliged to generate sound.  Using the timer channel allows the processor to simply select the desired pitch and continue doing other things.  However, the processor can programmatically synthesize sounds of various kinds and true polyphony.  <i>PC Speaker</i> cannot sound louder or quieter, softer or brighter.  All that he can do without constant processor intervention is squeaking or not squeaking at a given pitch with the same constant timbre. <br><img src="https://habrastorage.org/getpro/habr/post_images/75e/606/ca7/75e606ca7780ea1319353262f731b189.jpg" align="right" width="33%" height="33%"><br>  When playing sound effects or music, the processor updates the state of the speaker ‚Äî turns the sound on or off and changes its pitch ‚Äî at certain intervals.  As a rule, these changes occur in the interrupt from the zero channel of the same system timer.  The standard is 18.2 Hz, but games often change this value upwards, in the range from 30 to 200 Hz, depending on the game. <br><br>  The effective range of frequencies available to the speaker is approximately 100..2000 hertz.  Although other frequencies can be set, a variety of problems begin outside the specified range.  Firstly, the speakers used in themselves do not reproduce these frequencies very well.  Secondly, a noticeable deviation of possible frequencies from note frequencies begins above 2000 Hz, and when the sound frequency falls below the speaker‚Äôs update frequency, the updates start to operate late, the timer does not update the frequency divider until the count period with the previous divider ends . <br><br><h3>  Monophonic polyphony </h3><br>  Since the speaker is capable of playing only one sound channel or ‚Äúvoice,‚Äù that is, only one frequency at a time, and for musical purposes this is not enough, programmers and music authors sought ways to obtain imaginary or real polyphony.  There are three main approaches. <br><br>  In the first approach, the speaker generates sound as usual, the music player updates the frequency of the sound with a timer at a certain frequency and almost does not load the processor.  But at the same time, two or three virtual channels with different parts are simultaneously played, and the frequency and sound on / off values ‚Äã‚Äãare in turn derived from them to the real speaker in each update.  For example, with two channels, in the first update, the sound from the first virtual channel is output, and in the next, from the second one.  Polyphony in <i><a href="https://www.youtube.com/watch%3Fv%3D72vZ1asBIXQ">Lotus III</a></i> and <i><a href="https://www.youtube.com/watch%3Fv%3DizadA3nSPbk">Xenon 2</a></i> games is implemented in a similar way.  Since often one virtual channel plays a bass line and another melody, and these parts have pauses, it turns out alternating either distant notes from each other, or alternating notes and silence, which leads to constant cod, unpleasant for the ear.  It can be reduced by eliminating pauses in batches, as in <i><a href="https://www.youtube.com/watch%3Fv%3DgMjXxSag_yQ">Golden Ax</a></i> , which significantly impairs expressive means (pauses in music are just as important as notes), or by turning off the channel alternation when there is a pause in one of them. which gives a clearer single-note sound, as in <i><a href="https://www.youtube.com/watch%3Fv%3DJQ3Qg3ora2I">Stunts</a></i> . <br><br>  The second approach can be observed in <i>Lucas Art</i> games, in which the quality of speaker versions of music has traditionally received more attention.  As a rule, they predominantly consist of a single-voice melody with rare inserts of time-separated bass and rhythmic elements, interrupted by very short and abrupt sounds of a second, auxiliary channel part, such as arpeggios or drums.  In other words, the channels alternate not constantly, but only in short moments of time, when the second voice drowns out the first.  Examples can be heard in <i><a href="https://www.youtube.com/watch%3Fv%3D1IOL4q5tDDQ">Monkey Island</a></i> , <i><a href="https://www.youtube.com/watch%3Fv%3DSXT6tsb5vWM">Loom</a></i> , <i><a href="https://www.youtube.com/watch%3Fv%3D_dsYoqmY1mE">Indiana Jones</a></i> games, and perhaps the most advanced version of the arrangement in <i><a href="https://www.youtube.com/watch%3Fv%3D9pViljsxtcA">Zak McKracken and the Alien Mindbenders</a></i> .  This creates a more convincing and listenable illusion of polyphony, albeit a rather limited one. <br><br>  In the third approach, the speaker does not generate sound by itself, but is used as a D / A converter, through which sound or digitizing software, programmed by a processor, is reproduced.  This process requires significant computational resources, almost completely loading the usual 8086, so the method gained popularity with the spread of 80386. The quality of the sound played in this way is low and objectively inferior even to the simplest homemade <i>Covox</i> from a handful of resistors, but at that time it was an impressive achievement, by one of the implementations of which, <i><a href="https://en.wikipedia.org/wiki/RealSound">RealSound</a></i> , even a patent was issued and the technology was sublicensed. <br><br>  Turning a speaker into a DAC can be done by simply turning the sound off and on with a banned account, which gives the simplest 1-bit DAC, or by using the timer sound channel to generate short pulses of various lengths at a frequency set by the system timer (PWM), which turns it into a better quality 6-bit DAC.  The first version can be heard in multichannel music in <i><a href="https://www.youtube.com/watch%3Fv%3DXKYkhtTNQD4">Fantasy World Dizzy</a></i> and <i><a href="https://www.youtube.com/watch%3Fv%3DoKe59rIC-qQ">Hard Drivin '</a></i> games, the second is more often used for playing music based on samples, for example, in <i><a href="https://www.youtube.com/watch%3Fv%3Dyb8mLBa3dcg">Pinball Dreams</a></i> .  It was also used in such interesting projects of the past as <i>TEMU</i> and <i>VSB</i> - software emulators of the three-channel <i>Tandy</i> sound chip and the digital part of <i>Sound Blaster</i> , which allow them to output the sound they intended through the speaker in the absence of these devices ( <i>386SX</i> and above required). <br><br><h3>  Album and history of creation </h3><br>  Initially, I didn‚Äôt have a plan to make a music album.  There was a creative search for an audiovisual image for a game project with styling for pseudographic games of the XT era, and for the maximum authentic image, an idea arose to write not just styling, but music really possible on <i>PC Speaker</i> , following the classic 8-bit musical formula of games minutes  I would not like to use digital sound or software synthesis, since the result would hardly correspond to the spirit of the epoch, and would not have a special character.  Monophonic melodies have been the subject of my interest since the time of the <i>ZX Spectrum</i> and my acquaintance with the games <i><a href="https://www.youtube.com/watch%3Fv%3Dc_xSG8pmdq8">Ping Pong</a></i> , <i><a href="https://www.youtube.com/watch%3Fv%3DggDN928nAl4">Stardust</a></i> , <i><a href="https://www.youtube.com/watch%3Fv%3DfTPIjyG_R1g">Score 3020</a></i> .  And since there was such a case, I wanted to try to write exactly one-voiced music, but to get some unusual result at the expense of the arrangement is a tempting challenge for the composer. <br><br>  The work on music was even more exciting than the work on the game.  In the process of burning the idea, the <i>VSPi PCSPE</i> plugin was developed and published, several sketches of melodies and trial cover versions of old tracks were made in order to develop the technique of working with monophonic arrangements and to find common sound solutions.  Later it became clear that the result did not correspond to the vision of the game project, and the project itself gradually went to the table.  But the musical material remained, and the potential heard suggested that it would be nice to quickly arrange it in the form of a small separate collection of tunes for <i>MS-DOS</i> , at least as a demonstration of the plug-in's capabilities. <br><br>  It didn't work out quickly, the matter dragged on, several tracks grew into several dozen, a collection of random melodies evolved into a thematic album, plans changed, dates shifted.  As a result, the completion of the idea took a half years, from July 2017 to January 2019.  During this time, I managed to make <i><a href="https://habr.com/ru/post/421961/">AONDEMO</a></i> and write a track for it (sound iron AON almost repeats <i>PC Speaker</i> ), and also participate in the development of sound code and utilities for the game <i><a href="https://www.kickstarter.com/projects/1973096722/planet-x3-for-ms-dos">Planet X3</a></i> , where the title track was also included as a title track. <br><br>  The completion of the project was constantly postponed, more and more new tracks were added to it, until all the initial ideas and sketches were completely exhausted.  In the final form of the album included 23 tracks, divided into three groups. <br><br>  <b>Side A</b> contains 16 main tracks, more or less connected by a common theme and sound.  For the most part, they were composed specifically for the album, from scratch or based on old material that was well suited for a single-voiced arrangement.  The principle of selection in this group was in originality and more successful, as it seemed to me, arranged in selected constraints, as compared to other tracks. <br><br>  <b>Party B</b> included 6 tracks, supposedly less successful, which were cover versions of my old works for other platforms, or were based on more or less elaborated old material, which initially assumed completely different formats - from the XM module to the pop punk song.  It also included the track, already lit up in <i>Planet X3</i> . <br><br>  <b>Side X</b> included a track from <i>AONDEMO</i> with minimal changes.  This branch is made as a joke of humor. <br><br>  The album itself is designed as a player program for <i>MS-DOS 3.3</i> and higher, which will run on the <i>IBM PC XT</i> with at least 256KB of RAM and a <i>CGA</i> video <i>adapter</i> .  Since the original <i>CGA</i> card is subject to the so-called ‚Äúsnow‚Äù, the visual artifact when trying to update the screen during the ray path on the raster, the program is presented in two versions - <i>sbx.com</i> without the effect of a spectrum analyzer, but without snow, and <i>sb.com</i> with that effect.  For smoother rendering of the analyzer, it is desirable to have a more powerful processor.  Of course, more modern computers will also fit, for example, with <i>FreeDOS</i> loading from <i>USB</i> , as well as <i>DosBox</i> emulation. <br><br><h3>  Musical component </h3><br>  No software tricks are used in the album, such as sound synthesis by the processor and the use of a speaker as a DAC.  The technology is the most traditional - a strictly monophonic square wave generated by the system timer, updating the pitch with a relatively large but not out of the ordinary frequency of 120 Hz, which is quite possible by the classical XT and leaves enough processor time to perform other tasks besides playing music. <br><br>  The whole secret is in a special approach to writing melodies and arrangements.  Here, previous experience in different related areas helped a lot - the experience of writing a classic chip-tun for sound chips of the past, in which it is often necessary to combine several batches in one channel using the method of alternation and overlay;  experience in developing sound engines for games on old computers, where sound effects borrow channels from music, drowning it out;  as well as the experience of composing original music for the drive.  As it turned out later, in fact, I developed an approach to speaker music that was used by <i>Lucas Art</i> , although at the time I started working I heard only a topic from <i>Monkey Island</i> . <br><br>  One of the interesting problems that needed to be solved almost at the beginning of work was the instruments of percussion and percussion.  In chiptune, they are usually made using a noise channel, but there is no opportunity to play noise on the speaker at a refresh rate of the order of tens to hundreds of hertz. <br><img src="https://habrastorage.org/webt/-t/5p/xu/-t5pxu74-1ocdyguv-djt9iyqtg.png" align="right"><br>  The bass drum and the toms work well and without noise, in the form of simple slides down at different speeds and durations - the barrel is faster and shorter from a low note, the tomos are slower and truer from the higher notes.  But the main percussion instrument, a small (working) drum, in the form of a simple slide sounds unconvincing and does not cut through the mix loaded with other elements.  This is where the trick, often encountered in the imitation of the working drum on the <i>SID</i> and <i>AY-3-8910</i> , triggered off the sound at the beginning of the slide, creating a shot effect.  This makes the sound sufficiently different from other percussion instruments, and also improves the visibility of the drum in the mix.  This is particularly evident in conjunction with the characteristic resonances characteristic of a real speaker. <br><br>  Due to the absence of noise, we had to abandon any hass.  For a more varied and interesting sound, drum instruments differ between tracks.  Somewhere they are longer, somewhere abrupt, they sound higher or lower, sometimes there are additional elements. <br><br>  In the process of working on music, universal techniques were developed, suitable for writing monophonic arrangements for any monophonic devices that do not have volume control, whether it be a music card, a CNC machine or a Tesla coil.  Among them: <br><br><ul><li>  The peculiarity of human hearing, when the supposedly louder sound masks the quieter sounds.  For example, the drum beat or the note of the central melody - they divert attention to themselves and make the brief disappearance of the remaining parts unobtrusive. </li><li>  Arrangement in which there is enough pauses between the notes.  This is especially true of the introductory parts.  At these moments, the components are well heard separately and get an opportunity to be remembered so that as the track develops, when the arrangement becomes denser, the brain continues to recognize the presence of these elements, even if they become barely audible in the mix. </li><li>  The composition of melodies, in which a significant part of the notes falls on a weak share, as well as a shift in the beginning of the notes relative to the meter grid.  This allows the melody notes to take up pause spaces in the accompaniment, thereby reducing the imposition of parts.  In particular, it allows you to win some space for the notes of the bass parts, for which it is important to get into a strong beat.  This gives melodies a strong sync copy, creates a feeling of funkyness, which is beneficial to their interestingness. </li><li>  Regular chip tuners arpeggios at different speeds, including very fast two-note arpeggios at a frequency of 120 Hz.  Variations in speed allow you to create elements of the arrangement with different sound, which helps a lot in the absence of timbre expressive means - after all, all notes have the sound of the same square wave. </li><li>  Repeated pauses in extended sounds, for example in a solo instrument, in which other virtual channels are heard.  As a rule, such instruments begin with a continuous sound, then pauses appear and their frequency and length gradually increase, which is a kind of imitation of a falling volume. </li><li>  Variations of the duration of the notes, including very short, to simulate the difference in volume.  It is used to emphasize ripple in bass parts, where notes falling on a strong beat have an increased duration, as well as to create an echo effect ‚Äî when the part with notes of the same duration echoes itself, but with notes of significantly shorter duration. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/8i/ck/jk8icka2kllovhyfnh59xibrxbu.png"></div><br><br><h3>  Technical component </h3><br>  Another key point in the work on the album is the use of modern tools that make it much more comfortable and efficient.  This is a familiar to me modern digital studio <i>Reaper</i> (a program similar to <i>FL Studio</i> , <i>Cubase</i> and the like) and a set of independently developed VST plug-ins. <br><br><img src="https://habrastorage.org/webt/91/9a/og/919aogkjz8mdmykz9swed0e6d6c.png"><br><br>  Such an approach is experimental, completely unconventional to create a "tru-chiptune", that is, music intended to be played on a real device - usually special programs-trackers or manual typing of musical data are used for this.  Of course, the same result can be obtained with such more classical means (which was done for <i>Planet X3</i> ), but this requires more effort and regular diversion from the creative process to purely technical points. <br><br><img src="https://habrastorage.org/webt/4d/tp/zi/4dtpzi3okpvlcwu_xnx0malhm-g.png" align="right" width="40%" height="40%"><br>  Especially for the creation of speaker music was developed <i>VSTi</i> plugin <i>PCSPE</i> .  It emulates <i>PC Speaker</i> hardware, allowing you to immediately hear a near-to-real result, and also implements a system of chip tuners, like those used in trackers for various sound chips.  Virtual volume (priority) envelopes, arpeggios and pitch changes are specified as lines of text with a very simple format, reminiscent of the <i>MML</i> music language (relative to the lines of letters in the <i>PLAY</i> operator in <i>BASIC</i> ).  Using these envelopes, you can set, for example, various sounds of percussion instruments, or a solo instrument with gradually increasing vibrato. <br><br>  But the main task of the plug-in is to automatically mix several input <i>MIDI</i> tracks with different parts into the final mono track.  The mentioned virtual loudness of the instruments is the basis of the priority system.  At one point in time (the period of updating the state of the speaker), only the instrument with the highest current volume always sounds.  For example, a bass instrument has a volume of 2, a melody is 6, and a drum instrument has a volume of 8, which means that the notes of a melody will drown out the notes of a bass, and the drums will drown out both.  Thus, several simultaneous sounding musical parties are reduced to one speaker channel. <br><br>  The plugin has the export function for the further use of music in real programs.  The principle of the log is used: the plugin always knows what frequency is given to the emulated speaker at each time point, and how much time passes between its changes.  When you turn on the export function and play the track from the beginning to the end, this data is recorded in real time in a file of the selected format.  Further, in order to play music, it is enough to take this data from a file and output it to a real speaker with the required delays. <br><br>  A typical chip tuner arpeggio can be created in <i>PCSPE in the</i> classical way, corresponding to an envelope defining a sequence of offsets in semitones relative to the base note.  But it requires constantly switching instruments and keeping in mind the correspondence between the instruments and the resulting chords.  To do this in modern <i>DAW is</i> rather inconvenient. <br><br>  A much more convenient way is implemented by my other <i>VSTi</i> plugin - the <i>ChipArp</i> arpeggiator, specially designed for writing ChipTunes and styling.  It automatically converts traditional polyphonic chords from input <i>MIDI</i> tracks to arpeggios with preset parameters to output <i>MIDI</i> tracks, and does this on the fly ‚Äî you can play chords on the <i>MIDI</i> keyboard and hear the arpeggios immediately.  Unlike arpeggiators for modern electronic music, which constantly restart a note from the beginning, this plugin implements arpeggios in the form of pitch bands with respect to the lowest note of a chord.  Thus, the arpeggio does not violate the long-lasting sound of the instruments.  For the full-fledged operation of this plugin, it is necessary to support the installation of a wide range of bands and an instant reaction to bands in the synthesizer plugin used, which is rare, but all my synthesizers support this. <br><br>  <i>PCSPE</i> and <i>DosBox</i> type emulators produce an idealized square wave that is noticeably different in sound from a real device.  Tiny system speakers are subject to strong resonances and distortion of the frequency response, emphasizing the transients, that is, the moments of switching on and off the sound or a sharp change in frequency.  In particular, this makes the drums on a real speaker much more pronounced in the mix, i.e.  "Punch".  For the control and handling of such a feature for the benefit of the arrangement, the free <i>NadIR</i> plugin was <i>used</i> and the recorded impulses of several small speakers were recorded by hand - just like the impulses of real guitar cabinets are used for digital recording of guitars. <br><br><h3>  Materials </h3><br>  The project was published under the open license <i>CC-BY</i> , including the music itself, the sources of the player and the projects of all tracks for Reaper.  Thus, anyone is free to make any derivative products, both with respect to the musical component and the code.  All tools used in the development are also available with the source code: <br><br>  <a href="">Player software with music</a> <br>  <a href="">Sources of programs and projects for Reaper</a> <br>  <a href="">PCSPE plugin with sources</a> <br>  <a href="">ChipArp plugin with source code</a> <br>  <a href="">Speaker impulses</a> </div><p>Source: <a href="https://habr.com/ru/post/438448/">https://habr.com/ru/post/438448/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>