<div class="post__text post__text-html js-mediator-article">  <a href="https://en.wikipedia.org/wiki/Tragedy">According to Wikipedia</a> , tragedy is “a form of drama based on human suffering that causes catharsis or pleasure in the audience.”  Benno Rice took inspiration from this definition in his speech at the <a href="https://2019.linux.conf.au/">2019 linux.conf.au</a> conference.  His report is devoted to the history of systemd, in which a lot of suffering.  And the audience really enjoyed it, so it all fits.  Overall, this is a sympathetic and subtle look at one tumultuous chapter in the history of the Linux system. <br><br>  Rice was also inspired by the Aurinnna Show <a href="http://blog.aurynn.com/2015/12/16-contempt-culture">article</a> about the so-called "culture of contempt."  According to Shaw, people show contempt (for example, to developers who use another programming language) as a social sign, a way to show that they belong to the right group. <br><br>  Of course, in this story there is such a culture: large groups together show a general contempt for systemd and for those who use this system.  Hence the concept of change or resistance.  Yes, familiar things are comfortable.  But they are not necessarily good, especially if nothing has changed for many years. <br><a name="habracut"></a><br><h1>  The origins of the tragedy </h1><br>
По словам Райса, происхождение systemd связано с корнями самой системы Unix, которая была «счастливой случайностью»&nbsp;— реакцией на внешнюю сложность прежних систем. Unix был кардинально упрощён во всех отношениях, включая загрузку пользовательского пространства. Подсистема <code>init</code> заведовала всем «хозяйством», включая монтирование файловых систем и запуск демонов. Хотя это совершенно разные задачи, но их объединили в один процесс.<br>
<br>
В те дни важных демонов было мало: <code>cron</code>, <code>update</code> (чья работа заключалась в том, чтобы иногда выписывать суперблоки файловой системы), и сам процесс <code>init</code>. К моменту выхода <a href="https://en.wikipedia.org/wiki/History_of_the_Berkeley_Software_Distribution">4BSD</a> у Unix и появился правильный демон <code>getty</code>, сетевые демоны вроде <code>routed</code> и <code>telnetd</code>, а также «супердемон» <code>inetd</code>. Именно здесь ситуация начала становиться интересной, но некоторое время всё это работало достаточно хорошо.<br>
<br>
А потом случился Интернет. Хотя <code>inetd</code> нормально справлялся с небольшими объёмами трафика, но не мог создавать новый процесс на каждое входящее соединение. Тем временем веб-сайты обзавелись базами данных и другими системами с сохранением состояния между соединениями. Представление о демоне сместилось в сторону «сервиса», а это совсем другой зверь. Старый <code>init</code> мог только запустить сервис, но после этого становился практически бесполезен.<br>
<br>
Частично проблема заключалась в объединении сервисов и конфигурации. Такие задачи, как монтирование файловых систем, относятся к последней разновидности; они обычно выполняются один раз во время загрузки, после чего забываются. Но такого подхода недостаточно для автоматизированного управления сервисами, которое требует постоянного внимания. Вот так на свет появились сервис-ориентированные системы, такие как Upstart и systemd. Здесь Unix пошла по пути, проторенному другими ОС. По словам Райса, у Windows NT с самого начала была сильная сервисная модель, а у Mac OS она до сих пор работает в виде <code>launchd</code>. Другим системам приходилось догонять.<br>
<br>
Apple выпустила <code>launchd</code> в версии Tiger, где он заменил целую серию демонов обработки событий, включая <code>init</code>, <code>cron</code> и <code>inetd</code>. Таким образом, systemd стал попыткой позаимствовать хорошие идеи, реализованные в <code>launchd</code>. Когда Леннарт Пёттеринг начал решать эту проблему, он сначала посмотрел в сторону Upstart&nbsp;— системы, основанной на событиях. Она ещё работала на скриптах, но Пёттеринг пришёл к выводу, что сможет сделать лучше. В своей статье <a href="http://0pointer.de/blog/projects/systemd.html">Rethinking PID 1</a> он называет launchd одним из образцов для работы. Он думал о повышении скорости загрузки и необходимости настройки системы инициализации на аппаратные и программные изменения в работающей системе. Во время создания <code>init</code> системы были статичными, но современная среда гораздо динамичнее, чем тогда.<br>
<br>
<h1>Сервисный уровень</h1><br>
Классические Unix-подобные системы делятся на два основных компонента: ядро и пользовательское пространство. Но ядра со временем стали более динамичными и изменчивыми, подстраиваясь под оборудование, на котором они работают. Это привело к необходимости создания нового «сервисного слоя» (service layer) между ядром и пользовательским пространством. Этот слой включает в себя компоненты вроде <code>udev</code> и Network Manager, но systemd стремится обеспечить комплексный сервисный уровень; именно поэтому со временем он вбирал в себя функциональность таких компонентов как udev. Процесс шёл довольно успешно и был принят большинством (но не всеми) дистрибутивами Linux, хотя часто сопровождался язвительностью со стороны сообщества.<br>
<br>
Против демона systemd часто звучат одни и те же аргументы: например, что он нарушает философию Unix. Райс предполагает, что этот аргумент основан на понятии, что systemd представляет собой единый монолитный двоичный файл. На самом деле systemd структурирован иначе: это много отдельных двоичных файлов, поддерживаемых в рамках одного проекта. Как «человек BSD» (он входил в число основных разработчиков FreeBSD), Райс находит смысл в таком объединении смежных концепций. Systemd — вовсе не раздутая и монолитная система, как считают некоторые критики.<br>
<br>
Говорят, что в systemd много багов. «Это же софт», конечно, в нём будут баги, сказал Райс. Представление о том, что в отличие от любой другой системы systemd должен быть совершенным, поднимает планку слишком высоко. По крайней мере, у systemd практически всегда разумный режим работы при отказе, сказал он. <br>
<br>
В той или иной форме часто повторяется одна жалоба, которую можно сформулировать так: «Не выношу Леннарта Пёттеринга». Райс отказался защищать стиль общения Пёттеринга, но сказал, что нельзя не восхититься силой воли и решимостью Пёттеринга. Не каждый сможет пройти через всё это.<br>
<br>
Systemd не стремится к портируемости на системы, отличные от Linux, что приводит к отдельному классу жалоб. Если systemd станет стандартом, существует риск того, что операционные системы за пределами Linux станут ещё более изолированными. Многие хотят, чтобы systemd придерживался стандартных для Unix интерфейсов, но у Райса для них простой ответ: «Unix мёртв». Когда-то Unix был упражнением в предельной переносимости и имел реальный успех. Но теперь мы живём «в мире Linux с небольшими ошибками округления» (что человеку от FreeBSD больно говорить), и нет смысла придерживаться классических интерфейсов Unix. Нынешняя ситуация является «патологической монокультурой», где Linux может диктовать условия.<br>
<br>
Systemd много выиграл в такой ситуации. Например, контрольные группы&nbsp;— высокоэффективный и интересный механизм управления процессами, без них было бы гораздо труднее решать эти задачи. Они гораздо более мощные и детальные, чем джейлы FreeBSD. Разработчики систем типа FreeBSD могут видеть угрозу в непереносимости systemd. Но эта ситуация также даёт им возможность свободно работать и искать собственные решения этих проблем.<br>
<br>
<h1>Перемены и трагедия</h1><br>
Райс говорит, что миссия systemd сводится к большим разрушительным изменениям&nbsp;— вот где начинается трагедия. У нас нердов сложное отношение к изменениям. Да, это потрясающе, когда мы сами их создаём, но изменениям нельзя доверять, если они приходят извне. Systemd представляет тот вид внешне навязанных изменений, который люди находят угрожающим. Люди противятся таким изменениям даже от приятных разработчиков, не говоря уже о Пёттеринге, который не особо сочувствует окружающим. Это приводит к рефлекторным реакциям. Но людям нужно отступить и подумать, что они делают. «Никто не должен угрожать Леннарту смертью из-за какого-то программного обеспечения», — говорит Райс. Презрение&nbsp;— это не круто.<br>
<br>
Вместо этого стоит подумать: почему вообще появился systemd и почему это важно? Какую проблему он решает? Для критиков одним из решением может быть попытка создать собственную альтернативу: они поймут, насколько весёлая эта задача. Кроме всего прочего, эта история показывает разницу в мышлении у нового поколения, которое рассуждает о системах больше с точки зрения API и контейнеров, например.<br>
<br>
Итак, какие выводы можно сделать из истории systemd? Один из выводов: нельзя недооценивать транспорт сообщений. Systemd интенсивно использует шину D-Bus, которая во многом обеспечивает его гибкость. Райс не сторонник D-Bus, но большой сторонник шин для обмена сообщениями между процессами. В своё время он лоббировал создание такой нативной шины в BSD-системах, желательно встроенной в ядро и с лучшей безопасностью, чем у D-Bus. Поверх неё можно сделать надлежащую систему удалённого вызова процедур, где компоненты ядра и пользовательское пространство будут работать на одном уровне. В правильно спроектированной системе процесс просто отправит запрос API, не беспокоясь о том, где и как этот запрос будет обработан.<br>
<br>
Среди прочих уроков — важность поддержки надлежащего жизненного цикла службы без необходимости установки дополнительных систем управления службами. Важно наладить автоматизацию обслуживания через API; и systemd обеспечивает многое из этого. Поддержка контейнеров также важна: это полезный способ инкапсуляции приложений.<br>
<br>
Итак, в современных Linux-системах systemd выполняет роль сервисного слоя. Это хорошая платформа для управления службами, но она не должна быть единственной альтернативой. В systemd есть ряд полезных функций, включая удобные пользовательские юниты, последовательное именование устройств и даже хорошую модель журналирования, сказал Райс. Двоичные журналы&nbsp;— неплохая вещь, пока у вас есть инструменты, чтобы вытащить оттуда информацию. И systemd предоставляет новую модель приложения. Вместо одного двоичного файла приложение становится кучей модулей в одном контейнере.<br>
<br>
Мир вокруг нас меняется, сказал Райс. Мы можем либо отдаться течению, либо сопротивляться ему. В первом случае, вероятно, плыть будет проще, чем во втором. Райс предложил всем, кто критикует systemd, более пристально изучить эту систему и попытался найти в ней хорошие вещи. Возможно, тогда завершится фаза катарсиса нашей трагедии — и мы сможем двигаться дальше.<br>
<br>
Видеозапись выступления <a href="https://www.youtube.com/watch%3Fv%3Do_AIw9bGogo">опубликована на YouTube</a>.<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/o_AIw9bGogo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>