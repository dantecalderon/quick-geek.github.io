<div class="post__text post__text-html js-mediator-article">  When creating games, developers are obsessed with creating interesting and exciting gameplay for players: put them in new conditions or take a fresh look at acquaintances.  And sometimes you need to cheat a little.  Developers make small changes to gameplay systems or to certain basic game design functions.  This also applies to non-player characters.  Xenomorph from <a href="http://www.gamasutra.com/blogs/TommyThompson/20171031/308027/The_Perfect_Organism_The_AI_of_Alien_Isolation.php"><em>Alien Isolation</em></a> had short-range sensors on the back, and the “director” always knew where the user was, the enemies in <a href="http://www.gamasutra.com/blogs/TommyThompson/20171012/307480/The_Definition_of_Artificial_Insanity_The_Systemic_AI_of_Far_Cry.php"><em>Far Cry</em></a> became a little less accurate when they fought with the player, and the demons from <a href="https://habr.com/ru/post/419537/"><em>DOOM</em></a> waited patiently for their turn to get a chance to break player on shreds.  This may seem counterintuitive, but by limiting the behavior of characters or giving them more knowledge and skills than necessary, developers in some cases can make the game process more holistic.  And this brings us to the research of Ubisoft's <em>Ghost Recon Wildlands</em> : an action game released in 2017 in an open world in which players systematically destroy the Santa Blanca drug cartel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/098/c24/7ff/098c247ffa46f8003ed9fbbcd99c7c1d.png"></div><br>  In this article I will talk about three AI-controlled non-player characters working with the player in offline missions: Holt, Midas and Weaver.  This team of ghosts should be able to respond to the player’s commands and react to the world around him, while maintaining the illusion created by the game, while you secretly destroy enemy command posts or go head-on in a combat helicopter, smashing everything into pieces.  This is an interesting design challenge.  The game has become one of the outstanding modern examples of how AI does not cheat in order to perform what is expected of it, but because we, the players, cannot accept their failure. <br><a name="habracut"></a><br><h1>  Team of ghosts </h1><br>  AI-controlled companions in the <em>Ghost Recon</em> series of games should support the player and create a sense of secretive operatives penetrating buildings and destroying enemy forces.  Including they have to indicate the player’s goals, perform synchronized killings of several enemies on the team, and also stand up for themselves when it gets hot.  <em>Ghost Recon Wildlands</em> takes all these elements and significantly increases their scale, which is a serious problem for game designers.  Unlike older games in the series, such as <em>Ghost Recon: Future Soldier</em> , here the number of unique situations increases exponentially.  This is partly due to the systemic elements of the gameplay, the control of the weather, the patrolling opponents and rebels, the civilian population and many others.  Players can attack enemy camps from any angle and use a variety of tools.  Therefore, AI systems for friendly characters must adapt, in some cases ignore their rules, and sometimes simply cheat to maintain the illusion promised by Ghost Recon.  Now for the AI ​​of all the characters in Ghost Recon Wildlands, a behavioral tree system is used, while a friendly AI uses a much more complex system than its enemies.  Today I will not talk in detail about the implementation of the behavior trees themselves, but I will explain the applied design rules and supporting systems that help in managing AI partners. <br><br>  AI teammates in the Wildlands were created by a small team from Ubisoft Montpelier, in whose design philosophy the player was the center of all the behavior of friendly AI.  This determined the way in which these systems were created and used.  This philosophy rests on three main pillars. <br><br><ul><li>  <strong>Do not drag the blanket over yourself: the</strong> teammates support the player without switching the focus on themselves. </li><li>  <strong>Maintain where you need it: The</strong> ghost AI must respond to its surroundings and help when necessary. </li><li>  <strong>Follow orders:</strong> do as the player orders, as far as possible in current circumstances. </li></ul><br>  All this is necessary to fulfill one rule: the player must control the game process and not feel that the game systems do not do what he wants from them.  In each case, the player directly or indirectly determines the behavior of these AI characters.  And in order to maintain the illusion when a covert passage is near the enemy, shooting or restoring a player, an AI friendly person constantly “cheats”, and for this he needs a lot of gameplay systems, as well as certain concessions from the friendly and enemy AI. <br><br>  As described in detail in the report of Mathias Rolland on As GameAI North 2017, the management of teammates consists of three gameplay systems that guide the AI ​​ghost squad: <br><br><ul><li>  <strong>Smart Recon</strong> system: finds interesting items and characters in local proximity </li><li>  The <strong>Balance of Power system</strong> : affects how effective partners are in combat. </li><li>  And both of these systems are connected into one big one called <strong>Overlord</strong> : this is a set of subsystems that defines the entire list of threats in the vicinity of the player and various useful information that partners can most effectively use in battle. </li></ul><br>  All three systems regularly interact with the player through teammates' characters and control their behavior and actions in space. <br><br><h1>  In action </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4a/88b/9be/c4a88b9be02e2f4a16a3adbc32c9ece2.png"></div><br>  Suppose I want to attack the base from the screenshot above.  This is a densely filled location, it has enemies, transport, and, without any doubt, patrols are walking around the neighborhood and security posts are set up.  When I approach, the Overlord system comes into play, which begins to identify all enemies approximately 100 meters from me.  It not only keeps track of how far they are, but also whether I and my partners are in their line of sight.  Meanwhile, Holt, Midas and Weaver secretly approach me behind the base.  To know where to go, my character leaves tags on the navigation mesh so the squad knows how to move.  Having reached the camp, companions receive instructions from Overlord on how to navigate through space.  Having received all the necessary information about the nearby characters of the enemies, Overlord knows in which areas of the map the squad should not move so that it will not be noticed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f34/f47/dc0/f34f47dc00595ba56b0c19f1a10f8298.png"></div><br>  It was at this moment that one of the members of the detachment warns me about a helicopter hanging in the air.  Therefore, I need to lie down and wait until he flies away.  But this is not important for the detachment, because while I am in stealth mode and have not noticed me, <strong>they are invisible to the enemy</strong> .  Overlord helps them to <strong>seem</strong> secretive, and until I tell them to move to a place where they are found, or they do not find me, they will remain invisible. <br><br>  While I am approaching the camp, the Smart Recon system registers nearby objects such as air defense systems and electric generators, as well as enemies.  It ranks them by relative importance, as well as depending on my ability to eliminate them.  It is at this moment that they make me understand that there is an enemy nearby, and transfer contextual information about where he is located.  It is also recorded in my HUD and minimap.  Although this is not very realistic, given that partners sometimes report objects that they cannot see, this provides a support mechanism that prevents me from failing from the very beginning, as well as finding targets and important points that I could otherwise would miss. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd4/c71/923/cd4c71923268ecdac2289a6029206fe3.png"></div><br>  However, instead, I decided to find snipers on the towers and quietly "take them off".  To do this, we use the command of a synchronized shot, in which I choose up to three enemies, who must be destroyed by ghosts.  The interesting thing here is that these synchronous shots depend on the ability of the player to mark the target, and on the ability of the friendly AI to make a shot.  But sometimes the AI ​​really cannot shoot, so in order to shoot, he may deviate from the rules to a certain extent.  Suppose that sometimes he has to shoot for a corner, but if the enemy is in the bunker and he can’t be on the line of sight, the partner will tell me that he cannot make a shot. <br><br>  Now the question may arise: are the team members able to miss?  In fact, they can not miss, because they do not shoot.  The Wildlands AI team calls it the “ <strong>Magic Shot</strong> ”: a squad pretends to shoot your team at the enemy, and all enemy AIs just drop dead.  Thanks to the imitation of the shot, they cannot miss, which means you will not fail the mission in such a simple way. <br><br>  When I get to the base, this process will continue.  The squad continues to follow the rules of Overlord about where he can search for important objects, and, by order of the players, destroy other enemies on the base with the help of “magic shots”.  Plus, the Smart Recon system points me to a generator that I missed during reconnaissance.  Having penetrated to the base, the partners begin to slowly follow me, and Overlord guarantees that they will only pass through the safe zones I have indicated.  But it still does not matter, because they are invisible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/e02/2e8/cbce022e8cf737222b394a643220914f.png"></div><br>  But having penetrated the base, I decide to make some noise and start a stir.  At this moment, not only the friendly AI supports me and starts attacking the enemies, but the Overlord system switches to battle mode.  Therefore, information on the priorities of the targets, as well as on the places to move around the world, is significantly changing.  In addition, Balance of Power comes into play.  In fact, this system is a real-time balancing tool that makes a detachment of ghosts more or less effective in the development of combat: it affects the damage from their shots, the frequency of attacks and the overall resilience of their partners.  <strong>The effectiveness of the unit depends on how the player manifests itself in avoiding damage and destroying enemies</strong> .  Plus, teammates at the start of the battle receive an extra bonus to help the player avoid death when chaos begins.  Let's return to the basics of design: they not only often aim to support, but also tend to be close to the player so that he knows about their support.  After the end of the shootout, the Smart Recon system is still working, and they continue to find targets, such as snipers, which the player has forgotten, or other combat helicopters. <br><br>  When the fight becomes too intense, the player gets into and I need to recover, then another system called <strong>Revive Manager</strong> comes into play.  Revive Manager selects one of the ghosts, orders it to activate the corresponding behavior tree, and controls that the AI ​​successfully restores the player.  If a player is surrounded by enemies, then he uses magical shots on nearby enemies to clear the space.  You were shot on the roof or an uncomfortable piece of geometry?  Then the partner is <strong>teleported to the surface</strong> or, in the worst case, directly to your body to successfully complete the recovery.  The same system is used when partners need to restore each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bba/0be/eb5/bba0beeb5afa2bf86eca0030163c23da.png"></div><br>  And this process continues until either the conflict ends, or the squad is killed.  In any case, the squad continues to transmit information, becoming more effective if the player performs well in combat, and recovering it while it is possible.  But despite all this, the player is not invulnerable: otherwise the game would not be any difficulty.  Therefore, if during a certain period of time the player can not find a way to end the conflict, it will be destroyed. <br><br><h1>  Other tricks </h1><br>  In many other cases, the squad also acts in a very specific way or cheats to support the gameplay.  The most noticeable moment for the player is the movement in transport.  If a player climbs into the car, the squad is also trying to get into it.  But if the player leaves without them, then they simply teleport to the car to provide support.  And if there is no room for all four on this vehicle, they will teleport to the player as soon as he gets out of the car. <br><br>  Above, I briefly mentioned that the AI ​​is invisible until I order it to appear to the enemy.  The partners are invisible and do not attack enemies until the player gives permission to do so, either by commanding a synchronized shot, or ordering an attack in the command menu, or simply launching an attack on their own.  The only time when invisibility is turned off is when a player gives an order to move to the teams menu, and his enemies notice partners.  If they are noticed, then the player is to blame.  According to the rules of the game, the AI ​​cannot refuse a stupid order, because in the end it will be a player's mistake. <br><br><h1>  Finally </h1><br>  Creating support characters for games like <em>Ghost Recon Wildlands</em> has never been an easy task.  Players are often ... unreliable.  Therefore, it is necessary to develop systems capable of behaving as expected in covert penetration, serious skirmishes and just when wandering around the map.  As a game developer, I am very pleased to see how such an AAA game makes big concessions to ensure high-quality gameplay.  In the article, I often used the word "cheat", but it does not mean that the player deviates from the gameplay intended by the designers.  Such tricks simply mitigate serious implementation problems that could easily arise in a game of this magnitude.  Making smart AI for games in the open world is much more difficult than you can imagine, so if you do this, you can cut corners.  Even if this means that the AI ​​can teleport to a flying helicopter. <br><br><h1>  Bibliography </h1><br><ul><li>  <strong>Wildland,</strong> Game AI North 2017 </li></ul></div>