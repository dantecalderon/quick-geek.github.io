<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to test in Autotech: MindMap's, static code analysis and MockServer</title>
  <meta name="description" content="Hello! I want to tell you how testing is arranged in the Avtotek project, the VIN car inspection service. Under the cut - about what tools we use to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>How to test in Autotech: MindMap's, static code analysis and MockServer</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I want to tell you how testing is arranged in the <a href="https://autoteka.ru/">Avtotek</a> project, the VIN car inspection service.  Under the cut - about what tools we use to test the requirements, planning the sprint, how the testing process in our project is arranged. <br><br><img src="https://habrastorage.org/webt/93/rt/-e/93rt-erujom8mgz5w-1gmrjl2ew.png"><br><a name="habracut"></a><br><h3>  MindMap's for grooming tasks </h3><br>  We in Avtotek use scram, as this is the most successful methodology for our tasks.  We have weekly meetings where we prioritize, determine complexity, decompose backlog tasks, and set up Definition of Ready and Definition of Done for each of the tasks (you can read about them in <a href="https://habr.com/post/417101">this wonderful article</a> ).  This process is called backlog grooming. <br><br>  For effective grooming, it is necessary to take into account all dependencies.  Know how the implementation of the task can adversely affect the project.  Understand which features need to be supported and which ones should be cut.  Perhaps, in the process of implementing the task, the API for partners may suffer, or you just need to remember to implement metrics that can be used to understand business efficiency.  With the development of any project, such dependencies become more and more, and it becomes more and more difficult to take them into account.  This is bad: it is important for the support service to know in time about all the features.  And sometimes innovations need to be coordinated with the marketing department. <br><br>  As a result, I proposed a solution based on MindMap, where almost all dependencies that could affect DoD, DoR, and task evaluation were reflected. <br><br><img src="https://habrastorage.org/webt/c7/uv/en/c7uvenelsismfmm10p0wamwwwyk.png"><br><br>  The advantage of this approach is a visual representation of all possible dependencies in a hierarchical style, as well as additional buns in the form of icons, text highlighting and colored branches.  Access to this MindMap has the entire team, which allows you to keep the map up to date.  A blank of such a map, which can be taken as a reference point, I post it here - <a href="https://is.gd/IJ3Stm">pyn</a> .  (I‚Äôll make a reservation right away that this is only a guideline, and it‚Äôs very doubtful to use this map for your tasks without revising the project.) <br><br><h3>  Linty and static code analysis for Go </h3><br><br>  In our project, a fairly large number of golang-code, and in order for the code style to meet certain standards, it was decided to apply static code analysis.  About what it is, there is a great <a href="https://habr.com/company/roistat/blog/413175/">article</a> on Habr√©. <br>  We wanted to integrate the analyzer into the CI process, so that with each build of the project, the analyzer was launched, and depending on the results of the test, the build continued or fell with errors.  In general, using gometalinter as a separate step (Build step) in Teamcity would be a good solution, but viewing errors in the build logs is not very convenient. <br>  We continued to search and found Linty Bot, developed in the framework of the <a href="https://habr.com/ru/company/avito/blog/342466/">hackathon</a> in Avito by Artemy <a href="https://habr.com/ru/users/flaker/" class="user_link">Flaker</a> Ryabinkov. <br><br><img src="https://habrastorage.org/webt/lb/ji/dx/lbjidxwhrbgc2eouel6bhrty6ma.png"><br><br>  This is the bot that keeps track of the project code in our version control system and starts a diff code analyzer with each pull request.  If errors occurred during the analysis, the bot sends a comment to this PR to the desired line of code.  Its advantages are the connection speed to the project, the speed of work, comments to pull requests, and the use of the rather popular Gometalinter linter, which by default already contains all the necessary checks. <br><br><h3>  MockServer and how to get services to give what you need </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/60c/8b9/482/60c8b9482f49c0587ad9aa415ce0e568.png" alt="image"><br><br>  The next section is about test stability.  Autotech is extremely dependent on data sources (they come from dealers, government services, service stations, insurance companies and other partners), but their inoperability cannot be the basis for refusal to conduct tests. <br><br>  We have to check the assembly of reports both with working sources and with their inoperability.  Until recently, we used real data sources in the dev environment, and, accordingly, were dependent on their state.  It turned out that we indirectly checked these sources in UI tests.  As a result, we had unstable tests that fell off along with the sources and waited for the survey of data sources, which did not contribute to the speed of passing autotests. <br><br>  I had the idea to write my own mock and thereby replace the sources of the Autotech.  But in the end, a simpler solution was found - a ready-made <a href="http://www.mock-server.com/">MockServer</a> , open-source Java development. <br><br>  The principle of its work: <br><br><ul><li>  creating an expectation </li><li>  match incoming requests, </li><li>  If a match is found, send a response. </li></ul><br>  An example of creating a wait using a java client: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MockServerClient(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-number"><span class="hljs-number">1080</span></span>) .when( request() .withMethod(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>) .withPath(<span class="hljs-string"><span class="hljs-string">"/login"</span></span>) .withBody(<span class="hljs-string"><span class="hljs-string">"{username: 'foo', password: 'bar'}"</span></span>) ) .respond( response() .withStatusCode(<span class="hljs-number"><span class="hljs-number">302</span></span>) .withCookie( <span class="hljs-string"><span class="hljs-string">"sessionId"</span></span>, <span class="hljs-string"><span class="hljs-string">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span></span> ) .withHeader( <span class="hljs-string"><span class="hljs-string">"Location"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://www.mock-server.com"</span></span> ) );</code> </pre> <br>  Apparently from an example, we describe request which we will send, and the answer which we want to receive.  MockServer receives the request, tries to compare it with those that were created, and if there are matches, it returns a response.  If the request did not match, we get 404. <br><br>  For MockServer there are clients for Java and JavaScript, excellent documentation and usage examples.  It is possible to match requests via RegExp, detailed logging on the server, and a whole bunch of other chips.  For our needs, this was the perfect candidate.  The launch process is described in detail on the site, so retelling it here does not see the point.  The only point is that the latest version is quite leaking from memory, so we are using version 5.2.3.  Be careful.  Another disadvantage is that Mockserver does not have SOAP support out of the box. <br><br>  At the moment, MockServer has been working with us for about three months.  As a result, the stability of tests, their speed and the ability to receive any data on the dev-environment has increased.  And accordingly, more opportunities for testing. <br><br><h3>  Epilogue </h3><br>  These technologies are the main things I would like to talk about in this article.  Otherwise, we use the usual tools for testing: API tests with a bunch of Kotlin + JUnit + RestAssured, Postman for ease of accessing the API.  In this review article I didn‚Äôt talk about our approach to UI tests.  We use MBT and <a href="https://graphwalker.github.io/">graphwalker</a> .  We plan with colleagues to prepare a post about it. <br><br>  If you have any questions, ask in the comments, I will try to answer.  I hope this article will be useful for development teams.  (By the way, while she was preparing for release, we had a <a href="http://bit.ly/2DuZvct">QA developer</a> job vacancy in the team, show those who might be interested in it). </div><p>Source: <a href="https://habr.com/ru/post/437952/">https://habr.com/ru/post/437952/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>