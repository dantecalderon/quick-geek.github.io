<div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cf/2d4/0c4/8cf2d40c46d90635704303149102519a.svg" alt="defi.js"></div><br><p>  <a href="https://defi.js.org/">defi.js</a> is a library that includes dozens of functions that add interesting features to any JavaScript objects using getters and setters. </p><br><p>  <a href="">Gifka to attract attention (3.5MB)</a> <br>  <a href="https://github.com/defijs/defi">Repository</a> </p><br><p>  As Hello World, we will create a small widget consisting of a name field, a last name and a greeting ( <a href="https://jsbin.com/femuxovame/1/edit%3Fhtml,js,console,output">demo</a> ). </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"first"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"last"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"greeting"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// данные по умолчанию const obj = { first: 'John', last: 'Doe' }; // слушаем изменения в свойствах first и last // если произошло изменение, сообщим об этом в консоли defi.on(obj, 'change:first', () =&gt; console.log('First name is changed')); defi.on(obj, 'change:last', () =&gt; console.log('Last name is changed')); // автоматически генерируем приветствие (свойство greeting) каждый раз, // когда first или last изменились defi.calc(obj, 'greeting', ['first', 'last'], (first, last) =&gt; `Hello, ${first} ${last}`); // объявляем двусторонний байндинг между свойствами // и соответствующими элементами на странице defi.bindNode(obj, { first: '.first', last: '.last', greeting: '.greeting' });</span></span></code> </pre><br><p>  As a result, if <code>first</code> or <code>last</code> have changed, event handlers report this to the console, the <code>greeting</code> property is automatically updated, and its element gets a new value (by default, "Hello, John Doe").  This happens every time the properties change, and it doesn't matter how.  You can set the value using the code <code>obj.first = 'Jane'</code> , or by changing the value of the field, and all other changes will occur automatically. </p><a name="habracut"></a><br><p>  In case there is a need to synchronize the properties of the object and the <code>innerHTML</code> an arbitrary HTML element (in the example we used the <code>output</code> tag), the <code>bindNode</code> function <code>bindNode</code> be passed to the so-called binder, which is responsible for synchronizing the state of the element and the properties of the object.  By default, <code>bindNode</code> does not know how to work with nodes that are not form elements. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> htmlBinder = { <span class="hljs-attr"><span class="hljs-attr">setValue</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value, binding</span></span></span><span class="hljs-function">) =&gt;</span></span> binding.node.innerHTML = value, }; <span class="hljs-comment"><span class="hljs-comment">// изменение свойства obj.greeting обновит innerHTML любого элемента defi.bindNode(obj, 'greeting', '.greeting', htmlBinder)</span></span></code> </pre> <br><p>  In addition, you can use <code>html</code> from the <a href="https://github.com/defijs/common-binders">common-binders library</a> (this is a collection of general purpose <a href="https://github.com/defijs/common-binders">binders</a> ). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { html } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'common-binders'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// изменение свойства obj.greeting обновит innerHTML любого элемента defi.bindNode(obj, 'greeting', '.greeting', html())</span></span></code> </pre> <br><h2 id="metody-api">  API methods </h2><br><p>  Detailed documentation for all methods, available call variations, flags, etc. can be found at <a href="https://defi.js.org/">defi.js.org</a> .  It is worth mentioning that in addition to the methods below, defi.js has a library for routing: <a href="https://github.com/defijs/defi-router">defi-router</a> . </p><br><ul><li>  <a href="https://defi.js.org/">bindNode</a> — Binds a property of an object and a DOM node for bidirectional bidding. </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// обычное использование // (для стандартных HTML5 элементов форм, см. defaultBunders) defi.bindNode(obj, 'myKey', '.my-element'); // кастомный байндинг defi.bindNode(obj, 'myKey', '.my-element', { // событие, которое говорит об изменении элемента // (можно использовать функцию для не-DOM событий) on: 'click', // как извлечь текущее состояние элемента? getValue: ({ node }) =&gt; someLibraryGetValue(node), // как установить состояние элемента при изменении свойства? setValue: (v, { node }) =&gt; someLibrarySetValue(node, v), // как инициализировать элемент (библиотеку или виджет)? // это можно сделать любым способом // но 'initialize' добавляет немного синтаксического сахара initialize: ({ node }) =&gt; someLibraryInit(node), }); obj.myKey = 'some value'; // обновит элемент</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">calc</a> - Creates the dependence of one property of an object on other properties (including from other objects). </li></ul><br><pre> <code class="javascript hljs">defi.calc(obj, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, [<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>], (b, c) =&gt; b + c); obj.b = <span class="hljs-number"><span class="hljs-number">1</span></span>; obj.c = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj.a); <span class="hljs-comment"><span class="hljs-comment">// 3</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">mediate</a> - Modifies the value of a property when it changes. </li></ul><br><pre> <code class="javascript hljs">defi.mediate(obj, <span class="hljs-string"><span class="hljs-string">'x'</span></span>, value =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(value)); obj.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj.x); <span class="hljs-comment"><span class="hljs-comment">// "1" console.log(typeof obj.x); // "string"</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">on</a> - Adds an event handler.  On the website with documentation there is a <a href="https://defi.js.org/">small article</a> describing all possible events. </li></ul><br><pre> <code class="javascript hljs">defi.on(obj, <span class="hljs-string"><span class="hljs-string">'change:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">`obj.x now equals </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${obj.x}</span></span></span><span class="hljs-string">`</span></span>); }); obj.x = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">off</a> - Removes an event handler. </li></ul><br><pre> <code class="javascript hljs">defi.off(obj, <span class="hljs-string"><span class="hljs-string">'change:x bind'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">trigger</a> - Triggers an event. </li></ul><br><pre> <code class="javascript hljs">defi.on(obj, <span class="hljs-string"><span class="hljs-string">'foo bar'</span></span>, (a, b, c) =&gt; { alert(a + b + c); }); defi.trigger(obj, <span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// вызывает alert(6)</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">unbindNode</a> Disables the binding of an element and the DOM node. </li></ul><br><pre> <code class="javascript hljs">defi.bindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>); defi.unbindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">bound</a> - Returns the DOM element associated with the given property. </li></ul><br><pre> <code class="javascript hljs">defi.bindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> node = defi.bound(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// вернет document.querySelector('.my-element')</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">chain</a> - Used to chain the defi.j functions. </li></ul><br><pre> <code class="javascript hljs">defi.chain(obj) .calc(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, b =&gt; b * <span class="hljs-number"><span class="hljs-number">2</span></span>) .set(<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) .bindNode(<span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-string"><span class="hljs-string">'.node'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">defaultBinders</a> - An array of functions that return the corresponding binder or undefined.  Allows <code>bindNode</code> to bind custom elements and properties without explicitly specifying a binder. </li></ul><br><pre> <code class="javascript hljs">defi.defaultBinders.unshift(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// если у элемента есть класс "foo" if(element.classList.contains('foo')) { // значит, нужно использовать этот байндер return { on: ..., getValue: ..., setValue: ... }; } }); // ... defi.bindNode(obj, 'myKey', '.foo.bar');</span></span></code> </pre><br><ul><li>  <a href="https://defi.js.org/">lookForBinder</a> - Returns the binder corresponding to the element, if any, returned by one of the <code>defaultBinders</code> functions. </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'input'</span></span>); element.type = <span class="hljs-string"><span class="hljs-string">'text'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(defi.lookForBinder(element));</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">remove</a> - Removes the property of an object and the corresponding event handlers. </li></ul><br><pre> <code class="javascript hljs">defi.remove(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">set</a> - Sets an object property, like a setter, but it gives the opportunity to pass some data to the <code>change:KEY</code> event handler.  You can also make the setting of the property value "silent", that is, do not call <code>change:KEY</code> at all. </li></ul><br><pre> <code class="javascript hljs">defi.set(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> });</code> </pre> <br><hr><br><p>  defi.js is a revised and simplified hard fork of the Matreshka.js framework, which included the rendering of arrays, several classes and more methods.  Some methods that could potentially fall into defi.js have been replaced with options to other methods, for example, instead of <code>once</code> and <code>onDebounce</code> you can use the <code>on</code> method, passing the options <code>once: true</code> or <code>debounce: number</code> . </p><br><p>  Thank you for reading to the end.  Have a nice day, everyone. </p></div>