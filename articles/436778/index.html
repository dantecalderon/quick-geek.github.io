<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>defi.js - reactive library based on Object.defineProperty</title>
  <meta name="description" content="defi.js is a library that includes dozens of functions that add interesting features to any JavaScript objects using getters and setters. 


 Gifka to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>defi.js - reactive library based on Object.defineProperty</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cf/2d4/0c4/8cf2d40c46d90635704303149102519a.svg" alt="defi.js"></div><br><p>  <a href="https://defi.js.org/">defi.js</a> is a library that includes dozens of functions that add interesting features to any JavaScript objects using getters and setters. </p><br><p>  <a href="">Gifka to attract attention (3.5MB)</a> <br>  <a href="https://github.com/defijs/defi">Repository</a> </p><br><p>  As Hello World, we will create a small widget consisting of a name field, a last name and a greeting ( <a href="https://jsbin.com/femuxovame/1/edit%3Fhtml,js,console,output">demo</a> ). </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"first"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"last"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"greeting"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é const obj = { first: 'John', last: 'Doe' }; // —Å–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö first –∏ last // –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —Å–æ–æ–±—â–∏–º –æ–± —ç—Ç–æ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ defi.on(obj, 'change:first', () =&gt; console.log('First name is changed')); defi.on(obj, 'change:last', () =&gt; console.log('Last name is changed')); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (—Å–≤–æ–π—Å—Ç–≤–æ greeting) –∫–∞–∂–¥—ã–π —Ä–∞–∑, // –∫–æ–≥–¥–∞ first –∏–ª–∏ last –∏–∑–º–µ–Ω–∏–ª–∏—Å—å defi.calc(obj, 'greeting', ['first', 'last'], (first, last) =&gt; `Hello, ${first} ${last}`); // –æ–±—ä—è–≤–ª—è–µ–º –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –±–∞–π–Ω–¥–∏–Ω–≥ –º–µ–∂–¥—É —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ // –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ defi.bindNode(obj, { first: '.first', last: '.last', greeting: '.greeting' });</span></span></code> </pre><br><p>  As a result, if <code>first</code> or <code>last</code> have changed, event handlers report this to the console, the <code>greeting</code> property is automatically updated, and its element gets a new value (by default, "Hello, John Doe").  This happens every time the properties change, and it doesn't matter how.  You can set the value using the code <code>obj.first = 'Jane'</code> , or by changing the value of the field, and all other changes will occur automatically. </p><a name="habracut"></a><br><p>  In case there is a need to synchronize the properties of the object and the <code>innerHTML</code> an arbitrary HTML element (in the example we used the <code>output</code> tag), the <code>bindNode</code> function <code>bindNode</code> be passed to the so-called binder, which is responsible for synchronizing the state of the element and the properties of the object.  By default, <code>bindNode</code> does not know how to work with nodes that are not form elements. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> htmlBinder = { <span class="hljs-attr"><span class="hljs-attr">setValue</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value, binding</span></span></span><span class="hljs-function">) =&gt;</span></span> binding.node.innerHTML = value, }; <span class="hljs-comment"><span class="hljs-comment">// –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ obj.greeting –æ–±–Ω–æ–≤–∏—Ç innerHTML –ª—é–±–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ defi.bindNode(obj, 'greeting', '.greeting', htmlBinder)</span></span></code> </pre> <br><p>  In addition, you can use <code>html</code> from the <a href="https://github.com/defijs/common-binders">common-binders library</a> (this is a collection of general purpose <a href="https://github.com/defijs/common-binders">binders</a> ). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { html } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'common-binders'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ obj.greeting –æ–±–Ω–æ–≤–∏—Ç innerHTML –ª—é–±–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ defi.bindNode(obj, 'greeting', '.greeting', html())</span></span></code> </pre> <br><h2 id="metody-api">  API methods </h2><br><p>  Detailed documentation for all methods, available call variations, flags, etc. can be found at <a href="https://defi.js.org/">defi.js.org</a> .  It is worth mentioning that in addition to the methods below, defi.js has a library for routing: <a href="https://github.com/defijs/defi-router">defi-router</a> . </p><br><ul><li>  <a href="https://defi.js.org/">bindNode</a> ‚Äî Binds a property of an object and a DOM node for bidirectional bidding. </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// –æ–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ // (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö HTML5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º, —Å–º. defaultBunders) defi.bindNode(obj, 'myKey', '.my-element'); // –∫–∞—Å—Ç–æ–º–Ω—ã–π –±–∞–π–Ω–¥–∏–Ω–≥ defi.bindNode(obj, 'myKey', '.my-element', { // —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≥–æ–≤–æ—Ä–∏—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ // (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –Ω–µ-DOM —Å–æ–±—ã—Ç–∏–π) on: 'click', // –∫–∞–∫ –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞? getValue: ({ node }) =&gt; someLibraryGetValue(node), // –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–≤–æ–π—Å—Ç–≤–∞? setValue: (v, { node }) =&gt; someLibrarySetValue(node, v), // –∫–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç (–±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–ª–∏ –≤–∏–¥–∂–µ—Ç)? // —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º // –Ω–æ 'initialize' –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ —Å–∞—Ö–∞—Ä–∞ initialize: ({ node }) =&gt; someLibraryInit(node), }); obj.myKey = 'some value'; // –æ–±–Ω–æ–≤–∏—Ç —ç–ª–µ–º–µ–Ω—Ç</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">calc</a> - Creates the dependence of one property of an object on other properties (including from other objects). </li></ul><br><pre> <code class="javascript hljs">defi.calc(obj, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, [<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>], (b, c) =&gt; b + c); obj.b = <span class="hljs-number"><span class="hljs-number">1</span></span>; obj.c = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj.a); <span class="hljs-comment"><span class="hljs-comment">// 3</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">mediate</a> - Modifies the value of a property when it changes. </li></ul><br><pre> <code class="javascript hljs">defi.mediate(obj, <span class="hljs-string"><span class="hljs-string">'x'</span></span>, value =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(value)); obj.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj.x); <span class="hljs-comment"><span class="hljs-comment">// "1" console.log(typeof obj.x); // "string"</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">on</a> - Adds an event handler.  On the website with documentation there is a <a href="https://defi.js.org/">small article</a> describing all possible events. </li></ul><br><pre> <code class="javascript hljs">defi.on(obj, <span class="hljs-string"><span class="hljs-string">'change:x'</span></span>, () =&gt; { alert(<span class="hljs-string"><span class="hljs-string">`obj.x now equals </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${obj.x}</span></span></span><span class="hljs-string">`</span></span>); }); obj.x = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">off</a> - Removes an event handler. </li></ul><br><pre> <code class="javascript hljs">defi.off(obj, <span class="hljs-string"><span class="hljs-string">'change:x bind'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">trigger</a> - Triggers an event. </li></ul><br><pre> <code class="javascript hljs">defi.on(obj, <span class="hljs-string"><span class="hljs-string">'foo bar'</span></span>, (a, b, c) =&gt; { alert(a + b + c); }); defi.trigger(obj, <span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// –≤—ã–∑—ã–≤–∞–µ—Ç alert(6)</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">unbindNode</a> Disables the binding of an element and the DOM node. </li></ul><br><pre> <code class="javascript hljs">defi.bindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>); defi.unbindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">bound</a> - Returns the DOM element associated with the given property. </li></ul><br><pre> <code class="javascript hljs">defi.bindNode(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-string"><span class="hljs-string">'.my-element'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> node = defi.bound(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// –≤–µ—Ä–Ω–µ—Ç document.querySelector('.my-element')</span></span></code> </pre> <br><ul><li>  <a href="https://defi.js.org/">chain</a> - Used to chain the defi.j functions. </li></ul><br><pre> <code class="javascript hljs">defi.chain(obj) .calc(<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, b =&gt; b * <span class="hljs-number"><span class="hljs-number">2</span></span>) .set(<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) .bindNode(<span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-string"><span class="hljs-string">'.node'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">defaultBinders</a> - An array of functions that return the corresponding binder or undefined.  Allows <code>bindNode</code> to bind custom elements and properties without explicitly specifying a binder. </li></ul><br><pre> <code class="javascript hljs">defi.defaultBinders.unshift(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// –µ—Å–ª–∏ —É —ç–ª–µ–º–µ–Ω—Ç–∞ –µ—Å—Ç—å –∫–ª–∞—Å—Å "foo" if(element.classList.contains('foo')) { // –∑–Ω–∞—á–∏—Ç, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –±–∞–π–Ω–¥–µ—Ä return { on: ..., getValue: ..., setValue: ... }; } }); // ... defi.bindNode(obj, 'myKey', '.foo.bar');</span></span></code> </pre><br><ul><li>  <a href="https://defi.js.org/">lookForBinder</a> - Returns the binder corresponding to the element, if any, returned by one of the <code>defaultBinders</code> functions. </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'input'</span></span>); element.type = <span class="hljs-string"><span class="hljs-string">'text'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(defi.lookForBinder(element));</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">remove</a> - Removes the property of an object and the corresponding event handlers. </li></ul><br><pre> <code class="javascript hljs">defi.remove(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>);</code> </pre> <br><ul><li>  <a href="https://defi.js.org/">set</a> - Sets an object property, like a setter, but it gives the opportunity to pass some data to the <code>change:KEY</code> event handler.  You can also make the setting of the property value "silent", that is, do not call <code>change:KEY</code> at all. </li></ul><br><pre> <code class="javascript hljs">defi.set(obj, <span class="hljs-string"><span class="hljs-string">'myKey'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, { <span class="hljs-attr"><span class="hljs-attr">silent</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> });</code> </pre> <br><hr><br><p>  defi.js is a revised and simplified hard fork of the Matreshka.js framework, which included the rendering of arrays, several classes and more methods.  Some methods that could potentially fall into defi.js have been replaced with options to other methods, for example, instead of <code>once</code> and <code>onDebounce</code> you can use the <code>on</code> method, passing the options <code>once: true</code> or <code>debounce: number</code> . </p><br><p>  Thank you for reading to the end.  Have a nice day, everyone. </p></div><p>Source: <a href="https://habr.com/ru/post/436778/">https://habr.com/ru/post/436778/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>