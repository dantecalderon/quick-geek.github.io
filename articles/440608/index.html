<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The task of classification through the eyes of a schoolboy: determining whether a car is in the parking lot by frames from a video surveillance camera</title>
  <meta name="description" content="Hello, I am a schoolchild of 11 classes, interested in programming, around-IT topics. 

 I am writing this post in order to share my project, which to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>The task of classification through the eyes of a schoolboy: determining whether a car is in the parking lot by frames from a video surveillance camera</h1><div class="post__text post__text-html js-mediator-article">  Hello, I am a schoolchild of 11 classes, interested in programming, around-IT topics. <br><br>  I am writing this post in order to share my project, which took 10 hours of my life on weekends and was done to understand the possibilities of modern data analysis methods.  The publication can be considered as an example of a successful implementation for people who are unaware of this area of ‚Äã‚Äãknowledge, as well as a request to indicate my mistakes for people who are, accordingly, knowledgeable. <br><a name="habracut"></a><br>  It is given: video stream from a video surveillance camera, on which there is a fragment of 100x50 pixels with an image of a particular parking space, on which only a specific car may be present or absent. <br><br><div class="spoiler">  <b class="spoiler_title">Camera Image</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lj/tw/gn/ljtwgnucovy2ul-dnd55glqukvq.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Parking space image</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4q/hl/ig/4qhligevi8kiky3szfrtz9ncgjw.png"><br></div></div><br>  Task: to determine the presence or absence of a car in a parking space. <br><br><h3>  Obtaining images from the camera </h3><br>  I use the openCV library for image retrieval and preprocessing. <br>  I used the following code to build a dataset that I use to train a neural network: I photograph an hourly parking space, and after receiving 60 photos, I manually divide them into a photo with and without a machine. <br><br><div class="spoiler">  <b class="spoiler_title">dataminer.py</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time cap = cv.VideoCapture() r = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> r &lt;=<span class="hljs-number"><span class="hljs-number">100</span></span>: cap.open(<span class="hljs-string"><span class="hljs-string">'http://**.**.***.***:***/*****CG?container=mjpeg&amp;stream=main'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#URL-–∞–¥—Ä–µ—Å –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ hasFrame, frame = cap.read()#–ß—Ç–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ –∏–∑ –ø–æ—Ç–æ–∫–∞ frame = frame[100:200, 300:750] box = [0,335,100,385] quantframe = frame[box[0]:box[2], box[1]:box[3]]#–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —á–∞—Å—Ç–∏ –∫–∞–¥—Ä–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –º–∞—à–∏–Ω—ã r+=1 cv.imwrite(str(r)+'.png',quantframe) #–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—à–∏–Ω—ã –≤ —Ñ–∞–π–ª print('saved') cap.release() time.sleep(3600) key = cv.waitKey(1) if key &amp; 0xFF == ord('q'): cv.destroyAllWindows() break</span></span></code> </pre> <br></div></div><br><h3>  Image processing </h3><br>  I thought it was the right decision to train the neural network not on the original images, but on images with car outlines found using the cv2.findcontours (...) function. <br><br>  Here is the code that converts the source image into a contour image: <br><br><div class="spoiler">  <b class="spoiler_title">Finding contours</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contoursfinder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">:</span></span> img = image.copy() srcimg = img.copy() hsv_min = np.array((<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), np.uint8) hsv_max = np.array((<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>), np.uint8) <span class="hljs-comment"><span class="hljs-comment">#–ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–Ω—Ç—É—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ —Ä–∞–∑–ª–∏—á–∏—è–º –≤ —Ü–≤–µ—Ç–µ –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏—Å—Ö–æ–¥—è –∏–∑ —Ü–≤–µ—Ç–æ–≤–æ–π –≥–∞–º–º—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏ hsv = cv.cvtColor( img, cv.COLOR_BGR2HSV ) thresh = cv.inRange( hsv, hsv_min, hsv_max ) contours, _ = cv.findContours(thresh, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE) img = np.zeros((100,50,3), np.uint8) cv.drawContours(img, contours, -1, (255,255,255), 1, cv.LINE_AA) return cv.cvtColor(img, cv.COLOR_BGR2GRAY)</span></span></code> </pre><br></div></div><br>  The result of the function: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ja/ru/pv/jarupv7ez7gl_0aswbydbo-7gfa.png"></div></div><br><h3>  Neural network </h3><br>  I used the library tensorflow (keras). <br><br>  The network architecture is written off from the example from the Internet: for me, the explanation of why is not so obvious.  If knowledgeable people tell or tell where to read, why this architecture is effective or why some other one will be more effective, I will be immensely grateful. <br>  The neural network model: sequential, consists of two dense hidden layers of 256 and 128 neurons and input, output layers. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs">model = keras.Sequential([ keras.layers.Flatten(input_shape=(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)), keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">256</span></span>, activation=tf.nn.relu), keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">128</span></span>, activation=tf.nn.relu), keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">2</span></span>, activation=tf.nn.softmax) ]) model.compile(optimizer=tf.train.AdamOptimizer(), loss=<span class="hljs-string"><span class="hljs-string">'sparse_categorical_crossentropy'</span></span>, metrics=[<span class="hljs-string"><span class="hljs-string">'accuracy'</span></span>]) model.fit(trainingimagesarr, trainingimagesarrlabel, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, callbacks=[tbCallBack])</code> </pre><br></div></div><br>  Before training, the entire numpy matrix was divided by 255, in order to give numbers to the input of the neural network in the range from 0 to 1. <br><br><pre> <code class="python hljs">trainingimagesarr = trainingimagesarr / <span class="hljs-number"><span class="hljs-number">255.0</span></span> trainingimagesarrlabel = np.array(trainingimagesarrlabel)<span class="hljs-number"><span class="hljs-number">-1</span></span></code> </pre><br>  Now I can call the function: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">realtest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> cap = cv.VideoCapture() cap.open(<span class="hljs-string"><span class="hljs-string">'http://**.**.***.***:***/*****CG?container=mjpeg&amp;stream=main'</span></span>) hasFrame, frame = cap.read() frame = frame[<span class="hljs-number"><span class="hljs-number">100</span></span>:<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>:<span class="hljs-number"><span class="hljs-number">750</span></span>] quantframe = frame[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">275</span></span>:<span class="hljs-number"><span class="hljs-number">325</span></span>] quantframe = contoursfinder(quantframe) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model.predict(np.array([quantframe]))[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">0.60</span></span></code> </pre><br>  obtain information about the presence of the car in the parking lot. <br><br>  Do not kick much, but slightly :-) <br><br>  Thank! </div><p>Source: <a href="https://habr.com/ru/post/440608/">https://habr.com/ru/post/440608/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>