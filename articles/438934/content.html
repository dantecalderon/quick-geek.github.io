<div class="post__text post__text-html js-mediator-article"><p>  Hello.  When I started learning Python, installed Jupyter Notebook for the first time, then I tried to transfer the application I created to it to the company, I often encountered various problems.  That Cyrillic in the user name interferes, then the settings are not transferred, then something else.  I mostly overcame all these problems on my own, using Google and spending a lot of time on solving them. </p><br><p>  As my experience grew, I learned how to create a folder in which virtual Python is transferred from one computer to another, Jupyter and Matplotlib settings, portable programs (ffmpeg, etc.) and fonts.  I could write a program at home, copy the entire folder to the computer of the enterprise, and be sure that nothing will be lost or broken on level ground.  Then I thought that this folder could be given to a newbie in Python, and he would get a fully configured and portable environment. </p><a name="habracut"></a><br><p>  <strong>Table of contents</strong> </p><br><ul><li>  <a href="https://habr.com/ru/post/438934/">Introduction</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Brief instructions for creating a portable assembly Jupyter</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Install Miniconda (Python 3.7)</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Creating a directory structure</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Creating a portable Python virtual environment</a> <br><ul><li>  <a href="https://habr.com/ru/post/438934/">Creating a virtual environment with conda</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Correction of HTTP 000 CONNECTION FAILED error when creating a virtual environment</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Activation of the virtual environment</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Installing Python packages in a virtual environment</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Exit from the virtual Python environment</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/438934/">Preparing a portable build of Jupyter for launch</a> <br><ul><li>  <a href="https://habr.com/ru/post/438934/">Setting environment variables for Jupyter, IPython and Matplotlib</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Creating a file to run Jupyter with user settings</a> </li><li>  <a href="https://habr.com/ru/post/438934/">Additional files for housekeeping</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/438934/">Conclusion</a> </li></ul><br><a name="h-1"></a><br><h2 id="vvedenie">  Introduction </h2><br><p> In recent years, Python has become a popular programming language.  It is often used for writing mathematical calculations, analyzing big data, machine learning and building neural networks.  After the appearance of <code>asinc</code> and <code>await</code> constructions, writing fast web frameworks became possible.  Python performance gradually increases from release to release, and using Cython or Numba can make an application even faster than in other programming languages.  For example, the speed of the web framework <a href="https://vibora.io/">Vibora</a> <sup>(en) is</sup> comparable to the speed of the solutions on the <a href="https://golang.org/">Go</a> <sup>(en)</sup> .  In 2018, Python officially became the language of study in schools and universities of <a href="https://www.reddit.com/r/Python/comments/9y972g/python_will_be_the_official_programming_language/">France</a> <sup>(en)</sup> and <a href="https://www.reddit.com/r/Python/comments/9ybmyw/python_is_already_official_programming_language/">Kazakhstan</a> <sup>(en)</sup> .  In Russia, at least some of the departments have switched to Python, for example, the department <a href="https://rk6.bmstu.ru/">RK-6</a> <sup>(ru)</sup> at MSTU.  N.E.  Bauman. </p><br><p>  When starting to learn Python, new users sometimes have difficulty installing the necessary libraries and setting up the programming environment.  If the Windows username contains non-Latin characters, some of the libraries might not install or run.  Novice users may have problems configuring the Jupyter Notebook on their local computer.  If it is installed on the <code>C:\</code> drive, how to open the file on the <code>D:\</code> ?  When I took the first steps in Python, I also had to overcome these difficulties. </p><br><p>  Finally, if all the problems are behind, it can be difficult to transfer the application to another user.  I came across a situation where the virtual Python environment I created refused to work on another computer.  In addition, Jupyter Notebook and Matplotlib store their settings in the user's folder, which complicates the transfer of applications that use specific settings. </p><br><p>  The solution to the problems described above will be to create a fully portable assembly of Jupyter Notebook and / or Jupyter Lab on Windows.  It keeps the Python interpreter, its libraries and settings, the settings of all the necessary third-party libraries, including Matplotlib and Jupyter, is not tied to the user name and will not swear if you run it on another computer.  We can archive such an assembly into an archive, or write a script or program that will create the same assembly on an absolute beginner's computer.  For more advanced users, a portable build may be useful in that it allows you to store the Python environment and settings in libraries in different places.  You can place the settings folder in a special place that is synchronized with the cloud storage: Dropbox, Mail.ru * cloud, Yandex or Google.  Due to this, all computers will automatically have a locally working environment with the same settings. </p><br><p>  * Yes, the one whose client <a href="http://www.opennet.ru/opennews/art.shtml%3Fnum%3D50073">does not connect</a> to Linux <a href="http://www.opennet.ru/opennews/art.shtml%3Fnum%3D50073">anymore</a> <sup>(ru)</sup> .  If they remove the same for Windows, I will have to look for a replacement.  1 TB on the road for free is not lying. </p><br><p>  For simplicity, I decided to describe the creation of a portable assembly under Windows.  But this instruction with minimal changes is suitable for creating an assembly on Linux and Mac OS.  The article is primarily intended for beginners, so I tried to describe as much as possible and easier to read. </p><br><p>  The article consists of two parts.  In the first part we will create a portable assembly, in the second we will deal with the settings for Jupyter Notebook, Jupyter Lab, IPython and Matplotlib. </p><br><a name="h-1"></a><br><h2 id="kratkaya-instrukciya-po-sozdaniyu-portativnoy-sborki-jupyter">  Brief instructions for creating a portable assembly Jupyter </h2><br><ol><li><p>  Create a folder <code>C:\Dev</code> .  It will install Minconda and the portable assembly Jupyter *. <br>  * Here and below Jupyter = Jupyter Notebook + Juputer Lab. </p><br></li><li><p>  Download the Miniconda installer from <a href="https://conda.io/miniconda">https://conda.io/miniconda</a> <sup>(en)</sup> .  Choose Python 3 for Windows 64 bits or 32 bits depending on the bitness of your operating system.  Install Miniconda in the folder <code>C:\Dev\Miniconda3</code> . </p><br></li><li><p>  Create the following directory structure for the portable Jupyter build: </p><br><pre> <code class="plaintext hljs">C:\ Dev\ Jupyter\ dist\ apps\ conf\ backup\ ipython\ jupyter\ matplotlib\ fonts\ projects\</code> </pre> <br></li><li><p>  Create a virtual Python environment with <code>conda</code> *: </p><br><pre> <code class="plaintext hljs">C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes python=3 conda</code> </pre> <br><p>  * You can use the <code>conda-forge</code> channel to install more recent libraries by adding the argument <code>-c conda-forge</code> : </p><br><pre> <code class="plaintext hljs">C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes -c conda-forge python=3 conda</code> </pre> <br></li><li><p>  Activate the environment and install Python packages using <code>pip</code> *: </p><br><pre> <code class="plaintext hljs">C:\Dev\Jupyter\dist\pyenv3.7-win64\Scripts\activate pip --no-cache-dir install numpy scipy matplotlib jupyter jupyterlab</code> </pre> <br><p>  Note: if you need to install Numpy and Scipy, which use Intel's MKL library to speed up calculations, <a href="https://software.intel.com/en-us/articles/installing-the-intel-distribution-for-python-and-intel-performance-libraries-with-pip-and">use</a> <sup>(en)</sup> <code>intel-numpy</code> instead of <code>numpy</code> and <code>intel-scipy</code> instead of <code>scipy</code> (installed only in Python 3.6!): </p><br><pre> <code class="plaintext hljs">pip --no-cache-dir install intel-numpy intel-scipy matplotlib jupyter jupyterlab</code> </pre> <br><p>  After installation, run: </p><br><pre> <code class="plaintext hljs">conda.bat deactivate</code> </pre> <br><p>  * If errors occur during installation, try this: </p><br><pre> <code class="plaintext hljs">C:\Dev\Jupyter\dist\pyenv3.7-win64\Scirpts\activate conda config --add channels conda-forge conda install numpy scipy matplotlib jupyter jupyterlab</code> </pre> <br><p>  and after installation </p><br><pre> <code class="plaintext hljs">conda.bat deactivate</code> </pre> <br></li><li><p>  In the folder <code>C:\Dev\Jupyter\dist</code> create the file <code>setenv.bat</code> , which will control where Jupyter and Matplotlib will store their settings: </p><br><pre> <code class="plaintext hljs">@echo off set conf_path=%~dp0\conf set JUPYTER_CONFIG_DIR=%conf_path%\jupyter set JUPYTER_DATA_DIR=%conf_path%\jupyter\data set JUPYTER_RUNTIME_DIR=%conf_path%\jupyter\data\runtime set IPYTHONDIR=%conf_path%\ipython set MPLCONFIGDIR=%conf_path%\matplotlib REM Matplotlib search FFMPEG in PATH variable only! set PATH=%~dp0\apps\ffmpeg\bin;%PATH%</code> </pre> <br></li><li><p>  In the <code>C:\Dev\Jupyter\dist</code> folder, create a file <code>run_jupyter_notebook.bat</code> to launch Jupyter Notebook with the specified parameters: </p><br><pre> <code class="plaintext hljs">@echo off call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-notebook.exe --notebook-dir=%1</code> </pre> <br></li><li><p>  Similarly, in the folder <code>C:\Dev\Jupyter\dist</code> create the file <code>run_jupyter_lab.bat</code> to launch Jupyter Lab with the specified parameters: </p><br><pre> <code class="plaintext hljs">@echo off call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-lab.exe --notebook-dir=%1</code> </pre> <br></li><li><p>  In the <code>C:\Dev\Jupyter\dist</code> folder, create the file <code>enable_extension.bat</code> , which activates the specified extension in Jupyter Notebook: </p><br><pre> <code class="plaintext hljs">@echo off REM Enable extension in Jupyter Notebook. REM Example: REM enable_extension.bat widgetsnbextension call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-nbextension.exe enable %1</code> </pre> <br></li><li><p>  Assume that the work files are in the folder <code>D:\my-projects</code> .  In this folder, create shortcuts to the files <code>run_jupyter_notebook.bat</code> and <code>run_jupyter_lab.bat</code> .  After creating each of the shortcuts, go to its properties and clear the line "Working folder".  If you do not clear - Jupyter will not see the folder you need! </p><br></li><li><p>  Portable assembly Jupyter created and ready for configuration and operation.  To get started, just click on the created shortcuts.  If you decide not to delete the installed Miniconda, you can reduce the size of the <code>C:\Dev\Miniconda3</code> following command: </p><br><pre> <code class="plaintext hljs"> C:\Dev\Miniconda3\Scripts\conda.exe clean --all</code> </pre> <br><p>  After executing this command, go to the <code>C:\Dev\Miniconda3\pkgs</code> and clear the contents of the <code>.trash</code> folder.  Only then will we really reduce the size of the <code>Miniconda3</code> folder. </p><br></li></ol><br><a name="h-3"></a><br><h2 id="ustanovka-miniconda-python-37">  Install Miniconda (Python 3.7) </h2><br><p>  Let's create in the root of the drive <code>C:\</code> <code>Dev</code> folder.  In this folder, I add all the programs and development tools that for some reason prefer to be installed not in <code>C:\Program Files</code> .  For example, there I install Ruby, Go, Python, Jupyter, Msys, SQLite Studio, etc. </p><br><p>  First we need to install Python.  Python has two branches: Python 2 and Python 3. Python 2 is <a href="https://pythonclock.org/">supported</a> <sup>(en)</sup> until 2020, so we will install only Python 3. </p><br><p>  To install Python 3, they usually refer to the official site <a href="https://www.python.org/">python.org</a> <sup>(en)</sup> , from where they download it and install it.  However, we want to get a <em>portable</em> build, so we’ll do it differently: we download and install Miniconda. </p><br><p>  What is Miniconda?  In fact, it is Python with the <code>conda</code> package manager preinstalled and configured.  The <code>conda</code> console program will allow us to create a folder in which there will be a Python version we need no matter what version of Python comes with as part of Miniconda.  Also with the help of <code>conda</code> in this folder you can install almost all known libraries for Python: Numpy, Scipy, Matplotlib, Sympy, etc.  The folder in which Python and its libraries are installed is called a virtual environment.  Python libraries come in the form of special archives, called packages. </p><br><p>  The conda has distinctive features that make it convenient for both novice and experienced users: </p><br><ul><li>  Python packages, which are installed via conda, are already compiled under Windows.  There is less chance that an attempt to install it will result in an error *. </li><li>  You can create a virtual environment with the version of Python that you need.  It does not matter which version of Python is installed with Miniconda. </li></ul><br><p>  * It should be noted that the situation with installing packages in Python is improving from year to year.  A few years ago I was unable to install Numpy via <code>pip</code> (an error was issued), and I used a <code>conda</code> .  In 2018, I tried the latest version of <code>pip</code> , and I downloaded a file with the <code>.whl</code> extension (the so-called “wheel”) with the already compiled Numpy, and everything was fine. </p><br><p>  So, we need to download and install Miniconda.  To do this, go to <a href="https://conda.io/miniconda">https://conda.io/miniconda</a> <sup>(en)</sup> and select the 64-bit version for Windows in Python 3. If you have a 32-bit computer, you should download the 32-bit version. </p><br><p>  Miniconda is installed in the same way as a regular Windows application: </p><br><ol><li><p>  Run the installer, click Next. </p><br><p><img src="https://habrastorage.org/webt/kn/ya/ga/knyagazn9vmcn6tnwpjr4fcq5dq.png" alt="01"></p><br></li><li><p>  We agree with the license agreement I Agree </p><br><p><img src="https://habrastorage.org/webt/ad/yo/jv/adyojvkmyeledykuhwxwafvdvcq.png" alt="02"></p><br></li><li><p>  I prefer the installation for all users, because it will give me the opportunity to specify the path to install.  Select the item "All users": </p><br><p><img src="https://habrastorage.org/webt/y6/s7/8z/y6s78zpkghrewxpwz9ko5enmlmg.png" alt="03"></p><br></li><li><p>  Adjust the path for installation on <code>C:\Dev\Miniconda3</code> : </p><br><p><img src="https://habrastorage.org/webt/jf/0v/3u/jf0v3uv6odujxw4jufpq0tjw1ho.png" alt="04"></p><br></li><li><p>  Here I put both checkboxes.  The checkbox “Add Anaconda to the system PATH environment variable” will make the <code>conda</code> command available in the terminal from any directory.  If you do not check this box, the only thing that will change is that in the terminal instead of <code>conda</code> you will need to type the full path to <code>conda.exe</code> .  I do not install Anaconda, because it puts a lot of unnecessary things to me, so I ignore the undesirability of setting this flag.  If you check this box and change your mind after installation, you can simply remove the <code>conda</code> from the system variables.  It's simple.  But if you do not know, you can google or ask.  Contact at the end of the article. <br>  I also check the box “Register Anaconda as the system Python 3.7”.  If any program suddenly needs Python, it will use Python installed with Miniconda.  Also this flag will make the <code>python</code> command available in the terminal from any folder.  This checkbox is recommended if you have not installed Python before.  If some Python is already installed, I would not advise checking this box now, but adjust the system variables if necessary. <br>  After that, click Install and the installation process will start: </p><br><p><img src="https://habrastorage.org/webt/mu/9g/tg/mu9gtgenc_psjismr-ni90kw5le.png" alt="05"></p><br></li><li><p>  During installation, you can click Show details.  Thereby you will see more information about what exactly happens during installation.  But this is optional. </p><br><p><img src="https://habrastorage.org/webt/vj/er/ft/vjerftkxfjjctw8zecq-vutu2x8.png" alt="07"></p><br></li><li><p>  When the installation is complete, the phrase “Completed” will appear, and the Next button will become available.  Click Next </p><br><p><img src="https://habrastorage.org/webt/ag/tk/-s/agtk-skzzzhfairha6e86n8zxwk.png" alt="07"></p><br></li><li><p>  In the last window, we are invited to learn about Anaconda Cloud (this is the first box) and how to start working with Anaconda (second box).  I don't need any of this, so I clear all the checkboxes and click Finish.  Miniconda installation is complete. </p><br><p><img src="https://habrastorage.org/webt/if/jo/ap/ifjoaplhmkt7gbgbnnrxzbjdbdi.png" alt="08"></p><br></li></ol><br><p>  After installing Miniconda in the <code>C:\Dev</code> folder, we will see a new <code>Miniconda</code> folder weighing approximately 340 MB.  Yes, it is a lot, and she will still swell.  Later I will show how to reduce its volume quickly and safely. </p><br><p>  Go to the folder <code>Miniconda</code> .  Scrolling the file list a bit, we’ll see <code>python.exe</code> .  The same Python 3.7, which was installed in my case (in the screenshot of Directory Opus). </p><br><p><img src="https://habrastorage.org/webt/z6/yd/ho/z6ydhocs_l7mxbsr7o8lo8xod38.png" alt="09"></p><br><p>  If you double-click on <code>python.exe</code> , the console window will start, in which you can enter Python commands. </p><br><p><img src="https://habrastorage.org/webt/l_/_m/om/l__mom_bmuxd4cvk9dhe-yqfr2s.png" alt="ten"></p><br><p>  You can test after <code>&gt;&gt;&gt;</code> enter: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> antigravity</code> </pre> <br><p>  and press Enter.  A default browser will open with a Python comic on <a href="https://xkcd.com/353/">xkcd</a> . </p><br><p>  In the folder <code>C:\Dev\Miniconda\Scripts</code> we will find <code>conda.exe</code> .  This is the console command with which we will create a virtual Python environment. </p><br><a name="h-4"></a><br><h2 id="sozdanie-struktury-katalogov">  Creating a directory structure </h2><br><p>  Now we are ready to start creating a portable assembly Jupyter Notebook.  First, create the following directory structure: </p><br><pre> <code class="plaintext hljs">C:\ Dev\ Jupyter\ dist\ apps\ conf\ backup\ ipython\ jupyter\ matplotlib\ fonts\ projects\</code> </pre> <br><p>  In the <code>Dev</code> folder, create a folder <code>Jupyter</code> .  In turn, in the folder <code>Jupyter</code> create folders <code>dist</code> and <code>projects</code> .  In the <code>dist</code> folder there will be a virtual Python environment with all the necessary libraries, configuration files, additional programs, fonts - all that is necessary for our development in Python in the Jupyter Notebook or Jupyter Lab environment.  The <code>projects</code> folder is the default location for projects.  I myself usually do not use this folder, and it remains empty.  But if I need to transfer the program to another user along with the configured Jupyter, I will put my program in this <code>projects</code> folder, make an archive of the entire <code>Jupyter</code> folder and send the archive to the user. </p><br><p>  The <code>apps</code> folder contains helper programs.  For example, I often put there a portable version of FFMPEG that Matplotlib needs to create animations. </p><br><p>  The <code>conf</code> folder contains settings for various libraries.  In our case for IPython, Jupyter and Matplotlib. </p><br><p>  In the folder <code>conf\backup</code> I put copies of my settings files in case there are a few things in the future with settings. </p><br><p>  The <code>fonts</code> folder contains fonts that can be used, for example, in Matplotlib.  Personally, I liked Roboto and PTSerif. </p><br><p>  In addition to the <code>apps</code> , <code>conf</code> and <code>fonts</code> folders, you can create other folders as you like.  For example, the <code>temp</code> folder for temporary files. </p><br><a name="h-5"></a><br><h2 id="sozdanie-perenosimogo-virtualnogo-okruzheniya-python">  Creating a portable Python virtual environment </h2><br><a name="h-6"></a><br><h3 id="sozdanie-virtualnogo-okruzheniya-s-pomoschyu-conda">  Creating a virtual environment with conda </h3><br><p>  Open a command prompt ( <img src="https://habrastorage.org/webt/hf/02/bp/hf02bp1qralemu6si3-rjscg0lo.png">  + R → <code>cmd.exe</code> → Enter) and enter *: </p><br><pre> <code class="plaintext hljs">C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes python=3 conda</code> </pre> <br><p><img src="https://habrastorage.org/webt/7k/bg/g0/7kbgg0szrbb1osxvp9szvncw-au.png"></p><br><p>  * To install more recent versions of libraries, you can connect the channel <code>conda-forge</code> through the argument <code>-c conda-forge</code> : </p><br><pre> <code class="plaintext hljs">C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes -c conda-forge python=3 conda</code> </pre> <br><p>  If you later need to delete the <code>conda-forge</code> channel, go to the <code>%userprofile%</code> folder in the Explorer, find the <code>.condarc</code> file in it, open it with a notepad and delete the line <code>conda-forge</code> . </p><br><p>  Consider this command.  First comes the full path to <code>conda.exe</code> .  If during the installation of Minconda you checked the “Add Anaconda to the system PATH environment variable” checkbox, instead of the full path you just need to write just <code>conda</code> . </p><br><p>  The word <code>create</code> gives the command to create a new environment.  The argument <code>-p</code> says that this environment should be created where we specify, and not in the folder <code>C:\Dev\Miniconda3\envs</code> .  The example contains the full path and name of the future folder <code>pyenv3.7-win64</code> (decoding: python 3.7 environment for Windows 64-bit).  If your command line is open in the <code>dist</code> folder or you have moved to this folder with the help of the <code>cd</code> , instead of the full path, you could just write <code>pyenv3.7-win64</code> . </p><br><p>  The <code>--copy</code> argument tells <code>conda</code> that the packages themselves must be installed in the virtual environment.  Otherwise, the package will be installed in the folder <code>C:\Dev\Miniconda3</code> , and in the virtual environment there will be a link to it.  You will not notice this substitution until you try to start a virtual environment on another computer. </p><br><p>  Next is the enumeration of packages.  First of all, we have to install the third version of Python itself.  I also indicate the <code>conda</code> .  Those.  The <code>conda</code> program will be installed twice: in Miniconda and in a virtual environment.  Installing a <code>conda</code> in a virtual environment increases its size quite a bit, but will allow the user to update packages in a virtual environment on a computer where Miniconda is not installed.  This makes the virtual environment completely autonomous.  You can even uninstall Miniconda after creating a virtual environment, and it will continue to work as if nothing had happened.  I, however, leave Miniconda in case some application needs Python. </p><br><p>  In general, besides Python and conda, you could immediately specify the necessary packages, but in 2018 I stopped doing this and instead began using <code>pip</code> to install packages.  First, the latest versions of <code>pip</code> began to download <code>.whl</code> files with already compiled libraries, and the problems with installing a number of libraries disappeared.  Secondly, the size of the virtual environment when installing packages via <code>pip</code> is 3 times smaller than when installing packages through <code>conda</code> . </p><br><a name="h-7"></a><br><h3 id="ispravlenie-oshibki-http-000-connection-failed-pri-sozdanii-virtualnogo-okruzheniya">  Correction of <code>HTTP 000 CONNECTION FAILED</code> error when creating a virtual environment </h3><br><p>  One of the users when executing the command </p><br><pre> <code class="plaintext hljs">C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes -c conda-forge python=3 conda</code> </pre> <br><p>  encountered the following error: </p><br><pre> <code class="plaintext hljs">&gt; C:\Users\Asus&gt;C:\Dev\Miniconda3\Scripts\conda.exe create -p C:\Dev\Jupyter\dist\pyenv3.7-win64 --copy --yes -c conda-forge python=3 conda Collecting package metadata: failed CondaHTTPError: HTTP 000 CONNECTION FAILED for url &lt;https://conda.anaconda.org/conda-forge/win-64/repodata.json&gt; Elapsed: - An HTTP error occurred when trying to retrieve this URL. HTTP errors are often intermittent, and a simple retry will get you on your way. SSLError(MaxRetryError('HTTPSConnectionPool(host=\'conda.anaconda.org\', port=443): Max retries exceeded with url: /conda-forge/win-64/repodata.json (Caused by SSLError("Can\'t connect to HTTPS URL because the SSL module is not available."))'))</code> </pre> <br><p><img src="https://habrastorage.org/webt/b5/sm/9w/b5sm9wwkvacxxcd3z0hqqvrmpha.png"></p><br><p>  It took me more than one hour to deal with it, because at first glance the problem is either with an incorrect installation of Miniconda or with the network.  Some corporate users actually blocked this resource, but the problem occurred with the user at home.  Reinstalling Miniconda did not help. </p><br><p>  As a result, it turned out that this error means that <code>conda.exe</code> did not find the <code>openssl.exe</code> file.  As a result, the following solution was applied: </p><br><ol><li><p>  Create a folder <code>C:\Dev\openssl</code> . </p><br></li><li><p>  In the folder <code>C:\Dev\Miniconda3\pkgs</code> found a folder whose name starts with <code>openssl</code> .  For example, <code>openssl-1.1.1a-he774522_0</code> .  If there are several folders, select the one with the higher number in the title. </p><br></li><li><p>  In the found folder, look for the <code>openssl.exe</code> file and copy <code>openssl.exe</code> and <strong>all the files and folders</strong> that lie with <code>openssl.exe</code> in <code>C:\Dev\openssl</code> . </p><br><p><img src="https://habrastorage.org/webt/at/cy/yv/atcyyv4hhlcisdhqzfyw3hetidi.png"></p><br></li><li><p>  In Windows Explorer, go to "This computer" (which lists all the drives on the computer).  In the free space, right-click the mouse to open the context menu and select the “Properties” item at the very bottom. </p><br><p><img src="https://habrastorage.org/webt/bw/qr/0j/bwqr0jmx4hb8uzy6lbfkur2fe0o.png"></p><br></li><li><p>  In the window that opens, we find "Advanced system settings": </p><br><p><img src="https://habrastorage.org/webt/2f/we/vy/2fwevy8talpcoq7ivbhzjxggv8i.png" alt="1549300231528"></p><br></li><li><p>  On the Advanced tab, we find the Environment Variables button: </p><br><p><img src="https://habrastorage.org/webt/sl/o1/np/slo1npemtaxpqc9yeaieroygpnm.png"></p><br></li><li><p>  <strong>For Windows 7 and 8:</strong> in the “Environment Variables for User” section, double click on the <code>Path</code> variable.  If there is no semicolon at the end of the line, put it, and at the end of this line we add: </p><br><pre> <code class="plaintext hljs">C:\Dev\openssl;</code> </pre> <br><p><img src="https://habrastorage.org/webt/jt/gs/eb/jtgseb2tiivyyszam9uiemek0bs.png"></p><br><p>  <strong>For Windows 10:</strong> in the section “Environment Variables for a User”, double click on the <code>Path</code> variable.  As a result, this window should appear: </p><br><p><img src="https://habrastorage.org/webt/bb/mr/ve/bbmrveytykczvobawdcaznggnfk.png"><br>  Click the "Create" button and paste the path <code>C:\Dev\openssl</code> . </p><br></li><li><p>  Close and open the command prompt again.  Now everything should work.  If it doesn’t work, you have to google a mistake or go to the forums. </p><br></li></ol><br><a name="h-8"></a><br><h3 id="aktivaciya-virtualnogo-okruzheniya">  Activation of the virtual environment </h3><br><p>  When the creation of the virtual environment is finished, the window will look like this: </p><br><p><img src="https://habrastorage.org/webt/os/e0/48/ose048qyfj7l7ib7ebrtdrzjbw0.png" alt="13"></p><br><p>  After creating the virtual environment, install the packages via <code>pip</code> .  First you need to activate the virtual environment.  To do this, in the command window, enter: </p><br><pre> <code class="plaintext hljs">C:\Dev\Jupyter\dist\pyenv3.7-win64\Scripts\activate</code> </pre> <br><p>  As a result, you should get something like this: </p><br><p><img src="https://habrastorage.org/webt/d2/6y/jm/d26yjmjhbsbtmy9iqwbmzb3wgns.png"></p><br><p>  The word <code>(base)</code> at the beginning of the line indicates that we have entered the virtual environment we need. </p><br><a name="h-9"></a><br><h3 id="ustanovka-paketov-python-v-virtualnom-okruzhenii">  Installing Python packages in a virtual environment </h3><br><p>  Now you can install the packages *: </p><br><pre> <code class="plaintext hljs">pip --no-cache-dir install numpy scipy matplotlib jupyter jupyterlab</code> </pre> <br><p><img src="https://habrastorage.org/webt/fp/lu/-e/fplu-e6fhkpiia3hlcux9m0naw4.png"></p><br><p>  The <code>--no-cache-dir</code> argument tells <code>pip</code> not to cache downloaded packages.  This will allow us not to increase the size of the virtual environment folder. </p><br><p>  * There is an Intel-developed <a href="https://software.intel.com/en-us/mkl">MKL (Math Kernel Library)</a> library <sup>(en)</sup> that speeds up work on big data for popular Python libraries, in particular, Numpy and Scipy.  If you want to install Numpy and Scipy that use MKL, you should <a href="https://software.intel.com/en-us/articles/installing-the-intel-distribution-for-python-and-intel-performance-libraries-with-pip-and">use</a> <sup>(en)</sup> <code>intel-numpy</code> instead of <code>numpy</code> and <code>intel-scipy</code> instead of <code>scipy</code> : </p><br><pre> <code class="plaintext hljs">pip --no-cache-dir install intel-numpy intel-scipy matplotlib jupyter jupyterlab</code> </pre> <br><p>  I managed to install <code>intel-numpy</code> and <code>intel-scipy</code> only in a virtual environment with Python 3.6.  If you want to use Numpy and Scipy with MKL in an environment with Python 3.7, you need to use the command: </p><br><pre> <code class="plaintext hljs">conda install numpy scipy</code> </pre> <br><p>  If you are not sure what to bet, just use <code>numpy</code> and <code>scipy</code> . </p><br><p>  If the installation process fails with <code>pip</code> , try installing problem packages with <code>conda</code> .  Example: </p><br><pre> <code class="plaintext hljs">conda install numpy scipy matplotlib jupyter jupyterlab</code> </pre> <br><a name="h-10"></a><br><h3 id="vyhod-iz-virtualnogo-okruzheniya-python"> Выход из виртуального окружения Python </h3><br><p> После того, как установка завершена, необходимо выйти из виртуального окружения. Для этого в командной строке наберите*: </p><br><pre> <code class="plaintext hljs">conda.bat deactivate</code> </pre> <br><p> *Раньше я набирал просто <code>deactivate</code> , но это почему-то устарело, и надо набирать <code>conda.bat deactivate</code> . Даже <code>conda deactivate</code> будет неправильно. </p><br><a name="h-11"></a><br><h2 id="podgotovka-portativnoy-sborki-jupyter-k-zapusku"> Подготовка портативной сборки Jupyter к запуску </h2><br><p> Создадим несколько <code>.bat</code> файлов, которые будут заставят Jupyter и Matplotlib хранить настройки в папке <code>dist\config</code> , а также будут управлять запуском Jupyter Notebook и Jupyter Lab. </p><br><a name="h-12"></a><br><h3 id="nastroyka-peremennyh-okruzheniya-dlya-jupyter-ipython-i-matplotlib"> Настройка переменных окружения для Jupyter, IPython и Matplotlib </h3><br><p> Каталоги размещения настроек определяются переменными среды Windows. Изменив эти переменные, мы заставим Jupyter и Matplotlib хранить свои файлы там, где это нужно именно нам. В папке <code>C:\Dev\Jupyter\dist</code> создайте файл <code>setenv.bat</code> следующего содержания: </p><br><pre> <code class="plaintext hljs">@echo off set conf_path=%~dp0\conf set JUPYTER_CONFIG_DIR=%conf_path%\jupyter set JUPYTER_DATA_DIR=%conf_path%\jupyter\data set JUPYTER_RUNTIME_DIR=%conf_path%\jupyter\data\runtime set IPYTHONDIR=%conf_path%\ipython set MPLCONFIGDIR=%conf_path%\matplotlib REM Matplotlib search FFMPEG in PATH variable only! set PATH=%~dp0\apps\ffmpeg\bin;%PATH%</code> </pre> <br><p> Разберём, что делается в этом файле. </p><br><p> Команда <code>@echo off</code> необходима для того, чтобы в командной строке не выводилось сообщение при выполнении каждой строки нашего файла. </p><br><p> Команда <code>set</code> создаёт переменную. Конструкция <code>%~dp0</code> означает полный путь к <code>setenv.bat</code> . Обратите внимание, что пробелов до и после знака <code>=</code> быть не должно. </p><br><p> Затем мы настраиваем переменные для Jupyter: </p><br><ul><li> <code>JUPYTER_CONFIG_DIR</code> — папка для файлов конфигурации Jupyter ( <a href="https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html">документация</a> <sup>(en)</sup> ), </li><li> <code>JUPYTER_DATA_DIR</code> — папка для устанавливаемых файлов данных (расширения и ядра ( <code>kernel</code> ) для Jupyter) ( <a href="https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html">документация</a> <sup>(en)</sup> ), </li><li> <code>JUPYTER_RUNTIME_DIR</code> — папка для исполняемых файлов Jupyter ( <code>runtime files</code> ) ( <a href="https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html">документация</a> <sup>(en)</sup> ), </li><li> <code>IPYTHONDIR</code> — папка для файлов конфигурации IPython ( <a href="https://ipython.readthedocs.io/en/stable/development/config.html">документация</a> <sup>(en)</sup> ), </li><li> <code>MPLCONFIGDIR</code> — папка, где Matplotlib хранит свои настройки и кэш ( <a href="https://matplotlib.org/faq/troubleshooting_faq.html">документация</a> <sup>(en)</sup> ). </li></ul><br><p> Если вы планируете создавать анимации с Matplotlib, вам понадобится <a href="https://ru.wikipedia.org/wiki/FFmpeg">FFMPEG</a> <sup>(ru)</sup> . Я <a href="https://ffmpeg.zeranoe.com/builds/">скачиваю</a> <sup>(en)</sup> zip архив FFMPEG, распаковываю его содержание <code>C:\Dev\Jupyter\dist\apps\ffmpeg</code> . </p><br><p> Строка, которая начинается с <code>REM</code> — комментарий. Matplotlib почему-то ищет FFMPEG только в <code>%PATH%</code> . Я записываю путь к FFMPEG в начало <code>%PATH</code> , а не в его конец, чтобы при поиске первым нашёлся тот FFMPEG, который я положил в <code>dist\apps</code> . </p><br><a name="h-13"></a><br><h3 id="sozdanie-fayla-dlya-zapuska-jupyter-s-nastroykami-polzovatelya"> Создание файла для запуска Jupyter с настройками пользователя </h3><br><p> В папке <code>C:\Dev\Jupyter\dist</code> создайте файл <code>run_jupyter_notebook.bat</code> следующего содержания: </p><br><pre> <code class="plaintext hljs">@echo off call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-notebook.exe --notebook-dir=%1</code> </pre> <br><p> Аналогично, в папке <code>C:\Dev\Jupyter\dist</code> создайте файл <code>run_jupyter_lab.bat</code> следующего содержания: </p><br><pre> <code class="plaintext hljs">@echo off call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-lab.exe --notebook-dir=%1</code> </pre> <br><p> Каждый из этих файлов сначала выполняет <code>setenv.bat</code> , т.е. настраивает переменные окружения, потом запускает Jupyte Notebook или Jupyter Lab и указывает ему, где папка с нашими файлами для проекта. </p><br><p> Предположим, что есть папка <code>D:\my-projects</code> , в которой мы будем хранить файлы Jupyter Notebook или Lab. В этой папке создайте ярлыки на файлы <code>run_jupyter_notebook.bat</code> и <code>run_jupyter_lab.bat</code> . После этого в обязательном порядке откройте свойства каждого из этих ярлыков и сделайте пустой строку «Рабочая папка». Если вы этого не сделаете — Jupyter не увидит вашу папку! </p><br><p><img src="https://habrastorage.org/webt/hx/sh/m2/hxshm2lldbosvdmezgsmvoevhcy.png"></p><br><p> После того, как это сделали, можете кликнуть дважды по любому из ярлыков. Сначала появится новое окно командной строки, потом откроется браузер по умолчанию и в нём запустится Jupyter Notebook или Lab в новой вкладке. Поздравляю: квест пройден! </p><br><a name="h-14"></a><br><h3 id="dopolnitelnye-fayly-dlya-vypolneniya-sluzhebnyh-deystviy"> Дополнительные файлы для выполнения служебных действий </h3><br><p> Для Jupyter Notebook написаны <a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions">расширения</a> (о них будет подробнее в части 2). Но их недостаточно установить. Их ещё надо активировать. Согласно <a href="https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/install.html">документации</a> , вам нужно сделать следующее (не выполняйте эту команду!): </p><br><pre> <code class="plaintext hljs">jupyter nbextension enable &lt;nbextension require path&gt;</code> </pre> <br><p> Но мы не можем выполнить команду в таком виде, потому что настройки окажутся вне портативной сборки. Мы должны сделать иначе: </p><br><pre> <code class="plaintext hljs">C:\Dev\Jupyter\dist\setenv.bat C:\Dev\Jupyter\dist\pyenv3.7-win64\Scripts\jupyter.exe nbextension enable &lt;nbextension require path&gt;</code> </pre> <br><p> Чтобы упростить себе задачу, мы можем в папке <code>C:\Dev\Jupyter\dist</code> создать файл <code>enable_extension.bat</code> следующего содержания: </p><br><pre> <code class="plaintext hljs">@echo off REM Enable extension in Jupyter Notebook. REM Example: REM enable_extension.bat widgetsnbextension call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter-nbextension.exe enable %1</code> </pre> <br><p> В итоге наша запись в окне командной строки сократится и станет такой: </p><br><pre> <code class="plaintext hljs">C:\Dev\Jupyter\dist\enable_extension.bat &lt;nbextension require path&gt;</code> </pre> <br><p> Если вам время от времени в окне команд нужно запускать различные действия с <code>jupyter</code> , можно создать в папке <code>C:\Dev\Jupyter\dist</code> файл <code>jupyter.bat</code> следующего содержания: </p><br><pre> <code class="plaintext hljs">@echo off call %~dp0\setenv.bat call %~dp0\pyenv3.7-win64\Scripts\jupyter.exe %1 %2 %3 %4 %5 %6 %7 %8 %9</code> </pre> <br><p> Аналогично можно сделать для запуска <code>IPython</code> и других случаев. </p><br><hr><br><a name="h-15"></a><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p> Часть 1 подошла к концу. Мы создали полностью портативную и переносимую сборку Jupyter и можем работать с файлами, которые лежат в нужной нам папке. Для этого создаём ярлыки на <code>run_jupyter_notebook.bat</code> и <code>run_jupyter_lab.bat</code> , в свойствах ярлыков обязательно очищаем строку Рабочая папка», и всё готово к работе. </p><br><p> В части 2 будут рассмотрены различные вопросы кастомизации Jupyter Notebook, Jupyter Lab и Matplotlib. Научимся подключать расширения в Jupyter Notebook и Jupyter Lab, настраивать сочетания клавиш, размер шрифта и прочие настройки, напишем свои «магические команды». </p><br><p> Если у вас остались вопросы, но нет аккаунта на Хабре, вот мои контакты: </p><br><p> ВК: <a href="https://vk.me/sindzicat">https://vk.me/sindzicat</a> </p><br><p> Telegram: <a href="https://t.me/sindzicat">https://t.me/sindzicat</a> </p><br><p> E-mail: <a href="">sh.andr.gen@yandex.ru</a> </p></div>