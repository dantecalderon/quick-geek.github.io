<div class="post__text post__text-html js-mediator-article"><p>  <strong>Imagine that you write a task manager.</strong>  <strong>The application should work as native: work offline as well as online.</strong> </p><br><h2 id="osnovnaya-koncepciya">  Basic concept </h2><br><p>  Our main tool in building such an application is localstorage. </p><br><p>  With other ways to realize this, I am not familiar.  The method of which I will tell I thought up myself and it seemed to me successful. </p><a name="habracut"></a><br><h2 id="kak-eto-budet-rabotat">  How will this work? </h2><br><p>  So, we have a list of tasks: </p><br><pre><code class="javascript hljs">&lt;ul <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"tasks"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"task"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"task__text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Eggs</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"task"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"task__text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Breads</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"task__add-btn"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">New task</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  We need to store and update the text of the task and the status completed / not, as well as implement the addition of a new task. </p><br><p>  We will generate a random key for each task and use it as an identifier for each associated stored information in localstorage.  By analogy, it is similar to databases. </p><br><h2 id="s-chego-nachat">  Where to begin? </h2><br><p>  First of all, we will look whether there are already any tasks in memory.  All keys will be stored in one line. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> savedTokens = localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'tokens'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'.tasks'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tokens = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedTokens != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { tokens = savedTokens.split(<span class="hljs-string"><span class="hljs-string">', '</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  For the time being, let's understand the addition of a new task to understand the concept of storing and using stored data. </p><br><p>  When you click on add a task, a template task will appear in the list, the task text can be edited.  Neper need to describe all this. </p><br><p>  Create a function that creates an element with its contents from the data passed to it. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'li'</span></span>); task.classList.add(<span class="hljs-string"><span class="hljs-string">'task'</span></span>); task.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-token'</span></span>, token); task.innerHTML = <span class="hljs-string"><span class="hljs-string">` &lt;p class="task__text" contenteditable="true"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${data.text}</span></span></span><span class="hljs-string">&lt;/p&gt; &lt;input type="checkbox" </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${data.input == </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'true'</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'checked'</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">&gt; `</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre> <br><p>  We describe the events for the button and for editing the task: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> btnAddTask = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'.task__add-btn'</span></span>); btnAddTask.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newToken = randomToken(); tokens.push(newToken); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> taskData = { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'Task`s title'</span></span>, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; root.appendChild(getTemplate(newToken, taskData)); updateTokens(); updateEvent(newToken); });</code> </pre> <br><p>  Implement the missing updateEvent and randomToken functions. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = root.querySelector(<span class="hljs-string"><span class="hljs-string">`[data-token="</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">"]`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = task.querySelector(<span class="hljs-string"><span class="hljs-string">`.task__text`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input = task.querySelector(<span class="hljs-string"><span class="hljs-string">`input`</span></span>); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">`text-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>, text.innerHTML); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">`input-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>, input.checked); text.addEventListener(<span class="hljs-string"><span class="hljs-string">'input'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ localStorage.setItem(<span class="hljs-string"><span class="hljs-string">`text-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>, text.innerHTML); }); input.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ localStorage.setItem(<span class="hljs-string"><span class="hljs-string">`input-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>, input.checked); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateTokens</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'tokens'</span></span>, tokens.join(<span class="hljs-string"><span class="hljs-string">', '</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random().toString(<span class="hljs-number"><span class="hljs-number">36</span></span>).substring(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random().toString(<span class="hljs-number"><span class="hljs-number">36</span></span>).substring(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>); }</code> </pre> <br><p>  Fine!  We implemented adding a task and saving it to localStorage.  It remains to conclude the tasks that have already been saved. </p><br><h2 id="vyvod-sohranyonnyh-taskov">  Output saved tasks </h2><br><p>  To display tasks, it is enough to get all the keys, parse them, extract the text of the task and its status for each key.  Then just create each task in root: we get a task with getTemplate and insert it into root. </p><br><pre> <code class="javascript hljs"> tokens.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = localStorage.getItem(<span class="hljs-string"><span class="hljs-string">`text-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input = localStorage.getItem(<span class="hljs-string"><span class="hljs-string">`input-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${token}</span></span></span><span class="hljs-string">`</span></span>); root.appendChild(getTemplate(token, { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: text, <span class="hljs-attr"><span class="hljs-attr">input</span></span>: input })); updateEvent(token); });</code> </pre> <br><p>  In general, our simple task manager is ready.  It remains to collect everything in a bunch. </p><br><p>  <a href="https://volodya.space/publications/save-data-with-reload-application/demo/">Working task manager is available by reference</a> . </p></div>