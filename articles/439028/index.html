<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to improve network perimeter protection? Practical recommendations for Check Point and not only</title>
  <meta name="description" content="We continue the series of articles on the optimization of security settings for network perimeter protection (NGFW). I want to immediately note that t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>How to improve network perimeter protection? Practical recommendations for Check Point and not only</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/uf/gv/gb/ufgvgbmz59uqr9v-r-iz9r_tqj4.png"><br><br>  We continue the series of articles on the optimization of security settings for network perimeter protection (NGFW).  I want to immediately note that these recommendations are suitable not only for Check Point owners.  In fact, if you look at the threats are the same for everyone, it‚Äôs just that each NGFW vendor decides (or does not solve) in his own way.  Before that, we published a mini course ‚Äú <a href="https://habr.com/ru/company/tssolution/blog/334052/">Check Point to Maximum</a> ‚Äù, where we showed how dangerous the default settings are.  These were general recommendations.  Now we wanted to describe more specific steps for the possible strengthening of perimeter protection.  This article is only advisory in nature!  Do not blindly follow this instruction without first analyzing the possible consequences for your network! <a name="habracut"></a><br><br><h2>  Trends in cyber attacks </h2><br>  Before making recommendations, it is necessary to understand, and what threatens us?  From what to defend?  For this, I propose to use the Check Point report for 2018 (CYBER ATTACK TRENDS ANALYSIS).  Naturally there is a lot of marketing, but there is also very useful information.  For example, statistics on the types of virus files that were received via the Web (http / https) and Email (smtp): <br><br><img src="https://habrastorage.org/webt/i9/gz/fh/i9gzfhybabnduegjumowikjnblc.png"><br><br>  From this picture you can get very important information.  Web and Email are still two main attack vectors.  And if you look at the statistics, you can see that SMTP prevailed in the first half of the year, and HTTP dominated in the second half of the year. <br><br><img src="https://habrastorage.org/webt/1h/y3/ac/1hy3accfamco6ccboaoy-d-jska.png"><br><br>  Let's see how we can increase the protection for each attack vector (i.e., Web and Email). <br>  Immediately make a reservation that <b>these measures will certainly not be enough to provide comprehensive protection</b> .  However, according to statistics, we can <b>significantly improve the security of our network</b> . <br><br><h2>  Enhancing protection against malicious Web traffic. </h2><br>  Back in the course ‚Äú <a href="https://habr.com/ru/company/tssolution/blog/334052/">Check Point for Maximum</a> ‚Äù, I showed a few tricks to improve security for Web traffic.  The most important points: <br><br><ol><li>  <a href="https://habr.com/ru/company/tssolution/blog/341200/">Enable HTTPS inspection</a> ; </li><li>  <a href="https://habr.com/ru/company/tssolution/blog/351312/">Use Content Awareness Blade</a> ; </li><li>  <a href="https://habr.com/ru/company/tssolution/blog/353482/">Enable Deep scan in the Anti-Virus settings</a> ; </li><li>  <a href="https://habr.com/ru/company/tssolution/blog/420281/">Use IPS to check files</a> . </li></ol><br>  However, most of the recommendations were of a general nature.  Now we have information about the most relevant threats.  Let's try to apply our knowledge in practice. <br><br><h3>  1) Content Blocking (Content Awareness) </h3><br>  As we saw from the image above, the <b>.exe</b> format is most often found among the virus files that users receive via the Web.  Already <b>46%</b> !  Do these files need your users?  In <a href="https://habr.com/ru/company/tssolution/blog/351312/">Lesson 2</a> ‚ÄúCheck Point for Maximum‚Äù I already showed how to use the Content Awareness blade.  If you still had doubts about this blocking, then take another look at the statistics.  Having blocked this type of files you ‚Äúsimplify‚Äù the life of your NGFW by 46% (in terms of checking files).  Just add one rule: <br><br><img src="https://habrastorage.org/webt/tx/tq/bz/txtqbzoskv1xpmax6djuun5c_jc.png"><br><br>  Why check what you obviously do not need and hope that it does not screw up your antivirus or sandbox? <br><br>  If you use another solution (not Check Point), then perhaps there is no such functionality as Content Awareness, however, you will probably be able to block various types of files using antivirus.  This is a more resource-intensive way, but it's better than nothing. <br><br>  With the rest of the file types is not so simple.  <b>Doc</b> and <b>Pdf</b> are most likely needed by the majority and it is not possible to block them.  The same applies to the rest of the files (JS, Jar), ‚Äã‚Äãif you block them, then there will be problems with the display of web pages.  The only way out in this case is to check them VERY carefully. <br><br><h3>  2) Turn on Deep Scan for the most dangerous file types. </h3><br>  In the <a href="https://habr.com/ru/company/tssolution/blog/353482/">4th lesson ‚ÄúCheck Point for maximum‚Äù</a> I showed that with the default settings the Anti-Virus shows very bad results.  And this is absolutely true for all vendors.  Almost everyone has the option of ‚Äúquick‚Äù check and more ‚Äúdeep‚Äù.  By default, of course, ‚Äúfast‚Äù is used, for the purpose of optimization.  For Check Point, the ‚Äúdeep‚Äù scan option is called " <b>deep scan</b> " and it can be enabled for different file types.  The first thing that comes to mind is to enable it for all file types (currently there are about 90 file types).  And so it can be done!  If you have a very rich company.  It takes a very powerful iron for this option.  You can find a compromise - enable deep scan for the most dangerous files: <br><br><img src="https://habrastorage.org/webt/i8/0z/wv/i80zwvjvyzjylzcsrsz6c8rhohq.png"><br><br>  From the statistics we have the following files: <b>pdf, doc, javascript, jar</b> .  But I would add at least: <b>xls, zip, rar, 7zip, rtf, swf</b> .  And of course, you need to block password-protected archives. <br><br>  If you do not have Check Point, then check the possibility of using such options.  It is very important. <br><br><h3>  3) Include the necessary IPS signatures </h3><br>  Again, going back to the ‚ÄúCheck Point to Maximum‚Äù course, in <a href="https://habr.com/ru/company/tssolution/blog/420281/">Lesson 6,</a> I showed the importance of IPS for checking files.  IPS can find exploits in documents!  The biggest torment with IPS is choosing the signatures you need.  In the same place, I showed a few tricks to work with them (or more precisely, with categories).  But now we have additional information.  We definitely need signatures associated with such files as <b>pdf, doc, javascript</b> and <b>jar</b> .  Make it quite simple, just use the search by signatures: <br><br><img src="https://habrastorage.org/webt/7a/_v/30/7a_v30e8eekyhz_m0j7mlfkvd0e.png"><br><br>  (In the case of pdf, do not forget that there may be other ‚Äúviewers‚Äù, for example Foxit). <br>  Or again, using categories in filters: <br><br><img src="https://habrastorage.org/webt/tg/x2/lk/tgx2lk7xmzabs43wmcufjiincx0.png"><br><br>  Now we will scan incoming files not only with the help of Anti-Virus, but also with the help of IPS. <br><br>  If you are not using Check Point, then try also to include relevant signatures (all that concerns office documents, archives, javascript and jar). <br><br><h3>  4) Threat Emulation and Threat Extraction </h3><br>  Antivirus and IPS are good, but this is a signature analysis, the main drawback of which is that it works only with known threats.  What to do with the unknown (0-day)?  For this and come up with a "sandbox".  At Check Point, this technology is called SandBlast and is implemented using such blades as: <br><br>  <b>Threat Emulation</b> - file emulation.  Currently more than 65 file types are supported.  Be sure to enable emulation for the above-mentioned list ( <b>pdf, doc, javascript and jar</b> ) plus my recommendations ( <b>xls, zip, rar, 7zip, rtf, swf</b> ): <br><br><img src="https://habrastorage.org/webt/lr/wz/sm/lrwzsmqvg6w4ramfzjqa_-nwnw0.png"><br><br>  Threat Emulation will allow you to check files before they are downloaded.  This is a very important feature, because  not every solution can work in the Prevent mode for web traffic. <br><br>  <b>Threat Extraction</b> - clear active content.  Cleaning can be performed by converting a file to pdf, or by ‚Äúcutting out‚Äù all active content (scripts, macros, url, etc.).  Currently, Threat Extraction supports about 45 types of files.  And the advantages of using this blade, I told in <a href="https://habr.com/ru/company/tssolution/blog/326288/">3 parts of the course Check Point SandBlast</a> .  Look, there is a demonstration of work.  It is highly advisable to use Threat Extraction for cleaning pdf and doc.  And the best way is to choose the ‚Äúconversion to pdf‚Äù, this is the ‚Äú100 pood‚Äù method.  With xls, it doesn't always roll, because  the document may be badly affected, so use a customized policy for Threat Extraction. <br><br>  Unfortunately, currently, the Threat Extraction for Web traffic only works when using a special browser extension - <b>SandBlast Agent for Browsers</b> .  However, in the next release ( <b>Gaia R80.30</b> ), it will be possible to clean and convert files, even without additional extensions. <br><br>  If you are not using Check Point, then I also recommend trying out the sandbox functionality.  Almost all vendors have a trial mode.  I'm pretty sure that after switching on your ‚Äúcatch rate‚Äù will increase significantly. <br><br><h2>  We strengthen the protection against malicious email </h2><br>  With web traffic more or less sorted out (although in fact everything is more complicated).  Now let's move on to another popular attack vector, Email.  In almost all companies, mail protection receives the most attention.  Let's see what we can do with NGFW solutions at the perimeter of the network. <br><br><h3>  1) MTA mode </h3><br>  The first thing you need to do is switch the Check Point Gateway to MTA (Mail Transfer Agent) mode.  This will allow for a more comprehensive scan of email messages, especially if you use SMTPS (in this case, without the MTA function, your gateway will simply not be able to check for this traffic). <br><br><img src="https://habrastorage.org/webt/ai/cv/7q/aicv7qe1qbwuf08sauh86kqnibg.png"><br><br>  If you are not using Check Point and your NGFW does not support MTA, then read the article further - there is no point.  You simply will not be able to perform additional checks.  Most likely in this case, you use a separate solution to protect mail. <br><br><h3>  2) Upgrade to R80.20 </h3><br>  This is another important point.  In the release of the Gaia R80.20, the MTA functionality (and not only) has undergone significant changes.  This also applies to mailing reporting.  By default, several new dashboards are available at once: <br><br><img src="https://habrastorage.org/webt/6p/b5/35/6pb535enq3i21ydn_6d9ygcxmoo.png"><br><br>  No longer have to climb into the command line for monitoring and trashlshuting.  In addition, starting with version R80.20, the MTA functionality has been moved to a separate tab in the Threat Prevention profile settings: <br><br><img src="https://habrastorage.org/webt/la/ic/hx/laichxylm5ggcz72hwsnip-rfho.png"><br><br>  The most important points: <br><br><ol><li>  Now mail attachments can be checked not only by the sandbox (in MTA mode).  At first, the files and links in the email will be scanned by the antivirus engine.  This is very beneficial in terms of device performance, because  if the file is a known malware, it will be dropped, without being sent to the sandbox. </li><li>  Now all blocked emails can be sent to a dedicated email and thus organize some sort of quarantine.  This is useful in case you need access to a blocked email. </li></ol><br>  As far as I know, currently, a dedicated team has been formed at Check Point that deals exclusively with MTA functionality.  So, additional improvements are just around the corner (R80.30 is already in the EA program). <br><br><h3>  3. Make a separate Threat Prevention rule for MTA </h3><br>  Another important point.  There should be different profiles for web traffic and email.  The rule should look like this: <br><br><img src="https://habrastorage.org/webt/hm/pv/me/hmpvmets5-xcms85pwrttspcmdw.png"><br><br>  If you are using R80.20, this rule is created automatically when you turn on the MTA. <br><br><h3>  4. Email Antivirus </h3><br>  As mentioned above, at 80.20 we have the opportunity to use the anti-virus ‚Äúengine‚Äù to check attachments and hyperlinks.  It perfectly correlates with our needs.  If you look at the statistics at the very beginning, you can see that in addition to classic documents, <b>exe</b> files and <b>url</b> pose a threat. <br><br>  First of all, you need to block absolutely all unnecessary types of files that can be sent as attachments (not only exe).  Easier to say what to leave: pdf, doc, xls, ppt.  zip, rar, 7zip and other popular office file formats.  But various scripts, Linux archives, executable files should be blocked. <br>  Also do not forget about checking the url in the content of the letter: <br><br><img src="https://habrastorage.org/webt/k1/vy/r_/k1vyr_wbmoanilzqjgpo4q-52yy.png"><br><br>  For all types of files that we allow, of course, you need to configure a deep scan. <br><br><h3>  5. Threat Emulation and Threat Extraction </h3><br>  Mail is the main vector for targeted attacks, i.e.  attacks, which are prepared.  Most often it is in such attacks that the zero-day (0-day) vulnerabilities are used.  And here the signature analysis is powerless.  Therefore, if you decide to use a sandboxed solution, then email is the first place to use it.  For all allowed (in antivirus) files, we must use the sandbox functionality.  This concerns not only Check Point solutions. <br><br>  In terms of setting Threat Emulation for Email, everything is identical, as for the Web.  Just make sure that you enable emulation for all files that are allowed (by antivirus).  Again, if you look at our statistics, the most dangerous file types are doc, pdf, rtf, xls. <br>  Also, be sure to use Threat Extraction to clear active content. <br><br><img src="https://habrastorage.org/webt/ip/uk/sg/ipuksg2_qej5oql_eyhsbuzo1go.png"><br><br>  In this case, for documents such as <b>pdf</b> and <b>doc,</b> be sure to configure the conversion to pdf.  In this case, you do not have to rely on Threat Emulation.  Moreover, with a positive verdict, the user will be able to download the original file (in 95% of cases no one needs the original). <br><br><h2>  General recommendations </h2><br>  The main principle of network perimeter protection is to minimize the attack area.  For this we have a large set of mechanisms: <br><br><ol><li>  Restrict allowed ports to the firewall level; </li><li>  Restrict the applications used in the corporate network; </li><li>  Restrict access to malicious resources; </li><li>  Disallow unwanted content type (executable files, etc.); </li><li>  Enable SSL inspection to see the whole picture. </li></ol><br>  Without these steps, all other actions are useless.  Having reduced the attack area, we should make maximum use of signature analysis methods, such as: <br><br><ol><li>  Antivirus; </li><li>  IPS; </li><li>  Anti-Bot, </li><li>  Anti-Spam. </li></ol><br>  And after that we can move on to heavier tools, such as a sandbox: <br><br><ol><li>  Threat Emulation; </li><li>  Threat Extraction. </li></ol><br>  Such a consistent approach will significantly enhance network perimeter protection.  The approach is universal and relevant for almost all NGFW solutions. <br><br><h2>  Additional materials </h2><br>  If you are interested in this topic, then at least the following resources are recommended: <br><br><ul><li>  <a href="https://habr.com/ru/company/tssolution/blog/334052/">Check Point to maximum</a> </li><li>  <a href="https://habr.com/ru/company/tssolution/blog/432676/">Check Point Security Check List</a> </li><li>  Protection against targeted (0-day) attacks using Check Point SandBlast ( <a href="https://habr.com/ru/company/tssolution/blog/325246/">part 1</a> , <a href="https://habr.com/ru/company/tssolution/blog/325822/">part 2</a> , <a href="https://habr.com/ru/company/tssolution/blog/326288/">part 3</a> ) </li></ul><br>  Soon we plan to launch a small course, with a demonstration of all this functionality.  So stay tuned!  ( <a href="https://vk.com/ts_solution">vk</a> , <a href="https://t.me/tssolution">telegram</a> ). </div><p>Source: <a href="https://habr.com/ru/post/439028/">https://habr.com/ru/post/439028/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>