<div class="post__text post__text-html js-mediator-article">  The 14th and 15th editions of the <a href="https://habr.com/search/%3Fq%3D%255B%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8%2520%25D0%25B4%25D0%25BB%25D1%258F%2520%25D1%2581%25D0%25B0%25D0%25BC%25D1%258B%25D1%2585%2520%25D0%25BC%25D0%25B0%25D0%25BB%25D0%25B5%25D0%25BD%25D1%258C%25D0%25BA%25D0%25B8%25D1%2585%255D%26target_type%3Dposts">SDSM</a> , and in parallel with this, the work in megascale stimulated my interest in the hardware stuffing of network devices. <br><br>  Now it became curious how the process of production of equipment looks like, and how well Russian import substitution corresponds to the ideas of <a href="https://habr.com/post/345270/">SDTSM14</a> . <br><br>  By happy nonrandomness, we still maintain close ties with Artyom Spitsyn - now the head of the Moscow office of Eltex Communications.  And he offered me new questions to bring to Okruzhnuyu 29B in Novosibirsk. <br><br>  <i>This article is a product of a trip to the Eltex factory and further reflection.</i> <br><br><img src="https://habrastorage.org/webt/ri/oe/ly/rioelyc61qqihlw_xqox3gsdt3k.jpeg" width="800"><br><a name="habracut"></a><br>  And we again gathered the valiant four on the campaign for Eltex: the network engineer of Yandex (I), the tester from Plesk (our Natasha), the unemployed who returned from the Around the World (Sergey, who helped us with CCIE for a year), and a student of SibGUTI IHT (Misha). <br><br>  One of the things that changed in 2.5 years - allowed to take pictures.  Therefore, some of the photos in this publication are provided by Eltex - of good quality, and some - in general, I'm sorry. <br><br>  So in December 2018, Eltex finally launched a new building.  Just a week before our coming there.  There was a lot of noise, launched with aplomb.  Press, ministers, excursions. <br>  For my spoiled taste, the design is exclusively utilitarian: sterile labyrinths of corridors, monotonous cabinets, red clone tables, about which we have already <a href="http://linkmeup.ru/blog/237.html">seen the last time</a> .  However, against this background, the lairs of designers and hardware workers, strewn with boards, resistances, chips, oscilloscopes and other exciting equipment, look especially lively. <br><br><img src="https://habrastorage.org/webt/cd/bc/dh/cdbcdhjszcmfv4_ydl9qecpaleu.jpeg" width="800"><br><br><hr><br><h2>  Production Line </h2><br><br>  On the second floor they built the first of three lines 200 meters long. <br>  This is about a dozen of machines lined up in a row, between which a board travels along a conveyor belt, acquiring new and new details.  Machines are interspersed with sites installed around the conveyor tables, where ordinary people work, doing work for which the brain and the opposed finger is cheaper than soulless Asian iron. <br>  Thus, the line provides a complete production cycle of the product: bare PCBs enter at its start, and at the end there is a box with a device ready for sale or installation. <br><br>  Let's first take a look at the stages of production, and then we will understand what research and development work precedes this. <br><br><img src="https://habrastorage.org/webt/l7/n1/uw/l7n1uwav4lpw5xtpgy8okleg9x0.jpeg" width="800"><br><br><h4>  Surface mount </h4><br>  The first stage is the surface mounting of SMD components ( <i>Surface Mounted Device</i> ) - chips, resistors, capacitors and other components are installed in their places and soldered. <br><br>  A PCB with already etched tracks and prepared landing pads enters the first machine from the end. <br><br>  The machine applies to the board a mixture of solder and flux in the ratio of 9: 1.  To mix the mixture only on the desired points, a pre-prepared stencil is used. <br><br>  Then the board with solder moves to another machine, where components are placed on it in accordance with the scheme. <br><br>  Resistors, transistors, capacitors, memory chips, packet processors, CPUs are located on reels with ribbons attached to the front side of the machine. <br><br>  There are three such machines, and they are installed one after the other - all are physically identical, but have a different program and operate on different components.  If rough, the grip is configured for different sizes of elements. <br><br><img src="https://habrastorage.org/webt/ie/uv/lf/ieuvlf1yolw_8wjkoeynfgdlu9i.jpeg" width="800"><br><br>  The next machine is the oven for baking boards.  First, they warm up to 100 degrees smoothly, this equalizes the temperature of the components and protects them from thermal shock in the next production step, when the temperature rises sharply to about 330 ° C for 5 minutes.  Allowable temperature regimes are specified in the specifications of the components. <br><br>  At the end of the first stage, an optical analysis of the soldering takes place.  In automatic mode, each board is checked for <a href="">cold soldering</a> , damage and defects. <br><br><h4>  Pin mounting </h4><br>  Next comes the elegance of automation.  Fees fall to the mercy of gentle female (but not only) hands.  In our last visit, <a href="http://linkmeup.ru/blog/237.html">the pin-mounting shop</a> made an indelible impression.  Fortunately, this fragrant oasis with amazons has not gone anywhere, just a new conveyor was added to the new building. <br><br><img src="https://habrastorage.org/webt/hz/mb/9n/hzmb9nmeqpt2jaukoclxq5ujdry.jpeg" width="800"><br><br>  At this stage, the boards are installed in the already finished holes elements having pins.  These include, for example, power connectors, network, buttons, LEDs. <br><br>  Automation of such work is still extremely disadvantageous to a relatively small manufacturer, therefore, as before, it is performed by people in Eltex.  And since men (extremely poorly adapted to such monotonous work of creation) make many mistakes, it is entrusted mainly to women ( <i>and do not start talking about sexism - there is a historical difference between the sexes</i> ). <br><br>  Then the board goes into the furnace once again, where the installed elements are sealed using the wave method. <br><br>  First, the flux is applied here, then, as in the case of surface mounting, the board warms up in three stages.  And at the very end of the machine - a large tank with liquid solder and a laminar <a href="http://www.chukfamily.ru/kornei/tales/ajbolit">wave</a> in the tank.  The wave slightly touches one of the sides of the board, and the solder wets the contact pads, and under the action of the capillary effect rises up through the through holes, sealing the pins. <br><br>  Excess solder flows back to the tank.  The temperature is about 260 ° C. <br><br><img src="https://habrastorage.org/webt/9y/9d/kc/9y9dkcapmgyo_gapntooiwjd4ni.jpeg"><br>  <i>On the photo board just rush into the oven.</i> <br><br>  The line was turned off shortly before our visit - the machine still retained the exciting heat, but the solder was already frozen. <br><br><img src="https://habrastorage.org/webt/ei/1c/8e/ei1c8enu4teukw3oi2cnghv3kd0.png"><br>  <i>Illustration from the <a href="https://pcbdesigner.ru/pcb/montazh-pechatnykh-plat/avtomatizirovannaya-pajka-i-pajka-volnoj-pripoya-v-texnologii-skvoznogo-montazha-pechatnyx-plat.html">wave soldering</a> article</i> <br><br><hr><br><h4>  Firmware </h4><br>  All devices are further firmware. <br><br><img src="https://habrastorage.org/webt/ei/wo/iu/eiwoiuarfx9fti99kzzlecqltzk.jpeg" width="800"><br>  <i>On the photo of her pass TV set-top boxes.</i> <br><br><hr><br><h4>  Installation in the case </h4><br>  The next stage is the installation of the remaining elements and housing. <br><br><img src="https://habrastorage.org/webt/lx/f7/yx/lxf7yxxhzxx88pe4jijnobl8-ns.jpeg" width="800"><br><br>  This is done manually: a person in a case made in advance in Asia (or Russia) mounts a charge traveling along the line. <br><br><hr><br><h4>  Testing </h4><br><img src="https://habrastorage.org/webt/gw/gn/c_/gwgnc_aswglddvl4rd6abhydqwy.jpeg" width="800"><br>  <i>In the photo test set-top boxes.</i> <br><br>  Testing of Wi-Fi equipment looks quite interesting - metal boxes are installed on special tables, isolating radiation, and, accordingly, the influence of neighboring subjects, stuffed with measuring equipment. <br><br><hr><br><h4>  Packaging </h4><br>  The last step is to pack the finished device into protective bags, boxes, and add accessories: antennas, mounting lugs, power supplies, remote controls, etc.  A person is doing this, of course.  The assembled device comes to him along the line, and packing material is brought close to them in boxes. <br><br>  The finished products are taken away to the customer. <br><br><hr><br>  At a particular point in time, the line is configured for a specific device: starting with programs and stencils and ending with a set of tapes with components. <br><br>  If you need to change the configuration, the production stops and is fully reconfigured. <br><br>  In the new building, high-volume production is expected - set-top boxes, switches, routers, VoIP-gateways and VoIP-phones - something that immediately disperses to hundreds of customers of different caliber ( <i>Contrary to existing stereotypes, Eltex has more than one customer</i> ). <br>  The old line, to which we were last time, is not dismantled, of course - there will be small-scale and experimental production on it - devices that are still required piece. <br><br><hr><br>  But the most interesting question is not how in Asian machines the boards become overgrown with Asian components, but where the programs for them come from, the boards themselves, the stencils. <br><br>  Before launching the device into production, it needs to be developed, starting with the business task and ending with 3D-simulation of the air flow inside the device and the temperature map. <br><br><h2>  PCB Development </h2><br>  On this visit, Eltex engineers and architects were much more sociable than two years ago.  I attribute this to the fact that during this time linkmeup has grown from an unknown podcast to a project that even has its own personal haters.  Although it is quite possible, because last time it was four people from Huawei, who are known to send their Cossacks everywhere, and now it is I - the janed, Natasha from Plesk, the unemployed Seryoga, and the student Misha). <br><br>  Therefore, Eltex engineers were open and talked about their work with visible pleasure.  And we, in turn, did not miss the opportunity to ask a question. <br><br><h4>  Structural scheme </h4><br>  It all starts with a <b><a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2585%25D0%25B5%25D0%25BC%25D0%25B0">block diagram</a></b> .  This is the most superficial look at the device / board. <br><br>  This scheme depicts all elements of the board and the logical connections between them.  Its task is to give an idea of ​​the structure of the device, the role of individual parts and the interfaces of interaction between them without unnecessary detail. <br><br>  So the illustration below shows the structural diagram of the motherboard of a regular computer. <br><br><img src="https://habrastorage.org/webt/cp/ft/y1/cpfty1mlg6m4tpvqf857pha6sj8.png" width="800"><br>  <i><a href="https://ldasystem.com/files/mb/Asus_P5BW-MB.pdf">Block</a> diagram of the motherboard <a href="https://ldasystem.com/files/mb/Asus_P5BW-MB.pdf">ASUS P5BW-MB</a> .</i> <br><br>  We see all its basic elements and the connections between them in the most general form. <br><br>  In the case of network equipment, it will be a CPU, memory, a switching chip (also known as a batch processor, it is Forwarding Engine), PHY (it’s still not defined how to pronounce - “fi” or Fai ”in Eltex all tend to the second option), etc. . <br><br>  Eltex has several lines of equipment from STB to modular routers.  In large glands of operator level or DC, the Juniper and Forwarding Plane precepts are completely separate from Control, so the CPU does not participate in data transfer, but assumes intellectual functions.  For switching, there is a separate FE chip. <br><br>  More on this in the <a href="http://linkmeup.ru/blog/312.html">14th issue of the SDSM</a> . <br>  On the other hand, SOC routers and set-top boxes use SoC, which is quite enough for the functions that are expected from the device. <br><br>  Each type of device has its own structural scheme. <br><br>  You can lower the level of abstraction and remember that each microchip itself has a complex structure and corresponding <a href="">structural</a> and <a href="http://radiostorage.net/3382-mikroskhema-ba5302a-stereo-usilitel-nch-2-4watt-pri-5-12v.html">conceptual</a> schemes.  In general, the difference between the printed circuit board and the chip is that PCB with copper tracks is used as the substrate, and silicon oxide in the other. <br><br><h4>  Schematic diagram </h4><br>  After the structural scheme has been defined, it’s time to start choosing each specific component and developing a <b>concept</b> . <br><br>  This is a detailed device diagram with absolutely all the elements, the actual number of contacts and their connections.  This is usually a multi-page document in which the scheme is divided into many parts. <br><br>  But this is still the logic of the work - not wiring conductive connections on the board. <br><br>  Here is an example of a small piece of the motherboard concept: <br><br><img src="https://habrastorage.org/webt/o5/-x/7h/o5-x7h1ivgionbqbjglebx02vwm.png" width="800"><br>  <i>Part of the concept of the same motherboard <a href="https://ldasystem.com/files/mb/Asus_P5BW-MB.pdf">ASUS P5BW-MB</a> .</i> <br><br>  And here is an excerpt from the MES1124M switch circuit: <br><br><img src="https://habrastorage.org/webt/yx/o-/t-/yxo-t-hnef4ggmu7gn034mwzmui.jpeg" width="800"><br><br>  With some of the components, everything is relatively simple.  Roughly speaking, resistors and capacitors are selected at nominal.  Simple ASICs in their functions. <br><br>  However, the more complex the chip, the more questions and compromises arise. <br><br>  On the one hand, each supplier implements the same mechanisms in its own way.  On the other hand, a set of supported functions is also different for everyone. <br><br>  The most difficult is obviously the choice of processors - central and batch (FE).  And the latter is more difficult, because for the CPU it is enough to define the architecture, and then all the manufacturers do the same thing, and for the FE, the variations on the supported functionality and the language of communication with the chip are not limited. <br><br>  In addition, there are enough manufacturers on the market now: <br><br><ul><li>  Broadcom Series </li><li>  Marvell xpliant </li><li>  Barefoot tofino </li><li>  Mellanox Spectrum </li><li>  Innovium Teralynx </li><li>  Even Realtek </li></ul><br>  For switches, Eltex did not stop at one in the role of FE, but uses Broadcom, Marvell and Realtek. <br><br>  Both the switching chip for the switch and the SoC for any Wi-Fi point or STB is its heart, around which all other piping is built. <br><br>  When the bill goes to hundreds and thousands of legs, to understand how the chip works is worthy of scientific work.  Therefore, the manufacturer usually supplies some kind of experimental device with this chip.  It should not be flexible, compact, energy efficient — its only role is to show how to interact with the chip (besides thousands of pages of the SDK documentation). <br><br>  After that, the vendor of network equipment already thinks about how to attach these legs to their devices. <br><br>  By the way, as the software for the brownies and Fixed-size pieces of iron use this very SDK provided by the chip manufacturer.  In some cases, it is finished, and sometimes given to the user - as is. <br><br><hr><br>  Thus, at the stage of completing the concept, it becomes finally clear how the device will work and what components are used. <br><br><h4>  PCB layout </h4><br>  The next task is to place it all on a textolite board. <br><br>  Modern boards are multi-layered - up to 40 layers (which is more rare than general practice).  They are gradually increased in production - at first the scheme is etched out on the deepest inner layer, then one after another the next ones are etched and pressed with the existing ones.  The more layers, the smaller the thickness of each plate.  Accordingly, the relationship between the number of layers and the thickness of the board is non-linear. <br><blockquote>  In the simplest case - layer one.  In the simple case - there are four of them, and they are divided functionally: signal, power supply, grounding.  In complex cards, such as for switches, it is also an opportunity to multiply the available area for conductors without actually increasing the size, as well as to avoid induction between adjacent tracks on the same layer, passing next to each other. <br></blockquote><img src="https://habrastorage.org/webt/mf/tr/ts/mftrts3r1zmqj1b84ecdj8r_cuc.jpeg" width="800"><br>  <i>An example of a four-layer board: noticeably in the light, as on different layers, the conductive paths and grounding fill differ.</i> <br><br>  Naturally, different layers should interact with each other, that is, to have metallic contact, therefore, in the right places, the layers are drilled to the required depth (to which layer you need to drill).  If the diameter is greater than 0.2 mm, a standard drill is used, with smaller values, the laser is already. <br><br>  Further, this hole is metallized. <br><br>  In the photo, I highlighted how such vias look on the board. <br><br><img src="https://habrastorage.org/webt/uj/s5/ot/ujs5otiisvc2rxtbgmhea5jim6m.jpeg"><br>  <i>Vias.</i> <br><br><img src="https://habrastorage.org/webt/ut/mk/7a/utmk7awv50ig6cp6wtfoj42r-sw.png" width="800"><br>  <i>3D-model of a multilayer board and implementation of vias.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/924/9a9/d82/9249a9d82120799e66272f00db9ae2f6.jpg" width="800"><br>  <i>Slice of the board at the transition hole.</i> <br><br><img src="https://habrastorage.org/webt/st/wl/zf/stwlzfhz_mfnnkq9xaygklimo_g.png" width="800"><br><br>  A curious moment (which, by the way, occurs here at every step) - if a high-speed signal (10GE) passes through the via, say, from the upper layer and “dives” to the inner one, then there remains an unused portion of the hole between this inner and lower layers.  So let's say the stub part of the via.  To get rid of it from the back side of the board, such vias are drilled with a large drill to a certain depth to the required inner layer. <br><br>  A curious moment (which, by the way, occurs here at every step) - if you leave such a via as it is, the high-speed signal (10GE), diving from the upper layer to the inner one, will be reflected from the parasitic part (stub), and interference may occur transmitted interference, worsening the performance of the board up to complete malfunction. <br><br>  One possible solution to this problem that Eltex uses is backdrilling technology.  A counter opening of a larger diameter is drilled on the opposite side.  In this case, the signal is not reflected, but passes through. <br><br><img src="https://habrastorage.org/webt/cw/mp/zn/cwmpznd2ss61hk_ftxyvkzits1a.jpeg" width="258"><br><br>  Naturally, it turns out that in the place of such an orifice on one of the layers there can not be a path. <br><br>  However, the general recommendation is to avoid vias as much as possible, especially for high frequency signals. <br><br>  Until recently, I had the illusion that traces of tracks on printed circuit boards have long been done automatically.  It was difficult to imagine that kilometers of the thinnest tracks are drawn by hand. <br><br>  But first, in a <a href="http://linkmeup.ru/blog/388.html">podcast about virtualization,</a> Mr. Engineer, deeply absorbed in iron, reported in a tone of objection that now not a single product is able to adequately route, and now Eltex has become an example confirming this statement. <br><br>  Worse, initially there is not even a library of chips that could be thrown onto the workspace and connected with tracks.  The chip specification specifies the layout of the contact pads, which is manually recreated in the project. <br><br>  And if, for example, the chip has 1200 contacts, then the contacts themselves and the tracks from each are drawn manually. <br><br>  In general, modern platforms for developing boards have the functionality of autotrails, only for their adequate operation, it is necessary to set hundreds of rules in the case of a more or less complex scheme. <br><br>  Some of them are quite simple: <br><br><ul><li>  Width of conductive tracks.  There is a sea of ​​nuances.  But universal rules follow from Ohm's law: the lower the cross section, the higher the resistance and the greater the voltage drop, and, accordingly, the heating. </li><li>  Clearance width.  With different potentials in two conductors, even a dielectric can become a conductor.  And the more likely than the conductors closer. <br>  Thus, the width of the tracks and the gaps is a trade-off between risk and efficiency. <br>  By the way, there is a subtle point here: while all (no) Russia uses millimeters for calculating sizes, China (and not he alone) counts in miles. <br>  Mille - a thousandth of an inch or 0.0254 mm, respectively. <br>  This is where the imperial system of measures lurked us, as if 8 dimensions, hiding inside the elementary particles (I <i>wonder if I will manage to regret this belief in life</i> ). <br>  Therefore, situations are quite typical when working with Chinese manufacturers have to recalculate from one system to another.  Conveniently.  So at one time the Greeks transferred the numbers to the Babylonian system, because it was convenient to count in it, and then back to the Greek - because it was so accepted. <br></li></ul><br>  And the other part is less obvious. <br><br><ul><li>  It is not recommended to make turns of the tracks at an angle of 90 degrees - more correctly under 45 or rounded along the radius. <br><br>  Otherwise, the <a href="https://electronics.stackexchange.com/questions/202103/pcb-trace-electron-flow">current spreads unevenly</a> .  At high currents, this can cause local overheating and burnout of the track. <br><br>  In the case of dealing with a high-speed signal, it is necessary to flush the signal on the board as smoothly as possible to reduce its attenuation, and here it is not allowed to turn even at 45 degrees - just rounding. <br><br>  Eltex uses bend radius on the eye, which is more than enough. </li><li>  In some areas it is required that the length of the conductors be the same. <br>  One example would be connecting the RAM. <br><br>  The other is differential pairs connecting the high-speed port (10GE) to the PHY chip.  In this method, the signal is transmitted via two conductors, but one of them is inverted (with a different sign).  The receiver compares the two signals received by different paths, and not the signal of a single wire to ground.  In this case, electromagnetic interference affects two wires simultaneously, which increases stability, which is very important at such speeds. <br><br>  Obviously, in order for the receiver to have the same signal, this signal must come at the same time, respectively, and the length of the conductors must be the same. <br><br><img src="https://habrastorage.org/webt/jo/sw/yq/joswyq0f4c2jyw8gnwu7nvm0pvq.png" width="800"><br>  <i>CPU + DDR MES1124M cards.</i> <br><br><br><img src="https://habrastorage.org/webt/ob/qx/ot/obqxototsbascbj3j4d3niqktma.jpeg" width="800"><br>  <i>Fee, you're just a space!</i> <br><br>  This sometimes explains the strange shapes of the tracks on the boards.  This is nothing but the alignment of the lengths of the conductors between themselves. <br><br><br><img src="https://habrastorage.org/webt/o3/5y/4y/o35y4yrorwko74mv5muejjaaqau.jpeg" width="800"><br>  <i>Tracks linking the processor and RAM</i> <br><br>  The need for this has always been. <br><br><img src="https://habrastorage.org/files/c7b/462/104/c7b4621040384936be5da573232ceaad.jpg"><br>  <i>CRAY-1 vector supercomputer.</i> <br></li></ul><br>  Not only the paths of each of the thousands of tracks are determined manually, but also all vias, roundings, control of the same length of conductors where required (Read below about <a href="https://habr.com/ru/post/435990/">differential pairs</a> ). <br><br>  Pavel Bombizov, design engineer Eltex, showed how to select tracks, look at their length and compare with the length of its pair, how to choose a joint and smooth it along the radius, how to create contact pads of chips in the form of a uniform array of points. <br><br>  New housing components really need to be drawn by hand.  In the documentation for the chip manufacturer specifies the layout of the pads, their sizes and other information that needs to be redrawn into the library component.  Sometimes this is not so easy to do, since the number of contacts on a chip can reach several thousand, and the main thing here is not to be mistaken with their location and designation. <br><br>  However, once a component is drawn, it is brought into the library, and in the future it can be simply transferred to the workspace. <br><br>  That is, only new components are drawn that were not used in projects before.  The main part of the components is either already drawn or is available in the standard component library built into the CAD system. <br><br><img src="https://habrastorage.org/webt/st/5p/_b/st5p_b4_qrucgc7ruylacb0lbe8.jpeg" width="800"><br>  <i>Marvelovsky PHY chip on the reverse side - for estimating the number of contacts that need <b>to be</b> drawn <b>correctly</b> .</i> <br><blockquote>  During the tour, it was not very clear why Eltex hand-made alignments and bends.  Software for PCB layout has been able for a very long time at least in comparing the length of conductors, alignment, setting curvature parameters.  But later Eltex gave comments. <br>  Alignment of signals is done automatically, but it is easier and faster to do it manually.  It all depends on the case. <br><br>  For example, the memory, which in the photo of the <a href="https://habr.com/ru/post/435990/">Track linking the processor and RAM "is</a> divorced automatically, so it’s problematic to draw manually. <br>  But the diffpars in the picture of the Board <a href="https://habr.com/ru/post/435990/">, you are just a space! "</a> Aligned manually, and here you only need to align one and copy the alignment to all others. <br></blockquote>  That is, the design of the boards is still a colossal work, which requires the designer to be extremely accurate and focused. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to Pavel, the layout of one board goes away from the month. If it is a switch with a four-layer card - about one month. And for example, MES9032, having 20 layers, many nuances and requiring the solution of many constructive tasks, may require more than six months). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The final step in the design of the board is silk-screen printing - placement of component tags, connectors, input-output interfaces, and so on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is not only a mandatory requirement for the industrial development of boards, but also a kind of “code comments”: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to use the board, how to install the component, where is the power supply plus / minus, what the indicator shows, even how to position the board in the device (for example, a gyro sensor, for which is important the location of the axes).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this stage, there is already a complete understanding of how the board will look and what components where it will stand on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, the development of the device is not yet complete. </font><font style="vertical-align: inherit;">Even the printed circuit board can not yet be sent to production, because the results of the next step may require more changes.</font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculation of the hull and ventilation system </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Further (actually in parallel) the project is transferred to the designers of the building and the ventilation system. Obviously, these are related things, therefore one person (or department) deals with them. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this stage, the results of the previous stage are imported into SolidWorks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the point of view of the shape of the case, it is important to know the dimensions of the board, the location of the ports, indicators, buttons, antenna leads, and so on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the point of view of the ventilation system, the amount of heat emitted by the components, their size and location. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now a three-dimensional model of the device is being built together with the body and the inner gasket. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Based on heat dissipation, estimated air flow and experience, the designer places ventilation holes, radiators and partitions and starts the calculation.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But above all, the model is greatly simplified. </font><font style="vertical-align: inherit;">Cleaned:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Layered board </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tracks </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vias </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mounting holes </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Components that emit negligible heat and do not affect air flow. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The components themselves are also simplified down to parallelepipeds. </font></font></li></ul><br><img src="https://habrastorage.org/webt/8y/k9/2e/8yk92e-0eiy5erxdgrhdii03gro.jpeg" width="800"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplified model MES1124M.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The temperature map, the direction of air flow, their speed and all this for different time intervals are calculated for quite a long time. For a simple switchboard or STB on a near-video card, this takes several hours. And for the ME5000 modular router - 2 weeks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unfortunately, the amazingly beautiful results of calculations with air flow trajectories and temperature maps, which aroused the lively interest of any engineer, were not allowed to be published. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alas, Eltex does not have a sufficient need for a computing cluster, so the desktop designer works for the benefit of the customer. I forgot to ask, but it would not be more convenient to contact public clouds here - every self-respecting provider already has a farm with a GPU (or plans to).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Based on the first results, the designer tries various configurations of radiators, partitions, fans, and openings within the limits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is not always possible, therefore, in some cases, you have to return the project a step back and review the location of the elements and even their models. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This iterative process continues until the calculations show a stable temperature. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, the cooling system is one of the compromise solutions between energy efficiency and nominal temperature conditions.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, in TV set-top boxes, the cooler will look inappropriate. At the same time, no one expects passive cooling from the fifteen-unit chassis. By the way, there are 6 such fans in it, each of which, at maximum speed, comes off the table surface: </font></font><br><br><img src="https://habrastorage.org/webt/yv/ul/z8/yvulz8p8cuhycltxrcizz5wwxsw.jpeg" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I want to </font></font><a href="https://habr.com/company/yandex/blog/258823/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remember Yandex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which, thanks to competent planning of air flows in servers (not only this, of course) achieved in their DC free-cooling and PUE close to one . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, and then comes the stage of testing the theory of practice. Before the serial production of the case in the Eltex itself, a trial version is printed on the 3D printer; a prototype of the board is placed in it. And then the device is subjected to numerous tests. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here you can find inconsistencies of the case with the board, errors in the arrangement of elements,</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usability</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and most importantly, to measure the real temperature of the chips and in different parts of the board, finding out how the model corresponds to reality. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to Eltex employees, in most cases no abnormalities are detected. However, if the tests did not pass, the model has to be corrected - either they didn’t take something into account, or an error crept into the input data, for example, the heat release of the chip was incorrectly entered. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As for the model, then as always - it is a compromise between its proximity to reality and the efficiency of calculations. The simulated object needs to be simplified as much as possible, but no more.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the tests are completed, the hull is approved, the device is working properly, it starts up in a series. </font></font><br><br><img src="https://habrastorage.org/webt/28/10/zp/2810zp5l75kkopngqx8vpikkkxc.jpeg" width="800"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3d model of MES1124M in the case.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plastic cases are made mainly in China. Metal bending and we seem to be able, though not always, as Eltex tells. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multilayer boards are also produced in Asia, although we also have plants in Russia. This choice is due to several reasons. For example, technical process capabilities: our transition holes of 0.1 mm are not yet able to do. Product stability and predictable delivery times are other reasons. Well, nowhere to put the fact that production in Asia is still cheaper than in Russia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All crumbling and microchips are also from there. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, all this is already assembled on the assembly line in Novosibirsk. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To do this, create:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assembly drawing on the board, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stencils for applying solder paste on the machine, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> component installer program: what, how and where to install </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is all expected to do the same guys that are engaged in the development. </font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It looks like a printed circuit board made in China. </font></font><br><br><img src="https://habrastorage.org/webt/yt/oa/qb/ytoaqb2kjsqyabhb-2e1kj7v6xw.jpeg" width="800"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switch Board MES1124M. </font><font style="vertical-align: inherit;">On it, I noted the key components: CPU and memory, FE and PHY chips, Downlink and Uplink ports, and what's interesting is transformers. </font><font style="vertical-align: inherit;">Their role here is to isolate the connector contact circuits from the rest of the switch and housing circuits and, as a result, protect expensive PHY chips and packet switching chips. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1500 VAC insulation is the minimum requirement of the IEEE802.3 standard, so if 220 VAC hits a port (for example, through a twisted pair cable if the insulation of the cable is damaged), nothing will burn - 220 VAC cannot penetrate.</font></font><br><br> Однако трансформатор не может защитить от электростатического разряда, так как разряд с первичной стороны трансформатора наводится на цепи на вторичной стороне. Защита от электростатики выполняется другими средствами.</i> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As for import substitution, alas, we have to admit that further wiring of printed circuit boards and assembly / soldering of the finished device, we have not gone. All microchips are still being purchased in Asia. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eltex had (and still has) experience with Baikals as central processors. Interaction with Baikal Electronics experts is carried out when creating equipment for government agencies. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, with packet processors (FE), the situation has not changed - we still do not know how. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, as far as I know, we are not trying.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eltex says that I am mistaken, but without details, alas. Unless, of course, it's not about </font></font><a href="https://www.milandr.ru/upload/iblock/cb2/cb243724d0ae64b2a0fe9f64336bca55.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Milandra</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 's </font><a href="https://www.milandr.ru/upload/iblock/cb2/cb243724d0ae64b2a0fe9f64336bca55.pdf"><font style="vertical-align: inherit;">chips</font></a><font style="vertical-align: inherit;"> , which are certainly curious, but still far from the bleeding edge.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, this time we had the opportunity to speak with Alexander Evgenievich Mokhov, the head of the laboratory of Ethernet Technology for the second time. </font><font style="vertical-align: inherit;">In a sense, MES switches and ME5000 routers come out of his hands. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last time we were scouts from Huawei, which we were not warned in advance. </font><font style="vertical-align: inherit;">And now the visit was coordinated in advance, and guests from understandable places. </font><font style="vertical-align: inherit;">Therefore, instead of mistrustful phrases, a private conversation turned out, from which it became clear that, in general, Eltex followed the best practices in the construction of modular devices. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps essentially nothing to add here.</font></font><br><br><hr><br><h2>  useful links </h2><br><ul><li> <a href="http://stm32.chrns.com/post/151459703734/pcbrules"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCB layout</font></font></a> </li><li> <a href="https://habr.com/post/414141/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 rules for the design of printed circuit boards</font></font></a> </li><li> <a href="https://pcbdesigner.ru/pcb/montazh-pechatnykh-plat/avtomatizirovannaya-pajka-i-pajka-volnoj-pripoya-v-texnologii-skvoznogo-montazha-pechatnyx-plat.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automated wave soldering and wave soldering in the technology of through mounting of printed circuit boards</font></font></a> </li><li> <a href="https://habr.com/post/413955/">Полный цикл разработки IoT устройства управления подогревом бассейна на ESP8266 в среде Arduino</a> </li><li> <a href="http://we.easyelectronics.ru/plis/softovyy-phy-dlya-ethernet-10base-t.html">Софтовый PHY для Ethernet 10BASE-T</a> </li><li> <a href="http://www.nanometer.ru/2011/09/22/nanotechnology_262064.html">Современные чипы – взгляд изнутри</a> </li><li> <a href="https://habr.com/company/intel/blog/110234/">От песка до процессора</a> </li><li> <a href="https://www.milandr.ru/upload/iblock/cb2/cb243724d0ae64b2a0fe9f64336bca55.pdf">Перспективы развития Ethernet решений</a> </li><li> <a href="https://www.milandr.ru/upload/smi/perspektivnyy_kommutator_seti_ethernet_ot_kompaniimilandr.pdf">Перспективный коммутатор сети Ethernet от компании «Миландр»</a> </li></ul><br><hr><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In terms of technology, the excursion was excellent. Personally, it was interesting for me to plunge into the processes, besides, it made me read a little about this topic myself. A few things were real discoveries, others just put everything in its place. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite the ambiguous attitude of both engineers of operators and ordinary users to Eltex, I am glad that we have people who are able to create such things, create them, and are not afraid to talk about them. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During this time, the modular router has gone out of development and is working on the network of an unnamed customer. If there are happy engineers who exploit them, write comments.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to the marketing department of Eltex, today, in addition to Russia, their equipment is supplied to the CIS countries, Europe, the Middle East, North and South America, and Southeast Asia. </font><font style="vertical-align: inherit;">The greatest demand in the foreign market is used by broadband access equipment for telecom operators. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, we wish our producer an active and productive expansion into the international market - only there healthy competition poses real challenges.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If you bring something new to the network world and you have something to show and tell, we will gladly visit you too. </font></font><br></blockquote><hr><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thank you </font></font></h4><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maria Mishchenko</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eltex marketing specialist and our guide.</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Spitsyn</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - head of the Moscow office of Eltex Communications and initiator of the tour.</font></font></li><li> <b>Павел Бомбизов</b> — инженер-конструктор Элтекс (проектирование плат) </li><li> <b>Алексей Филон</b> — инженер-конструктор Элтекс (проектирование корпусов и системы вентиляции) </li><li> <b>Сергей Игонин</b> — начальник участка SMD Элтекс (производственная линия) </li><li> <b>Вячеслав Горбач</b> — инженер-программист Элтекс (лаборатория Hardware, рассказ про использование SDK для SoC) </li><li> <b>Александр Мохов</b> — начальник лаборатории Ethernet Technоlogy Элтекс (разработка сетевого оборудования и взаимодействие с производителями чипов) </li><li> <b>Роман Гурьев</b> — инженер-электронщик (за исправление неточностей) </li><li> <b>Дмитрий Булыгин</b> — инженер связи (за знакомство с Артёмом и замечания по читаемости текста) </li><li> <b>Сергей Луньков</b> — сетевой инженер (за компанию) </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Natalya Astashenko</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tester (for the company and amendments to the article)</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Purtov</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - student (for company)</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pavel Ostapenko</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Communications Engineer (for photos that were not taken and amendments to the article)</font></font></li></ul></div>