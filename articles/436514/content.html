<div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  Recently, people are more willing to watch social networking videos than browse through photos.  Storis on Instagram gains 3-4 times more views than just posted a photo. <br><br>  And of course, we do not cease to forget that social networks not only show themselves, look at others, but also promote their products, services, etc.  We have long learned to post in vkontakte svezhepubilirovannuyu news from the site.  And what if you go on?  What if you submit this information as a video?  Or lay out interesting video story instagram to attract more attention of the audience? <br><br>  So I came up with the idea of ​​creating a library that would allow creating short videos from photos, text and animation of these objects.  Yes, someone can say that the services that allow you to do this already exist and why invent a bicycle?  First, I want to; secondly, I can; thirdly, it will be free of charge. <br><br>  This article is about how to work with the library, how to create your own story from PHP. <br><a name="habracut"></a><br><h2>  Restrictions </h2><br>  Immediately it should be said that the library uses FFmpeg to generate the final video file.  FFmpeg must be installed on the server.  Perhaps in the future, there will be an option to generate a story as a gif-file, but for myself I chose the video file as the result of the work. <br><br><h2>  Training </h2><br>  The library is installed through the composer <br><br><pre><code class="bash hljs">composer require borodin-vasiliy/php-stories</code> </pre> <br><h2>  Create story </h2><br>  It is time to create your own story.  For example, we want to see a background photo of a kitten, which is a little closer throughout the whole story and display 2 text on it with an animation of appearance.  Easy! <br><br><div class="spoiler">  <b class="spoiler_title">Initialization Story</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Мы хотим создать 5 секундное сторис размерами 720x1280 $stories = new Stories([ "width" =&gt; 720, "height" =&gt; 1280, "duration" =&gt; 5 ]);</span></span></code> </pre><br></div></div><br>  As you can see, all parameters are passed as an array.  At the moment, you can change: <br><br><ul><li>  "Width" - The width of the color in pixels </li><li>  "Height" - height in pixels </li><li>  "Duration" - Duration in seconds </li><li>  "Fps" - The number of frames per second, according to the standard - 30 </li></ul><br>  Next, we need to add 3 objects (picture and 2 texts) on our future story.  At the moment, the library allows you to add 4 types of different objects - a picture, text, elex, a rectangle.  Each object has its own method, the method argument is an array of the parameters of the object being added. <br><br>  Objects have as general parameters: <br><br><ul><li>  "Top" - the position of the object from the top edge of the color </li><li>  "Left" - the position of the element from the left edge of the color </li><li>  "Opacity" - transparency, as in css [0 ... 1] </li><li>  "Rotate" - the angle of rotation of the object [0 ... 359] </li><li>  "Z-index" - a layer, like z-index in css - the more, the higher the layer on the frame will be the element </li><li>  "Start" is the second when the item should be added to the story </li><li>  "End" - the second when the item should be removed from the story </li></ul><br>  So are unique for each type of object, for example, for a picture: <br><br><ul><li>  "Path" - The path to the image that we want to add </li><li>  “Scale” - Image size multiplier (approximation) </li></ul><br><div class="spoiler">  <b class="spoiler_title">Adding pictures to the story</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Путь до файла с котиком $main_image = $dir."/images/1.jpg"; // Получим размеры картинки) list($image_width, $image_height) = getimagesize($main_image); // Посчитаем, каким должно быть приближение для картинки, что бы она покрыла весь сторис $image_start_scale = round(1280 / $image_height, 1); // Добавление картинки $stories-&gt;addImage([ "path" =&gt; $main_image, "top" =&gt; round(-1 * ($image_height * $image_start_scale - $stories_height) / 2), // Вычислим параметр отступа сверху при текущем приближении "left" =&gt; round(-1 * ($image_width * $image_start_scale - $stories_width) / 2), // Вычислим параметр отступа слева при текущем приближении "scale" =&gt; $image_start_scale ]);</span></span></code> </pre><br></div></div><br>  Done!  If you now generate a story, then 5 seconds we will admire the cat.  But I promised that there will be an animation, let's add it. <br><br>  An animation for an object is added using a separate method whose argument is an array of parameters to which the object should come.  Animations for one object can be any number.  It is worth saying that the syntax of the library implies the use of the Fluent Interface. <br><br><div class="spoiler">  <b class="spoiler_title">Adding pictures and animations</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Путь до файла с котиком $main_image = $dir."/images/1.jpg"; // Получим размеры картинки) list($image_width, $image_height) = getimagesize($main_image); // Посчитаем, каким должно быть приближение для картинки, что бы она покрыла весь сторис $image_start_scale = round(1280 / $image_height, 1); // $image_end_scale = $image_start_scale + 0.5; // Добавление картинки с анимацией $stories-&gt;addImage([ "path" =&gt; $main_image, "top" =&gt; round(-1 * ($image_height * $image_start_scale - $stories_height) / 2), // Вычислим параметр отступа сверху при текущем приближении "left" =&gt; round(-1 * ($image_width * $image_start_scale - $stories_width) / 2), // Вычислим параметр отступа слева при текущем приближении "scale" =&gt; $image_start_scale ])-&gt;addAnimation([ "top" =&gt; round(-1 * ($image_height * $image_end_scale - $stories_height) / 2), // Вычислим финальное местоположение картинки с учетом финального приближения "left" =&gt; round(-1 * ($image_width * $image_end_scale - $stories_width) / 2),// Вычислим финальное местоположение картинки с учетом финального приближения "scale" =&gt; $image_end_scale, ]);</span></span></code> </pre><br></div></div><br>  As you can see, the addAnimation method is used to add animation.  Required parameters for animation: <br><br><ul><li>  “Start” - the second when the animation should start.  If not specified, the animation will start when the object is added. </li><li>  "Duration" - the duration of the animation in seconds </li></ul><br>  Array of parameters on which it can affect animation: <br><br><ul><li>  "Top" </li><li>  "Left" </li><li>  "Opacity" </li><li>  "Rotate" </li><li>  "Scale" </li><li>  "Width" </li><li>  "Height" </li></ul><br><div class="spoiler">  <b class="spoiler_title">Adding text</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Добавление заголовка $stories-&gt;addText([ "text" =&gt; "Hello world!", "path" =&gt; $dir."/fonts/helvetica.ttf", "size" =&gt; 130, "color" =&gt; "#ffffff", "width" =&gt; 620, "top" =&gt; 200, "left" =&gt; 50, "opacity" =&gt; 0, "shadow" =&gt; [ "color" =&gt; "#000000", "top" =&gt; 4, "left" =&gt; 4 ] ])-&gt;addAnimation([ "duration" =&gt; 1, "opacity" =&gt; 1 ])-&gt;addAnimation([ "start" =&gt; 4.5, "duration" =&gt; 0.5, "opacity" =&gt; 0 ]); // Добавление текста $stories-&gt;addText([ "text" =&gt; "This is a test of function adding text", "path" =&gt; $dir."/fonts/helvetica.ttf", "size" =&gt; 100, "color" =&gt; "#ffffff", "width" =&gt; 620, "top" =&gt; 750, "left" =&gt; 50, "start" =&gt; 0.5, "opacity" =&gt; 0, "shadow" =&gt; [ "color" =&gt; "#000000", "top" =&gt; 4, "left" =&gt; 4 ] ])-&gt;addAnimation([ "duration" =&gt; 1, "opacity" =&gt; 1 ])-&gt;addAnimation([ "start" =&gt; 4.5, "duration" =&gt; 0.5, "opacity" =&gt; 0 ]);</span></span></code> </pre><br></div></div><br>  The text has its own unique parameters: <br><br><ul><li>  “Text” - the text you want to display is required </li><li>  "Path" - the path to the font (.ttf) - required </li><li>  "Size" - font size </li><li>  "Color" - color, for example "#ffffff" </li><li>  "Width" - the width of the block of text, if specified, the text will automatically be split into lines </li><li>  “Align” - text alignment [left, center, right] </li><li>  "Shadow" - shadow </li></ul><br>  Shadow is also an array of parameters: <br><br><ul><li>  "Color" - the color of the shadow </li><li>  "Top" - indent from above </li><li>  "Left" - left indent </li></ul><br><div class="spoiler">  <b class="spoiler_title">Storis generation</b> <div class="spoiler_text"><pre> <code class="php hljs">$file_hash = $stories-&gt;generate(<span class="hljs-string"><span class="hljs-string">"/tmp"</span></span>);</code> </pre><br></div></div><br>  As a result, we get the name of the file that is in the temporary folder passed as an argument. <br><br><h2>  Work result </h2><br><img src="https://habrastorage.org/webt/kh/yg/2c/khyg2cy_9yemzeksskxu9jsd1ro.gif"><br><br>  It should be said that the speed of creating a story is not great, on a good computer a 5 second video is generated on the order of a minute, on a simple server more than 3 minutes. <br><br><h2>  Development plans </h2><br><ul><li>  Adding standard animation scripts to shorten code </li><li>  Text animations (appearing line by line, etc.) </li><li>  Background for text </li></ul><br>  I hope someone like this library will be useful.  I will be glad to hear criticism and suggestions in the functional. <br><br>  <a href="https://github.com/borodin-vasiliy/php-stories">Git repository</a> </div>