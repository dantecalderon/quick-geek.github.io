<div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/f5/nk/9x/f5nk9xtvbba6zicqjt_99apnkdu.png"><br><br>  Hello colleagues.  Last time, in the article <a href="https://habr.com/ru/company/tssolution/blog/431146/">“1.</a>  <a href="https://habr.com/ru/company/tssolution/blog/431146/">Check Point Log Analysis: The Official Check Point App for Splunk ”</a> we discussed parsing the Security Gateway logs based on the official app in the Splunk logging system.  In conclusion, we came to the conclusion that at least the application as a quick solution is very convenient, but at this stage it is unfinished - there are not a large number of dashboards that are very important for the security engineer to understand in order to understand what is happening in the organization from the point of view of information security.  In this article we will discuss the possibilities of viewing and analyzing logs with SmartEvent functionality, which you should pay attention to, and consider what options for automating events are available. <br><a name="habracut"></a><br>  SmartEvent compares logs from all Check Point gateways to identify suspicious activity, track trends and investigate security incidents.  Data analysis takes place in real time, which allows you to quickly respond to an event.  SmartEvent is included in the list of products on the management server; however, it requires a separate license, consists of views and reports that you can create yourself or use pre-installed ones. <br><br>  In fact, in order for the functionality to work, you just need to enable the blade in the management server settings, you immediately get a set of reports that can be generated, besides there is an opportunity to create new reports depending on your tasks, and the rules for automating events are configured in the SmartEvent Settings &amp; Policy snap-in. <br><br>  Consider the standard SmartEvent reports first.  I also draw your attention to the fact that the version of the GAIA R80.20 operating system is on the management server. <br><br><h3>  SmartEvent Standard Reports </h3><br>  Thanks to a large number of predefined, easily customizable security events, you can run SmartEvent and start collecting threat information in minutes.  Immediately after activating the blade, you get the opportunity to create a large number of standard SmartEvent reports, which you can see in the image below. <br><br><img src="https://habrastorage.org/webt/ny/lp/3u/nylp3udwjrgwsmdy2j6wemuqalw.png"><br><br>  Integrated reporting allows you to implement a continuous process of protection.  And this is a prerequisite for information security. <br>  Let's walk with a small overview of the main views and reports. <br><br>  <b>1) Threat Prevention</b> <br><br>  The most interesting information in this review is a list of all IPS signatures that were only detected, but were not blocked.  According to the security policy settings, many signatures can only be detected, this is not desirable, but even worse, when these signatures were seen in traffic and no further action is taken, there can always be such an event variant that this particular signature can be a threat to your infrastructure. therefore, an engineer must look through this report and take action on these events, for example, transfer signatures to Prevent mode.  You should also check the hosts that the Security Gateway has identified as infected machines. <br><br><img src="https://habrastorage.org/webt/cq/hu/i4/cqhui43q5kmiq93musegf2-u6bg.png"><br><br>  <b>2) Security Checkup Summary</b> <br><br>  I think if you already have Check Point or you have tested this product, then you know this report for sure.  Security Checkup Summary gives you a complete picture of the state of information security in your organization and unwanted processes that occur in your infrastructure.  However, I cannot advise using the report as a daily material for the work, as a huge amount of information will simply interfere and distract.  It is more sensible to generate a report with a certain periodicity for comparison with its previous version in order to make sure that changes in the security policy brought positive actions. <br><br>  <b>3) User Activity</b> <br><br>  A very convenient report of internal user activity, however, from my point of view, it is more convenient to show separately the statistics of the use of High Risk Applications by users, and not just a list of all applications. <br><br><img src="https://habrastorage.org/webt/wn/r_/1y/wnr_1yaluw7qs-p1dxrndqlh7xq.png"><br><br><img src="https://habrastorage.org/webt/1a/vl/d6/1avld6v59puybqc4pbdn5yws5ny.png"><br><br>  <b>4) Intrusion Prevention System (IPS)</b> <br><br>  A smart report on the monitoring of the IPS system, for me the most interesting table is Top Services and Top Connections.  This report helps a lot to properly optimize the IPS system for services, as a result, based on this report, you can identify the actions of attackers to find vulnerabilities in your infrastructure, and then in turn you can correctly configure the Threat Prevention policy for services without disrupting business processes. <br><br><img src="https://habrastorage.org/webt/md/ff/ov/mdffovf9abt9cb5ura4_qclcoz0.png"><br><br>  <b>5) Compliance Blade</b> <br><br>  The Check Point Compliance Software Blade is an integrated solution for monitoring compliance with the requirements of existing IT security techniques. <br>  This report contains suggestions for changing policies to comply with best practice and basic IS standards.  If you do not know how to secure your infrastructure properly, then these recommendations give a good idea of ​​how to configure the firewall, however, you should understand which processes should be blocked and which should not be applied to your organization.  I'm not sure that it will be interesting for you to see this report every day, but it’s definitely worth reading at least once. <br><br><img src="https://habrastorage.org/webt/0f/e1/3j/0fe13j1uuquw7fd7paohsa9bjns.png"><br><br>  <b>6) Cloud Services</b> <br><br>  In the report on the use of cloud applications, you will see statistics on the use of cloud services, as a rule, the most interesting thing here is of course the use of cloud disks, and how many MB are downloaded and downloaded, in the report you will see only summary statistics, it is more important to watch how much traffic users merge from jobs in cloud drives, since these can be documents that make up confidential information. <br><br><img src="https://habrastorage.org/webt/ga/dp/vl/gadpvl9lby21tvz6vwkw68xanzq.png"><br><br>  <b>7) Application and URL Filtering</b> <br><br>  I have no doubt that “Application and URL Filtering” is the most popular preset report.  “Application and URL Filtering” contains information about visits to both potentially dangerous and most popular sites.  The statistics on the most visited categories, sites, and the amount of traffic for each individual user are collected, a clear understanding of what employees are doing comes.  An indispensable document when drafting and updating rules for application control and URL filtering blades. <br><br><img src="https://habrastorage.org/webt/1j/fg/gx/1jfggxi3fajws69wf8ahakdlnse.png"><br><br>  You can also read the article <a href="https://habr.com/ru/company/tssolution/blog/355010/">“Check Point Dashboards, which is what I love,”</a> in which you can get acquainted in more detail with dashboards, functional capabilities, and accordingly, why they love it so much. <br><br><h3>  Create your report </h3><br>  Although the preset reports are very convenient, you can’t put all the mushrooms in one basket.  Almost all engineers are faced with the need to customize their reports, which will contain information potentially important for the performance of their work functions, following the characteristics of the device and the nature of the work of the organization. <br><br>  Once we mentioned the desire to collect statistics on the amount of traffic that goes to cloud applications, let's try to create a typical example - a table.  Let's create a report on traffic uploaded to cloud drives, which will include information on users, IP addresses, and the amount of traffic sent to cloud applications. <br><br>  Create a report - select the <b>New Report</b> menu, set the name <b>Cloud Service Traffic</b> . <br><br><img src="https://habrastorage.org/webt/hd/ee/kq/hdeekqqgxog3d0kbjqu9-g1uafi.png"><br><br>  Next, add a table to an empty page: <b>Add Widget -&gt; Table</b> . <br>  Set the name of the table, for example <b>'Cloud Table'</b> , then leave the type <b>Statistical Table</b> .  In this case, the calculated summarized statistical data will be shown, if you select the <b>Log Table</b> , the table will consist of data for each individual event, in the context of our task, we do not need this option. <br><br>  Next, you need to decide on what parameters the table will be built, you need to see the user, the name of the cloud application where the data is downloaded, the amount of outgoing traffic, and also consider the option when the user name is missing, that is, you need to add an additional column with the IP address from which There is a connection.  Accordingly, select the parameters <b>Source</b> , <b>User</b> , <b>Application Name</b> , <b>Traffic Sent Bytes</b> . <br><br><img src="https://habrastorage.org/webt/rs/-y/oy/rs-yoy1jazefy9v-rmvyiyykfa4.png"><br><br>  Next you need to properly configure and sort the parameters.  As the first parameter, we choose Source, depending on the size of the organization, we set the maximum number of values ​​( <b>Number of values</b> ), I indicated 100, we sort by our own value, since this is the main parameter that does not depend on the other parameters. <br><br><img src="https://habrastorage.org/webt/uu/eh/xa/uuehxazw8kiz2d4jkp3mfiihurs.png"><br><br>  Next, set up in a similar way the parameters <b>User</b> , <b>Application Name</b> and <b>Traffic sent bytes</b> .  Just sort the results by Source. <br><br><img src="https://habrastorage.org/webt/xa/w9/9g/xaw99gnmuxctr2_ad3nl1fvajqm.png"><br><br><img src="https://habrastorage.org/webt/b7/ir/8a/b7ir8ax_u6ioewx3mz7wwmathde.png"><br><br><img src="https://habrastorage.org/webt/wd/cx/4j/wdcx4jkzwy9lk762d-xveqwk1kc.png"><br><br>  We set the structure, as a result, a table will be issued for all users and applications, of which there are a huge number, and we are only interested in cloud applications, to solve this question, we will set a filter (an icon located on the same level as the Title). <br><br>  For the field, select the <b>Application Category</b> , the <b>Equals</b> operation, set the group name — <b>File Storage and Sharing</b> . <br><br><img src="https://habrastorage.org/webt/xl/vb/y2/xlvby2ntgmzlh8kjpweq3jns3qm.png"><br><br>  After that we stretch the table to the whole page, save the changes - Done.  Also, if we have a large number of results in the table, and everything does not fit on one page, you should install the extension of the results on new pages, for this we go in <b>Options -&gt; View Settings</b> . <br><br><img src="https://habrastorage.org/webt/jr/3k/an/jr3kan7wqum9_ax4l9osbaf3cqo.png"><br><br>  As a result, we get a ready-made table, you can study the results. <br><br><img src="https://habrastorage.org/webt/5k/bo/il/5kboil6aaefahjacrddmrmd73gc.png"><br><br>  You can also customize graphs, charts, and so on.  The principle is about the same everywhere.  The toolkit for the average user is fairly transparent and does not require special talents.  It remains to consider the automation functionality in SmartEvent, which is not very popular, but from my point of view, plays an important role in ensuring information security processes. <br><br><h3>  SmartEvent Automation </h3><br>  In SmartEvent, there is a special utility with the same name for managing the blade, which allows you to customize the generation and correction of security events, and automate actions to these events. <br><br>  The management tree is divided into 2 branches: Event Policy and General Settings.  All events detected by SmartEvent are categorized by category in the event policy branch.  When you select an event, its custom properties are displayed in the details panel, and the event description is displayed in the description panel.  Clearing the property removes this type of event from the policy during the next installation. <br><br>  In General Settings, the initial settings are set, but most likely the only thing that will be needed there is this: <br><br><ol><li>  the Offline Jobs setting is the upload of old logs to SmartEvent, which were either not on the management server, or SmartEvent was turned on after these logs were created. </li><li>  Create automatic actions in Automatic Reactions. </li></ol><br>  For each policy, you can set an automatic action. <br>  An automatic action is the execution of a specified set of actions subject to the execution of an event, which includes: <br><br><ol><li>  Email sending </li><li>  Sending SNMP traps </li><li>  Source IP Blocking </li><li>  Block attack (Block Event activity) </li><li>  Execute external script. </li></ol><br><img src="https://habrastorage.org/webt/wx/bj/mi/wxbjmibjraeg_npv44mvimnp4bk.png"><br><br>  Each option is quite applicable in real life depending on the event on which you set the automatic action, for example, for some events of a controversial nature, you can set the action for sending the letter to the engineer, and for other events blocking the IP address, for example, in case of an attempt to scan your network or virus attack.  Automatic action is superimposed in the event properties. <br><br><img src="https://habrastorage.org/webt/37/gg/9c/37gg9cvxz-xhodcuy4lfstqt13a.png"><br><br>  You can configure the script to run on a specific event, but in this mode, I believe that this is not very convenient and appropriate, since the functionality is rather limited, and you cannot configure the input to the script, since it is required for certain tasks, you can easily make a mistake because the triviality of the system, so everything related to scripts is better left to logging systems like Splunk + Check Point API, a greater scope of possibilities and practically unlimited functionality. <br><br><h3>  Conclusion </h3><br>  Let's highlight the main reports that should be of interest to the information security engineer: <br><br><ol><li>  Threat prevention </li><li>  Intrusion Prevention System (IPS) </li><li>  Application and URL Filtering </li><li>  Custom reports </li></ol><br>  If we consider SmartEvent as a simple logging and analysis system, which also provides all the necessary reports with minimal pre-settings, then this is the ideal solution. <br>  A trivial interface to create your reports, all that is needed for the subsequent analysis of security incidents, and the maintenance of information security processes in the organization.  What is a continuous process and requires the continued participation of the engineer.  But if we consider this product as a SIEM solution, then it has shortcomings, limited functionality for automation and event correlation, is difficult to configure, and it is impossible to build on this basis a single center for monitoring and managing the information security system in the organization.  Consider all the details and compare the various solutions for analyzing Check Point logs in the following articles. </div>