<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forwarding requests from Apache to Payara Server 5 in Ubuntu</title>
  <meta name="description" content="In this article series, we will try to give an overview of the basics of using Payara Server in production using Apache Web Server (httpd) and Ubuntu....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Forwarding requests from Apache to Payara Server 5 in Ubuntu</h1><div class="post__text post__text-html js-mediator-article"><p>  In this article series, we will try to give an overview of the basics of using Payara Server in production using Apache Web Server (httpd) and Ubuntu. <a name="habracut"></a>  Many of the concepts do not rely on the tools we use here, and can be applied to other scenarios. <br></p><br>  Our goal is to configure the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbf/2c9/449/cbf2c9449f2d4a04fd2e682f53837fcc.jpg" alt="image"><br><p>  Here we have an Apache web server that will be available to our users.  Their requests will be sent to one of the two copies of the Payara server.  Here we will look at using JSESSIONID cookie-based session hooking to ensure that each user interacts with the same Payara server, as well as session replication to ensure that if one Payara server goes down, another will be able to handle existing sessions. no problem. <br></p><br><p>  We assume that the Apache web server is already installed and configured.  Our next step is to set up request forwarding to send traffic to Payara Server. <br></p><br><h2>  What is forwarding requests? </h2><br><p>  Forwarding requests (or proxies) is when the server that receives web traffic sends it to another destination.  They can be used to hide the user's real location, not to see internal systems or control performance.  Like most web servers, the Apache web server can be supplemented with modules that give it the ability to forward requests to the server and send responses through a proxy.  This means that you can use Apache as an intermediary, which eliminates the need to specify port numbers or exact IP addresses and allows the user to receive replies from the same server (instead of clicking on <a href="http://localhost/">localhost</a> and having the address bar labeled <a href="http://localhost/">localhost</a> : 8080 ). <br></p><br><h2>  Configure forward requests between the Apache web server and Payara server <br></h2><br><p>  In this post we will look at the package available in the Ubuntu repository.  The Ubuntu package contains Apache binaries, but also has additional ‚Äúhelper tools‚Äù for managing configuration files.  In Ubuntu 18, the two modules that we need to add to Apache are part of the apache2 package that we installed earlier.  It can be installed from the repository using: <br><br></p><pre><code class="plaintext hljs">sudo apt install apache2</code> </pre> <br>  <u>Please note that before Ubuntu 16.04 you will need to use ‚Äúapt-get‚Äù instead of ‚Äúapt‚Äù.</u> <br><br>  We will install two modules to enable basic transfer of http requests - mod_proxy and mod_proxy_http.  In Ubuntu, helper tools control the installation of these modules ‚Äî to make it even easier, tools will search for their dependencies and include them.  It is useful that mod_proxy_http requires mod_proxy to work, which means that our team looks like this: <br><br><pre> <code class="plaintext hljs">sudo a2enmod proxy_http</code> </pre><br><h3>  Please note that in these commands we can omit the mod_ prefix. </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/db1/fb3/9d0/db1fb39d075e035381a244e3fa1bb333.png" alt="image"><br><p><br>  If you want to disable the module, for a2enmod there is an auxiliary tool called a2dismod, which is used in the same way.  The tool found a dependency and also included mod_proxy.  If you had several modules that you wanted to activate, you can add them after proxy_http, separated by spaces ... <br></p><br><p>  We will restart the server later, as we also need to change the configuration. <br></p><br><p>  The apache2 package in Ubuntu has an example site configuration called ‚Äú000-default‚Äù.  The configuration file for this site is located in the / etc / apache2 / sites-available folder and contains a symbolic link to the sites-enabled folder. <br></p><br><h2>  Apache configuration file structure <br></h2><br><p>  As a rule, you will see that online manuals refer to httpd.conf as a configuration file for editing.  This is just the default parent configuration file.  On Debian / Ubuntu systems (and their derivatives, such as Linux Mint), the search file is apache2.conf. <br></p><br><p>  This file is read, and its directives are applied from top to bottom, so if two different values ‚Äã‚Äãare given for the same property, the second will be used.  (More precisely, the first will be applied only to read the second parameter). <br></p><br><p>  This file can also specifically "include" files and folders (note that wildcards also work).  They will be read and combined with the main configuration in the place where it is written ‚Äúinclude‚Äù.  Thus, the most recent line in the main configuration file (unless it indicates another file) will be the last line of the configuration to be installed, no matter what. <br></p><br><p>  The default page for a new installation for Apache in Ubuntu is in /var/www/index.html and gives a good overview of how this works in detail. <br></p><br><h2>  Creating a new site configuration <br></h2><br><p>  We will not use the default configuration because we need to add certain behavior.  Copy the old configuration from the available sites and rename it to something memorable. <br></p><br><pre> <code class="plaintext hljs">sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/payara-site.conf</code> </pre><br><p>  Open a new file in your preferred text editor as root.  You should see something like this: <br></p><br><img src="https://habrastorage.org/getpro/habr/post_images/235/554/90a/23555490ac12826fba5c877acab7cbb2.png" alt="image"><br><br>  The element contains a series of directives that tell the server how to respond to the listed incoming requests.  In this example, &lt;VirtualHost *: 80&gt; handles all responses coming to the server through port 80. For a more detailed description of the VirtualHost tags, see the Apache documentation. <br><br><p>  We need to add two lines in the tags to tell Apache how to handle incoming and outgoing traffic ‚Äî one to tell Apache where to send requests, and another to tell Apache where the responses should come from.  Thus, a user visiting <a href="http://localhost/">localhost</a> can be redirected to our application server at <a href="http://localhost/">localhost</a> : 8080 /, and responses sent to <a href="http://localhost/">localhost</a> : 8080 / are redirected instead, so the user sees them coming from <a href="http://localhost/">localhost</a> . <br><br></p><p>  To manage incoming traffic, add the line: <br></p><br><pre> <code class="plaintext hljs">ProxyPass / http://localhost:8080/</code> </pre> <br>  This directive tells Apache to send everything after the domain name of the server to <a href="http://localhost/">localhost</a> : 8080 /, as if the user went directly to this URL. <br><br><pre> <code class="plaintext hljs"> ProxyPassReverse / http://localhost:8080/</code> </pre> <p>  This directive tells Apache about the reverse URL of the proxy, so that, although the response is returned from the Payara Server instance on port 8080, the URL looks like it was received from Apache.  These two directives, when used together, mean that we can avoid complex regular expressions with mod_rewrite. <br></p><br><p>  Assuming that the domain name we want to use, for example, <a href="http://www.example.com/">www.example.com</a> , our configuration means that the request to <a href="http://www.example.com/myapp">www.example.com/myapp</a> will actually be sent to the Payara server, as if the user had directly connected to <a href="http://localhost/">localhost</a> : 8080 // MyApp. <br></p><br><p>  Your file should now look like this (I deleted most of the comments to clarify exactly what was needed): <br></p><br><img src="https://habrastorage.org/getpro/habr/post_images/bbb/674/657/bbb674657e8fe8263cceca168af27427.png" alt="image"><br>  Save your file. <br><br><p>  To disable the default site and activate our new configuration, run the following commands: <br></p><br><pre> <code class="plaintext hljs"> sudo a2dissite 000-default.conf sudo a2ensite payaraSite.conf</code> </pre> <br>  Restart the Apache HTTP Server service (restart, which we missed earlier): <br><br><pre> <code class="plaintext hljs">sudo service apache2 restart</code> </pre> <br>  To stop and start the Apache HTTP Server, this is: <br><br>  service stop <br><br><pre> <code class="plaintext hljs"> sudo service apache2 stop sudo service apache2 start</code> </pre> <br>  Do not forget to start Payara Server: <br><br><pre> <code class="plaintext hljs">/opt/payara5/bin/asadmin start-domain domain1</code> </pre> <br><p>  Before making changes to the configuration, logging on to <a href="http://localhost/">localhost</a> will take you to the Apache welcome screen: <br></p><br><img src="https://habrastorage.org/getpro/habr/post_images/29e/11e/055/29e11e05529e5232f9c678a75607ce42.png" alt="image"><br><br>  But now we have added to our proxy server and included new directives for our Apache user configuration when we enter localhost / index.html, which we now send to the Payara Server welcome screen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce0/a1a/36f/ce0a1a36fba25b94ba1c4865b4f7375e.png" alt="image"><br><br><h2>  Now you can add applications to the Payara server. </h2><br><p>  Thus, we now have an active Apache HTTP server, acting as our proxy (with the possibility of adding additional modules), and a working Payara server, ready to add applications to it. <br><br>  We went through the installation of both servers, configuring Apache, examining the file system and very briefly reviewed the asadmin commands of the Payara Server. <br></p><br><p>  Next time we will look at how to expand the functionality of Apache and Payara Server, and how we can make Payara Server provide scalability and additional improvements that we will add to Apache to handle several internal servers. <br></p></div><p>Source: <a href="https://habr.com/ru/post/438442/">https://habr.com/ru/post/438442/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>