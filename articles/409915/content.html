<div class="post__text post__text-html js-mediator-article">  On the way to creating our own cloud service, we have just <a href="https://geektimes.ru/post/297093/">mastered the Debian system</a> .  Now it's time for the next step - creating and configuring a web server, on the basis of which you can run Nextcloud. <img src="https://habrastorage.org/webt/ke/r5/x8/ker5x8nlot-vrpcr5iuvyrauhvm.png"><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3>  Table of contents </h3><br>  <a href="https://geektimes.ru/post/297093/">Part 1. Setting up a Debian environment for everyday use.</a> <br>  <a href="https://geektimes.ru/post/297601/">Part 2. Creating a server - setting LAMP in Debian</a> <br>  <a href="https://geektimes.ru/post/297969/">Part 3. Creating a personal cloud - installing and configuring Nextcloud</a> <br>  <a href="https://geektimes.ru/post/300907/">Part 4. Update 2018 - Debian 9 and Nextcloud 13</a> <br><br><hr><br><h3>  Quick chapter navigation </h3><br>  <a href="https://habr.com/ru/post/409915/">Foreword</a> <br>  <a href="https://habr.com/ru/post/409915/">Software installation</a> <br>  <a href="https://habr.com/ru/post/409915/">Setting up an Apache2 web server and accessing it via HTTP and HTTPS protocols</a> <br>  <a href="https://habr.com/ru/post/409915/">SQL Setup</a> <br>  <a href="https://habr.com/ru/post/409915/">PHP setup</a> <br>  <a href="https://habr.com/ru/post/409915/">SSH access setup</a> <br>  <a href="https://habr.com/ru/post/409915/">Access protection</a> <br>  <a href="https://habr.com/ru/post/409915/">Web Server Reference</a> <br>  <a href="https://habr.com/ru/post/409915/">MySQL reference material</a> <br>  <a href="https://habr.com/ru/post/409915/">Fail2ban reference material</a> <br><br><hr><a name="chap1"></a><br><h3>  Foreword </h3><br>  In the first part of this story, one of the possible options for configuring the Debian graphical user interface for convenient and familiar (extremely subjective point of view of the author) use by a person who came to Linux from Windows was shown.  And if for setting up a virtual machine with Debian, I used only the host system, then I specifically worked only in this virtual machine, searching for information on the Internet, taking notes in Notepadqq or gedit, listening to music through Audacious, opening files through LibreOffice and the like.  In this way, you can settle down and feel much more deeply and appreciate the work with the operating system and its environment, which is quite fully functional in the standard Debian package. <br><br>  At the moment, our system is configured in such a way that in the future you can only use the command line with a console text editor, for example, nano or use the Double Commander file manager with the integrated editor Notepadqq.  It is also possible to combine these two methods, for example, by navigating through the system and editing configuration files through the file manager, and all other commands through the console.  All methods are equivalent to achieve the final result. <br><br>  The current goal is to create a server, which this part will be devoted to.  The server can be configured with or without the installation and use of the graphical interface.  In the second case from the previous part, you can simply skip the sections on installing and configuring the software for the graphical interface and its settings, installing the graphical software packages and vmware-tools. <br><br>  I see nothing wrong with using a graphical interface when creating a server: if a person is more comfortable, more comfortable and more comfortable to make his first or second server with a graphical environment - why not?  In the end, my GUI web server has worked for a year and will work for as many years as necessary.  However, you need to keep in mind some points. <br><br>  Ideally, a once-configured system would have to work without our intervention for a very long time.  My server in the “clean” version was set up in two days, and it worked for almost a year without intervention.  This means that the graphical interface was used 0.05% of the time the server was active (the computer only worked half a day) and at the same time occupied resources: RAM, disk space, processor time.  It is better to direct all these resources to ensure the functioning of the server itself: for example, raise the memory_limit for PHP or fit more user data to the hard disk.  In addition, in case of problems and problems when working with a real remote server, it is often much easier to use <a href="https://ru.wikipedia.org/wiki/SSH">SSH access</a> .  In this context, the presence of a graphical interface is undesirable and that is why the second server in my network already had a virtual machine without a graphical environment, on which only Midnight Commander was installed from the graphical software, which I used to navigate the file system and edit the settings files through its editor mcedit .  Therefore, the following is a universal instruction: commands are given with an emphasis on using the command line, however it is assumed that the user sets up a machine with a graphical environment for the very first time, which caused the use of a browser to locally check the availability of the created sites and some features of the mail program. <br><br>  In the process of creating a server and adding new sites to it, I have accumulated some background information that may be useful to a novice user.  I outlined it after the material on installing and configuring the server. <br><br>  <b>Note</b> <br>  Upon further reading in constructions of the form http: // 127.0.0.1 (https: // 127.0.0.1), the space after http: // (https: //) must be removed when entering into the address bar of the browser.  A space is inserted when publishing this article in order to prevent the text engine from automatically converting text into links. <br><br><hr><a name="chap2"></a><br><h3>  Software installation </h3><br>  Apache and Nginx are a pair of open source web servers, on which about 55% of servers around the world are built.  Apache has been the most popular web server since 1995, and I chose it, hoping for good documentation, popularity, and, so to speak, I wanted to start from the beginning.  This does not mean that Nginx is worse: Nginx is more efficient in terms of resource consumption and work under load.  In the Russian segment of the Internet, the Nginx server takes up about 65%, while Apache - about 18%.  Not bad comparative article of two servers is <a href="https://habrahabr.ru/post/267721/">placed on Habré</a> . <br><br>  Install Apache2 web server: <br><br>  <b># apt-get install apache2 apache2-doc</b> <br><br>  And it's all.  Some twenty megabytes and the web server is already installed.  No reboot or settings are needed - the server is already able to open <a href="https://ru.wikipedia.org/wiki/HTML">HTML</a> pages.  However, a modern website on the Internet is not only a collection of static files, styles, fonts, and other things like twenty years ago.  A modern website contains scripts written in <a href="https://ru.wikipedia.org/wiki/PHP">PHP</a> , and dynamic information (for example, text content, comments, user profiles) is not written to files next to PHP files, but to a special <a href="https://ru.wikipedia.org/wiki/SQL">SQL database</a> .  For a full server, you must provide support for these technologies.  Moreover, it is easy: <br><br>  <b># apt-get install mysql-server mysql-client phpmyadmin</b> <br>  <b># apt-get install php5 php5-mysql libapache2-mod-php5</b> <br><br>  During the MySQL installation process, you will be asked to set the mysql superuser password and you will need to select the apache2 server to automatically configure how to work with mysql.  When installing the <a href="https://ru.wikipedia.org/wiki/PhpMyAdmin">phpmyadmin</a> package, I agreed to automatically configure the package and everywhere I entered the mysql superuser password.  PHP installation takes place without any requests. <br><br>  I did not use faster PHP7 or free MariaDB as an alternative open SQL replacement and decided to build my server on the “canonical” LAMP = Linux + Apache + MySQL + PHP using old and proven solutions, in case of problems I could quickly and easy to find information on the Internet. <br><br>  Three teams (which can actually be reduced to one) and we have locally installed a full-fledged and modern server.  It is quite simple! <br><br>  But setting up a server takes much more time than installing its components.  Initially, I wanted to show in this part my typical mistakes, false solutions to the problems and the results to which they led, but it turned out that over the course of a year, I lost a lot of memory, a lot had to be restored from records, so only the work instruction with small comments, allowing to achieve a universal working result. <br><br><hr><a name="chap3"></a><br><h3>  Setting up an Apache2 web server </h3><br>  First you need to make sure that the web server is running.  To do this, open a browser and type the address http: // 127.0.0.1 ( <a href="https://ru.wikipedia.org/wiki/Localhost">localhost</a> ).  A web page should open with an encouraging caption: “Apache2 Debian Default Page.  It's works! ”  The server really works.  If you have a set of 2000 site files, you can place it in the / var / www / html directory and it will most likely open on our server. <br><br><img src="https://habrastorage.org/webt/3t/q6/x-/3tq6x-2ahadvbbshmoxl2_3hfhc.png"><br><br>  All basic web server settings are stored in / etc / apache2.  If you open this directory, you can see the main configuration file apache2.conf and the directory conf-available, mod-available, sites-available.  These directories contain pre-configured configuration files (so-called snippets), which you can simply use by default, with your own edits, or take them as a template to create your own configurations.  For example, in the directory sites-available is the default host configuration file 000-default.conf.  If you open and study it, it turns out that this file just sets the path that opens our website at http: // 127.0.0.1: “DocumentRoot / var / www / html”.  Moreover, the line “&lt;VirtualHost *: 80&gt;” means that if I release my machine to the local network and access it on port 80 (port for <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP</a> ), I will open the site located along the path / var / www / html.  How to make sure of it? <br><br>  First you need to know the IP address that was assigned to the virtual machine after it was loaded.  To view the configuration of network adapters, run: <br><br>  <b># ifconfig</b> <br><br>  The information displayed on the console makes it easy to determine that the following address is set for the eth0 adapter: <br><br> <code>inet addr:192.168.233.138</code> <br> <br>  Now, on the host machine, I open the address http: // 192.168.233.138 in the browser and expect that the familiar page will open.  But ... it does not open.  After a while, my browser writes: "Connection timed out."  And he writes correctly.  Indeed, in the first part I turned on the firewall, but I did not open port 80!  Fix this: <br><br>  <b># ufw allow 80</b> <br><br>  Again we try to open the address http: // 192.168.233.138 and make sure that the expected page opens.  A virtual host in the virtual machine has opened from outside of all this virtualization.  We have made a small step in building our own small virtual Internet. <br><br>  In addition to the -available directories, there are also -enabled directories that contain what is currently "enabled".  If you look at them, you can see that these directories contain links to files that are in the directories-available.  In the directory sites-enabled at the moment, only one link - to the file /etc/apache2/sites-available/000-default.conf.  This is very convenient - we can manage shortcuts to enable or disable hosts without editing their configuration files.  In addition, the source of the configuration - one file, regardless of whether this configuration is currently enabled or not, and this prevents errors when something is ruled in one file, and in the other - is forgotten.  To disable our host, you need to remove the required shortcut, and to enable it, create it.  In order not to delete or create shortcuts manually, it is easier and more reliable to use special utilities. <br><br>  Disable virtual host: <br><br>  <b># a2dissite 000-default</b> <br><br>  Enable the virtual host: <br><br>  <b># a2enssite 000-default</b> <br><br>  After each change, you need to reload the host configuration or restart the server: <br><br>  <b># service apache2 reload</b> <br><br>  or <br><br>  <b># service apache2 restart</b> <br><br>  So, a basic understanding of how to configure regular hosts in apache is now available, and then I will show an example of how I configured my server to work on the HTTP and <a href="https://ru.wikipedia.org/wiki/HTTPS">HTTPS</a> protocols. <br><br>  You need to start with the fact that when you turn off the virtual host 000-default, the disconnection as such does not occur.  That is, the site as opened from inside and outside of the virtual machine - and it will open regardless of its configuration in the sites-enabled folder.  It was unexpected and I spent a relatively long time to understand if I did everything right or understood.  Until the end, I didn’t figure it out, apparently because the path / var / www / html is set globally as the default directory for DocumentRoot.  Since I didn’t want that something extra was included and available, I decided to get rid of the html directory itself, and for all nested / var / www, by default, deny access. <br><br>  To configure the virtual host by default, I edited its configuration file: <br><br>  <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>  The contents of the configuration file is as follows: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> localhost ServerAdmin user@localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined &lt;/VirtualHost&gt;</code> </pre> <br>  With this configuration, I reinstalled the default directory on / var / www, allowed the server to follow symbolic links in this directory, allowed the server to execute all directives declared in the found .htaccess files and denied access to this directory.  The logic of these actions is that I can control access to this directory without referring to the settings of the web server at all and without restarting it.  Now you need to check this solution. <br>  Transfer the file: <br><br>  <b># mv /var/www/html/index.html /var/www/index.html</b> <br><br>  And delete the directory: <br><br>  <b># rm / var / www / html</b> <br><br>  Restart the server for the new virtual host default settings to take effect: <br><br>  <b># service apache2 restart</b> <br><br>  Create a file: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  In which we write one line (without quotes): "Require all granted". <br><br>  To summarize  Now there is no path / var / www / html, but the default host is reconfigured to the path / var / www, which has the index.html file, and by default, at the web server level, access to this directory is denied, but is allowed by the content locally there is a .htaccess file. <br><br>  Open http: // 127.0.0.1 in the browser and see the already familiar page “Apache2 Debian Default Page.  It's works. ”  Now check the functionality of the “local” access control: <br>  Delete the .htaccess file: <br><br>  <b># rm /var/www/.htaccess</b> <br><br>  And we update the open page in the browser - the page with the notice of access restriction (Forbidden) should open.  Yes, it all works, then everything is done correctly. <br><br>  In principle, these simple settings are enough for the continued smooth operation of the web server.  But I thought this was not enough.  Now our web server can work only over HTTP.  But what about the HTTPS protocol?  After all, if in the future to display projects based on this web server on the Internet, the ability to work using this protocol is at least desirable.  And I decided to organize HTTPS support based on the creation of a self-signed <a href="https://ru.wikipedia.org/wiki/SSL">SSL</a> certificate. <br><br>  First you need to get an SSL certificate that will be installed on our server.  We do not have any domain, and in fact there is no static IP address either.  But this is all unimportant, because I will generate the certificate myself, using the means of my system. <br><br>  Attention!  In the instructions below, it is assumed that the server is installed on a “nameless” machine.  If you have a real IP or domain name, then you need to specify them in three places: &lt;Common Name IP / Domain&gt;;  &lt;ServerName IP / Domain&gt;;  &lt;Redirect "/" "https: // IP / Domain /"&gt; - in the corresponding constructions, replace IP / Domain with IP address or domain name.  In the text below, instead of IP / Domain, localhost is used. <br><br>  Generate SSL certificate: <br><br>  <b># openssl req -x509 -nodes -days 3650 -newkey rsa: 2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt</b> <br><br>  This command will create a self-signed X.509 standard certificate for as long as 10 years with the password protection option skipped with a passphrase - it is necessary that the Apache server has the ability to read the file without user intervention, because after setting the password, you will have to enter it after each boot or reboot. server.  Together with the certificate, a new RSA key for 2048 bits will be created, with which the certificate will be signed.  The –keyout and –out options indicate the ways in which OpenSSL should generate a key and certificate. <br><br>  In the process of creating a certificate, questions will be asked, to which I have indicated the following data: <br><br><blockquote>  Country Name = MW <br>  State or Province Name = Sun System <br>  Locality Name = Lunar <br>  Organization Name = Hellium Inc. <br>  Organizational Unit Name = 2 <br>  Common Name = localhost <br>  Email Address = user @ localhost </blockquote><br>  Next, you need to create Diffie-Hellman keys to ensure <a href="https://ru.wikipedia.org/wiki/Perfect_forward_secrecy">PFS</a> support: <br><br>  <b># openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</b> <br><br>  Dots and plus signs will run in the terminal and after the end of the cartoon you can create an ssl-params.conf file, which will define the SSL parameters for the server: <br><br>  <b># nano /etc/apache2/conf-available/ssl-params.conf</b> <br><br>  For a secure, up-to-date setup, I used the code generated in the <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">generator to configure SSL on mozilla.github.io</a> .  In the generator, I chose the Apache2 server, the Modern profile, and correctly set the server versions and OpenSSL, which can be found in the following commands: <br><br>  <b># apache2 -v</b> <b><br></b>  <b># openssl version</b> <br><br>  As a result, I got the following text: <br><br><pre> <code class="apache hljs"><span class="hljs-comment"><span class="hljs-comment"># 14-01-2018 / for apache2 2.4.10 &amp; openssl 1.0.1t # from https://mozilla.github.io/server-side-tls/ssl-config-generator/ # parametrs help: https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html # modern configuration, tweak to your needs SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1 SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256 SSLHonorCipherOrder on SSLCompression off # OCSP Stapling, only in httpd 2.3.3 and later SSLUseStapling on SSLStaplingResponderTimeout 5 SSLStaplingReturnResponderErrors off SSLStaplingCache shmcb:/var/run/ocsp(128000)</span></span></code> </pre> <br>  Now configure the virtual host with SSL support: <br><br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br>  The text of this file I led to the following form: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> user@localhost ServerName localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br>  From the above, it follows that in our capacity as the DocumentRoot directory we also defined / var / www, access to which is configured in the same way as the previous settings.  The <a href="https://ru.wikipedia.org/wiki/HSTS">HSTS</a> mechanism is <a href="https://ru.wikipedia.org/wiki/HSTS">enabled</a> , which contributes to the forced connection establishment through the HTTPS protocol.  SSL support is included, indicating the certificate and key used, and support for processing certificate data in PHP and <a href="https://ru.wikipedia.org/wiki/CGI">CGI</a> scripts is included.  The last section is designed to ensure compatibility with earlier versions of Internet Explorer and, in general, is not necessary. <br><br>  Now we make the final touches. <br><br>  Open the port for SSL: <br><br>  <b># ufw allow 443</b> <br><br>  Enable apache modules for SSL and HSTS support: <br><br>  <b># a2enmod ssl</b> <b><br></b>  <b># a2enmod headers</b> <br><br>  Enable SSL configuration: <br><br>  <b># a2enconf ssl-params</b> <br><br>  Enable the virtual host with SSL support: <br><br>  <b># a2ensite default-ssl</b> <br><br>  Restart the server to accept all new settings: <br><br>  <b># service apache2 restart</b> <br><br>  Here comes an interesting point - testing the functionality of a new tuned system. <br><br>  Create a file: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  In which we write one line: "Require all granted". <br><br>  Open in the browser https: // 127.0.0.1.  The page about the unknown certificate should open, after its acceptance (one-time or permanent permission), the already familiar page with the notification about the launched web server will open. <br><br>  Delete the .htaccess file: <br><br>  <b># rm /var/www/.htaccess</b> <br><br>  And we update the open page in the browser - the page with the notice of access restriction (Forbidden) should open.  Everything works correctly.  Now our sites are accessible via both HTTP and HTTPS. <br><br>  HTTP access can be left enabled, disabled or forced redirected to HTTPS. <br><br>  For HTTP enabled access, you do not need to do anything, since the server processes the requests for ports 80 and 443 individually and our site in the / var / www folder will open both via HTTP and HTTPS. <br><br>  To disable access via HTTP, simply disable the corresponding virtual host and restart the web server: <br><br>  <b># a2dissite 000-default</b> <b><br></b>  <b># service apache2 restart</b> <br><br>  Now, if you open http: // 127.0.0.1 in the browser, the page with the Not Found Page notification should open. <br><br>  The most interesting third option.  In this case, HTTP formally remains enabled, but data processing will be forcibly redirected via HTTPS. <br><br>  To do this, first enable the redirection module: <br><br>  <b># a2enmod rewrite</b> <br><br>  Now open the file 000-default.conf: <br><br>  <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>  And before the closing tag add the text below: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L]</span></span></code> </pre> <br>  Restart the server: <br><br>  <b># service apache2 restart</b> <br><br>  Create a file: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  In which we write one line: "Require all granted". <br><br>  Now, if you open the address http: // 127.0.0.1 in the browser, we will automatically redirect to https: // 127.0.0.1 with a warning about an unknown certificate (if it was not previously listed as an exception in the browser), after accepting which the familiar page with the notification of the running web server. <br><br><hr><a name="chap4"></a><br><h3>  SQL Setup </h3><br>  To configure mysql for the first time, just run the following command: <br><br>  <b># mysql_secure_installation</b> <br><br>  After entering the mysql root password, I answered the questions asked in the following order: <br><br><ul><li>  refused to change the root password; </li><li>  confirmed the deletion of anonymous users from the database; </li><li>  confirmed a remote connection lock for root (for security reasons, root can only be connected locally); </li><li>  confirmed the deletion of test databases; </li><li>  agreed to reload privilege tables. </li></ul><br>  To test the performance of mysql, you can run the following command: <br><br>  <b># mysql -uroot -p</b> <br><br>  After entering the mysql superuser password, we see the mysql prompt - it means the service is up and running.  You can exit the mysql terminal by typing the "exit" command. <br><br>  To check phpmyadmin operability, open the address http: // 127.0.0.1/phpmyadmin in the browser.  If a page opens with an invitation to enter phpmyadmin, the service is up and running. <br><br><hr><a name="chap5"></a><br><h3>  PHP setup </h3><br>  After installing PHP, I opened its settings file: <br><br>  <b># nano /etc/php5/apache2/php.ini</b> <br><br>  And he brought some parameters to the following form: <br><br><ul><li>  memory_limit = 1024M </li><li>  default_charset = "UTF-8" </li><li>  upload_max_filesize = 256M </li><li>  sendmail_path = /usr/bin/fake_sendmail.sh </li></ul><br>  With the help of the PHP module, you can provide caching of data in memory.  Caching is useful when server load is high for data that generates a large amount of resources, for example, the results of database queries or processing “heavy” pieces of a site template.  As a caching server, I chose the <a href="https://ru.wikipedia.org/wiki/Memcached">memcached</a> module. <br><br>  Installing memcache: <br><br>  <sup>[ <a href="https://geektimes.ru/post/297601/">This text was</a> written specifically for the site <a href="https://geektimes.ru/">geektimes.ru</a> by <a href="https://geektimes.ru/users/alexanders/">AlexanderS</a> .</sup> <sup><br></sup>  <sup>Reference to the source is optional, but its mention is highly desirable!</sup>  <sup>]</sup> <br><br>  <b># apt-get install memcached php5-memcached</b> <br><br>  Let's look at the service configuration settings: <br><br>  <b># nano /etc/memcached.conf</b> <br><br>  In the settings, I increased the size of the memory used for caching: -m 64 -&gt; -m 256. And I checked the presence of the operation mode only in the local zone: -l 127.0.0.1. <br><br>  Restart the caching service and web server: <br><br>  <b># service memcached restart</b> <b><br></b>  <b># service apache2 restart</b> <br><br>  Now you need to make sure that the service is working.  To do this, create a file: <br><br>  <b># nano /var/www/info.php</b> <br><br>  And add the following text to it: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> phpinfo (); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  We do not forget to check for the presence of the .htaccess file in the / var / www directory with the corresponding permission content, if it is not there, we create it. <br><br>  Now you can open in the browser http: // 127.0.0.1/info.php - a page should open with information about PHP, in which you need to check the presence of the memcached section in it.  If the table appeared - PHP works. <br><br>  You can check the running memcached service as follows: <br><br>  <b>$ ps -aux |</b>  <b>grep memcached</b> <br><br>  The terminal should return a string containing memcached settings. <br><br>  <b>Creating a mail stub for PHP</b> <br><br>  At PHP settings, the shell script was specified as the sendmail_path parameter.  The function of this script is to save the letters sent via the standard php mail () function on the local machine, in some convenient folder, and not send them somewhere. <br><br>  Create a file: <br><br>  <b># nano /usr/bin/fake_semdmail.sh</b> <br><br>  With the following content: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh prefix="/var/mail/sendmail/new" numPath="/var/mail/sendmail" if [ ! -f $numPath/num ]; then echo "0" &gt; $numPath/num fi num=`cat $numPath/num` num=$(($num + 1)) echo $num &gt; $numPath/num name="$prefix/letter_$num.txt" while read line do echo $line &gt;&gt; $name done chmod 777 $name /bin/true</span></span></code> </pre> <br>  Make this file executable: <br><br>  <b># chmod + x /usr/bin/fake_semdmail.sh</b> <br><br>  Create the necessary directories that may be needed in case of setting up the collection of letters by the mail program: <br><br>  <b># mkdir / var / mail / sendmail / var / mail / sendmail / cur / var / mail / sendmail / new / var / mail / sendmail / tmp</b> <br><br>  And we assign rights so that the server can write files in this folder: <br><br>  <b># chmod 777 -R / var / mail / sendmail</b> <br><br>  Now all outgoing emails will be added to / var / mail / sendmail.  You can view them with a text editor, or you can collect them with a mail program.  Included with the pre-installed Debian software is the Evolution mail client.  When setting up an account, select “Maildir in Maildir format” as the server type and specify the path to the mail directory (/ var / mail / sendmail), and “Sendmail” as the server. <br><br>  Everything.  In general, we have finished with the server - a universal virtual machine has been received, on the basis of which you can build your network services.  I left both HTTP and HTTPS accessed.  However, after gaining experience in creating and configuring a server, as well as adding sites (see below) to it, I would recommend creating a new virtual machine with a server without a graphical interface as more optimal in terms of resource consumption. <br><br><hr><a name="chap6"></a><br><h3>  SSH access setup </h3><br>  A server would not be a full-fledged server without access via SSH.  The so-called "shell" allows you to quickly and safely connect to a remote server, using, for example, a small program putty, - on the local computer, we get direct access to the terminal of the remote server. <br><br>  Service installation: <br><br>  <b># apt-get install ssh</b> <br><br>  Let's open the port for SSH (actually, the default port should be number 22, but below I have redefined the port in the SSH configuration): <br><br>  <b># ufw allow 106</b> <br><br>  To organize access for our user user, you need to open the file: <br><br>  <b># nano / etc / ssh / sshd_config</b> <br><br>  And add the directive to the end of the file: <br><br><blockquote>  AllowUsers user </blockquote><br>  In addition, for security reasons, I made the following changes to this file: <br><br><ul><li>  changed the port from 22 to some other ( <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582%25D0%25BE%25D0%25B2_TCP_%25D0%25B8_UDP">list of ports</a> ): Port 22 -&gt; Port 106 </li><li>  disabled the outdated protocol: Protocol 2.1 -&gt; Protocol 2 </li><li>  disabled remote root access: PermitRootLogin yes (or PermitRootLogin without-password) -&gt; PermitRootLogin no </li></ul><br>  After that we restart the service: <br><br>  <b># service sshd restart</b> <br><br>  Now I can run the putty program on the host machine and connect to my server in console mode by entering the connection address 192.168.233.138, port 106 and the user name user.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When connecting, you must answer affirmatively on the acceptance of keys and enter the password of the user user. </font><font style="vertical-align: inherit;">If you need to execute commands from the superuser, you can use the already known command su.</font></font><br><br><hr><a name="chap7"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Access protection </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I did not begin to protect the web server from DDoS, initially believing that if it will be hosted on a VPS / VDS, then hosting will provide effective protection, and if you make your server “sticking out” on the Internet, then this issue should be dealt with seriously and this is the topic separate article. Protection from Slow HTTP DDoS is done relatively simply in accordance with numerous instructions on the Internet, but it will not save from a distributed attack made from many different IP addresses. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With DDoS, our server will simply stop working for a while. But after the attack, which will not last forever, the server will be restored. But if someone manages to get access via SSH, then control over the server will be lost, and the data on it will be compromised, so controlling access to the server via SSH is a sensible idea.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The simplest and most trivial thing you can do is change the standard port, which we did when configuring SSH. Five years ago, I “put up” a newly created server on the Internet at a recently received real IP address and was surprised that during the week the server existed, about which no one knew anything yet, a large number of records of unsuccessful authorization attempts accumulated in the system logs Ssh and ftp. It is obvious that in the modern Internet there is a considerable number of service-robots that are looking for computers with open ports and trying to connect to them, going through passwords on an existing database or using the brute force method. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortunately for us, there is such a thing as fail2ban: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># apt-get install fail2ban</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediately after installation, the utility is already configured to protect most ports, and if more than six failed attempts to connect appear in the system logs for ten minutes, the intruder will be blocked for ten minutes. The mechanism of the work of fail2ban is quite simple - on certain triggers, so-called jails are triggered, which determine the action intended to protect the application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The blocking parameters can be set individually: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/fail2ban/jail.local</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the created file, you must specify the settings that will be replaced by the existing ones by default. An example of my file content:</font></font><br><br> <code># общие настройки <br> [DEFAULT] <br> ignoreip = 127.0.0.1 <br> bantime = 2592000 <br> findtime = 43200 <br> maxretry = 6 <br> banaction = iptables-multiport <br> # настройка отправки сообщения на почту <br> destemail = user@localhost <br> sendername = Fail2Ban <br> mta = sendmail <br> action = %(action_mwl)s <br> <br> # защита SSH <br> [ssh] <br> enabled = true <br> port = 106 <br> filter = sshd <br> logpath = /var/log/auth.log <br> <br> # выявляем неудачные попытки ввода пароля <br> [apache] <br> enabled = true <br> port = http,https <br> filter = apache-auth <br> logpath = /var/log/apache*/*error.log <br> <br> # выявляем потенциальные сканирования для применения эксплойтов и php уязвимостей <br> [apache-noscript] <br> enabled = true <br> port = http,https <br> filter = apache-noscript <br> logpath = /var/log/apache*/*error.log <br> <br> # выявляем попытки переполнения Апача <br> [apache-overflows] <br> enabled = true <br> port = http,https <br> filter = apache-overflows <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2 <br> <br> # выявляем неудачные попытки в поиске домашней директории на сервере <br> [apache-nohome] <br> enabled = true <br> port = http,https <br> filter = apache-nohome <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The above setting allows you to not control local access, and with six incorrect login attempts, within 12 hours, the attacker's IP address is banned using iptables for 30 days. </font><font style="vertical-align: inherit;">It controls not only port access for SSH, but also suspicious actions aimed at destabilizing the operation of the web server.</font></font><br><br><hr><a name="chap8"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Web Server Reference </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start, stop and restart the server: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 start </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 stop </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 restart</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restarting server configurations: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 reload</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enabling and disabling host test: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2ensite test </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2dissite test</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enabling and disabling test configuration: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2enconf test </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2disconf test</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Check file syntax (should return: “Syntax OK”): </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># apache2ctl configtest </font></font></b> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option to add a site with HTTP or HTTPS access using an existing virtual host</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose you need to add a new site to our server, located in the site.com directory, located in / home / user / www. This can be convenient, since the user will not need to leave the limits of his home directory when working with the site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We set permissions for the user directory (just in case): </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># chmod 755 / home / user</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a directory for the site: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ mkdir / home / user / www /home/user/www/site.com Place a</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> symbolic link to the site directory: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># ln -s /home/user/www/site.com /var/www/site.com</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To add access via HTTP, open the file: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/apache2/sites-available/000-default.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Or to add access via HTTPS open the file:</font></font><br><br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And add to the open file the following content before the closing tag / VirtualHost:</font></font><br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/site.com&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restarting the web server: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 restart We</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> check the availability of the site at http: // 127.0.0.1/site.com or https: // 127.0.0.1/site.com (the verification procedure - see below). It should be noted that the site will open regardless of the presence of the .htaccess file, since the directive: Require all for is set for the site directory. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The option to add a site with access via HTTP or HTTPS using a new virtual host and setting up access to the site via its domain name, not IP.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Task conditions are the same as above: let's say we need to add a new site to our server located in the site directory .com located in / home / user / www. But now I also want to access the site by typing in the browser line only its domain name.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We set permissions for the user directory (just in case): </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># chmod 755 / home / user</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create a directory for the site: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ mkdir /home/user/www/site.com Place a</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> symbolic link to the site directory: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># ln -s / home / user /www/site.com /var/www/site.com</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To add HTTP access, create a file: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/apache2/sites-available/site.com.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And add the following content to it:</font></font><br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # Redirect HTTP-&gt;HTTPS #RewriteEngine <span class="hljs-literal"><span class="hljs-literal">On</span></span> #RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> #RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L] ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined &lt;/VirtualHost&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or, to add access via HTTPS, create the file: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/apache2/sites-available/site.com-ssl.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And add the following content to it:</font></font><br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the line “127.0.0.1 site.com” to </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / hosts</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;"># echo &gt;&gt; / etc / hosts 127.0.0.1 site.com</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Activate the HTTP host: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2ensite site.com.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Or activate the HTTPS host: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># a2ensite site. com-ssl.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restarting the web server: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service apache2 restart We</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> check the availability of the site at http: // site.com or https: // site.com (test method - see below). It should be noted that the site will open regardless of the presence of the .htaccess file, since the directive: Require all for is set for the site directory.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All actions are performed inside the guest virtual machine. </font><font style="vertical-align: inherit;">It would be interesting to "open" the site in the browser of the host system. </font><font style="vertical-align: inherit;">It is not difficult. </font><font style="vertical-align: inherit;">We know the domain name and the IP address of the guest machine. </font><font style="vertical-align: inherit;">If the Windows host system, you need to open the file c: \ Windows \ System32 \ drivers \ etc \ hosts and at the very end add the following line:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.168.233.138 site.com </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After this change, the computer or host system will have to restart. Now, when opening site.com in a browser, the call to it will be redirected to our virtual machine. In fact, we did the simplest routing on our personal Internet at the level of the host operating system. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you need access to a virtual host only via HTTPS, but do not want to lose connections using the HTTP protocol, you can set up a redirect: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- create the file /etc/apache2/sites-available/site.com.conf using the above instructions, if it is not created </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- in the /etc/apache2/sites-available/site.com.conf file, uncomment the three lines of RewriteEngine / RewriteCond / RewriteRule </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">— activate the host site.com.conf if it is not activated</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- restart the server: # service apache2 restart </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checking the efficiency of the added site</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The easiest way to check the availability of a site is to place the index.html file with some content in its root directory. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create the index.html file: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ nano /home/user/www/site.com/index.html</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And add the following content to it:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Depending on the method of adding the site, open the browser address http: // 127.0.0.1/site.com (https: 127.0.0.1/site.com) or http: // site.com (https: // site.com ) - the page containing the text "TEST OK" should open. </font></font><br><br><hr><a name="chap9"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MySQL reference material </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating user user123 with password pass123 and db123 database via console. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log in to mysql by entering the mysql superuser password when prompted: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># mysql -u root -p</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And create a database (you do not need to type the “mysql&gt;” prefix, a semicolon is required at the end): </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; CREATE DATABASE `db123`;</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create user user123 with password pass123: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; CREATE USER 'user123' @ 'localhost' IDENTIFIED BY 'pass123';</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grant user privileges to the database: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; GRANT ALL PRIVILEGES ON `db123`. * TO 'user123' @ 'localhost';</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Update privilege table: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; FLUSH PRIVILEGES;</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quit mysql: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; exit</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For verification, open the address http: // 127.0.0.1/phpmyadmin and log in with the user123 / pass123 access details. </font><font style="vertical-align: inherit;">Must open access to the database db123. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change root password mysql from pass123 to pass456: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># mysqladmin -uroot -ppass123 password pass456</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Change user password from user123 from pass123 to pass456: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># mysqladmin -uuser123 -ppass123 password pass456</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Delete user123 user: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; DROP USER 'user123' @ 'localhost' ; </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deleting a db123 table: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; DROP DATABASE `db123`;</font></font></b> <br><br><hr><a name="chap10"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fail2ban reference material </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restarting the service: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># service fail2ban restart</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Checking the running rules: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fail2ban-client status</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Detailed statistics on the sshd rule: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fail2ban-client status ssh</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unbanking: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fail2ban-client set ssh unbanip Banned_IP</font></font></b> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Return </font></font><a href="https://habr.com/ru/post/409915/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the beginning, to the table of contents</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><hr><br>  The history of creating a home cloud.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part 2. Creating a server - setting LAMP in Debian. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Text version: 1.0.0. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Date of first publication: 01/30/2018. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last edited date: hh.hh.hhhh.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update log</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.0.0 [30-01-2018] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first version. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Describes the installation and configuration of LAMP in Debian 8.7.x.</font></font><br></div></div></div>