<div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  I present to you the translation of my article <a href="https://medium.com/taxify-labs/understanding-the-customer-lifetime-value-with-data-science-c14dcafa0364">"Understanding the Customer Lifetime Value with Data Science"</a> . </p><br><p>  <i>Customer relationships are important for each company and play a key role in business growth.</i>  <i>One of the most important metrics in this area is customer lifetime value (hereinafter LTV) - the prediction of net income associated with all future customer relationships.</i>  <i>The longer customers continue to use the company's products, increasing profits, the higher their LTV.</i> <i><br></i> <br>  There are many marketing articles about how important LTV and customer segmentation are.  But as a Data Scientist, I'm more interested in formulas and I want to understand how the model actually works.  How to predict LTV using only 3 signs?  In this post I will show some models that are used for marketing client segmentation and explain the mathematics on which they are based.  There will be many formulas, but do not worry: everything is ready in the Python libraries.  The purpose of this blog is to show how math does all the work. </p><br><h3>  Beta-geometric / negative binomial model for determining the likelihood that a client is “alive” </h3><br><p>  Consider this example [from the online service for booking trips (taxi) around the city]: a user registered 1 month ago, made 4 trips and the last trip took place 20 days ago.  Based only on this data, this model can predict the likelihood that a client will be active for a certain period of time (as shown in the graph), as well as the number of transactions in the future (which is the basis for understanding the value of the client throughout his “life” - relationship of the client and the company). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/m-/7w/clm-7w-bjlwwhmc0dggx1hrazco.png"></div><br><p>  <i>The model provides a direct guide to business action: to take marketing measures towards the user when his probability of activity drops below a certain level in order to prevent him from leaving.</i> </p><a name="habracut"></a><br><p>  This model was proposed by <a href="http://mktg.uni-svishtov.bg/ivm/resources/Counting_Your_Customers.pdf">Fader, Hardie and Lee</a> and is called the Beta Geometric / Negative Binomial distribution model (BG / NBD). </p><br><p>  <u>BG / NBD model has the following properties:</u> </p><br><p>  When the user is active, the number of his transactions for the period <i>t is</i> described by the Poisson distribution with the transaction parameter <i>λ</i> . </p><br><p>  <i>Poisson distribution helps predict events by using data on how often events occurred in the past.</i>  <i>For example, if a user made an average of 2 trips per week (</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">λ</span></span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-5">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.616ex" height="2.057ex" viewBox="0 -780.1 2418.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/436236/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjV2z0QL06lLxrk4hhCrVxr3TFZFA#MJMATHI-3BB" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/436236/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjV2z0QL06lLxrk4hhCrVxr3TFZFA#MJMAIN-3D" x="861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/436236/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjV2z0QL06lLxrk4hhCrVxr3TFZFA#MJMAIN-32" x="1917" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> λ = 2 </script></i>   <i>on the chart below), then the probability that he will make 3 orders next week is equal to 0.18.</i> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/py/dd/x5/pyddx5ptnu8_54pvwvjyhxaxmm4.png"></div><br><ol><li>  The heterogeneity of the transaction parameter among users (which means how customers differ from each other in consumer behavior) has a Gamma distribution with parameters <i>r (form)</i> and <i>α (scale)</i> . </li></ol><br><p>  <i>Gamma distribution is suitable for processes with a waiting time between events with a Poisson distribution (in our case for the transaction parameter <i>λ</i> ).</i>  <i>For example, consider a user who makes an average of 2 transactions per week.</i>  <i>In this case, the probability that the waiting time before the user makes 3 purchases will be more than 4 weeks equals the area on the graph to the right of the vertical dashed line (under the blue distribution line) is 0.13.</i> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/hg/z-/qmhgz-cuy9j0dfvznhbabjpoi74.png"></div><br><ol><li>  Users may become inactive after any transaction with probability <i>p</i> , and their exit point (when they become inactive) is distributed between Geometrical purchases. </li></ol><br><p>  <i>The geometric distribution is similar to Bernoulli outcomes and is used to model the number of outcomes before (and including) the first successful outcome.</i>  <i>If for some user</i> <math> </math><i><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">p</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-9">0.2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-2"> p = 0.2 </script></i></i>   <i>then its probability of being inactive after 3 transactions is 0.12 (the blue line on the chart).</i> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bt/0s/_h/bt0s_hz6ypqodkp1dhp1ck0ialg.png"></div><br><ol><li>  Heterogeneity (variations between users) in the probability of leaving has Beta distribution with form parameters <i>α</i> and <i>β</i> . </li></ol><br><p>  <i>The beta distribution is best suited for representing probability probability distributions — a case where we do not know the probability beforehand, but we have some reasonable a priori prerequisites described by <i>α</i> and <i>β</i> (Mat. Expectation Beta</i> <math> </math><i><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-10"><span class="MJXp-mrow" id="MJXp-Span-11"><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0em;">α</span></span><span class="MJXp-mrow" id="MJXp-Span-13"><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-16"><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0em;">α</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-19"><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;">β</span></span><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-3"> α / (α + β)) </script></i></i>   <i>.</i> </p><br><p>  For the previous example with a user whose prior probability of leaving is 0.2, the orange line in the graph with <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mrow" id="MJXp-Span-24"><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0em; margin-right: 0em;">α</span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-27">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-4"> α = 2 </script>  and <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-28"><span class="MJXp-mrow" id="MJXp-Span-29"><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0em;">β</span></span><span class="MJXp-mo" id="MJXp-Span-31" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-32">8</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> β = 8 </script></i>   describes the probability density function for the probability of user exit. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s3/zy/rq/s3zyrqlcq_r4of9dls3b4veslvw.png"></div><br><ol><li>  The transaction parameter and the probability of leaving are independently distributed between users. </li></ol><br><p> Mathematical notation for user attributes <i>X</i> : </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">X</span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">x</span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-38"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-40" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">t</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> X = x, t_x, t </script></p><br><p>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> x </script>  - number of transactions over a period of time <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mo" id="MJXp-Span-46" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-47">0</span><span class="MJXp-mo" id="MJXp-Span-48" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">T</span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> (0, T] </script></i>   and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-51"><span class="MJXp-msubsup" id="MJXp-Span-52"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-54" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">T</span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> t_x (<= T) </script>  - the time of the last purchase. <br>  Based only on these signs, the model predicts the future consumer prerequisites of users: <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">P</span><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">X</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">t</span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">x</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> P (X (t) = x) </script>  - probability <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-69"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> x </script>  transactions for the period <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-71"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> t </script>  in future, <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">E</span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">Y</span><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">t</span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mrow" id="MJXp-Span-80"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">X</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">x</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-86"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-88" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">T</span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> E (Y (t) | X = x, t_x, T) </script>  - The expected number of transactions per period for a user with a specific behavior. </p><br><p>  Now we can find these two main indicators.  Without going into details, I will show the final formulas (more calculations in the articles). </p><br><p>  Chance to be active: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/e-/yu/sze-yuuwmy8gcovhcz2easjqmk4.png"></div><br><p>  Expected number of transactions: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gc/qq/ph/gcqqphfflmy-mtebrkqmegkbjzg.png"></div><br><p>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-92"><span class="MJXp-msubsup" id="MJXp-Span-93"><span class="MJXp-mi" id="MJXp-Span-94" style="margin-right: 0.05em;"></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-95" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-96"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-98" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> _2F_1 </script>  - hyper-Gaussian function </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dp/w9/gx/dpw9gxhfjntuqi1hdkpfurzbwnc.png"></div><br><h3>  Gamma-gamma model for assessing LTV </h3><br><p>  Up to this point, we have used only the frequency and recentity of customer purchases.  But in addition to this, we can apply the monetary component of his transactions.  Add new data to our example: the user made these 4 trips at a price of 10, 12, 8, 15. The gamma-gamma model helps predict the most likely value of a transaction in the future. <br>  I summarize everything together, now we have all the elements to determine the client's LTV: </p><br><p>  <i><b>LTV = expected number of transactions</b></i> <math> </math><i><b><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-99"><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0.267em; margin-right: 0.267em;">∗</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> * </script></b></i>   <i><b>tranzakia price</b></i> <math> </math><i><b><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.267em; margin-right: 0.267em;">∗</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> * </script></b></i>   <i><b>margin</b></i> </p><br><p>  where the first element is from the BG / NB model, the second is from the Gamma-gamma model, and the margin is set by the business. </p><br><p>  <i>Mathematical notation for gamma-gamma models:</i> <br>  User committed <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> x </script>  value transactions <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-msubsup" id="MJXp-Span-106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-108" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-112" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-116" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> z_1, z_2, ... </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-117"><span class="MJXp-msubsup" id="MJXp-Span-118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-120" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-121" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123" style="margin-right: 0.05em;">Z</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-124" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-125"><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> m_x = Z_i / x </script>  - the observed average value of the transaction. <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-128"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">E</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">M</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> E (M) </script>  - the hidden average value of the transaction, and what we are interested in - <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">E</span><span class="MJXp-mo" id="MJXp-Span-135" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">M</span><span class="MJXp-mrow" id="MJXp-Span-137"><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-141" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">x</span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> E (M | m_x, x) </script>  - the expected monetary value of the user, based on his buying behavior. </p><br><p>  <u>Properties Gamma-gamma models:</u> <br>  The monetary value of the user's transactions is random and is within their average transactional values. </p><br><p>  The average transaction value varies among users, but does not vary for a particular user over time. </p><br><p>  The average transaction value has a gamma distribution among users. </p><br><p>  The articles describe in detail the derivation of the formula through several more Gamma distributions.  The result is: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/td/pr/dz/tdprdz-1yusei0-fx1w7gjftbc0.png"></div><br><p>  where <i>p is</i> the form parameter and <i>v is</i> the scale parameter gamma distribution for transactions <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">Z</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">i</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">q</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> Zi, q </script>  shape parameter and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-150"><span class="MJXp-mrow" id="MJXp-Span-151"><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0em; margin-right: 0em;">γ</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> γ </script>  the scale parameter for the gamma distribution <i>v</i> (assumption of the model that <i>p is</i> constant — the coefficients of variation at the individual level are the same for users).  To find the parameters of the model, we can use the maximum likelihood method. </p><br><p>  We are done with math and now we can rate LTV users.  But what about the accuracy of this model? </p><br><h3>  Model Accuracy Assessment </h3><br><p>  The traditional approach proposes to divide the data into two groups - part for training, part for test.  In the articles, the authors show that their approach works well.  I also tried these models on real data and also got similar results. </p><br><p>  The graph shows the distribution of real and predicted transactions for the data from the test group: the error here is 2.8%. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hq/zz/sd/hqzzsdvfrofsaeqmzp-dnjpm2ma.png"></div><br><h3>  How to apply </h3><br><p>  As I said at the beginning, all models are already implemented.  For example, the Python “ <a href="https://lifetimes.readthedocs.io/en/master/">lifetimes</a> ” library contains all the functions and metrics necessary to define an LTV.  Detailed documentation contains many examples and explanations.  There are also examples of sql queries to receive data in the required format.  So you can get to work in just a few minutes. </p><br><h3>  Conclusion </h3><br><p>  In this post, I showed in detail how LTV users can be assessed using only a few signs. </p><br><p>  I want to note that sometimes you can move away from the frequently used gradient boosted trees and try other approaches that have a comparable level of accuracy.  Statistical training can still be used in practice and can help a business to better understand customers. </p><br><h4>  References </h4><br><p>  <a href="http://mktg.uni-svishtov.bg/ivm/resources/Counting_Your_Customers.pdf">Fader, Peter &amp; GS Hardie, Bruce &amp; Lok Lee, Ka.</a>  <a href="http://mktg.uni-svishtov.bg/ivm/resources/Counting_Your_Customers.pdf">(2005).</a>  <a href="http://mktg.uni-svishtov.bg/ivm/resources/Counting_Your_Customers.pdf">“Counting Your Customers”: The Easy Way: An Alternative to the Pareto / NBD Model.</a>  <a href="http://mktg.uni-svishtov.bg/ivm/resources/Counting_Your_Customers.pdf">Marketing Science.</a> <br>  <a href="http://www.brucehardie.com/notes/025/gamma_gamma.pdf">Fader, Peter &amp; GS Hardie, Bruce (2013).</a>  <a href="http://www.brucehardie.com/notes/025/gamma_gamma.pdf">The Gamma-Gamma Model of Monetary Value.</a> <br>  <a href="http://brucehardie.com/papers/rfm_clv_2005-02-16.pdf">Fader, Peter S., Bruce GS Hardie, and Ka Lok Lee (2005), “RFM and CLV: Using Iso-value Curves for Customer Base Analysis,” Journal of Marketing Research.</a> </p></div>