<div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br><h3>  Introduction </h3><br>  Pursuing home automation over the past three years, I try to keep track of all the new devices in this area.  Recently, the exhibition caught the eye of a new device of domestic production.  Searching the Internet, I did not find any information about them.  I thought strangely and decided to contact the manufacturer (I will not indicate it).  After talking, I managed to get a test sample for a month.  A month later I decided to share my impressions about this product. <br><br><h3>  Description from the manufacturer </h3><br>  According to the manufacturer, the device under study is a platform that allows you to create automated systems for monitoring and managing infrastructure facilities.  The platform allows you to develop both centralized and distributed systems, including connecting any smart devices, and the functional features of the system are determined by the installed software. <br><br>  The manufacturer claims the following characteristics of the device: <br><a name="habracut"></a><table><tbody><tr><td>  CPU </td><td>  • CPU: Allwinner H5 Quad-core 64-bit Cortex A53 <br>  • RAM: 1GB <br>  • Storage: 8GB eMMC, MicroSD card </td></tr><tr><td>  operating system </td><td>  • Linux Debian or Ubuntu </td></tr><tr><td>  Communications </td><td>  • Network: Gbps Ethernet <br>  • WiFi: 802.11b / g / n <br>  • Bluetooth: 4.0 dual mode <br>  • Radio: 2.4 GHz <br>  • 2 x USB Host <br>  • 1 x RS485 </td></tr><tr><td>  I / O Ports </td><td>  • 4 “dry” contacts 350 v / 120 mA <br>  • 4 outputs 12 v / 1A <br>  • 4 inputs 0 - 12 v </td></tr><tr><td>  Status indication </td><td>  • OLED display <br>  • LED </td></tr><tr><td>  Nutrition </td><td>  • DC 12 v </td></tr></tbody></table><br><h3>  We prepare a client <br></h3><br>  The device comes in two versions: just “bare” hardware and a ready-made solution with software.  I got the first option, but it's even more interesting - there is where to frolic fantasies. <br><br>  The appearance of the device is rather ascetic: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/7e/rp/b87erppacywqripfkc5as0cvpxu.png"></div><br>  The housing of the device provides for mounting in a cabinet on a DIN rail and occupies four modules in width. <br><br>  On the front panel are: <br><br><ul><li>  display; </li><li>  four buttons; </li><li>  LED status indicator of the device (“red” - off, “green” - power is on, “blue” - shows the processor activity); </li></ul><br>  Under the covers are: <br><br><ul><li>  I / O connectors (at first glance it seemed to me that their number may be insufficient, but I will comment on this point just below); </li><li>  RS485 interface; </li><li>  power connection. </li></ul><br>  All connectors are made under the screw that pleased me, because I do not like clamping.  On the right side of the box there are no connectors and controls, which in general can be useful for more dense installation of equipment in the cabinet. <br><br>  On the left side all connectors are assembled: <br><br><ul><li>  removable WiFi antenna; </li><li>  2 USB; </li><li>  1 Eth </li><li>  audio jack. </li></ul><br>  WiFi antenna interferes with connecting USB devices and network cable.  It should either be turned down or carried to the front of the cabinet with a cable, the second option is probably more correct, thus improving the signal level. <br><br>  We proceed to the "opening of the patient" (the entire body is assembled on latches, it is easy to disassemble it) and see what it is inside / Open the front cover and see: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/j4/d4/kaj4d4omm3_z-78fnhmpqiv5ws4.png"></div><br><ul><li>  OLED display SSD1306 (128x64px): the screen is of course small, but you can get the minimum information; </li><li>  Four buttons for local control of the device, judging by the designation, to control the display of information on the screen; </li><li>  The power management button (as then figured out for the power management is responsible ATtiny13); </li><li>  RGB LED; </li><li>  Under the inscription is the antenna of the radio module. </li></ul><br>  We go further - we open the case and see that the device consists of three boards: the main board, the processor board is mounted on it and the “upper” board is connected to it with the front side, the front side of which is described above.  We examine them more closely: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/ty/hz/lttyhznbz7tcf5yn8dzppnqxjtc.png"></div><br><br><ul><li>  The processor module is a single-board computer NanoPi NEO Plus2.  Not too promoted by OBC, but very interesting from a technical point of view.  You can read about it <a href="http://wiki.friendlyarm.com/wiki/index.php/NanoPi_NEO_Plus2">here</a> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gp/3p/x-/gp3px-m9pebjgkevd2dnqi-fsbm.png"></div><br>  On the main board is located: <br><br><ul><li>  Protection against polarity reversal (thought out "protection against fools" is already quite good); </li><li>  The DC-DC converter on XL4005E1 5A makes us glad that we didn’t stint on a powerful Schottky diode (12A), but the coil was wound with a thin wire - 3A would pull, but wouldn’t load it, on the reverse side of the board there are polygons for cooling the converter, which adds confidence in the work (controlled by the converter from ATtiny13); </li><li>  The rest of the details are included according to standard schemes: voltage regulator AMS 1117 3.3 v, MCP23017 expander, SP3485 for RS485 interface, ADS1115 16-bit ADC, the presence of the BMP180 atmospheric pressure sensor was pleasantly surprised. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/iw/r_/qkiwr_vhzvpuc6l9aii7ovcb6u0.png"></div><br>  On the reverse side of the "upper" board installed: <br><br><ul><li>  RTC module DS3231; </li><li>  Port Expander PCF8574, responsible for handling key presses; </li><li>  Radio module nRF24L01P with amplifier. </li></ul><br><h3>  Use and programming </h3><br>  As I said, I got bare iron and had to check the work of the modules and the creation of scripts myself.  I didn’t philosophize, Linux took Armbian, and did all the programming in Python - quickly, cheaply and angrily!  All microcircuits are well known to a wide circle of radio amateurs; it is easy to find a description and basic applications. <br><br>  After studying the device formed an approximate list of tasks: <br><br><ol><li>  Through the outputs of "dry" contacts connect the contactors 220v.  (Get manageable power lines) </li><li>  To two outputs 12v / 1A and to two inputs to connect standard security and fire sensors.  (Get a fire and security system, without access to the remote, but it is often not necessary). </li><li>  Connect free inputs and outputs, leakage sensors and ball valves with 12 v electric drive.  (Get leak protection). </li><li>  Raise the WEB server and write the management interface (Get remote control). </li><li>  Check the connection by radio, WiFi and RS485 of additional devices (Check the possibility of building a distributed network). </li><li>  Check the USB modem. </li><li>  Check work as a router. </li></ol><br><img src="https://habrastorage.org/webt/zc/za/cu/zczacu4t1wrx2kogetbvn3kx53u.png"><br><br>  For testing, I quickly assembled a booth and began to amuse myself: <br><br>  ATtiny13 is already programmed, I did not let her touch be responsible for the power according to the manufacturer's plan. <br><br>  MCP23017, ADS1115, PCF8574, DS3231, BMP180 - all this works on I2C, so an understanding of the functioning of this bus immediately determines about 80% of the code.  Everything started (as expected), since the device addressing is already installed by the manufacturer. <br><br>  nRF24L01P works on the SPI bus, examples of which are also enough.  I contacted a pair of devices on the Arduino, everything works as intended. <br><br>  RS485 was tested on the Modbus protocol with an Eastron SDM220 electricity meter.  Indications are removed, no surprises have arisen. <br><br>  In USB, I plugged in the Huawei E1550 modem, everything was determined, picked up the vpn client and contacted the home server.  Installed a web server and played with remote control. <br><br>  The WiFi module works in both client mode and access point mode.  I switched the module to AP mode, installed a DHCP server, configured iptables and got a WiFi router. <br><br>  Installing a local Blynk server didn't cause any problems.  Checked work with ESP8266.  Control from the smartphone works, the readings are displayed. <br><br>  So, all the tasks are completed, the central device of the smart home is running!  It may seem that everything is programmed, adjusted easily and simply, or I am a genius. <br><br>  I assure you it is not so!  I have already encountered the majority of microcircuits and modules, so I attacked the rake earlier and my forehead hurt very much , but the bumps were gone, but the knowledge remained! <br><br>  The power of the processor module is more than enough to solve the problems I have set; during testing, the average load on the processor did not exceed 15%.  The presence of eMMC memory and microSD card will allow to organize the duplication of operating systems and software.  Consumption without connecting USB devices is about 300 mA.  With this consumption, it is easy to organize uninterrupted power supply from a battery for 5 hours. <br><br>  The selected element base for the construction of the periphery is quite reliable, which gives confidence for the smooth operation of the device in the 24x7 mode. <br><br>  The presence of a small number of inputs and outputs on the device itself is completely compensated by the presence of 485 bus and a radio module, that is, building a distributed control system will not be difficult, and the set of inputs and outputs that is on board can be used for local control in the power cabinet. <br><br><h3>  findings </h3><br>  Will this device, declared by the manufacturer, integrate all smart devices?  With some stretch, you can say that you will.  But unfortunately, there is not enough radio module for 433 MHz, CAN-bus, ZigBee support, but the presence of RS485, radio module at 2.4 GHz and WiFi will allow you to connect a sufficient number of devices, and the interaction protocols can be implemented programmatically. <br><br>  I repeat, the device under consideration is produced in two versions: a completely ready-made solution for building a distributed control system and only “hardware”.  In my opinion, you can buy a ready-made solution only if you do not want to deal with programming and laziness.  In other cases, it is much more interesting to take the platform and program it for yourself. <br><br>  The cost of the device is currently unknown to me.  In my opinion, if the manufacturer does not drive the price more than 13 tr.  for the "bare" version, then this device is quite interesting to purchase.  Having bought all the parts in China and packaged it in a single case, you are unlikely to get cheaper. <br><br>  The competitor may be <a href="https://geektimes.ru/company/wirenboard/blog/274530/">Wiren Board 5</a> .  He wins in the number of ports and possible interfaces, but loses in the power of the processor module.  This does not affect standard tasks in any way, but installing a Blynk server locally or making a voice control module can be problematic.  If anyone tried to do this on WB5, please comment in the comments. <br><br>  <b>PS:</b> Having already finished the article, I also found the ATSHA204 cryptography chip on the board.  It supports the SHA ‑ 256 cryptographic algorithm and is well suited for symmetric authentication tasks.  Well, this is quite for Geeks! </div>