<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Increasing the informational content of errors in Go - github.com/ztrue/tracerr</title>
  <meta name="description" content="After many years of experience working with php and js, I‚Äôm used to having the error in the errors and looking at the place where the error occurred d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Increasing the informational content of errors in Go - github.com/ztrue/tracerr</h1><div class="post__text post__text-html js-mediator-article">  After many years of experience working with php and js, I‚Äôm used to having the error in the errors and looking at the place where the error occurred directly from the error report.  After reseeding Go a couple of years ago, I was somewhat surprised that there are other rules in Go and you need to guess the setrays for some line of the  ªinvalid character` type.  And if it happened on the prode and it is not known how to reproduce it, then it turned into a whole attraction. <br><br>  Since I am sure that not one suffered from this, I made a package that can do this: <br><br> <a href="https://github.com/ztrue/tracerr"><img src="https://habrastorage.org/webt/r4/ck/uz/r4ckuzglosfy6oz2qfokxiakngs.png" alt="golang error output"></a> <br><br>  ‚Üí <a href="https://github.com/ztrue/tracerr">GitHub</a> <br><a name="habracut"></a><br>  All he does is: <br><br><ol><li>  Adds to the error of the error. </li><li>  Displays the template and source code fragments where this error occurred (in the presence of source codes, of course). </li></ol><br><h3>  Add feature </h3><br>  You can create an error with the model in one of several ways: <br><br><pre><code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é err := tracerr.New("some error") // –º–æ–∂–Ω–æ –º–µ—Ç–æ–¥–æ–º Errorf, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ fmt.Errorf err := tracerr.Errorf("some error %d", num) // –∏–ª–∏ –æ–±–µ—Ä–Ω—É—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –æ—à–∏–±–∫—É, –¥–æ–±–∞–≤–∏–≤ –µ–π —Å—Ç–µ–∫—Ç—Ä–µ–π—Å err = tracerr.Wrap(err)</span></span></code> </pre> <br>  When the error is re-wrapped, the spectra will remain the same and will not be overwritten, this is convenient if it is not known whether the error already has a spectra or not. <br><br>  The code might look something like this: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, data </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { b, err := ioutil.ReadFile(path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tracerr.Wrap(err) } err = json.Unmarshal(b, data) <span class="hljs-comment"><span class="hljs-comment">// –µ—Å–ª–∏ err = nil, —Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è nil return tracerr.Wrap(err) }</span></span></code> </pre><br><h3>  Displaying the frame </h3><br>  After the error through 100500 <code>if err != nil { return err }</code> returns to the Motherland in <code>main()</code> (or where it is processed), most likely you will want to display or log it. <br>  There are several options for this: all work like Print (prints text) or Sprint (returns text): <br><br>  1) Display the text of the error and the frame: <br><br><pre> <code class="go hljs">tracerr.Print(err)</code> </pre><br>  2) Display the error text, the spectra and a fragment of the source code (6 lines by default): <br><br><pre> <code class="go hljs">tracerr.PrintSource(err)</code> </pre><br>  3) Same, but in color, usually more informative: <br><br><pre> <code class="go hljs">tracerr.PrintSourceColor(err)</code> </pre><br>  4) You can pass as a parameter how many lines of code to display: <br><br><pre> <code class="plaintext hljs">tracerr.PrintSource(err, 9) tracerr.PrintSourceColor(err, 9)</code> </pre><br>  5) Or transfer 2 optional parameters, how many before and how many after the line with an error to display: <br><br><pre> <code class="go hljs">tracerr.PrintSource(err, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) tracerr.PrintSourceColor(err, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br><h3>  Questions </h3><br>  I have already received some feedback, so I will allow myself to answer in advance some questions that have already been asked. <br><br>  <i>Q: Is this only for debugging?</i>  <i>There is a debugger.</i> <br>  A: This is not only suitable for debugging, you can log errors with information about the setrace, and even with fragments of source codes, in the sale, as in my experience, this will greatly simplify later to disassemble these errors. <br><br>  <i>Q: There is a super pkg / errors package, why not use it?</i> <br>  A: Yes, I used it quite well and was glad, but it didn‚Äôt suit me for these reasons: <br>  1) There is no easy way to display the template right from the source. <br>  2) When re-wrapping the error (for example, one level higher), the grid-frame is overwritten by less informative. <br>  3) With each wrapping, it is necessary to transfer an additional text of the error, which seems to me to be some overhead-leader when writing / reading code. <br><br>  <i>Q: In Go, errors are not exceptions, and you can't do that at all.</i> <br>  A: I agree, in Go, errors are not exceptions.  If it is more convenient for you to process thousands of <code>if err != nil { return err }</code> some other way - this is your choice, of course.  You can only wrap errors that you treat as exceptions. <br><br>  <i>Q: Stektreys adds overhead to performance.</i> <br>  A: Yes, it adds, but this is relevant only for places where errors are created in large quantities, just do not add a glass trace there if it is critical (I am sure that in most cases this overhead is insignificant). <br><br>  In general, I hope this package will make your gofer life somewhat easier, I will be glad to any feedback, thanks. </div><p>Source: <a href="https://habr.com/ru/post/440008/">https://habr.com/ru/post/440008/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>