<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>App for iOS and Android on Kotlin + Flutter UI</title>
  <meta name="description" content="Introduction 
 Hello. Some time ago, I decided to do my project for Android and iOS at the same time. Naturally, the question arose about the choice o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>App for iOS and Android on Kotlin + Flutter UI</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/tn/n5/ey/tnn5eyx2-qajug1osnh-iduaoss.png" alt="image"><br><br><h2>  Introduction </h2><br>  Hello.  Some time ago, I decided to do my project for Android and iOS at the same time.  Naturally, the question arose about the choice of technology.  A couple of weeks, I watched the popular stacks and chose Kotlin / Native.  Since I am an Android developer, I‚Äôve been familiar with Kotlin for a long time, but I didn‚Äôt have much experience with Swift and I wanted to get most of the code common to both platforms.  Therefore, the question immediately arose, and how to write a UI for iOS.  A quick glance at the market prompted Flutter, which allows you to write UI for two platforms at the same time.  Actually, this is how the story began. <br><br>  The article describes the Flutter build experience as a UI and Kotlin for the main logic.  <b>Important:</b> under the cut a lot of pictures and instructions on how to build a project <br><a name="habracut"></a><br><h3>  Table of contents </h3><br><ul><li>  <a href="https://habr.com/ru/post/437176/">Creating a shared library on Kotlin</a> </li><li>  <a href="https://habr.com/ru/post/437176/">Creating an Android Application</a> </li><li>  <a href="https://habr.com/ru/post/437176/">Create an iOS project</a> </li><li>  <a href="https://habr.com/ru/post/437176/">Adding Flutter to Android Application</a> </li><li>  <a href="https://habr.com/ru/post/437176/">Adding Flutter to an iOS project</a> </li><li>  <a href="https://habr.com/ru/post/437176/">Conclusion</a> </li></ul><br><h2>  Part 1 </h2><a name="Part1"></a><br><h3>  Creating a shared library on Kotlin </h3><br><ol><li>  Choosing the Kotlin Mobile Shared library <br><br><img src="https://habrastorage.org/webt/9v/ih/vf/9vihvf3lnf6ppc1lppe_mpsqjxm.png" alt="image"></li><li>  Further <br><br><img src="https://habrastorage.org/webt/sm/xm/i1/smxmi1x1g3ru3qaiy8l8knekwsm.png" alt="image"></li><li>  We specify our working folder, here I made a separate folder for the project.  Since I will have 4 different projects and it is more convenient to keep them in one place. <br><br><img src="https://habrastorage.org/webt/gg/cm/p7/ggcmp7a-lfkfykiahtf8fmr26bu.png" alt="image"></li><li> It remains to indicate in <code>local.properties</code> path to <code>sdk.dir</code> and the project starts to build, I have the path <code>/Users/vlad/Library/Android/sdk</code> <br><br><img src="https://habrastorage.org/webt/s1/qs/ma/s1qsmae_reifkslk0t94n1waibq.png" alt="image"></li><li>  Project structure, change package names from <code><code>sample –Ω–∞</code> habr.example</code> <br><br><img src="https://habrastorage.org/webt/tx/xa/sp/txxaspup0aj21roktmzrse3wpre.png" alt="image"></li><li>  It's time to start publishing, call the <code>wrapper</code> .  After that, we will have a .gradlew <code>.gradlew</code> in the project and it will be possible to work with it from the terminal. <br><br><img src="https://habrastorage.org/webt/hq/tt/ex/hqttexr0kbmajyia4nb-_bm7zvy.png" alt="image"></li><li>  Run from the terminal <code>./gradlew publishToMavenLocal</code> <br><br><img src="https://habrastorage.org/webt/2l/zz/q3/2lzzq3aic0tvmactva-ckfyijgg.png" alt="image"></li><li>  After that, in the local maven repository, we will have 4 folders in which our libraries will be located <br><br><img src="https://habrastorage.org/webt/tx/j9/hu/txj9hupusxcluuq-xl8zxmms7m8.png" alt="image"></li></ol><br><h2>  Part 2 </h2><a name="Part2"></a><br><h3>  Creating an Android Application </h3><br>  Create android project <br><br><div class="spoiler">  <b class="spoiler_title">It's all standard</b> <div class="spoiler_text"><br><img src="https://habrastorage.org/webt/6z/i4/yl/6zi4yli8ggxwaheqsrt9rqeyiqg.png" alt="image"><br><br><img src="https://habrastorage.org/webt/dx/ay/at/dxayatfq4rdaxi0yfn0yuakepoa.png" alt="image"><br><br><img src="https://habrastorage.org/webt/ae/nm/lp/aenmlp8jhosi8tjthkiqq2wpd1k.png" alt="image"><br><br><img src="https://habrastorage.org/webt/05/ic/nc/05icncf4al2slfyas4kbcsgp4my.png" alt="image"><br></div></div><br><ol><li>  At the time of this writing, the project is generated with a ‚Äúbat‚Äù dependency, so we remove it at the end of <code>jre7</code> , it will turn out <code>koltin-stdlib</code> , after that the project will start to build <br><br><img src="https://habrastorage.org/webt/4m/jy/vv/4mjyvvguzs20la2elbcxvprwxda.png" alt="image"></li><li>  Open <code>build.gradle</code> and add <code>mavenLocal</code> <code>repositories</code> section.  <b>Important!</b>  The <code>repositories</code> section should be the one inside <code>allprojects</code> and not in <code>buildScript</code> <br><br><img src="https://habrastorage.org/webt/_p/az/7w/_paz7wevjbjnt_qclsoniuqlbpw.png" alt="image"></li><li>  Now we can add our library as a dependency. <br> <code>implementation 'habr.example:commonLibrary-jvm:0.0.1'</code> <br> <br><img src="https://habrastorage.org/webt/yu/fw/2s/yufw2sv7ujhsfkta0pxx655jbaq.png" alt="image"></li><li>  Open <code>activity_main.xml</code> and specify <code>main_activity_text</code> in <code>TextView</code> id <br><br><img src="https://habrastorage.org/webt/fu/io/_h/fuio_hytjxh69uzbhcn794n8wsg.png" alt="image"></li><li>  In <code>MainActivity.kt</code> just set the text in this <code>TextView</code> <br><br><img src="https://habrastorage.org/webt/xb/a2/ko/xba2kofenukufnaiy5dyukz1wzq.png" alt="image"></li><li>  Great, by this moment we have an Android application that can use the <code>hello()</code> function from our library. <div class="spoiler">  <b class="spoiler_title">hello () on the emulator</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hx/np/hn/hxnphnn6gcund5pwchqsupx9py4.png" alt="image"></div></div></li></ol><br><h2>  Part 3 </h2><a name="Part3"></a><br><h3>  Create an iOS project </h3><br><ol><li>  Choose Single View App <br><br><img src="https://habrastorage.org/webt/wh/sm/rd/whsmrdovqwginog3ork9m-ixl6e.png" alt="image"></li><li>  Fill in the basic information and select the folder.  Here it is important to choose the folder root for our other projects, since in it Xcode will create a subfolder with the name of the project <br><br><img src="https://habrastorage.org/webt/dm/0n/ek/dm0nekavglxijkgxn2aqevqzewu.png" alt="image"><br><br><img src="https://habrastorage.org/webt/zz/ar/l3/zzarl3w00bmqb5_trebibfdys_s.png" alt="image"></li><li>  First we add <code>CocoaPods</code> .  To do this, run <code>pod init</code> in the project folder, close the project in <code>Xcode</code> and run <code>pod install</code> .  We see that the installation was completed successfully. <br><br><img src="https://habrastorage.org/webt/-u/gs/yl/-ugsylzq2r2dynkhhf-oiao60t8.png" alt="image"></li><li>  <b>Important!</b>  On the <code>CocoaPods</code> site, <code>CocoaPods</code> not recommended to add the <code>/Pods</code> folder to <code>.gitignore</code> , but I did it anyway.  Since after adding <code>flutter</code> , we will reconfigure dependencies for each <code>build</code> .  So far, I like this solution more than cluttering up <code>.git</code> </li><li>  Open the project through the file <code>Awesome App.xcworkspace</code> <br><br><img src="https://habrastorage.org/webt/op/lc/tb/oplctbpukazz8zvqmk5joh9__l0.png" alt="image"></li><li>  We open the terminal, in it we go to the folder of our <code>commonLibrary</code> and run <code>./gradlew linkDebugFrameworkIos</code> .  After that, <code>iOSFramework</code> appears in our <code>build</code> folder <code>iOSFramework</code> <br><br><img src="https://habrastorage.org/webt/js/wa/60/jswa60y2wu1kjt6sjgeqtjc6rsm.png" alt="image"></li><li>  Choose Target <br><br><img src="https://habrastorage.org/webt/ib/df/mk/ibdfmkvpdousduhvyhkudid0jke.png" alt="image"></li><li>  And for this Target we add a binary <br><br><img src="https://habrastorage.org/webt/ca/z8/86/caz8860hcerj6i9viyftgsv8emo.png" alt="image"></li><li>  Choose Add Other <br><br><img src="https://habrastorage.org/webt/xq/5a/xj/xq5axjattke900eciiyfck5uxky.png" alt="image"></li><li>  Specify the path to the <code>framework</code> , which was obtained in step 6 ( <code>commonLibrary.framework</code> ) <br><br><img src="https://habrastorage.org/webt/5-/8w/wd/5-8wwdjjm2ydn-5xtjoox7ayn7i.png" alt="image"><br><br><img src="https://habrastorage.org/webt/kb/3-/rn/kb3-rn2dsfenbg6m6hycwljqrjo.png" alt="image"></li><li>  Now in the project we should display this <code>framework</code> <br><br><img src="https://habrastorage.org/webt/07/0m/0y/070m0yvsht6bwx-spupgst_oe1i.png" alt="image"></li><li>  Go to <code>Build Settings</code> and disable <code>Enable Bitcode</code> <br><br><img src="https://habrastorage.org/webt/qv/f8/me/qvf8meu7dhulzmhyjxbwjs_mvrw.png" alt="image"></li><li>  Now you need to specify exactly where to look for our <code>framework</code> , open the <code>Framework Search Path</code> <br><br><img src="https://habrastorage.org/webt/mm/er/qn/mmerqn5fmpnbb18rtl1xqroa3uu.png" alt="image"></li><li>  Specify the path <code>"${PODS_ROOT}/../../commonLibrary"</code> .  Be sure to choose <code>recursive</code> .  Of course, you can do without it, if you more accurately configure the path.  But, since this is only the beginning of the project, now it is important for us to make sure that this whole bundle will work.  And we can change the way and then <br><br><img src="https://habrastorage.org/webt/nr/t6/4h/nrt64hosrv4amzwaggq21z2czk4.png" alt="image"></li><li>  It is necessary to make so that at each <code>build</code> in <code>Xcode</code> our <code>framework</code> with the help of <code>gradle</code> .  Open <code>Build Phases</code> <br><br><img src="https://habrastorage.org/webt/v_/fw/tp/v_fwtptscjajeguglhiagdr3jke.png" alt="image"></li><li>  Add a new <code>Script Phase</code> <br><br><img src="https://habrastorage.org/webt/lu/qi/gi/luqigim-6ssgxd-vmy_3kstef6s.png" alt="image"></li><li>  Add script code. <br><br><pre> <code class="ruby hljs">cd <span class="hljs-string"><span class="hljs-string">"${PODS_ROOT}/../../commonLibrary"</span></span> echo $(pwd) ./gradlew linkIos</code> </pre> <br>  Here we just go to the project folder of our library and run <code>./gradlew linkIos</code> .  The call <code>echo $(pwd)</code> needed only to show in the console which folder we are in <br><br><img src="https://habrastorage.org/webt/li/-c/yd/li-cydckaogxfa66p5n9cmebbwg.png" alt="image"></li><li>  We shift our <code>build phase</code> to the very top, right after <code>target dependencies</code> <br><br><img src="https://habrastorage.org/webt/v4/kw/yz/v4kwyzblhw49ukhiazvvm_3yk3i.png" alt="image"></li><li>  Now open the <code>ViewController</code> and add a call to our function from the library. <br><br><img src="https://habrastorage.org/webt/ru/r6/03/rur603vthj9viihpxh2k8mvscmg.png" alt="image"></li><li>  We start our project and see <br><br><img src="https://habrastorage.org/webt/g0/r5/_v/g0r5_v0jincaisukye4vixbcbya.png" alt="image"></li></ol><br>  Great, it means that we correctly connected the Kotlin Library to the iOS project. <br>  All that remains is to add flutter, as a framework for writing UI, to our applications and you can start developing the product. <br><br><h2>  Part 4 </h2><a name="Part4"></a><br><h3>  Adding Flutter to Android Application </h3><br>  Here the article on <a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps">github</a> really helped me. <br><br><ol><li>  Go to the root folder where all our projects are located and do <code>flutter create -t module flutter_ui</code> <br><br><img src="https://habrastorage.org/webt/7h/m2/hb/7hm2hbcpuh0l9i5acnr6jmkpjk0.png" alt="image"><br></li><li>  Open <code>settings.gradle</code> and enable our flutter module as a subproject <br><br><img src="https://habrastorage.org/webt/qo/cn/od/qocnodbi3qtq4cjjfdw7bdtkn40.png" alt="image"><br></li><li>  Open the build.gradle file and add our project depending <br><br><img src="https://habrastorage.org/webt/-6/c_/ez/-6c_ezkjqkqc_zdvdrw8snv1kdi.png" alt="image"><br></li><li>  <code>MainActivity.kt</code> to <code>FlutterActivity</code> <br><br><img src="https://habrastorage.org/webt/sg/ji/th/sgjith4j4y16zlsa9mwchkudjae.png" alt="image"><br></li><li>  Add <code>App.kt</code> , in which we will initialize <code>Flutter</code> when the application starts <br><br><img src="https://habrastorage.org/webt/ox/nx/mf/oxnxmfhqw1mdir99e3pcd-pny7g.png" alt="image"><br></li><li>  We change the manifest and say that now we have a class for <code>Application</code> <br><br><img src="https://habrastorage.org/webt/mx/zm/an/mxzman7erwk9r7kqbybzcppeo94.png" alt="image"><br></li><li>  Be sure to add <code>java8</code> , without this flutter will not start <br><br><img src="https://habrastorage.org/webt/lu/ha/t4/luhat4wsecwx0zsuenocq4fkbc0.png" alt="image"><br></li><li>  We see the UI in the <u>Hello from JVM</u> logs, which means that we have gathered the UI on Flutter and the main library on Kotlin / Native <br><br> <a href=""><img src="https://habrastorage.org/webt/rb/-0/2u/rb-02uakaz1-62vubrmax6g0bso.png"></a> <br><br><img src="https://habrastorage.org/webt/3g/bm/az/3gbmazzp7tktkmgsutsgrdpjih8.png" alt="image"><br></li><li>  Add a method to the <code>MainActivity.kt</code> , which we will call from Flutter.  Here, on an event from Flutter, we return our <code>hello()</code> from the kotlin-library <br><br><img src="https://habrastorage.org/webt/ai/uq/hp/aiuqhpmvl823rrhvjj8yhlsvymc.png" alt="image"><br></li><li>  And add to <code>main.dart</code> code that will call the method in the <code>iOS/Android-—á–∞—Å—Ç–∏</code> application <br><br><img src="https://habrastorage.org/webt/vc/lp/rz/vclprz5zjtbqdczannng6t_teoi.png" alt="image"><br></li><li>  Get <br> <a href=""><img src="https://habrastorage.org/webt/1i/49/8v/1i498vcqirringj5rr8sz1cbmyw.png"></a> <br></li></ol><br><h2>  Part 5 </h2><a name="Part5"></a><br><h3>  Adding Flutter to an iOS Application </h3><br><ol><li>  Update our <code>Podfile</code> <br><pre> <code class="ruby hljs">flutter_application_path = File.expand_path(<span class="hljs-string"><span class="hljs-string">"../flutter_ui"</span></span>, File.dirname(path)) eval(File.read( File.join( flutter_application_path, <span class="hljs-string"><span class="hljs-string">'.ios'</span></span>, <span class="hljs-string"><span class="hljs-string">'Flutter'</span></span>, <span class="hljs-string"><span class="hljs-string">'podhelper.rb'</span></span>)), binding)</code> </pre><br><img src="https://habrastorage.org/webt/62/tp/zl/62tpzluojshpo3s1ctpgio55dos.png" alt="image"><br><br><img src="https://habrastorage.org/webt/8h/le/_z/8hle_zsuchlejqtqob8ddse39k8.png" alt="image"></li><li>  <b>Is important</b> .  Add <code>$(inherited)</code> to the first line of the <code>framework search paths</code> .  Be sure to check that your <code>framework search paths</code> not empty. <br><br><img src="https://habrastorage.org/webt/kb/yi/n-/kbyin-eec4jk_jpypglbhnmkonw.png" alt="image"><br><br>  When you change dependencies in <code>some/path/my_flutter/pubspec.yaml</code> , you need to run <code>flutter packages get</code> from <code>some/path/my_flutter</code> to update the dependencies in <code>podhelper.rb</code> .  After that, you need to run <code>pod install</code> from <code>some/path/MyApp</code> </li><li>  Add another 1 <code>Build Phase</code> , only for Flutter.  <b>Above what we added in part 3 of the</b> <code>Script phase</code> <br><br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">"$FLUTTER_ROOT/packages/flutter_tools/bin/xcode_backend.sh"</span></span> build <span class="hljs-string"><span class="hljs-string">"$FLUTTER_ROOT/packages/flutter_tools/bin/xcode_backend.sh"</span></span> embed</code> </pre><br><img src="https://habrastorage.org/webt/qn/cu/ae/qncuaeb_4nit-13xc-0dzdlobu4.png" alt="image"></li><li>  <code>AppDelegate</code> our <code>AppDelegate</code> with <code>FlutterAppDelegate</code> <br><br><img src="https://habrastorage.org/webt/x6/qd/oy/x6qdoylgfgde0jzsryehlfi4nt0.png" alt="image"></li><li>  Update <code>ViewController</code> <br><br><img src="https://habrastorage.org/webt/7y/oi/x5/7yoix508vlyhyvgzx-dlcnklvwk.png" alt="image"></li><li>  Wrap our <code>ViewController</code> in <code>NavigatorController</code> <br><br><img src="https://habrastorage.org/webt/xb/kg/5h/xbkg5hxwfttdgo3vlihibgwtzya.png" alt="image"> <a href=""><img src="https://habrastorage.org/webt/ul/yf/wu/ulyfwu_khrnskwnggz4-aeianma.png"></a> </li><li>  Now the application starts.  But, so far, we have no connection between the library and flutter. <a href=""><img src="https://habrastorage.org/webt/4x/wl/gz/4xwlgzn-gdy5ejb4s3kxcawtpio.png"></a> </li><li>  Add this link using <code>FlutterMethodChannel</code> <br><br><img src="https://habrastorage.org/webt/is/ah/3s/isah3stvmthus7why381vaikabq.png" alt="image"><br></li><li>  Great, now the iOS application uses <code>flutter</code> for the <code>UI</code> and <code>kotlin</code> for the main logic <br><br> <a href=""><img src="https://habrastorage.org/webt/mq/ss/jg/mqssjg0c9ln11i-_vik9qxjwejc.png"></a> <br></li></ol><br><h2>  Conclusion <a name="Conclusion"></a></h2><br>  What is important to say here: I do not pretend that you have learned something new or unique.  I just shared my experience, because in order to make it all work together, I spent about 4 working days.  And I could not find examples of project code that uses both Kotlin / Native and Flutter simultaneously <br><br>  Final Projects <br><br><ol><li>  <a href="https://gitlab.com/habr-example-flutter-and-kotlin">project group</a> </li><li>  <a href="https://gitlab.com/habr-example-flutter-and-kotlin/flutter-ui">flutter-ui</a> </li><li>  <a href="https://gitlab.com/habr-example-flutter-and-kotlin/ios">ios</a> </li><li>  <a href="https://gitlab.com/habr-example-flutter-and-kotlin/android">android</a> </li><li>  <a href="https://gitlab.com/habr-example-flutter-and-kotlin/common-library">common-library</a> </li></ol><br>  List of links that helped me, but not immediately <br><br><ol><li>  <a href="https://flutter.io/">Flutter himself</a> </li><li>  Communication between native code and UI <a href="https://flutter.io/docs/development/platform-integration/platform-channels">flutter platform-channels</a> </li><li>  Add flutter to existing <a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps">github</a> application </li><li>  Kotlin Native <a href="https://kotlinlang.org/docs/reference/native-overview.html">native-overview</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/437176/">https://habr.com/ru/post/437176/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>