<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why do you need low-level optimization on Elbrus or how to speed up the recognition system by one and a half times</title>
  <meta name="description" content="When we met in 2019 and had a little rest from developing new features for the Smart IDReader, we remembered that we had not written anything about do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Why do you need low-level optimization on Elbrus or how to speed up the recognition system by one and a half times</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/ld/rm/lyldrmwtslapvbi5e1tzou01qpq.jpeg"></div><br><p>  When we met in 2019 and had a little rest from developing new features for the Smart IDReader, we remembered that we had not written anything about domestic processors for a long time.  Therefore, we decided to urgently fix and show another recognition system on Elbrus. </p><br><p>  As a recognition system, the system of recognition of objects of painting ‚Äúunder uncontrollable conditions by the method with one-example training‚Äù was considered [1].  This system builds a description of the image based on the singular points and their descriptors, which performs a search in the indexed database of paintings.  We analyzed the performance of this system and identified the most time-consuming low-level part of the algorithm, which was then optimized using the tools of the Elbrus platform. </p><a name="habracut"></a><br><h3 id="o-kakoy-raspoznayuschey-sisteme-voobsche-idet-rech">  What is the recognition system in general? </h3><br><p>  Currently, most museums and galleries use a variety of tools to familiarize themselves with the exhibition.  Along with classic audio guides, mobile applications using image processing and analysis methods are widely used.  Some of these applications recognize the graphic codes of the exhibits (bar or QR) [2], for others [3-4] the input data are photo or video frames with an exhibit taken close-ups (Smartify, Artbit).  Of course, the ‚Äúmobile guides‚Äù of the latter category are more convenient for the user [5] than solutions with manual input of the exhibit number or recognition of QR: the number and code are rather small, and their search and input require additional actions not related to the exposure review.  This is the system we will consider. </p><br><p>  The task of recognizing the works of painting on the images was formulated as follows.  Image request <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.419ex" viewBox="0 -780.1 791.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-51" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> Q </script>  should be assigned to one of the classes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="noError" id="MJXp-Span-4" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C = \ {C_i \} _ {i \ in [0, N]}</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">C&nbsp;=&nbsp;\&nbsp;{C_i&nbsp;\}&nbsp;_&nbsp;{i&nbsp;\&nbsp;in&nbsp;[0,&nbsp;N]}</span></span><script type="math/tex" id="MathJax-Element-2"> C = \ {C_i \} _ {i \ in [0, N]} </script>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.461ex" height="2.419ex" viewBox="0 -780.1 1059.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> C_i </script>  - image class <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> i </script>  th exhibit, with <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">[ </font></span><span class="MJXp-mn" id="MJXp-Span-17"><font style="vertical-align: inherit;">1 </font></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;">, </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;">N </font></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">]</font></span></font><span class="MJXp-mtext" id="MJXp-Span-13">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-17"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.134ex" height="2.66ex" viewBox="0 -832 3932.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-6E" x="941" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMAIN-5B" x="1541" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMAIN-31" x="1820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMAIN-2C" x="2320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-4E" x="2765" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMAIN-5D" x="3654" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> i \ in [1, N] </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-24" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.716ex" height="2.419ex" viewBox="0 -780.1 1169.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMAIN-30" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> C_0 </script>  - class of other images corresponding to the value of "unknown picture".  For each <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-msubsup" id="MJXp-Span-26"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-28" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.461ex" height="2.419ex" viewBox="0 -780.1 1059.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> C_i </script>  set the reference image <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-32" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.157ex" height="2.419ex" viewBox="0 -780.1 928.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-54" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-69" x="826" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> T_i </script>  . <br>  In addition, we were guided by the following assumptions: </p><br><ol><li>  Image request <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.419ex" viewBox="0 -780.1 791.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-51" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-9"> Q </script>  obtained by the camera of the mobile device by an unprepared user during the tour, therefore: <br>  a) it may contain visual defects - glare, defocused areas, noise; <br>  b) the angle, framing, lighting and color balance are unknown (Fig. 1a); <br>  c) there may be foreign objects in the picture, such as decorations, picture frames, visitors (Fig. 1b). </li><li>  Image reference <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-10"> T </script>  It is a high resolution image with a frontal projection of the picture or its digital reproduction.  The standard does not contain foreign objects and visual defects.  Reference standards can be, for example, high-quality scanned pages of art albums (Fig. 2). </li><li>  The picture (both on request and on the standard) can relate to any style - realism, <br>  impressionism, abstractionism, fractal graphics, etc. </li><li>  Number of classes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/smartengines/blog/438948/&amp;xid=17259,15700022,15700186,15700191,15700248&amp;usg=ALkJrhiua-fdRAWYxxHIlDwz23zqNac-Ug#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> N </script>  fits the size of the collection and for one gallery can reach <br>  hundreds of thousands of exhibits [6]. </li></ol><br><img src="https://habrastorage.org/webt/_f/ud/yw/_fudywtqtobjv6xx2asfj0e-7em.png"><br><p>  <em>Figure 1 - Examples of image requests a) the picture was photographed from a distance in low light, b) the visitor in the frame.</em> </p><br><img src="https://habrastorage.org/webt/dn/e5/uz/dne5uzig5x0pwsikf-f4ykgedmo.png"><br><p>  <em>Figure 2 - Examples of image-standards for paintings a) Claude Monet "De Voorzaan en de Westerhem", b) Salvador Dali "La persist√®ncia de la mem√≤ria"</em> </p><br><p>  The main idea of ‚Äã‚Äãour solution to this problem is based on constructing a special description of a picture from an input image, which is then used to search for this picture in the base of descriptions of reference images of high-resolution pictures that are not subject to geometric distortion and other photodefects.  Such descriptions are the coordinates of the singular points found using the YACIPE algorithm [7], and their RFD descriptors. </p><br><p>  For each reference <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-39"><span class="MJXp-msubsup" id="MJXp-Span-40"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-42" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> T_i </script>  we will construct the description, and then we will index it - for each point in the description we will put a record of the form <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="MJXp-mtext" id="MJXp-Span-44">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-53"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-55" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"> r </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60"><font style="vertical-align: inherit;">g </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61"><font style="vertical-align: inherit;">l </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62"><font style="vertical-align: inherit;">e</font></span></font><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> \ langle i, f_i \ rangle </script>  in a randomized hierarchical clustering search tree [8], which allows you to perform an approximate search for the nearest neighbors with a significant gain in speed compared to a linear search.  Hamming distance is used as a metric, since we use a binary descriptor. </p><br><p>  The recognition process is as follows: </p><br><ol><li><p>  On request image <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> Q </script>  painting area <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-65"><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-68" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> Q_L </script>  pre-localized using the assumption about the squareness of the frame.  A zone search is performed using the fast quadrangle search algorithm [9] with the aspect ratio removed.  This prevents the following problems: <br>  - insufficient description of the area of ‚Äã‚Äãthe picture due to extraneous objects in the frame, which may have special points with the best estimates; <br>  - computational cost of matching descriptors of regions located outside the picture; <br>  - a significant discrepancy between the scale and the angle of inclination between the standard in the base and the picture of the picture, which leads to an incorrect result of the descriptor matching. </p><br></li><li><p>  The image in the found zone is projectively normalized: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-69"><span class="MJXp-msubsup" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q </font></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-72" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-73" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mo" id="MJXp-Span-75" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-76"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="MJXp-mo" id="MJXp-Span-80" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-16"> Q ^ * = H (Q_L), </script></p><br><p>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> H </script>  - projective transformation. </p><br></li><li><p>  Building a compact description <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-83"><span class="MJXp-msubsup" id="MJXp-Span-84"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-86" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> w ^ * </script>  : <br>  a) the image is reduced to the standard size while preserving the proportions in order to make the algorithm more resistant to scaling; <br>  b) high-frequency noise is suppressed by a Gaussian filter; <br>  c) special points are calculated on the resulting image, their number is artificially limited to <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-87"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> M </script>  best rated by internal YACIPE; <br>  d) color RFD-like descriptors of the neighborhoods of the found points found are computed, since in our task it was important to store information about the color characteristics of the input images.  For example, the paintings in Fig.  3 it would be extremely difficult to distinguish without it; <br>  e) thus the description of the image <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> I </script>  can be represented as: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-91"><span class="noError" id="MJXp-Span-92" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w ^ * = \ {\ langle p_i, f_i) \ rangle \} _ {i \ in [1, M]}</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> w ^ * = \ {\ langle p_i, f_i) \ rangle \} _ {i \ in [1, M]} </script>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-93"><span class="MJXp-msubsup" id="MJXp-Span-94"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-96" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-97" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-98">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">e</span><span class="MJXp-msubsup" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-107" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-108" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-111" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-112">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">e</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> p_i = \ langle x_i, y_i \ rangle </script>  - coordinates of the i-th singular point, and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-119"><span class="MJXp-msubsup" id="MJXp-Span-120"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-122" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> f_i </script>  - A handle to the neighborhood of the i-th singular point. </p><br></li><li><p>  For each entry <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-123"><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">p</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">f</span><span class="MJXp-mtext" id="MJXp-Span-134">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">e</span><span class="MJXp-mtext" id="MJXp-Span-141">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">n</span><span class="MJXp-msubsup" id="MJXp-Span-144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145" style="margin-right: 0.05em;">w</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-146" style="vertical-align: 0.5em;">‚àó</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> \ langle p, f \ rangle \ in w ^ * </script>  in the index, an approximate search is performed for the nearest neighbors of the descriptor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> f </script>  .  The voting procedure - descriptor is applied to the found descriptors. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-149"><span class="MJXp-msubsup" id="MJXp-Span-150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-152" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> f_i </script>  adds voice to standard <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-153"><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155" style="margin-right: 0.05em;">T</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-156" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> T_i </script>  .  Then K candidate standards with the highest number of votes are selected. </p><br></li><li><p>  For each of <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">K</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> K </script>  selected variants using the RANSAC algorithm searches for a projective transformation <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-159"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">H</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> H </script>  , translating, within a given geometric error <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-161"><span class="MJXp-mtext" id="MJXp-Span-162">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> \ delta </script>  query points <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-msubsup" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170" style="margin-right: 0.05em;">Q</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-171" style="vertical-align: 0.5em;">‚àó</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> Q ^ * </script>  to the points of reference <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> T </script>  .  A couple of points <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-174"><span class="MJXp-mtext" id="MJXp-Span-175">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">p</span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msup" id="MJXp-Span-184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185" style="margin-right: 0.05em;">p</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-186" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mtext" id="MJXp-Span-187">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">e</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> \ langle p, p '\ rangle </script>  with close descriptors is considered a correct mapping if: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-194"><span class="MJXp-mtext" id="MJXp-Span-195">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mrow" id="MJXp-Span-200"><span class="MJXp-mo" id="MJXp-Span-201" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-205" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-206" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-msup" id="MJXp-Span-207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-209" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211"><font style="vertical-align: inherit;"> r </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213"><font style="vertical-align: inherit;">g </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214"><font style="vertical-align: inherit;">h </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-mrow" id="MJXp-Span-216"><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;">| </font></span></span><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;">&lt; </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220"><font style="vertical-align: inherit;">d </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222"><font style="vertical-align: inherit;">l </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;">, </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226"><font style="vertical-align: inherit;">p </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">w </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mo MJXp-script" id="MJXp-Span-232" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">‚àó</font></span></span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"> , </font></span><span class="MJXp-msup" id="MJXp-Span-234"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">p </font></span></span><span class="MJXp-msup" id="MJXp-Span-234"><span class="MJXp-mo MJXp-script" id="MJXp-Span-236" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">‚Ä≤</font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238"><font style="vertical-align: inherit;"> i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">w </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-242" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">t</font></span></span></font><span class="MJXp-mtext" id="MJXp-Span-210">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-216"><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-219">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-225" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-227">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-232" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msup" id="MJXp-Span-234"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-236" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-237">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-242" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-34"> \ left | H (p) - p '\ right | <\ delta, p \ in w ^ *, p '\ in w ^ T </script></p><br></li><li><p>  The standard is chosen as the final result. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-243"><span class="MJXp-msubsup" id="MJXp-Span-244"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-246" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> T_b </script>  for which the number of correct comparisons turned out to be maximum.  If it is less than a certain threshold <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-247"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> R </script>  , the result will be the answer ‚Äúan unknown picture‚Äù in order to avoid false positives (for example, in pictures for which there is no reference description in the search database). </p><br></li></ol><br><p><img src="https://habrastorage.org/webt/5l/lt/fe/5lltfeejo28mzfnbe8zglfujp8q.jpeg"><img src="https://habrastorage.org/webt/sb/2w/pq/sb2wpqtrcflw7vdeael5yajhmje.jpeg"><br>  <em>Figure 3 - Claude Monet.</em>  <em>Rouen Cathedral, West Facade, Sunlight (left) and Rouen Cathedral, Portal and Tower Saint-Romain in the Sun (right).</em> </p><br><p>  One of the main parts of the system is the search for close descriptors using the Hamming distance as a metric.  Since it is calculated many times, this stage becomes quite computationally time consuming and takes 65% of the system operation time.  That is why we optimized it. </p><br><h3 id="sovsem-nebolshoe-opisanie-arhitektury-elbrus">  A very small description of the architecture of Elbrus </h3><br><p>  The processor architecture Elbrus uses the principle of a wide command word (Very Long Instruction Word, VLIW).  This means that the processor executes commands in groups, and there are no dependencies within each group, and these commands are executed in parallel.  Each such group is called a broad command word.  The formation of broad command words is performed by the optimizing compiler, due to which a more detailed analysis of the source code is possible, leading to more efficient parallelization [10]. </p><br><p>  A special feature of the architecture of Elbrus are the methods of working with memory.  In addition to having a cache to optimize memory access time, Elbrus processors support a hardware-software method of preliminary data paging.  This method allows predicting memory hits and pumping data to the data pre-buffer.  The hardware of the processor includes a special device for accessing arrays (Array Access Unit, AAU), but the need to swap is determined by the compiler, which generates special instructions for the AAU.  The use of a swap device is more efficient than putting an array of elements into a cache, since array elements are most often processed sequentially and rarely used more than once [11].  However, it should be noted that the use of the preliminary swap buffer on Elbrus is possible only when working with aligned data.  Due to this, the read / write of the aligned data takes place noticeably faster than the corresponding operations for the non-aligned data. </p><br><p>  In addition, Elbrus processors support several types of parallelism in addition to command-level parallelism: SIMD-parallelism, control flow parallelism, task parallelism in a multi-machine complex.  Of particular interest to us is SIMD-parallelism. </p><br><h3 id="osobennosti-ispolzovaniya-simd-rasshireniya-processora-elbrus">  Features of using SIMD-expansion processor Elbrus </h3><br><p>  Using SIMD-extensions can be carried out in two modes: automatic and direct.  In the first case, the parallelization of operations is fully performed by the compiler without the participation of the developer.  This mode is limited, since the optimized code must completely repeat the behavior of the source code, including the behavior of overflow, rounding, etc.  In this case, the behavior of SIMD-expansion commands may differ in these aspects from the processor commands.  In addition, the algorithms used in compilers are imperfect and not always able to perform efficient parallelization.  However, developers can also access the commands of SIMD extensions directly using intrinsics.  Intrinsics are functions whose calls are replaced by the compiler with a highly efficient code for this platform, in particular, with SIMD extension commands.  The Elbrus-4C and Elbrus-8C processors support a set of intrinsics, for which the register size is 64 bits.  It includes operations for data transformation, initialization of vector elements, arithmetic operations, bitwise logical operations, permutation of vector elements, etc. </p><br><p>  When using intrinsics on the Elbrus platform, special attention should be paid to access to memory, since in practical tasks, such as image processing tasks, unaligned reading of data into a 64-bit register is often required.  Such a reading is in itself inefficient, as it requires a pair of read commands and a subsequent command to form a data block, but, more importantly, an array swap buffer cannot be used, which increases the speed of data access.  However, it is worth noting that the problem of inefficient access to unaligned data is relevant for the Elbrus-4C and Elbrus-8C processors, while for the newer Elbrus-8CB with the 5th version of the command system it is partially solved.  It is expected that Elbrus processors with the 6th version of the instruction system will be fully resolved. </p><br><p> However, on Elbrus-4C and Elbrus-8C processors, low-level data processing is efficiently performed with regard to alignment.  For example, for numeric arrays, it can consist of several stages: processing the initial part (up to the alignment boundary on 64-bits of one of the arrays), processing the main part using aligned memory access, and processing the remaining elements of the array.  Since the analysis of pointers at compile time is a non-trivial task, you can use the <code>‚Äìfaligned</code> compiler <code>‚Äìfaligned</code> , with which all memory access operations are performed in an aligned manner. </p><br><p>  The following feature of using intrinsics on the Elbrus platform is directly related to its VLIW architecture.  Due to the presence of several arithmetic logic units (ALUs) that work in parallel and are loaded when forming broad command words, several commands can be executed simultaneously.  In total, Elbrus-4C and Elbrus-8C processors have six ALUs that can be used within one wide team, but each ALU maintains its own set of intrinsics.  Simple operations, for example, addition or multiplication of elements in 64-bit registers, as a rule, support two ALUs.  This means that the Elbrus processor can execute two such instructions per cycle.  To do this, in the executable code you should use loop deployment.  The Elbrus optimizing compiler supports the <code>#pragma unroll(n)</code> pragma, which allows you to deploy n loop iterations. </p><br><p>  An example of the implementation of the addition function with these features can be found in our previous <a href="https://habr.com/ru/company/smartengines/blog/351134/">article</a> . </p><br><h3 id="eksperimenty">  Experiments </h3><br><p>  Hurray, the text is over and finally we will launch something on Elbrus! </p><br><p>  We first consider separately the Hamming distance.  Without further ado, we compared two bit vectors of random data.  Binary values ‚Äã‚Äãwere packed into arrays of 8-bit integers, and for simplicity, we thought that the lengths of the original vectors are multiple of 8. As usual, the code was written in C ++, compiled by lcc 1.21.24 - an optimizing e-compiler. </p><br><p>  We wrote several realizations of Hamming distance, which consistently took into account the characteristics of Elbrus processors.  They looked like this: </p><br><ol><li>  A bitwise XOR between 8-bit integers and a table of pre-calculated values ‚Äã‚Äãare used.  This is a basic implementation without intrusions and other tricks. </li><li>  XOR is used between 32-bit integers and intrinsic to calculate the number of ones in a 32-bit integer - popcnt32.  Alignment of data on the 32-bit boundary was not performed. </li><li>  XOR is used between 64-bit integers and intrinsic to calculate the number of ones in a 64-bit integer - popcnt64.  Alignment of data on the border in 64-bit was not performed. </li><li>  XOR is used between 64-bit integers and intrinsic to calculate the number of ones in a 64-bit integer - popcnt64.  Memory access is carried out in an aligned manner.  Since the initial addresses of arrays can have different alignments, reading one of the arrays reads two adjacent 64-bit blocks and forms the necessary 64-bit block from them. </li><li>  XOR is used between 64-bit integers and intrinsic to calculate the number of ones in a 64-bit integer - popcnt64.  Memory access is carried out in an aligned manner.  Since the initial addresses of arrays can have different alignments, reading one of the arrays reads two adjacent 64-bit blocks and forms the necessary 64-bit block from them.  Additionally used compiler flag <code>-faligned</code> . </li><li>  XOR is used between 64-bit integers and intrinsic to calculate the number of ones in a 64-bit integer - popcnt64.  Memory access is carried out in an aligned manner.  Since the initial addresses of arrays can have different alignments, reading one of the arrays reads two adjacent 64-bit blocks and forms the necessary 64-bit block from them.  Additionally, the compiler flag <code>-faligned</code> and the pragmas of the <code>#pragma unroll(2)</code> compiler (to use both available ALUs for popcnt64) and <code>#pragma loop count(1000)</code> (to enable additional cyclic optimizations) are used. </li></ol><br><p>  The results of time measurements are shown in table 1. </p><br><p>  Table 1. Time to calculate the Hamming distance between two arrays of packed binary numbers of length 10 ^ 5 on a machine with an Elbrus-4C processor.  Time averaged over 10 ^ 5 runs. </p><br><table><thead><tr><th>  No </th><th>  Experiment </th><th>  Time, ms </th></tr></thead><tbody><tr><td>  one </td><td>  table of pre-calculated values </td><td>  141.18 </td></tr><tr><td>  2 </td><td>  popcnt32, without alignment </td><td>  125.54 </td></tr><tr><td>  3 </td><td>  popcnt64, without alignment </td><td>  58.00 </td></tr><tr><td>  four </td><td>  popcnt64 alignment </td><td>  17.36 </td></tr><tr><td>  five </td><td>  popcnt64, alignment, <code>-faligned</code> </td><td>  17.15 </td></tr><tr><td>  6 </td><td>  popcnt64, alignment, <code>-faligned, pragma unroll</code> </td><td>  12.23 </td></tr></tbody></table><br><p>  It can be seen that all the considered optimizations resulted in a decrease in the operation time by 11.5 times.  It is worth noting that the use of intrinsics with unallocated access to memory showed acceleration only 1.13 times (for popcnt32) and 2.4 times (for popcnt64), while accounting for data alignment led to the use of the APB array swap buffer , with which it was possible to achieve acceleration by 3.4 times (58 ms versus 17.15 ms).  Despite the fact that in the above example, the use of the -faligned flag did not show significant performance gains, in more complex algorithms it is possible that the compiler will not be able to analyze the source code deep enough to generate commands for APB.  Accounting for the current number of specialized ALUs allowed speeding up the calculations by another 1.4 times. </p><br><p>  Not so bad!  Since we compared as many as 6 options for implementation, we give the pseudocode of the final, the fastest: </p><br><pre> <code class="plaintext hljs">–í—Ö–æ–¥: –º–∞—Å—Å–∏–≤—ã 8-–±–∏—Ç–Ω—ã—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª A –∏ B, –º–∞—Å—Å–∏–≤ T, –≥–¥–µ T[i] —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å–ª–æ –µ–¥–∏–Ω–∏—Ü –≤ —á–∏—Å–ª–µ i –í—ã—Ö–æ–¥: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ res, —Ä–∞–≤–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –•—ç–º–º–∏–Ω–≥–∞ –º–µ–∂–¥—É A –∏ B offset ‚Üê —á–∏—Å–ª–æ –±–∞–π—Ç–æ–≤ –¥–æ –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ A –Ω–∞ 64-–±–∏—Ç–∞ effective_len ‚Üê –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–æ–∫–∞–º–∏ –ø–æ 64-–±–∏—Ç–∞ for i from 1 to offset: res ‚Üê res + T[xor(A[i] , B[i])] v_a ‚Üê 64-–±–∏—Ç–Ω—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—á–∏–Ω–∞—è —Å A[offset+1] v_b1 ‚Üê 64-–±–∏—Ç–Ω—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç B[offset] v_b2 ‚Üê 64-–±–∏—Ç–Ω—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ v_b1 //–≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Ü–∏–∫–ª–∞ –∏ —Ü–∏–∫–ª–æ–≤—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö 64-–±–∏—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö for i from offset to effective_len: v_b ‚Üê align(v_b1, v_b2) // —Å–æ–∑–¥–∞–Ω–∏–µ 64-–±–∏—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ v_a res ‚Üê res + popcnt64(xor(v_a, v_b)) v_a ‚Üê —Å–ª–µ–¥—É—é—â–∏–π 64-–±–∏—Ç–Ω—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö v_b1 ‚Üê v_b2 v_b2 ‚Üê —Å–ª–µ–¥—É—é—â–∏–π 64-–±–∏—Ç–Ω—ã–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–æ–≤</code> </pre> <br><p>  It would be great once and for all to speed up the calculation of the Hamming distance by 11.5 times, but in life everything is a bit more complicated: such an implementation will have an advantage only if the arrays are long enough.  In Fig.  4 shows a comparison of the counting time using the table of pre-calculated values ‚Äã‚Äãand our final implementation.  It can be seen that with our version it starts to win only starting from lengths exceeding 400 bytes, and this must also be taken into account when optimizing on Elbrus. </p><br><img src="https://habrastorage.org/webt/my/5_/dz/my5_dzx_akm4pis3kuqvdhm3fns.png"><br><p>  <em>Figure 4 - The average time (per 1 byte) for calculating the Hamming distance between two arrays depending on their length on Elbrus-4C.</em> </p><br><p>  That's all, now we are ready to measure the time of the entire system.  We measured the average request processing time (excluding image loading) for 933 requests.  In compiling a compact image description, a color RFD-like binary descriptor of 5328 bits was used.  It consisted of 3 concatenated 1776-bit gray RFD descriptors calculated for each channel of the input image section.  On the one hand, such long descriptors are not pleasing to the high speed of calculation and comparison, on the other hand, they allow to ensure a fairly high quality of work.  However, there is good news - we can use the fast implementation of Hamming distance to compare them!  The lengths of the arrays being compared are 666 bytes, which is more than a 400 byte threshold for Elbrus-4C. </p><br><p>  The results of the measurements are given in Table 2. It can be seen that only one quick realization of the Hamming distance gives the query processing acceleration 1.5 times.  It is also worth noting that this optimization does not change the results of the calculations, and therefore the quality of recognition. </p><br><p>  Table 2. The average processing time of the request to the system of recognition of objects of painting in uncontrolled conditions. </p><br><table><thead><tr><th>  Experiment </th><th>  Request time, with </th><th>  Hamming distance calculation took </th><th>  Acceleration times </th></tr></thead><tbody><tr><td>  Base implementation </td><td>  2.81 </td><td>  63% </td><td>  - </td></tr><tr><td>  Quick implementation </td><td>  1.87 </td><td>  40% </td><td>  1.5 </td></tr></tbody></table><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  In this article, we talked a little about the structure of the object recognition system of painting in uncontrolled conditions and once again showed how low-level manipulations can significantly improve its speed on the Elbrus platform.  Thus, the proposed implementation of the Hamming distance, works an order of magnitude (!) Faster than the implementation of a table of pre-calculated values ‚Äã‚Äãwith a sufficiently large length of input vectors, and the entire system has accelerated one and a half times!  To achieve this result, SIMD-extensions were used, as well as the peculiarities of the architecture and memory access to the Elbrus-4C and Elbrus-8C processors were taken into account.  These results show that Elbrus processors contain significant resources for efficient operation, which are not fully utilized in the absence of specially implemented optimization.  However, it is expected that on newer Elbrus processors memory access methods will be improved, which will allow to perform some of these optimizations in automatic mode and will significantly simplify the lives of developers. </p><br><h3 id="literatura">  Literature </h3><br><p>  [1] N.S.  Skoryukina, A.N.  Milovzorov, D.V.  Polevoy, V.V.  Arlazarov.  The method of recognition of painting objects in uncontrolled conditions with learning by one example // Proceedings of the ISA RAS.  - Special edition, 2018 - with.  5-15. <br>  [2] P√©rez-Sanagust√≠n M. et al.  Using QR codes to increase user engagement in muse-like spaces // Computers in Human Behavior.  - 2016. - T. 60. - p. 73-85.  doi: 10.1016 / j.chb.2016.02.012 <br>  [3] Antoshchuk S. G., Godovichenko N. A. Analysis of the point features of the image in the Mobile Virtual Guide system // Pratsi.  - 2013. - ‚Ññ.  1 (40).  - pp. 67-72. <br>  [4] Andreatta, C., Leonardi F. Appearance and the VISAPP.  - 2006. <br>  [5] Leonard Wein.  2014. In the SIGCHI Conference on Computing Systems (CHI '14).  ACM, New York, NY, USA, 635-638. <br>  doi: 10.1145 / 2556288.2557270 <br>  [6] The Tretyakov Gallery, <a href="https://www.tretyakovgallery.ru/collection/">https://www.tretyakovgallery.ru/collection/</a> <br>  [7] Lukoyanov A. S., Nikolaev D. P., Konovalenko I. A. Modification of the YAPE algorithm for images with a large spread of local contrast // Information technologies and nanotechnologies.  - 2018. - p. 1193-1204. <br>  [8] Muja M., Lowe DG Fast matching of binary features // Computer and Robot Vision (CRV), 2012 Ninth Conference on.  - IEEE, 2012. - p. 404-410. <br>  doi: 10.1109 / CRV.2012.60 <br>  [9] Skoryukina, N., Nikolaev, DP, Sheshkus, A., Polevoy, D. (2015, February).  Real time rectangular document detection on mobile devices.  In Seventh International Conference on Machine Vision (ICMV 2014) (Vol. 9445, p. 94452A).  International Society for Optics and Photonics. <br>  doi: 10.1117 / 12.2181377 <br>  [10] Kim A.K., Bychkov I.N.  Russian Technologies ‚ÄúElbrus‚Äù for personal computers, servers and supercomputers // Modern information technologies and IT education, M .: Foundation for Assistance in the Development of Internet Media, IT Education, Human Potential ‚ÄúLeague of Internet Media‚Äù, 2014, No 10, p.  39-50. <br>  [11] Kim A.K., Perekatov V.I., Ermakov S.G.  Microprocessors and computing systems <br>  family "Elbrus".  - SPb .: Peter, 2013. - 272 C. </p></div><p>Source: <a href="https://habr.com/ru/post/438948/">https://habr.com/ru/post/438948/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>