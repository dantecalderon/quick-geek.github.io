<div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  I am currently working on a messenger project on the blockchain, along with a team of my colleagues.  Who cares - see the links in the profile or ask in the comments. <br><br>  Blockchain development is a new and unexplored area, so sometimes you have to use very non-standard tools.  Where there is a microscope and nails!  Therefore, I decided to keep this blog to tell different interesting cases from the practice.  Today's post is about how I set up instant notifications about the status of my node in order to quickly bring it back to life. <br><br><img src="https://habrastorage.org/webt/qq/tv/7h/qqtv7hpy3x3jiswfyat9zqeg8dc.jpeg"><br><br><h2>  The plan that I adhered to </h2><br>  I set myself the following task: every time a node goes down or down, I should receive instant notifications about it.  We live in a progressive century and are used to receiving all the important information instantly, right? <br><br>  I decided that in order to accomplish this task I would screw Zabbix to Slack (he is our working tool for the project).  Zabbix, respectively, will monitor the node and send fault messages to me in lichku Slack'a. <br><br><h2>  Implementation: step by step </h2><br><a name="habracut"></a><h3>  Step 1: Zabbix </h3><br>  Of course, Zabbix does not have standard pre-configured monitoring tools for our node.  Therefore, the first desire was to determine the availability of the node port using the <code>net.tcp.listen[port].</code> key <code>net.tcp.listen[port].</code> <br><br>  But there is one “but”: it happens that the node is active, it listens on the port, but at the same time it functions incorrectly.  And here I was confronted with the fact that it is necessary to determine the main feature of a node's performance. <br><br>  Noda what should do?  Right, grow.  That growth will be the main feature.  So I decided to use the <code>system.run[command, mode]</code> key. <br><br>  Together with <code>curl -s http://127.0.0.1:36666/api/blocks/getHeight</code> . <br><br>  As a result, we received a JSON format string <br><br><pre> <code class="java hljs">{<span class="hljs-string"><span class="hljs-string">"success"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">"nodeTimestamp"</span></span>:XXXXXXX,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:XXXXXXX}</code> </pre> <br>  The jq package came to the rescue of the JSON parsing task (https://stedolan.github.io/jq/).  A simple transfer of the result through the pipe <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code>天6666/api/blocks/getHeight <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code>  <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code> , and instead of the long-awaited height, we received a response containing information about the execution of the <code>curl</code> command. <br><br><img src="https://habrastorage.org/webt/8a/a5/aw/8aa5aw1zpzwkd8sfagshwhxe8di.png"><br><br>  The redundant information needed to be removed, and then the assistant came - the <code>-s</code> key, he is <code>-silent</code> .  As a result, using the Zabbix-key <code>system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height]</code>  <code>system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height]</code> we get the height of the node desired and convenient for monitoring the type XXXXXXX. <br><br><img src="https://habrastorage.org/webt/ug/0u/vh/ug0uvhe-dlzx1xbsndurogpbkyq.png"><br><br>  A trigger was also required to set up a scheduled alert.  The plan was this: to compare the last and previous values, and that the trigger worked, if the growth is less than one. <br><br> <code>{ADAMANT Node Monitoring:system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height].change()}&lt;1</code> <br> <br><h3>  Step 2. Zabbix to Slack </h3><br><img src="https://habrastorage.org/webt/ac/bm/7-/acbm7-ojg-sbdpdyw3gt8k9gk-8.jpeg"><br><br>  The next task is to notify about the trigger trigger in Slack.  I took the <a href="https://github.com/ericoc/zabbix-slack-alertscript">https://github.com/ericoc/zabbix-slack-alertscript</a> material as a basis. <br><br>  The instruction is clear, but using emoticons to distinguish between Severity is not serious.  Highlighting with color stripes is much more interesting.  After processing the script, this remains: <br><br><pre> <code class="java hljs"> url=<span class="hljs-string"><span class="hljs-string">'********************************'</span></span> username=<span class="hljs-string"><span class="hljs-string">'Server'</span></span> to=<span class="hljs-string"><span class="hljs-string">"$1"</span></span> subject=<span class="hljs-string"><span class="hljs-string">"$2"</span></span> recoversub=<span class="hljs-string"><span class="hljs-string">'^RECOVER(Y|ED)?$'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Warning'</span></span> ]]; then color=<span class="hljs-string"><span class="hljs-string">'#EBFF00'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Not classified'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#D8E3FF'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Information'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#0049FF'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Average'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FFC200'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'High'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FF5500'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Disaster'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FF0000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-string"><span class="hljs-string">'#00FF06'</span></span> fi message=<span class="hljs-string"><span class="hljs-string">"${subject} \n $3"</span></span> payload=<span class="hljs-string"><span class="hljs-string">"payload={\"attachments\": [{\"color\": \"${color}\", \"text\": \"${message}\"}]}"</span></span> curl -m <span class="hljs-number"><span class="hljs-number">5</span></span> --data-urlencode <span class="hljs-string"><span class="hljs-string">"${payload}"</span></span> $url</code> </pre> <br><h2>  findings </h2><br>  As morality - a couple of words, why convenient monitoring is so important.  The sooner you learn about the situation, the faster you will correct it and the less pronounced the consequences will be.  As they say, just raised does not count as fallen.  And in Slack, among other things, there are group chats, so the team can connect to fix the problem and coordinate actions.  By the way, our project is open source, and we treat with great respect to other open source projects.  My experiment has once again shown that open source is good. </div>