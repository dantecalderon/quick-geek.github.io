<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Benefits of analyzing level 7 applications in firewalls. Part 1. Basics</title>
  <meta name="description" content="The new generation of firewalls is more convenient and safer, thanks to the new architecture of the engine and the new ideology of managing network fl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6974184241884155",
      enable_page_level_ads: true
    });
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Benefits of analyzing level 7 applications in firewalls. Part 1. Basics</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/786/9e4/d4e/7869e4d4eac6b07b8bfa763cb3985347.png"><br>  The new generation of firewalls is more convenient and safer, thanks to the new architecture of the engine and the new ideology of managing network flows. <br><h3>  Why did this article appear? </h3><blockquote>  Repeatedly I came to security colleagues who use the firewall of a new generation and saw that they continue to write rules for port numbers.  On my proposal to write by the name of the application, I heard, ‚ÄúWhat if it doesn‚Äôt work?‚Äù.  If you are also ‚Äúscared‚Äù or do not understand why writing rules on applications, from this article is for you. </blockquote><br><a name="habracut"></a><br><h1>  PART 1. Firewall Basics </h1><br><h3>  CONTENT </h3>  <a href="https://habr.com/ru/post/436392/">Introduction</a> <br>  <a href="https://habr.com/ru/post/436392/">Definitions</a> <br>  <a href="https://habr.com/ru/post/436392/">Firewall</a> <br>  <a href="https://habr.com/ru/post/436392/">L3 firewall</a> <br>  <a href="https://habr.com/ru/post/436392/">L4 firewall</a> <br>  <a href="https://habr.com/ru/post/436392/">L7 firewall</a> <br>  <a href="https://habr.com/ru/post/436392/">UTM</a> <br>  <a href="https://habr.com/ru/post/436392/">Ngfw</a> <br>  <a href="https://habr.com/ru/post/436392/">Examples</a> <br>  <a href="https://habr.com/ru/post/436392/">Proxy server</a> <br>  <a href="https://habr.com/ru/post/436392/">What is a USER-ID</a> <br>  <a href="https://habr.com/ru/post/436392/">Stateful Inspection Misconceptions: L4 vs L7 State</a> <br>  <a href="https://habr.com/ru/post/436392/">Misconceptions about Stateful Inspection: The number of sessions L4 vs L7</a> <br>  <a href="https://habr.com/ru/post/436392/">Misconceptions about Stateful Inspection: L4 vs L7 Cluster</a> <br>  <a href="https://habr.com/ru/post/436836/">Part 2. The impact of L7 Firewall on security</a> <br><br><a name="Intro"></a><h2>  Introduction </h2><br>  Skype, TOR, Ultrasurf, TCP-over-DNS and several hundreds more applications and tunnels quietly pass through statefull inspection firewall and HTTP proxies.  Many defenses open connections, but do not check what goes inside them.  I propose to understand how to control the connection of applications in a new generation of firewall, where the rules are written by application names, which corresponds to the 7th level of the OSI ISO model.  These firewalls are called Next Generation Firewall, a new generation firewall, or simply NGFW. <br><blockquote>  The firewall administrator needs not only to allow the connection, but also to ensure that what you want goes within the allowed connection, including checks on the files being transferred.  This is called <b>secure application resolution</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b2/d52/1e2/9b2d521e2806d725232f208f318014fb.jpg"></blockquote>  There are several important differences in the work with traffic, which you understand only when you switch to the actual use of the rules, where the criterion is the ISO 7 application model level 7 application: <br><br><ul><li>  An IT administrator sees that NGFW visualizes network traffic, that is, shows the contents of the packet data field, user names and which application is running and which files are being transmitted. <br></li><li>  IT security sees that NGFW provides secure application resolution, since deeper analysis of the data in the package allows you to see viruses, connect sending unknown files to the sandbox, check the file type, keywords for DLP, check the URL category, check what goes inside SSL and SSH, compare with the world-famous indicators of compromise, enable the DNS filter and other modern techniques. <br></li></ul><br>  To understand the reasons for this, compare the L4 and L7 firewall logs. <br><blockquote>  A) Compare the log entry in the <b>L4 firewall</b> , which parses only the header of the transport (fourth) layer of the OSI ISO model - in this case TCP: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8a/7bd/dbd/d8a7bddbdb4f4b2de47d82f964de4075.png"></blockquote>  Yes, there is information about the source and the recipient, you can guess by the port number 443, that inside, with a high degree of probability (as the British say) SSL connection.  I personally cannot see any incident in this record.  And you? <br><blockquote>  B) Compare the <b>L7 firewall</b> log entry for the same TCP connection, where the content transmitted in the TCP / IP data field is also parsed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cea/5fc/e07/cea5fce0756312001f33bc13bf101d7a.png"></blockquote>  Here you can see that Ivanov from the marketing department has uploaded a file on ‚ÄúSlideshare‚Äù marked ‚Äúnot for distribution‚Äù.  This is an example of a real incident where an employee posted confidential company development plans for the year on the Internet.  This information was obtained in the L7 firewall based on the analysis of the same connection as above in the L4 firewall and immediately the information becomes sufficient to understand that there was an incident.  And this is a completely different approach to traffic analysis.  But I will immediately warn you that such a deep analysis imposes a serious load on the processor and the operational memory of the device. <br><br>  It is sometimes felt that the level of log detail in NGFW is similar to the level of detail in SIEM systems that collect information bit by bit from different sources.  That is why NGFW is one of the best sources of information for SIEM. <br><br><a name="Def"></a><h2>  Definitions </h2><br>  It is necessary to highlight the terms with which we will continue to operate.  I have no purpose in detail to give all the definitions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/871/b80/69b/871b8069b4cf331d60aeb72e986a6fa1.png"><br><br>  <b>The OSI ISO seven-tier model</b> is a model of interaction between network devices, which states that there are 7 consecutive levels of interaction abstraction: the first is physical, the next channel, network, the fourth is transport, then session, views, and the seventh level is applications (see picture above ). <br><br>  Each network device operates at its own abstraction level: web server and browser - at the application level (level 7 or L7 for short), routers - communicate with each other on the link (2) and network level (3), when they send frames and packets to each other . <br><br>  Firewalls are also network devices and, depending on their type, can also be switches and routers and even be a ‚Äúvirtual cable‚Äù in terms of network topology, but these network devices have an additional burden: they must analyze the contents of the packets. <br><br>  And the depth of network packet analysis may vary.  Whether they analyze level 4 or level 7 is an important difference. <br><br><a name="FW"></a><h2>  Firewall </h2><br>  <b>Firewall (ITU) Network Firewall</b> is a network device that divides a network into segments with different security policies and controls these policies.  For example, the segment of the Internet - there you can anything.  And a segment of your data center - there you can work only with a dedicated list of employees on allowed applications.  Within a single VMware host, there may be several virtual networks with virtual machines and different access policies. <br><br>  The firewall security policy contains the rules that the device program code triggers, analyzing every frame and packet that arrives and outgoing from the firewall.  The firewall rules specify test criteria (qualifiers) according to which the decision is made to pass or block traffic.  Examples of qualifiers in the rules are: address, port, application, user, zone.  Firewall sequentially, rule by rule, top down the list scans the criteria and if the incoming traffic meets all the criteria of the rule (logical operation ‚ÄúAnd‚Äù between the criteria), then the specified action is taken: block or skip.  The action is performed both for the first packet and for all subsequent packets of one TCP / IP connection. <br><br>  There are different types and implementations of the firewall.  We consider the classification according to the degree of depth of traffic analysis used: L3, L4 and L7. <br><br><a name="L3"></a><h2>  L3 firewall </h2><br>  <b>L3 firewall</b> is a firewall that passes traffic through itself and analyzes only IP protocol headers, that is, the address from where and where the traffic is going.  These firewalls are called <b>packet filters</b> .  The rules are called ‚Äúaccess list‚Äù or access-list (ACL) and this functionality currently works in almost any router and operating system.  Such an analysis does not require a serious load on the processors and memory of the firewall. <br><br><a name="L4"></a><h2>  L4 firewall </h2><br>  <b>L4 firewall</b> is a firewall that passes traffic through itself and checks protocol headers 4 levels: TCP, UDP, ICMP, that is, the main test criteria for passing traffic are IP addresses and TCP / UDP ports or ICMP services. <br><br>  Also, the concept of stateful inspection appears in the L4 firewall when every passing request is remembered and the status of the request is stored in order to allow the necessary response connections.  That is, the concept of a connection initiator appears, which is logical in networks built on client-server technology.  Such a firewall spends memory for storing data about each connection, that is, there is a limit on the maximum number of stored simultaneous sessions in memory.  In the L4 firewall, it is no longer necessary to write a response rule for the reverse connection, as is required in the L3 firewall, because based on the connection state, the firewall automatically allows reverse connections.  That is, L4 firewall is more convenient than a packet filter. <br><br>  Modern L4 firewalls store not only TCP, UDP, and ICMP status, but also track the interaction of some L7 applications.  For example, the state of FTP, HTTP, SIP, and other applications, which already depends on the specific implementation of the firewall.  You need to ask the manufacturer of the L4 firewall the question: what specific applications does the stateful inspection firewall engine support? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbb/493/449/fbb49344946f0e1ae8ecde30d879b35e.png"><br><br><a name="L7"></a><h2>  L7 firewall </h2><br>  <b>The L7 firewall</b> is a firewall that passes IP network traffic through itself and checks both Layer 4 and the data segment of each IP packet, that is, L7 understands application-level traffic, down to which files are transmitted and in which direction.  As more data is analyzed, there are more criteria for checking in the L7 firewall rules: username, application, URL category, software status on the user's computer. <br><br>  The load on the L7 firewall is much higher, because its processor must constantly analyze the megabytes of the data field that the application transmits, while the L4 firewall checks only a few bytes of the IP packet header with source and destination addresses and ports.  The buffer size for storing the state of each L7 application is much more required, since more data is transmitted to L7 than just the TCP / IP header.  Due to the increased buffer size when using application analysis, the number of simultaneous in-memory sessions of the L7 firewall is less than the L4 firewall with the same amount of memory.  Since the L7 firewall sees from the content that the application goes over the network, the port number does not have any special meaning and the rules can be written by the name of the L7 application.  In addition, modern applications generate many connections and all of these connections are part of the same application.  This type of firewall allows you to regain control of modern dynamic applications running on any port, for example, teamviewer, bittorent, tor, about which the L4 firewall knows nothing.  That is, the L7 firewall in modern realities is needed if the network needs security. <br><blockquote>  If, after reading this article, you continue to use the L4 firewall, it means that you do not care about security. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9dd/ded/ecb/9dddedecb30376ea249d293db19a016d.png"><br></blockquote><br><a name="UTM"></a><h2>  UTM </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/ab9/466/fc5/ab9466fc51717a9788e0093244b6261d.png"><br><br>  <b>UTM</b> is a network device within which several different protection components are installed that sequentially analyze the traffic passing through the device.  The core of UTM is L4 firewall, attack prevention system (IPS), antivirus, analysis of URL categories in HTTP and HTTPS.  Often, UTMs still implement VPN gateway functions.  All of these components are typically controlled from several different control systems.  The traffic inside the UTM passes sequentially through the filtering modules and the output is pure traffic, which is allowed by the security policies of each module.  UTM can be used as a platform for other functions: virus protection, IPS, DDoS, QoS, DLP, DNS filter, Threat Intelligence compromise indicators database, phishing protection, and so on (depending on the manufacturer). <br><br><blockquote>  The parable about the person who ordered seven hats from one skin was written, including for UTM buyers: the more functions you want to include after the purchase, the more burden the UTM processor will bear to analyze the same traffic volume.  More functions - less device speed. </blockquote><br><br>  The idea of ‚Äã‚ÄãUTM - to load one processor with as many functions as possible became an evolutionary deadlock, because the number of functions grew and the processors could not withstand all this load.  Today, despite the stated good features, no one includes all the functionality in UTM to eliminate traffic delays. <br><blockquote>  The goal of UTM is to implement as many functions as possible on one server in order to make the device cheaper for the user. </blockquote>  Now UTM manufacturers have begun to put Level 7 application analysis engines to say that they are NGFW, which confuses the consumer.  However, this is easily recognized when looking at the security policy: the rules are still based on the criteria for checking the L4 fields.  And for filtering L7 applications, a separate settings section is used, that is, the L7 application is not a qualifier, as it should be in the L7 firewall.  Recognizing the L7 application and using the L7 application as a security policy criterion are ‚Äútwo big differences.‚Äù <br><br><a name="NGFW"></a><h2>  Ngfw </h2><br>  <b>NGFW</b> is the network device within which the <a href="https://habr.com/ru/post/436392/">L7 firewall</a> is implemented.  Since the main qualifier becomes the name of the L7 application, the rules are written according to the new criteria.  Dynamic mapping of IP addresses to network users always works in NGFW, so the user name also becomes a qualifier (criterion).  NGFW includes SSL / TLS and SSH decryption functions for recognizing applications and attacks inside them, IPS, antivirus, URL filtering. <br><br>  The term NGFW was first coined by the marketing of Palo Alto Networks.  But it gradually got accustomed to the market and all the UTM manufacturers now also call themselves NGFW.  Indeed, NGFW also performs several functions at the same time, why then is NGFW not UTM?  The difference is important to know.  It is that in NGFW, application security features (IPS, antivirus, URL filtering) are hardware accelerated.  There are specialized hardware chips: IPS checks for attacks on its chip, anti-virus signature on its own, decryption of SSL on its own, and so on.  Separation of functions for different processors makes it possible to run protective functions in parallel and not wait for the previous function to finish, as in UTM.  For example, in hardware firewalls of Palo Alto Networks, up to 60 are installed. <br>  Cavium‚Äôs dedicated processors accelerate security, networking and management functions.  It is important that NGFW contain a single software interface for managing all functions simultaneously. <br><blockquote>  The idea of ‚Äã‚ÄãNGFW, in contrast to UTM, is to implement each function on a separate processor that is specialized for the required functionality. </blockquote>  In the same way once the computer makers went, who carried out the functions of mathematics and graphics into separate mathematical and graphic coprocessors.  Therefore, in NGFW there are separate processors for recognizing L7 applications, for decrypting SSL / SSH, for checking antivirus signatures, checking IPS signatures, and so on.  This allows you to enable all functions at the same time, without degradation and delay of traffic in the device during the scan.  Why no one buys computers without graphic accelerators, and firewalls without acceleration buy?  Because acceleration is not necessary at low speeds, but when traffic analysis speeds go beyond 1-5 Gigabits, it is no longer possible to implement all security features without acceleration. <br><br>  The goal of the NGFW device is to enable companies to operate safely without slowing down traffic.  This allows you to constantly check that applications deliver the required content to the company, and the parallel operation of the protection engines with one traffic stream ensures the specified performance with all the security features enabled and also the minimum traffic delay. <br><br><a name="Ex"></a><h2>  Examples </h2><br><blockquote>  L7 Policy Example at Palo Alto Networks NGFW <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3d/433/201/c3d433201745dec7e570b6fe82769f2b.png"></blockquote>  Why might a URL category be required as a qualifier?  For example, you can still allow some employees to visit malicious sites with a browser, but block their downloading of files. <br><blockquote>  Palo Alto Networks policy example using Host Information Profile checks and category URLs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/957/d22/0a0/957d220a05d44f91fef65d4cebf76b89.png"></blockquote>  This policy also includes checking for the presence of the TRAPS host protection in the HIP Profile column, which will prevent you from entering the site with malicious code and exploits without protection installed on your computer.  Traps is an agent for protection against malicious code and exploits. <br><br>  Blocking of downloading files is performed in the settings of the Profile column, where the profile of blocking the transfer of all files for any application is applied.  This is what its setup looks like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/87e/6e2/48087e6e2f973ee821ef6240828dfd6a.png"><br><br><a name="Proxy"></a><h2>  Proxy server </h2><br>  <b>A proxy server</b> is a device that terminates the traffic of an application on itself, checks this traffic using various methods and sends this traffic further.  Most commonly used in proxy networks for HTTP and HTTPS protocols.  Since UTM and NGFW analyze HTTP and HTTPS streams transparently, without requiring explicitly specifying proxy server settings for clients, HTTP proxies are gradually disappearing from companies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf2/e91/3eb/bf2e913eb4c39a379ff76818a6173b6d.png"><br><br><a name="USER-ID"></a><h2>  What is a USER-ID </h2><br>  In NGFW, a user identification mechanism was invented.  The algorithm either runs inside or runs on an external agent.  I will call this the USER-ID mechanism.  The USER-ID creates and maintains a lookup table for the user's name and current IP address.  It also happens that there is a value and a port for this user in the table if the users work through VDI (that is, the users go from the same address and can be distinguished only by ports). <br><img src="https://habrastorage.org/getpro/habr/post_images/37d/0cc/99b/37d0cc99baa26dc2597b17e7ae9ed7a4.png" alt="image"><br>  List the <a href="https://docs.paloaltonetworks.com/pan-os/8-1/pan-os-admin/user-id/user-id-overview.html">USER-ID</a> mechanisms in Palo Alto Networks. <br><ol><li>  <b>Server monitoring</b> : User-ID agent reads Exchange Servers events, domain controllers or Novell eDirectory servers </li><li>  <b>Client probing</b> : User-ID agent polls Windows clients via WMI </li><li>  <b>Terminal services agent</b> : TS agent distributes different TCP / UDP port ranges to different users for working with Windows / Citrix Terminal Servers </li><li>  <b>Syslog</b> messages parsing: User-ID agent reads syslog authentication messages from various systems, wireless controllers, 802.1x devices, Apple Open Directory servers, proxy servers, VPN gateways, Cisco ISE </li><li>  Authentication through the <b>GlobalProtect</b> client: login and password on VPN +, you can add MFA </li><li>  Authentication via <b>Captive Portal</b> : Web traffic is authenticated by NTLM or AAA web form (Captive Portal is used in the Moscow metro and cafes. NTLM allows you to make authentication transparent) </li><li>  <b>XML API</b> : entry and exit information is transmitted by the User-ID agent by special commands via the REST API firewall </li><li>  <b>X-Forwarded-For</b> : proxy server fill in this field in the HTTP request to make it clear who is hiding behind the proxy </li></ol><br>  Reading logs from Active Directory controllers is the most frequently used feature in USER-IDs.  The USER-ID agent periodically reads messages from AD logs, where it is recorded which user logged in from which IP address, it is from them that the USER-ID knows what address the user is storing inside NGFW, for example, for Windows 2008/2012, these messages: <br>  - 4768 - Authentication Ticket Granted <br>  - 4769 - Service Ticket Granted <br>  - 4770 - Ticket Granted Renewed <br>  - 4264 - Logon Success <br>  To read the logs, the USER-ID agent needs access with Even Log Reader permissions. <br><br><a name="Stateful"></a><h2>  Misconceptions about Stateful Inspection </h2><br>  I must devote a separate chapter to this saint to every network engineer and safety technician.  It is necessary to emphasize and supplement important things that are often missed on courses on firewalls.  If you have already studied the basics of stateful inspection, then most likely you have several misconceptions. <br><br>  <b>There is one misconception</b> that I sometimes see from colleagues.  Attention!  Stateful inspection is not only about TCP, UDP, or ICMP connection status!  It is also about the state of other more complex protocols and applications: FTP, SIP, RPC, SMTP, SMB and so on! <br><blockquote>  Example. <br><br>  FTP is an application level protocol.  And it has a PORT command that can assign a new TCP connection.  Any firewall that positions itself as a stateful inspection firewall should monitor the FTP commands and see the PORT command and allow the connection to the port and the address requested there.  And that's not all: the firewall also has to replace the parameters of the PORT command and insert the correct address if the FTP server is running for NAT. </blockquote>  That is, in any modern L4 firewall there is a component that spies on the L7 level.  And there is not one such protocol: there are still HTTP, RPC, and others ... And such Layer 7 protocol analyzers are called Application Layer Gateway (ALG). <br><blockquote>  Example. <br><br>  The most "beloved" of networkers and security guards at the same time is ALG for SIP, with which many who set up SIP ALG on the L4 firewall are full of problems, and often end with its shutdown. </blockquote>  That is, already in the L4 firewall there are the beginnings of the analysis of level 7 protocols.  L4 firewalls differ in the amount of ALG implemented.  When you compare ordinary L4 firewalls, then a fair question to the manufacturer‚Äôs system engineer will be: how many protocols and applications does your Stateful Inspection engine support?  As a rule, no one answers. <blockquote>  It turns out that the L7 firewall is also a stateful inspection firewall, but which analyzes and stores the status of ALL applications, and not just selectively, like the L4 firewall. </blockquote><br><br><a name="Sessions"></a>  <b>The second misconception is</b> made by the firewall manufacturers themselves.  Take any datasheet, where the manufacturer writes such a parameter as ‚Äúnumber of simultaneous sessions‚Äù.  The question to the manufacturer is the following: what particular protocols and applications were the sessions measured and was at least stateful for TCP included, let alone were there checks for the L7 level? <br><br>  We know that every protocol or application has a state that the firewall remembers.  And to store this state, you need to allocate a buffer in the device memory.  In fact, the parameter ‚Äúnumber of simultaneous sessions‚Äù means how many buffers for storing states can be stored in the device memory.  You need to understand that for L4 firewall most often measure this parameter for bare TCP or even UDP.  That is, for TCP, a buffer is needed, in which only the IP and port of the connection can fit.  However, in the test for L7 applications, for example, HTTP, this buffer will be much larger, because storing, for example, GET request parameters inside HTTP requires more memory.  And the memory is not rubber.  Accordingly, if the manufacturer writes such a parameter as ‚Äúthe number of simultaneous sessions‚Äù, then he should write: <br><ul><li>  was it just a switch / router mode test, with stateful inspection turned off, </li><li>  was it L4 mode, where he remembered only TCP / IP headers, </li><li>  Whether any L7 level application was taken for the test. </li></ul><br>  Correctly measure the L7 firewall on the number of simultaneous HTTP sessions, on packets of different lengths: 64Kb, 44Kb, 16Kb, 1.5Kb.  It is clear that if some manufacturer made all measurements on UDP 1518 bytes, then most likely this device will not work on your network, since it will not work to force your users to send only 1518 byte UDP packets, and even more so to make them respond HTTP server packages.  It is necessary to say to such a manufacturer that the performance of the L7 firewall must be measured at least on the traffic with the HTTP protocol.  From well-known companies that conduct such tests in public: NSS Labs. <br>  Firewall manufacturers themselves conduct custom tests in their laboratories, which can order their traffic profile, for example: 30% of HTTPS traffic, 10% of SMB traffic, 10% of FTP traffic, and so on. <br><blockquote>  Example. <br><br>  After checking the IXIA device on a traffic generator from one of the UTM manufacturers: <br><ul><li>  in L4 firewall mode - 4,000,000 simultaneous sessions, </li><li>  in L7 firewall mode - 200,000 simultaneous sessions. </li></ul><br>  This is an indication that the buffers for L7 sessions in the device‚Äôs memory are smaller due to their large size. </blockquote><br>  And, by the way, it will also be with the overall performance of the device: with the application content checks turned off, the firewall works 10 times faster than with those turned on.  You can only use header analysis 4 to speed up the device, but there is no security anymore. <br><br><a name="Cluster"></a>  <b>The third important point</b> is the work in the cluster.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All firewalls should work in a cluster, because if a single firewall stops working, then its task is to "breastfeed" and block all traffic - such is the theory of building protection based on firewalls. As long as a ‚Äúbroken‚Äù firewall blocks traffic, the next firewall should take over the task of passing legitimate traffic. And what about the connections that went through the first? Most likely, the first firewall transmitted the status of all connections to the second, but whether it transmitted to the neighbor only the status of IP headers or the full status of all L7 level applications: there were some SSL connections that were decrypted and IPS and anti-virus worked on them - they collected packets in the buffer to check the contents. And here it turns out that L4 and L7 firewall are also different: transmitting the L4 state is not the same,that pass the state of L7. This is also important to understand.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is another misconception</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that the L7 firewall can work in clusters of more than two devices - this is incorrect, since the amount of L7 data transferred grows exponentially with each new node in the cluster and the data processing of even two neighbors exceeds the cost of processing the data of its own device. That is why clusters of more than two devices work only by exchanging L4 headers, and when switching clusters, all application analysis and protection functions are restarted.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, you need to competently compare the L4 and L7 firewall, as well as when you compare whether a car and a tank suits you in a war. </font><font style="vertical-align: inherit;">L7 firewall to increase the security of your network does more complex work, much more work goes on its processors and it needs more memory to store the state of your applications! </font><font style="vertical-align: inherit;">All this needs to be done for safety. </font></font><br><br> <a href="https://habr.com/ru/post/436836/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part 2. The impact of L7 Firewall on security</font></font></a> <br><a name="Opros"></a></div><p>Source: <a href="https://habr.com/ru/post/436392/">https://habr.com/ru/post/436392/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>