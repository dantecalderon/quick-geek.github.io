<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Etherblade.net - opensource project to create an ethernet traffic encapsulator on FPGA (part one)</title>
  <meta name="description" content="Just want to make a reservation that this article not only implies passive reading, but also invites everyone to join the development. System programm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Etherblade.net - opensource project to create an ethernet traffic encapsulator on FPGA (part one)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ny/dp/nj/nydpnjy4-t3sceksgb2crf_odse.jpeg" alt="image"><br><br>  Just want to make a reservation that this article not only implies passive reading, but also invites everyone to join the development.  System programmers, hardware developers, network engineers and DevOps engineers are welcome. <br><br>  As the project goes at the junction of network technologies and hardware design, let's divide our conversation into three parts - it will be easier to adapt the information to a particular audience of readers. <br><br>  We define the first part as introductory.  Here we will talk about the hardware encapsulator of ethernet traffic created on the FPGA, we will discuss its main functions, architectural features and advantages in comparison with software solutions. <br><br>  The second part, let's call it "network", will be more interesting for hardware developers who want to get acquainted with network technologies closer.  It will be devoted to the role that "Etherblade.net" can take in the networks of telecom operators.  We will also talk about the concept of SDN <i>(software defined networking)</i> and how open network hardware can complement the solutions of large vendors such as Cisco and Juniper, and even compete with them. <br><br>  And the third part - ‚Äúhardware‚Äù, which is more likely to interest network engineers who want to join the hardware design and begin to develop network devices on their own.  In it, we will look in detail at FPGA-workflow, ‚Äúthe union of software and hardware,‚Äù FPGA boards, development environments, and other things that tell you how to get involved in the project ‚ÄúEtherBlade.net‚Äù. <br>  So let's go! <br><a name="habracut"></a><br><h4>  Ethernet encapsulation </h4><br>  The goal of the Etherblade.net project is to design and build a device that can, at the hardware level, emulate an L2-ethernet channel over the L3 environment.  A simple example of use is the connection of disparate servers and workstations among themselves just as if there was a normal physical ethernet cable between them. <br><br>  On the Internet you can find different terms for this technology.  The most common ones are <i>pseudowire, evpn, L2VPN, e-line / e-tree / e-lan,</i> and so on.  Well, a huge number of derivative terms are different for different types of transport networks through which a virtual ethernet channel is laid. <br><br>  For example, emulation of ethernet over an IP network is provided by the following technologies - <i>EoIP, VxLAN, OTV</i> ; <br>  ethernet emulation over MPLS network using <i>VPLS and EoMPLS technologies</i> ; <br>  ethernet emulation over ethernet is a task of <i>MetroEthernet, PBB-802.1ah</i> , etc. technologies. <br><br>  The job of marketers is to come up with terms, but if iron designers invented a separate device for each term or abbreviation, they would go crazy.  Therefore, the goal of the hardware developers and our goal is to develop a universal device - an encapsulator that can encapsulate ethernet frames into any transport network protocol, be it <i>IP / IPv6, MPLS, Ethernet</i> , etc. <br><br>  And such an encapsulator has already been implemented and is being developed in a project called ‚ÄúEtherblade-Version1 - encapsulator core‚Äù. <br><br>  For a better understanding, I propose to consider a drawing explaining this principle of encapsulation: <br><img src="https://habrastorage.org/webt/8h/ha/3u/8hha3ulnruaxaokrf-ravtcejuq.jpeg" alt="image"><br><br>  We see that the encapsulators are located around the perimeter of the carrier‚Äôs transport network.  Each encapsulator has two interfaces <i>(L2 is a trunk port ‚Äúlooking‚Äù towards customers, and L3 interface that ‚Äúlooks‚Äù towards transport network)</i> . <br><br>  Let's take a closer look at the rightmost encapsulator.  Clients are connected to it, where the traffic of each client ‚Äúwalks‚Äù in a separate vlan-e.  A device must be able to create virtual channels for individual clients or, in scientific terms, be able to encapsulate ethernet traffic for different vlans with different L3 headers.  The figure shows how one encapsulator emulates four virtual channels for four clients: <br><br><ul><li>  vlan-11 (green) - <i>Ethernet over IP (IPv4 + GRE)</i> ; </li><li>  vlan-12 (purple) - <i>Ethernet over IP (IPv4 + UDP)</i> ; </li><li>  vlan-13 (blue) - <i>Ethernet over MPLS</i> ; </li><li>  vlan-14 (red) - <i>Ethernet over IP (IPv6 + UDP)</i> ; </li></ul><br>  So, we have dealt with the functionality, now let's talk about the embodiments of the encapsulator. <br><br><h4>  Why FPGA? </h4><br>  FPGA is, in essence, a chip that replaces a soldering iron and a box of chips <i>(logic elements, memory chips, etc.)</i> .  That is, having FPGA, we have the opportunity to create hardware for your needs and tasks. <br><img src="https://habrastorage.org/webt/za/9u/56/za9u56d7cawurfoqoorc3m5vzp4.jpeg" alt="image"><br><br>  But besides "a set of elements and a soldering iron" it is necessary to have also schematic diagrams  So, the repository of such schemes, from which you can ‚Äúsolder‚Äù the encapsulator inside the FPGA and get a working device, is the project ‚ÄúEtherblade.net‚Äù.  Another important advantage of FPGA can be called the fact that its elements can be ‚Äúsoldered‚Äù for new schemes, but the schemes themselves, thanks to the repository, do not need to be created and verified ‚Äúfrom scratch‚Äù to implement the new functionality. <br><br>  And yet, why FPGA, and not a software solution? <br><br>  Of course, if the question was raised about developing a system from scratch, then it would be easier and faster to take a ready-made computer and write a program to it than to develop a specialized hardware device. <br><br>  For simplicity and speed of development, however, you have to pay the worst performance, and this is the main drawback of the software solution.  The fact is that software is a computer program that has a variable execution time due to branching and cycles.  Add here the microprocessor's permanent interrupts by the operating system and traffic recycling in the DMA subsystem. <br><br>  In the hardware implementation, our encapsulator is, in fact, a straight-through ‚Äústore-and-forward‚Äù buffer equipped with additional memory in which the headers are stored.  Due to its simplicity and linearity, the hardware solution processes traffic at a speed equal to the capacity of the ethernet channel with minimal delays and stable jitter.  As a bonus, add here the lower power consumption and lower cost of FPGA solutions compared to microprocessor systems. <br><br>  Before moving on to the next topic, let me share with you <a href="https://www.youtube.com/watch%3Fv%3DQCqwg6KuyCg">this link</a> to the video demonstrating the encapsulator in action.  <i>The video is connected with English subtitles, and if necessary, ‚ÄúYoutube‚Äù has the option to enable auto-translation into Russian.</i> <br><br>  In the final part of the article I would like to say about a pair of blocks that are also being developed as part of the project ‚ÄúEtherblade.net‚Äù. <br><br><h4>  Development of the receiver "Etherblade-Version2 - decapsulator core" </h4><br>  You may have noticed that in the previous network diagram <i>(where the encapsulators connected to the provider‚Äôs network are shown)</i> there is one small remark indicating that the MTU in the network must be greater than 1560. For large telecoms, this is not a problem, as they are work on "dark" fiber-optic channels with jumbo-frames support enabled on the equipment.  In this case, the encapsulated ethernet packets, with a maximum size of 1500 bytes and an additional L3 header, can freely ‚Äúwalk‚Äù on such networks. <br><br>  But what if, as a transport network, we would like to use the usual Internet with encapsulators connected, say, to home DSL or 4G modems?  In this case, the receiving part of the encapsulators must be able to collect fragmented ethernet frames. <br><br>  Neither Cisco nor Juniper, at the moment, offer such functionality in their devices, and this is understandable, because their equipment is intended for large telecom operators.  The project ‚ÄúEtherBlade.net‚Äù was originally oriented to customers of different calibers and already has in its arsenal a developed ‚Äúhardwired‚Äù assembly of fragments, which allows emulating ‚Äúethernet-anywhere‚Äù channels with a ‚Äútelco-grade‚Äù quality of service.  For detailed documentation and source codes, welcome to <a href="https://etherblade.net/">https://etherblade.net</a> . <br><br><h4>  10 Gigabit </h4><br>  Currently, active work is also underway on a ten-gigabit version of the encapsulator and porting it to hardware, in particular, to the board shown by the Intel R &amp; D team in St. Petersburg at the beginning of the Intel Cyclone 10GX article. <br><br>  In addition to the functional described in this article, ten-gigabit encapsulators can be used in carrier networks for redirecting ‚Äúinteresting‚Äù traffic to DDoS clearing centers, the Yarovoi server, etc.  More on this in the next article on the concept of SDN <i>(software defined networking)</i> and the use of Etherblade.net in large networks - stay tuned. </div><p>Source: <a href="https://habr.com/ru/post/439540/">https://habr.com/ru/post/439540/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>