<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Modern" dining philosophers in C ++ through actors and CSP</title>
  <meta name="description" content="Some time ago, a link to the article "Modern dining philosophers" spread over resources like Reddit and HackerNews. The article is interesting, it sho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>"Modern" dining philosophers in C ++ through actors and CSP</h1><div class="post__text post__text-html js-mediator-article"><p>  Some time ago, a link to the article <a href="http://lucteo.ro/2018/12/28/modern-dining-philosophers/">"Modern dining philosophers"</a> spread over resources like Reddit and HackerNews.  The article is interesting, it shows several solutions to this well-known problem, implemented in modern C ++ using the task-based approach.  If someone has not read this article, then it makes sense to spend time and read it. </p><br><p>  However, I cannot say that the solutions presented in the article seemed simple and clear to me.  This is probably due to the use of Tasks.  Too many of them are created and dispatched by various dispatchers / serializers.  So it is not always clear where, when and what tasks are performed. </p><br><p>  At the same time, the task-based approach is not the only one possible to solve such problems.  Why not see how the task of the "dining philosophers" is solved through the models of actors and CSP? </p><br><p>  Therefore, I tried to look at and implemented several solutions to this problem both with the use of Actors and with the use of CSP.  The code for these solutions can be found <a href="https://bitbucket.org/sobjectizerteam/so5_dining_philosophers">in the BitBucket repository</a> .  And under the cut explanations and explanations, so who cares, you are welcome under the cat. </p><a name="habracut"></a><br><h1 id="neskolko-obschih-slov">  A few common words </h1><br><p>  I didn‚Äôt have the goal of exactly repeating the solutions shown in the very article <a href="http://lucteo.ro/2018/12/28/modern-dining-philosophers/">"Modern dining philosophers"</a> , especially since I fundamentally dislike one important thing: in fact, the "philosopher" does not do anything in those decisions.  He only says ‚ÄúI want to eat,‚Äù and then either someone magically provides forks to him, or he says ‚Äúnow it won't work out‚Äù. </p><br><p>  It is clear why the author resorted to this behavior: it allows you to use the same implementation of the "philosopher" in conjunction with different implementations of the "protocols".  However, it seems to me personally that it is more interesting when exactly the ‚Äúphilosopher‚Äù tries to take one fork first, then the other.  And when the "philosopher" is forced to handle unsuccessful attempts to seize the plug. </p><br><p>  It is such an implementation of the task of the "dining philosophers" that I tried to do.  In this case, some solutions used the same approaches as in the above-mentioned article (for example, implemented by the ForkLevelPhilosopherProtocol and WaiterFair protocols). </p><br><p>  I built my decisions on the basis of <a href="https://habr.com/post/304386/">SObjectizer</a> , which would hardly surprise those who read my articles before.  If someone has not yet heard about SObjectizer, then in a nutshell: this is one of the few living and developing OpenSource "action frameworks" for C ++ (among others, <a href="http://actor-framework.org/">CAF</a> and <a href="https://state-machine.com/qpcpp/">QP / C ++</a> can also be mentioned).  I hope that the examples given with my comments will be clear enough even for those unfamiliar with SObjectizer.  If not, I will be happy to answer questions in the comments. </p><br><h1 id="resheniya-na-baze-aktorov">  Actor based solutions </h1><br><p>  The discussion of implemented solutions will begin with those made on the basis of the Actors.  First, consider the implementation of the Edsger Dijkstra solution, then move on to several other solutions and see how the behavior of each of the solutions differs. </p><br><h2 id="reshenie-deykstry">  Dijkstra's decision </h2><br><p>  Edsger Dijkstra, not only did he formulate the task of ‚Äúdining filophos‚Äù (formulated using forks and spaghetti voiced by Tony Hoar), he also suggested a very simple and beautiful solution.  Namely: philosophers should seize the forks only in the order of increasing numbers of the forks, and if the philosopher managed to take the first fork, then he would not let go of it until he received the second fork. </p><br><p>  For example, if a philosopher needs to use plugs with numbers 5 and 6, the philosopher must first take plug number 5. Only after that he can take plug number 6. Thus, if forks with smaller numbers lie to the left of philosophers, then the philosopher must first take the left fork and only then can it take the right fork. </p><br><p>  The last philosopher on the list, who has to deal with forks for numbers (N-1) and 0, does the opposite: he first takes the right fork with the number 0, and then the left fork with the number (N-1). </p><br><p>  To implement this approach, two types of actors are required: one for forks, the second for philosophers.  If the philosopher wants to eat, he sends a message to the corresponding actor-fork to seize the fork, and the actor-fork responds with a response message. </p><br><p>  The implementation code for this approach can be seen <a href="">here</a> . </p><br><h3 id="soobscheniya">  Messages </h3><br><p>  Before talking about the actors, you need to look at the messages that the actors will exchange: </p><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">take_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> m_who; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_philosopher_index; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">taken_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">signal_t</span></span> {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">put_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">signal_t</span></span> {};</code> </pre> <br><p>  When a philosopher actor wants to take a fork, he sends the <code>take_t</code> message to the fork <code>take_t</code> , and the actor-fork responds with the message <code>taken_t</code> .  When the philosopher actor finishes eating and wants to put the forks back on the table, he sends the messages put_t to the forks <code>put_t</code> . </p><br><p>  In the <code>take_t</code> message, the <code>take_t</code> field indicates the mailbox (aka mbox) of the actor-philosopher.  A reply message <code>taken_t</code> should be sent to this <code>taken_t</code> .  The second field from <code>take_t</code> is not used in this example, we will need it when we get to the waiter_with_queue and waiter_with_timestamps implementations. </p><br><h3 id="aktor-vilka">  Actor Fork </h3><br><p>  Now we can look at what the actor-plug is.  Here is his code: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fork_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">fork_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx ) : so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(ctx) } {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">so_define_agent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –ù–∞—á–∞–ª—å–Ω—ã–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ 'free'. this &gt;&gt;= st_free; // –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ 'free' –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ. st_free .event( [this]( mhood_t&lt;take_t&gt; cmd ) { this &gt;&gt;= st_taken; so_5::send&lt; taken_t &gt;( cmd-&gt;m_who ); } ); // –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ 'taken' –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è. st_taken .event( [this]( mhood_t&lt;take_t&gt; cmd ) { // –§–∏–ª–æ—Å–æ—Ñ—É –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–¥–æ–∂–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏. m_queue.push( cmd-&gt;m_who ); } ) .event( [this]( mhood_t&lt;put_t&gt; ) { if( m_queue.empty() ) // –í–∏–ª–∫–∞ —Å–µ–π—á–∞—Å –Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–Ω–∞. this &gt;&gt;= st_free; else { // –í–∏–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –¥–æ—Å—Ç–∞—Ç—å—Å—è –ø–µ—Ä–≤–æ–º—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏. const auto who = m_queue.front(); m_queue.pop(); so_5::send&lt; taken_t &gt;( who ); } } ); } private : // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –∞–∫—Ç–æ—Ä–∞. const state_t st_free{ this, "free" }; const state_t st_taken{ this, "taken" }; // –û—á–µ—Ä–µ–¥—å –∂–¥—É—â–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. std::queue&lt; so_5::mbox_t &gt; m_queue; };</span></span></code> </pre> <br><p>  Each actor in SObjectizer should be derived from the base class <code>agent_t</code> .  What we see here is for the <code>fork_t</code> type. </p><br><p>  In the <code>fork_t</code> class, the <code>so_define_agent()</code> method is <code>so_define_agent()</code> .  This is a special method, it is automatically called by SObjectizer when registering a new agent.  In the <code>so_define_agent()</code> method, the <code>so_define_agent()</code> is "configured" to work in SObjectizer: the starting state changes, the necessary messages are subscribed to. </p><br><p>  Each actor in a SObjectizer is a state machine with states (even if the actor uses only one default state).  Here the <code>fork_t</code> actor has two states: <em>free</em> and <em>taken</em> .  When the actor is <em>free</em> , the plug can be "captured" by the philosopher.  And after the fork is <code>fork_t</code> actor should go into the state of <em>taken</em> .  Inside the <code>fork_t</code> class <code>fork_t</code> states are represented by instances of <code>st_free</code> and <code>st_taken</code> special type <code>state_t</code> . </p><br><p>  States allow you to process incoming messages in different ways.  For example, in the <em>free</em> state, the agent responds only to <code>take_t</code> and this reaction is very simple: the state of the actor changes and the response <code>taken_t</code> : </p><br><pre> <code class="cpp hljs">st_free .event( [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span>&gt; cmd ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_taken; so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span> &gt;( cmd-&gt;m_who ); } );</code> </pre> <br><p>  While all other messages, including <code>put_t</code> in the <em>free</em> state, are simply ignored. </p><br><p>  In the state <em>taken, the</em> actor handles two messages, and even the <code>take_t</code> message it processes differently: </p><br><pre> <code class="cpp hljs">st_taken .event( [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span>&gt; cmd ) { m_queue.push( cmd-&gt;m_who ); } ) .event( [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span>&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_queue.empty() ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_free; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> who = m_queue.front(); m_queue.pop(); so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span> &gt;( who ); } } );</code> </pre> <br><p>  Here the handler for <code>put_t</code> most interesting: if the queue of waiting philosophers is empty, then we can return to <em>free</em> , but if not empty, then the first one should be sent <code>taken_t</code> . </p><br><h3 id="aktor-filosof">  Actor-philosopher </h3><br><p>  <a href="">The code of the actor-philosopher is</a> much more extensive, so I will not give it here in full.  We will discuss only the most significant fragments. </p><br><p>  The actor-philosopher has several more states: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_thinking{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"thinking.normal"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_wait_left{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"wait_left"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_wait_right{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"wait_right"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_eating{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"eating"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_done{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"done"</span></span> };</code> </pre> <br><p>  The actor starts his work in the state of <em>thinking</em> , then switches to <em>wait_left</em> , then to <em>wait_right</em> , then to <em>eating</em> .  From <em>eating the</em> actor can return to <em>thinking</em> or can go to <em>done</em> if the philosopher ate everything he should have. </p><br><p>  The state diagram for the actor-philosopher can be represented as follows: </p><br><p><img src="https://habrastorage.org/webt/ir/j0/sm/irj0smrzaedcsud20y71aynfqb4.png" alt="image"></p><br><p>  The logic of the behavior of the actor is described in the implementation of its <code>so_define_agent()</code> method: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">so_define_agent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ thinking —Ä–µ–∞–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∏–≥–Ω–∞–ª stop_thinking. st_thinking .event( [=]( mhood_t&lt;stop_thinking_t&gt; ) { // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –ª–µ–≤—É—é –≤–∏–ª–∫—É. this &gt;&gt;= st_wait_left; so_5::send&lt; take_t &gt;( m_left_fork, so_direct_mbox(), m_index ); } ); // –ö–æ–≥–¥–∞ –∂–¥–µ–º –ª–µ–≤—É—é –≤–∏–ª–∫—É —Ä–µ–∞–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ taken. st_wait_left .event( [=]( mhood_t&lt;taken_t&gt; ) { // –£ –Ω–∞—Å –µ—Å—Ç—å –ª–µ–≤–∞—è –≤–∏–ª–∫–∞. –ü—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –ø—Ä–∞–≤—É—é. this &gt;&gt;= st_wait_right; so_5::send&lt; take_t &gt;( m_right_fork, so_direct_mbox(), m_index ); } ); // –ü–æ–∫–∞ –∂–¥–µ–º –ø—Ä–∞–≤—É—é –≤–∏–ª–∫—É, —Ä–µ–∞–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ taken. st_wait_right .event( [=]( mhood_t&lt;taken_t&gt; ) { // –£ –Ω–∞—Å –æ–±–µ –≤–∏–ª–∫–∏, –º–æ–∂–Ω–æ –ø–æ–µ—Å—Ç—å. this &gt;&gt;= st_eating; } ); // –ü–æ–∫–∞ –µ–¥–∏–º —Ä–µ–∞–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ stop_eating. st_eating // 'stop_eating' –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–æ—Å–ª–∞–Ω –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—Ö–æ–¥–∏–º –≤ 'eating'. .on_enter( [=] { so_5::send_delayed&lt; stop_eating_t &gt;( *this, eat_pause() ); } ) .event( [=]( mhood_t&lt;stop_eating_t&gt; ) { // –û–±–µ –≤–∏–ª–∫–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Å—Ç–æ–ª. so_5::send&lt; put_t &gt;( m_right_fork ); so_5::send&lt; put_t &gt;( m_left_fork ); // –ù–∞ —à–∞–≥ –±–ª–∏–∂–µ –∫ —Ñ–∏–Ω–∞–ª—É. ++m_meals_eaten; if( m_meals_count == m_meals_eaten ) this &gt;&gt;= st_done; // –°—ä–µ–ª–∏ –≤—Å–µ, —á—Ç–æ –º–æ–≥–ª–∏, –ø–æ—Ä–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è. else think(); } ); st_done .on_enter( [=] { // –°–æ–æ–±—â–∞–µ–º –æ —Ç–æ–º, —á—Ç–æ –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏. completion_watcher_t::done( so_environment(), m_index ); } ); }</span></span></code> </pre> <br><p>  Perhaps the only point on which it should stop especially is the approach to imitating the processes of "thinking" and "food."  There is no <code>this_thread::sleep_for</code> or any other way of blocking the current working thread in the actor code.  Instead, deferred messages are used.  For example, when the actor enters the <em>eating</em> state, it sends to itself a pending message <code>stop_eating_t</code> .  This message is given to the SObjectizer timer, and the timer delivers the message to the actor when the time comes. </p><br><p>  The use of deferred messages allows you to run all the actors in the context of a single working thread.  Roughly speaking, one thread reads from some message queue and pulls the handler of the next message from the corresponding receiving actor.  More on working contexts for actors will be discussed below. </p><br><h3 id="rezultaty">  results </h3><br><p>  The results of this implementation may look like this (small fragment): </p><br><pre> <code class="plaintext hljs"> Socrates: tttttttttttLRRRRRRRRRRRRRREEEEEEEttttttttLRRRRRRRRRRRRRREEEEEEEEEEEEE Plato: ttttttttttEEEEEEEEEEEEEEEEttttttttttRRRRRREEEEEEEEEEEEEEttttttttttLLL Aristotle: ttttEEEEEtttttttttttLLLLLLRRRREEEEEEEEEEEEttttttttttttLLEEEEEEEEEEEEE Descartes: tttttLLLLRRRRRRRREEEEEEEEEEEEEtttLLLLLLLLLRRRRREEEEEEttttttttttLLLLLL Spinoza: ttttEEEEEEEEEEEEEttttttttttLLLRRRREEEEEEEEEEEEEttttttttttRRRREEEEEEtt Kant: ttttttttttLLLLLLLRREEEEEEEEEEEEEEEttttttttttLLLEEEEEEEEEEEEEEtttttttt Schopenhauer: ttttttEEEEEEEEEEEEEttttttLLLLLLLLLEEEEEEEEEttttttttLLLLLLLLLLRRRRRRRR Nietzsche: tttttttttLLLLLLLLLLEEEEEEEEEEEEEttttttttLLLEEEEEEEEEttttttttRRRRRRRRE Wittgenstein: ttttEEEEEEEEEEtttttLLLLLLLLLLLLLEEEEEEEEEttttttttttttRRRREEEEEEEEEEEt Heidegger: tttttttttttLLLEEEEEEEEEEEEEEtttttttLLLLLLREEEEEEEEEEEEEEEtttLLLLLLLLR Sartre: tttEEEEEEEEEttttLLLLLLLLLLLLRRRRREEEEEEEEEtttttttLLLLLLLLRRRRRRRRRRRR</code> </pre> <br><p>  Read this as follows: </p><br><ul><li>  <code>t</code> means that the philosopher "reflects"; </li><li>  <code>L</code> means that the philosopher is waiting for the capture of the left fork (is in the <em>wait_left</em> state); </li><li>  <code>R</code> means that the philosopher is waiting for the capture of the right fork (is in the <em>wait_right</em> state); </li><li>  <code>E</code> means that the philosopher is "eating." </li></ul><br><p>  We can see that Socrates can take the plug on the left only after Sartre gives it away.  Then Socrates will wait for Plato to release the right fork.  Only then can Socrates eat. </p><br><h2 id="prostoe-reshenie-bez-arbitra-oficianta">  A simple decision without an arbitrator (waiter) </h2><br><p>  If we analyze the result of the work of Dijkstra‚Äôs solution, we will see that philosophers spend a lot of time waiting for the forks to be captured.  What is not good, because  This time can also be spent on meditation.  Not for nothing is the opinion that if you think on an empty stomach, you can get much more interesting and unexpected results;) </p><br><p>  Let's look at the simplest solution, in which the philosopher returns the first fork seized if he cannot capture the second one (in the Modern Dining philosophers article mentioned above, this solution is implemented by ForkLevelPhilosopherProtocol). </p><br><p>  The source code of this implementation can be seen <a href="">here</a> , and the code of the corresponding actor-philosopher is <a href="">here</a> . </p><br><h3 id="soobscheniya-1">  Messages </h3><br><p>  This solution uses almost the same set of messages: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">take_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> m_who; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_philosopher_index; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">busy_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">signal_t</span></span> {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">taken_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">signal_t</span></span> {}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">put_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">signal_t</span></span> {};</code> </pre> <br><p>  The only difference is the presence of the <code>busy_t</code> signal.  This signal actor-fork sends in response to the actor-philosopher if the plug is already captured by another philosopher. </p><br><h3 id="aktor-vilka-1">  Actor Fork </h3><br><p>  Actor-fork in this solution is even easier than in the decision Dijkstra: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fork_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">fork_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx ) : so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span>( ctx ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_free; st_free.event( [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span>&gt; cmd ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_taken; so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span> &gt;( cmd-&gt;m_who ); } ); st_taken.event( []( <span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span>&gt; cmd ) { so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">busy_t</span></span> &gt;( cmd-&gt;m_who ); } ) .just_switch_to&lt; <span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span> &gt;( st_free ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_free{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> st_taken{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }; };</code> </pre> <br><p>  We do not even need to keep the waiting line of philosophers here. </p><br><h3 id="aktor-filosof-1">  Actor-philosopher </h3><br><p>  The actor-philosopher in this implementation is similar to that of Dijkstra‚Äôs decision, but here the actor-philosopher also has to process <code>busy_t</code> , so the state diagram looks like this: </p><br><p><img src="https://habrastorage.org/webt/xa/ek/c8/xaekc8xbxewoj1e7myao4le6jn0.png" alt="image"></p><br><p>  Similarly, the entire logic of the actor-philosopher is defined in <code>so_define_agent()</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">so_define_agent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override </span></span>{ st_thinking .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">stop_thinking_t</span></span> &gt;( [=] { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_wait_left; so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span> &gt;( m_left_fork, so_direct_mbox(), m_index ); } ); st_wait_left .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span> &gt;( [=] { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_wait_right; so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span> &gt;( m_right_fork, so_direct_mbox(), m_index ); } ) .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">busy_t</span></span> &gt;( [=] { think( st_hungry_thinking ); } ); st_wait_right .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span> &gt;( [=] { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_eating; } ) .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">busy_t</span></span> &gt;( [=] { so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span> &gt;( m_left_fork ); think( st_hungry_thinking ); } ); st_eating .on_enter( [=] { so_5::send_delayed&lt; <span class="hljs-keyword"><span class="hljs-keyword">stop_eating_t</span></span> &gt;( *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, eat_pause() ); } ) .event&lt; <span class="hljs-keyword"><span class="hljs-keyword">stop_eating_t</span></span> &gt;( [=] { so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span> &gt;( m_right_fork ); so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span> &gt;( m_left_fork ); ++m_meals_eaten; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_meals_count == m_meals_eaten ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &gt;&gt;= st_done; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> think( st_normal_thinking ); } ); st_done .on_enter( [=] { <span class="hljs-keyword"><span class="hljs-keyword">completion_watcher_t</span></span>::done( so_environment(), m_index ); } ); }</code> </pre> <br><p>  In general, this is practically the same code as in Dijkstra‚Äôs solution, except that a couple of handlers for <code>busy_t</code> . </p><br><h3 id="rezultaty-1">  results </h3><br><p>  The results of the work look different: </p><br><pre> <code class="plaintext hljs"> Socrates: tttttttttL..R.....EEEEEEEEEEEEttttttttttR...LL..EEEEEEEttEEEEEE Plato: ttttEEEEEEEEEEEttttttL.....L..EEEEEEEEEEEEEEEttttttttttL....L.... Aristotle: ttttttttttttL..LR.EEEEEEtttttttttttL..L....L....R.....EEEEEEEEE Descartes: ttttttttttEEEEEEEEttttttttttttEEEEEEEEttttEEEEEEEEEEEttttttL..L.. Spinoza: ttttttttttL.....L...EEEEEEtttttttttL.L......L....L..L...R...R...E Kant: tttttttEEEEEEEttttttttL.L.....EEEEEEEEttttttttR...R..R..EEEEEtttt Schopenhauer: tttR..R..L.....EEEEEEEttttttR.....L...EEEEEEEEEEEEEEEEttttttttttt Nietzsche: tttEEEEEEEEEEtttttttttEEEEEEEEEEEEEEEttttL....L...L..L....EEEEEEE Wittgenstein: tttttL.L..L.....RR....L.....L....L...EEEEEEEEEEEEEEEtttttttttL. Heidegger: ttttR..R......EEEEEEEEEEEEEttttttttttR..L...L...L..L...EEEEtttttt Sartre: tttEEEEEEEtttttttL..L...L....R.EEEEEEEtttttEEEEtttttttR.....R..R.</code> </pre> <br><p>  Here we see a new symbol, which means that the actor-philosopher is in "hungry thoughts". </p><br><p>  Even on this short fragment, one can see that there are long moments of time during which the philosopher cannot eat.  This is because this solution is protected from the problem of deadlocks, but does not have protection against fasting. </p><br><h2 id="reshenie-s-oficiantom-i-ocheredyu">  Solution with a waiter and a queue </h2><br><p>  The simplest solution shown above without an arbitrator does not protect against fasting.  The above-mentioned article "Modern dining philosophers" contains a solution to the problem of fasting in the form of the WaiterFair protocol.  The bottom line is that an arbitrator (waiter) appears to whom philosophers turn to when they want to eat.  And the waiter has a queue of applications from philosophers.  And the philosopher gets the forks only if both of the forks are now free, and there is still no one in the queue of the neighbors of the philosopher who turned to the waiter. </p><br><p>  Let's look at how the same solution might look like on actors. </p><br><p>  The source code for this implementation can be found <a href="">here</a> . </p><br><h3 id="tryuk">  Trick </h3><br><p>  The easiest thing would be to introduce a new set of messages through which philosophers could communicate with the waiter.  But I wanted to save not only the already existing set of messages (i.e. <code>take_t</code> , <code>taken_t</code> , <code>busy_t</code> , <code>put_t</code> ).  I also wanted the same actor-philosopher to be used as in the previous decision.  Therefore, I needed to solve a clever puzzle: how to make the actor-philosopher communicate with the only actor-waiter, but at the same time thought that he interacts directly with the actors-forks (which are no longer in fact). </p><br><p>  This problem was solved with the help of a simple trick: the actor-waiter creates a set of mboxes, links to which are given to actors-philosophers as references to the mboxes of the forks.  At the same time, the actor-waiter subscribes to messages from all these mboxes (which is easily implemented in SObjectizer, since SObjectizer is not only / much of the Actor model, but also Pub / Sub is supported out of the box) . </p><br><p>  In code, it looks like this: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">waiter_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">waiter_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> forks_count ) : so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(ctx) } , m_fork_states( forks_count, <span class="hljs-keyword"><span class="hljs-keyword">fork_state_t</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">free</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">// –ù—É–∂–Ω—ã mbox-—ã –¥–ª—è –∫–∞–∂–¥–æ–π "–≤–∏–ª–∫–∏" m_fork_mboxes.reserve( forks_count ); for( std::size_t i{}; i != forks_count; ++i ) m_fork_mboxes.push_back( so_environment().create_mbox() ); } ... void so_define_agent() override { // –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π "–≤–∏–ª–∫–∏". for( std::size_t i{}; i != m_fork_mboxes.size(); ++i ) { // –ù–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∏–Ω–¥–µ–∫—Å –≤–∏–ª–∫–∏. –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª—è–º–±–¥—ã. // –õ—è–º–±–¥–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –∏ –∑–∞—Ç–µ–º –æ—Ç–¥–∞–µ—Ç —ç—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å –≤ // –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. so_subscribe( fork_mbox( i ) ) .event( [i, this]( mhood_t&lt;take_t&gt; cmd ) { on_take_fork( std::move(cmd), i ); } ) .event( [i, this]( mhood_t&lt;put_t&gt; cmd ) { on_put_fork( std::move(cmd), i ); } ); } } private : ... // –ü–æ—á—Ç–æ–≤—ã–µ —è—â–∏–∫–∏ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö "–≤–∏–ª–æ–∫". std::vector&lt; so_5::mbox_t &gt; m_fork_mboxes;</span></span></code> </pre> <br><p>  Those.  First, create a vector mboxes for non-existent "forks", then subscribe to each of them.  Yes, so we subscribe to know which plug the request belongs to. </p><br><p>  The real handler for the <code>on_take_fork()</code> incoming request is the <code>on_take_fork()</code> method: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_take_fork</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mhood_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">take_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; cmd, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fork_index )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ —É –ª–µ–≤–æ–π –≤–∏–ª–∫–∏ –∏–Ω–¥–µ–∫—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç // —Å –∏–Ω–¥–µ–∫—Å–æ–º —Å–∞–º–æ–≥–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∞. if( fork_index == cmd-&gt;m_philosopher_index ) handle_take_left_fork( std::move(cmd), fork_index ); else handle_take_right_fork( std::move(cmd), fork_index ); }</span></span></code> </pre> <br><p>  By the way, it was here that we needed the second field from the <code>take_t</code> message. </p><br><p>  So, in <code>on_take_fork()</code> we have the original query and the index of the fork to which the query belongs.  Therefore, we can determine whether the philosopher is asking for the left or right fork.  And, accordingly, we can process them in different ways (and we have to process them in different ways). </p><br><p>  Since the philosopher always asks for the left plug first, we need to do all the necessary checks at this very moment.  And we may end up in one of the following situations: </p><br><ol><li>  Both forks are free and can be given to the philosopher who sent the request.  In this case, we <code>taken_t</code> philosopher, and mark the right fork as reserved so that no one else can take it. </li><li>  Plugs cannot be given to the philosopher.  No matter why.  Maybe some of them are busy right now.  Or in the queue there is someone from the neighbors of the philosopher. –ö–∞–∫ –±—ã —Ç–æ –Ω–∏ –±—ã–ª–æ, –º—ã –ø–æ–º–µ—â–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–∞, –ø—Ä–∏—Å–ª–∞–≤—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å, –≤ –æ—á–µ—Ä–µ–¥—å, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ—Ç—Å—ã–ª–∞–µ–º –µ–º—É <code>busy_t</code> . </li></ol><br><p> –ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–∞–∫–æ–π –ª–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ, –ø–æ–ª—É—á–∏–≤—à–∏–π <code>taken_t</code> –¥–ª—è –ª–µ–≤–æ–π –≤–∏–ª–∫–∏, –º–æ–∂–µ—Ç —Å–ø–æ–∫–æ–π–Ω–æ –ø–æ—Å–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å <code>take_t</code> –¥–ª—è –ø—Ä–∞–≤–æ–π –≤–∏–ª–∫–∏. –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Å—Ä–∞–∑—É –∂–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω, —Ç.–∫. –≤–∏–ª–∫–∞ —É–∂–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∞. </p><br><h3 id="rezultaty-2">  results </h3><br><p> –ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª—É—á–∏–≤—à–µ–µ—Å—è —Ä–µ—à–µ–Ω–∏–µ, —Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: </p><br><pre> <code class="plaintext hljs"> Socrates: tttttttttttL....EEEEEEEEEEEEEEttttttttttL...L...EEEEEEEEEEEEEtttttL. Plato: tttttttttttL....L..L..L...L...EEEEEEEEEEEEEtttttL.....L....L.....EEE Aristotle: tttttttttL.....EEEEEEEEEttttttttttL.....L.....EEEEEEEEEEEtttL....LL Descartes: ttEEEEEEEEEEtttttttL.L..EEEEEEEEEEEEtttL..L....L....L.....EEEEEEEEEE Spinoza: tttttttttL.....EEEEEEEEEttttttttttL.....L.....EEEEEEEEEEEtttL....LL Kant: ttEEEEEEEEEEEEEtttttttL...L.....L.....EEEEEttttL....L...L..L...EEEEE Schopenhauer: ttttL...L.....L.EEEEEEEEEEEEEEEEEtttttttttttL..L...L..EEEEEEEttttttt Nietzsche: tttttttttttL....L..L..L...L...L.....L....EEEEEEEEEEEEttL.....L...L.. Wittgenstein: tttttttttL....L...L....L....L...EEEEEEEttttL......L.....L.....EEEEEE Heidegger: ttttttL..L...L.....EEEEEEEEEEEEtttttL...L..L.....EEEEEEEEEEEttttttL. Sartre: ttEEEEEEEEEEEEEttttttttL.....L...EEEEEEEEEEEEttttttttttttL.....EEEEE</code> </pre> <br><p> –ú–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ <code>R</code> . –≠—Ç–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –Ω–µ—É–¥–∞—á–∏ –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–∞–≤–æ–π –≤–∏–ª–∫–∏. </p><br><h2 id="esche-odno-reshenie-s-ispolzovaniem-arbitra-oficianta"> –ï—â–µ –æ–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Ä–±–∏—Ç—Ä–∞ (–æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞) </h2><br><p> –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ waiter_with_queue –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ—Ö–æ–∂–∏–µ –≤–æ—Ç –Ω–∞ —ç—Ç–æ—Ç: </p><br><pre> <code class="plaintext hljs"> Socrates: tttttEEEEEEEEEEEEEEtttL.....LL...L....EEEEEEEEEttttttttttL....L.....EE Plato: tttttL..L..L....LL...EEEEEEEEEEEEEEEttttttttttttL.....EEEEEEEEEttttttt Aristotle: tttttttttttL..L...L.....L.....L....L.....EEEEEEEEEEEEtttttttttttL....L.. Descartes: ttttttttttEEEEEEEEEEttttttL.....L....L..L.....L.....L..L...L..EEEEEEEEtt Spinoza: tttttttttttL..L...L.....L.....L....L.....L..L..L....EEEEEEEEEEtttttttttt Kant: tttttttttL....L....L...L...L....L..L...EEEEEEEEEEEttttttttttL...L......E Schopenhauer: ttttttL....L..L...L...LL...L...EEEEEtttttL....L...L.....EEEEEEEEEttttt Nietzsche: tttttL..L..L....EEEEEEEEEEEEEttttttttttttEEEEEEEEEEEEEEEttttttttttttL... Wittgenstein: tttEEEEEEEEEEEEtttL....L....L..EEEEEEEEEtttttL..L..L....EEEEEEEEEEEEEEEE Heidegger: tttttttttL...L..EEEEEEEEttttL..L.....L...EEEEEEEEEtttL.L..L...L....L...L Sartre: ttttttttttL..L....L...L.EEEEEEEEEEEtttttL...L..L....EEEEEEEEEEtttttttttt</code> </pre> <br><p> –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –≤—Ä–µ–º–µ–Ω–∏, –∫–æ–≥–¥–∞ —Ñ–∏–ª–æ—Å–æ—Ñ—ã –Ω–µ –º–æ–≥—É—Ç –ø–æ–µ—Å—Ç—å –¥–∞–∂–µ –Ω–µ —Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –≤–∏–ª–æ–∫. –ù–∞–ø—Ä–∏–º–µ—Ä, –ª–µ–≤–∞—è –∏ –ø—Ä–∞–≤–∞—è –≤–∏–ª–∫–∏ –¥–ª—è –ö–∞–Ω—Ç–∞ —Å–≤–æ–±–æ–¥–Ω—ã –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –ö–∞–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –∏—Ö –≤–∑—è—Ç—å, —Ç.–∫. –≤ –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è —É–∂–µ —Å—Ç–æ—è—Ç –µ–≥–æ —Å–æ—Å–µ–¥–∏. –ö–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç —Å–≤–æ–∏—Ö —Å–æ—Å–µ–¥–µ–π. –ö–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç —Å–≤–æ–∏—Ö —Å–æ—Å–µ–¥–µ–π –∏ —Ç.–¥. </p><br><p> –ü–æ—ç—Ç–æ–º—É —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω–∞—è –≤—ã—à–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è waiter_with_queue –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –≥–æ–ª–æ–¥–∞–Ω–∏—è –≤ —Ç–æ–º —Å–º—ã—Å–ª–µ, —á—Ç–æ —Ä–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ —Ñ–∏–ª–æ—Å–æ—Ñ –ø–æ–µ—Å—Ç. –≠—Ç–æ –µ–º—É –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ. –ù–æ –ø–µ—Ä–∏–æ–¥—ã –≥–æ–ª–æ–¥–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –¥–æ–ª–≥–∏–º–∏. –ò —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –≤—Ä–µ–º–µ–Ω–∞–º–∏. </p><br><p> –î–∞–±—ã —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –µ—â–µ –æ–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ, waiter_with_timestamp (–µ–≥–æ –∫–æ–¥ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ <a href="">–∑–¥–µ—Å—å</a> ). –í–º–µ—Å—Ç–æ –æ—á–µ—Ä–µ–¥–∏ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏—Ö –≥–æ–ª–æ–¥–∞–Ω–∏—è. –ß–µ–º –¥–æ–ª—å—à–µ —Ñ–∏–ª–æ—Å–æ—Ñ –≥–æ–ª–æ–¥–∞–µ—Ç, —Ç–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –µ–≥–æ –∑–∞–ø—Ä–æ—Å. </p><br><p> –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–æ–¥ —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –º—ã –Ω–µ –±—É–¥–µ–º, —Ç.–∫. –ø–æ –±–æ–ª—å—à–æ–º—É —Å—á–µ—Ç—É –≥–ª–∞–≤–Ω–æ–µ –≤ –Ω–µ–º ‚Äî —ç—Ç–æ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π —Ç—Ä—é–∫ —Å –Ω–∞–±–æ—Ä–æ–º mbox-–æ–≤ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö "–≤–∏–ª–æ–∫", –∫–æ—Ç–æ—Ä—ã–π –º—ã —É–∂–µ –æ–±—Å—É–¥–∏–ª–∏ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ –ø—Ä–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é waiter_with_queue. </p><br><h2 id="neskolko-detaley-realizacii-na-kotorye-hotelos-by-obratit-vnimanie"> –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ </h2><br><p> –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–∞–ª–µ–π –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ, —Ç.–∫. —ç—Ç–∏ –¥–µ—Ç–∞–ª–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ SObjectizer-–∞. </p><br><h3 id="rabochiy-kontekst-dlya-aktorov"> –†–∞–±–æ—á–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∞–∫—Ç–æ—Ä–æ–≤ </h3><br><p> –í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–∫—Ç–æ—Ä—ã ( <code>fork_t</code> , <code>philosopher_t</code> , <code>waiter_t</code> ) —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–¥–Ω–æ–π –æ–±—â–µ–π —Ä–∞–±–æ—á–µ–π –Ω–∏—Ç–∏. –ß—Ç–æ –≤–æ–≤—Å–µ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ SObjectizer-–µ –≤—Å–µ –∞–∫—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–∏—Ç–∏. –í SObjectizer-–µ –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –∞–∫—Ç–æ—Ä–æ–≤ –∫ —Ä–∞–∑–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º, —á—Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ <code>run_simulation()</code> –≤ —Ä–µ—à–µ–Ω–∏–∏ no_waiter_simple. </p><br><div class="spoiler"> <b class="spoiler_title">–ö–æ–¥ run_simulation –∏–∑ no_waiter_simple</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_simulation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">environment_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; env, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">names_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; names )</span></span></span><span class="hljs-function"> </span></span>{ env.introduce_coop( [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop ) { coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">trace_maker_t</span></span> &gt;( so_5::disp::one_thread::create_private_disp( env )-&gt;binder(), names, <span class="hljs-keyword"><span class="hljs-keyword">random_pause_generator_t</span></span>::trace_step() ); coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">completion_watcher_t</span></span> &gt;( so_5::disp::one_thread::create_private_disp( env )-&gt;binder(), names ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> count = names.size(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> * &gt; forks( count, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != count; ++i ) forks[ i ] = coop.make_agent&lt; <span class="hljs-keyword"><span class="hljs-keyword">fork_t</span></span> &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != count; ++i ) coop.make_agent&lt; <span class="hljs-keyword"><span class="hljs-keyword">philosopher_t</span></span> &gt;( i, forks[ i ]-&gt;so_direct_mbox(), forks[ (i + <span class="hljs-number"><span class="hljs-number">1</span></span>) % count ]-&gt;so_direct_mbox(), default_meals_count ); }); }</code> </pre> </div></div><br><p> –í —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–∫—Ç–æ—Ä—ã —Ç–∏–ø–æ–≤ <code>trace_maker_t</code> –∏ <code>completion_watcher_t</code> . –û–Ω–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö. –î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ —Ç–∏–ø–∞ <code>one_thread</code> –∏ –∞–∫—Ç–æ—Ä—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —ç—Ç–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤. –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç–æ—Ä—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ <em>–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã</em> : –∫–∞–∂–¥—ã–π –±—É–¥–µ—Ç –≤–ª–∞–¥–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–∞–±–æ—á–µ–π –Ω–∏—Ç—å—é. </p><br><p> SObjectizer –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–±–æ—Ä –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–Ω—ã—Ö –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä—è–º–æ "–∏–∑ –∫–æ—Ä–æ–±–∫–∏". –ü—Ä–∏ —ç—Ç–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –≤ —Å–≤–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–≤, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –Ω—É–∂–Ω–æ. </p><br><p> –ù–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ —Ç–æ, —á—Ç–æ –≤ —Å–∞–º–æ–º –∞–∫—Ç–æ—Ä–µ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å, —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–º –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ. –°–∫–∞–∂–µ–º, –º—ã –ª–µ–≥–∫–æ –º–æ–∂–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–∫—Ç–æ—Ä–æ–≤ <code>fork_t</code> –Ω–∞ –æ–¥–Ω–æ–º –ø—É–ª–µ —Ä–∞–±–æ—á–∏—Ö –Ω–∏—Ç–µ–π, –∞ –∞–∫—Ç–æ—Ä–æ–≤ <code>philosopher_t</code> –Ω–∞ –¥—Ä—É–≥–æ–º –ø—É–ª–µ. </p><br><div class="spoiler"> <b class="spoiler_title">–ö–æ–¥ run_simulation –∏–∑ no_waiter_simple_tp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_simulation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">environment_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; env, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">names_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; names )</span></span></span><span class="hljs-function"> </span></span>{ env.introduce_coop( [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop ) { coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">trace_maker_t</span></span> &gt;( so_5::disp::one_thread::create_private_disp( env )-&gt;binder(), names, <span class="hljs-keyword"><span class="hljs-keyword">random_pause_generator_t</span></span>::trace_step() ); coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">completion_watcher_t</span></span> &gt;( so_5::disp::one_thread::create_private_disp( env )-&gt;binder(), names ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> count = names.size(); <span class="hljs-comment"><span class="hljs-comment">// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è thread_pool-–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞. so_5::disp::thread_pool::bind_params_t bind_params; bind_params.fifo( so_5::disp::thread_pool::fifo_t::individual ); std::vector&lt; so_5::agent_t * &gt; forks( count, nullptr ); // –°–æ–∑–¥–∞–µ–º –ø—É–ª –Ω–∏—Ç–µ–π –¥–ª—è –∞–∫—Ç–æ—Ä–æ–≤-–≤–∏–ª–æ–∫. auto fork_disp = so_5::disp::thread_pool::create_private_disp( env, 3u // –†–∞–∑–º–µ—Ä –ø—É–ª–∞. ); for( std::size_t i{}; i != count; ++i ) // –ö–∞–∂–¥–∞—è –≤–∏–ª–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø—É–ª—É. forks[ i ] = coop.make_agent_with_binder&lt; fork_t &gt;( fork_disp-&gt;binder( bind_params ) ); // –°–æ–∑–¥–∞–µ–º –ø—É–ª –Ω–∏—Ç–µ–π –¥–ª—è –∞–∫—Ç–æ—Ä–æ–≤-—Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. auto philosopher_disp = so_5::disp::thread_pool::create_private_disp( env, 6u // –†–∞–∑–º–µ—Ä –ø—É–ª–∞. ); for( std::size_t i{}; i != count; ++i ) coop.make_agent_with_binder&lt; philosopher_t &gt;( philosopher_disp-&gt;binder( bind_params ), i, forks[ i ]-&gt;so_direct_mbox(), forks[ (i + 1) % count ]-&gt;so_direct_mbox(), default_meals_count ); }); }</span></span></code> </pre> </div></div><br><p> –ò –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞–º –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –ø–æ–º–µ–Ω—è—Ç—å –Ω–∏ —Å—Ç—Ä–æ—á–∫–∏ –≤ –∫–ª–∞—Å—Å–∞—Ö <code>fork_t</code> –∏ <code>philosopher_t</code> . </p><br><h3 id="trassirovka-smeny-sostoyaniy-aktorov"> –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–º–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–∫—Ç–æ—Ä–æ–≤ </h3><br><p> –ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ –≤ —É–ø–æ–º—è–Ω—É—Ç–æ–π –≤—ã—à–µ —Å—Ç–∞—Ç—å–µ <a href="http://lucteo.ro/2018/12/28/modern-dining-philosophers/">Modern dining philosophers</a> –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —É–≤–∏–¥–µ—Ç—å –∫–æ–¥, –æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–µ –¥–µ–π—Å—Ç–≤–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doEat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ eventLog_.startActivity(ActivityType::eat); wait(randBetween(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>)); eventLog_.endActivity(ActivityType::eat);</code> </pre> <br><p> –í —Ç–æ–∂–µ –≤—Ä–µ–º—è –≤ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤—ã—à–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö –Ω–∞ –±–∞–∑–µ SObjectizer –ø–æ–¥–æ–±–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–µ—Ç. –ù–æ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞, —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ó–∞ —Å—á–µ—Ç —á–µ–≥–æ? </p><br><p> –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –≤ SObjectizer-–µ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —à—Ç—É–∫–∞: —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–≥–µ–Ω—Ç–∞. –¢–∞–∫–æ–π —Å–ª—É—à–∞—Ç–µ–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∫–∞–∫ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –∫–ª–∞—Å—Å–∞ <code>agent_state_listener_t</code> . –ö–æ–≥–¥–∞ —Å–ª—É—à–∞—Ç–µ–ª—å —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –∞–≥–µ–Ω—Ç–æ–º, —Ç–æ SObjectizer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª—è –æ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–∞. </p><br><p> –£—Å—Ç–∞–Ω–æ–≤–∫—É —Å–ª—É—à–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∞–≥–µ–Ω—Ç–æ–≤ <code>greedy_philosopher_t</code> –∏ <code>philosopher_t</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">philosopher_t</span></span>(...) ... { so_add_destroyable_listener( <span class="hljs-keyword"><span class="hljs-keyword">state_watcher_t</span></span>::make( so_environment(), index ) ); }</code> </pre> <br><p> –ó–¥–µ—Å—å <code>state_watcher_t</code> ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –Ω—É–∂–Ω–∞—è –º–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª—É—à–∞—Ç–µ–ª—è. </p><br><div class="spoiler"> <b class="spoiler_title">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ state_watcher_t</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state_watcher_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_state_listener_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> m_mbox; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_index; <span class="hljs-keyword"><span class="hljs-keyword">state_watcher_t</span></span>( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> mbox, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> index ); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">environment_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; env, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_state_listener_unique_ptr_t</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">state_watcher_t</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">trace_maker_t</span></span>::make_mbox(env), index } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">agent_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">state_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; state )</span></span></span><span class="hljs-function"> override</span></span>; };</code> </pre> </div></div><br><p> –ö–æ–≥–¥–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä <code>state_watcher_t</code> —Å–≤—è–∑–∞–Ω —Å –∞–≥–µ–Ω—Ç–æ–º SObjectizer –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ <code>changed()</code> –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–∞. –ò —É–∂–µ –≤–Ω—É—Ç—Ä–∏ <code>state_watcher_t::changed</code> –∏–Ω–∏—Ü–∏–∏—Ä—É—é—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∞–∫—Ç–æ—Ä–∞-—Ñ–∏–ª–æ—Å–æ—Ñ–∞. </p><br><div class="spoiler"> <b class="spoiler_title">–§—Ä–∞–≥–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ state_watcher_t::changed</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">state_watcher_t</span></span>::changed( so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">state_t</span></span> &amp; state ) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> detect_label = []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp; name ) {...}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> state_label = detect_label( state.query_name() ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-string"><span class="hljs-string">'?'</span></span> == state_label ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; so_5::send&lt; trace::<span class="hljs-keyword"><span class="hljs-keyword">state_changed_t</span></span> &gt;( m_mbox, m_index, state_label ); }</code> </pre> </div></div><br><h1 id="resheniya-na-baze-csp"> –†–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ CSP </h1><br><p> –¢–µ–ø–µ—Ä—å –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–∫—Ç–æ—Ä–æ–≤ –≤–æ–æ–±—â–µ. –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç–µ –∂–µ —Å–∞–º—ã–µ —Ä–µ—à–µ–Ω–∏—è (no_waiter_dijkstra, no_waiter_simple, waiter_with_timestamps) –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è <code>std::thread</code> –∏ SObjectizer-–æ–≤—Å–∫–∏–µ mchain-—ã (–∫–æ—Ç–æ—Ä—ã–µ, –ø–æ —Å—É—Ç–∏, –µ—Å—Ç—å CSP-—à–Ω—ã–µ –∫–∞–Ω–∞–ª—ã). –ü—Ä–∏—á–µ–º, –ø–æ–¥—á–µ—Ä–∫–Ω—É –æ—Å–æ–±–æ, –≤ CSP-—à–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –Ω–∞–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (–≤—Å–µ —Ç–µ –∂–µ <code>take_t</code> , <code>taken_t</code> , <code>busy_t</code> , <code>put_t</code> ). </p><br><p> –í CSP-–ø–æ–¥—Ö–æ–¥–µ –≤–º–µ—Å—Ç–æ "–ø—Ä–æ—Ü–µ—Å—Å–æ–≤" –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∏—Ç–∏ –û–°. –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥–∞—è –≤–∏–ª–∫–∞, –∫–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –∏ –∫–∞–∂–¥—ã–π –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º <code>std::thread</code> . </p><br><h2 id="reshenie-deykstry-1"> –†–µ—à–µ–Ω–∏–µ –î–µ–π–∫—Å—Ç—Ä—ã </h2><br><p> –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å <a href="">–∑–¥–µ—Å—å</a> . </p><br><h3 id="nit-dlya-vilki"> –ù–∏—Ç—å –¥–ª—è –≤–∏–ª–∫–∏ </h3><br><p> –ù–∏—Ç—å –¥–ª—è –≤–∏–ª–∫–∏ –≤ —Ä–µ—à–µ–Ω–∏–∏ –î–µ–π–∫—Å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ: —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ + –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–∏–ø–∞ <code>take_t</code> –∏ <code>put_t</code> . –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π <code>fork_process</code> —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fork_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fork_ch )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–ª–∫–∏: –∑–∞–Ω—è—Ç–∞ –∏–ª–∏ –Ω–µ—Ç. bool taken = false; // –û—á–µ—Ä–µ–¥—å –∂–¥—É—â–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. std::queue&lt; so_5::mbox_t &gt; wait_queue; // –ß–∏—Ç–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ—é—Ç. so_5::receive( so_5::from( fork_ch ), [&amp;]( so_5::mhood_t&lt;take_t&gt; cmd ) { if( taken ) // –í–∏–ª–∫–∞ –∑–∞–Ω—è—Ç–∞, —Ñ–∏–ª–æ—Å–æ—Ñ –¥–æ–ª–∂–µ–Ω –∂–¥–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏. wait_queue.push( cmd-&gt;m_who ); else { // –§–∏–ª–æ—Å–æ—Ñ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –≤–∏–ª–∫—É. taken = true; so_5::send&lt; taken_t &gt;( cmd-&gt;m_who ); } }, [&amp;]( so_5::mhood_t&lt;put_t&gt; ) { if( wait_queue.empty() ) taken = false; // –í–∏–ª–∫–∞ –±–æ–ª—å—à–µ –Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–Ω–∞. else { // –í–∏–ª–∫—É –Ω—É–∂–Ω–æ –æ—Ç–¥–∞—Ç—å –ø–µ—Ä–≤–æ–º—É —Ñ–∏–ª–æ—Å–æ—Ñ—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏. const auto who = wait_queue.front(); wait_queue.pop(); so_5::send&lt; taken_t &gt;( who ); } } ); }</span></span></code> </pre> <br><p> –£ —Ñ—É–Ω–∫—Ü–∏–∏ <code>fork_process</code> –≤—Å–µ–≥–æ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç: –≤—Ö–æ–¥–Ω–æ–π –∫–∞–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –≥–¥–µ-—Ç–æ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ. </p><br><p> –°–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤ <code>fork_process</code> ‚Äî —ç—Ç–æ "—Ü–∏–∫–ª" –≤—ã–±–æ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–∞ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç. –≠—Ç–æ—Ç —Ü–∏–∫–ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤—Å–µ–≥–æ –æ–¥–Ω–∏–º –≤—ã–∑–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–∏ <code>receive()</code> : </p><br><pre> <code class="cpp hljs">so_5::receive( so_5::from( fork_ch ), [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span>&gt; cmd ) {...}, [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">put_t</span></span>&gt; ) {...} );</code> </pre> <br><p> –í SObjectizer-–µ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π —Ñ—É–Ω–∫—Ü–∏–∏ <code>receive()</code> –∏ –∑–¥–µ—Å—å –º—ã –≤–∏–¥–∏–º –æ–¥–Ω—É –∏–∑ –Ω–∏—Ö. –≠—Ç–∞ –≤–µ—Ä—Å–∏—è —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞ –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏—â–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫. –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω, —Ç–æ –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è. </p><br><p> –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–¥–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏–π. –≠—Ç–∏ –ª—è–º–±–¥—ã –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ –±–ª–∏–∑–Ω–µ—Ü—ã –±—Ä–∞—Ç—å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ –∞–∫—Ç–æ—Ä–µ <code>fork_t</code> –∏–∑ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤. –ß—Ç–æ, –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ, –Ω–µ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ. </p><br><h3 id="nit-dlya-filosofa"> –ù–∏—Ç—å –¥–ª—è —Ñ–∏–ª–æ—Å–æ—Ñ–∞ </h3><br><p> –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ <code>philosopher_process</code> . –£ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ä–µ–º–Ω—ã–π –∫–æ–¥, –ø–æ—ç—Ç–æ–º—É –º—ã –±—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è —Å –Ω–∏–º –ø–æ —á–∞—Å—Ç—è–º. </p><br><div class="spoiler"> <b class="spoiler_title">–ü–æ–ª–Ω—ã–π –∫–æ–¥ philosopher_process</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">oid </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">philosopher_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trace_maker_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; tracer, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> control_ch, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> philosopher_index, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left_fork, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right_fork, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> meals_count )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> meals_eaten{ <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">random_pause_generator_t</span></span> pause_generator; <span class="hljs-comment"><span class="hljs-comment">// –≠—Ç–æ—Ç –∫–∞–Ω–∞–ª –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –≤–∏–ª–æ–∫. auto self_ch = so_5::create_mchain( control_ch-&gt;environment() ); while( meals_eaten &lt; meals_count ) { tracer.thinking_started( philosopher_index, thinking_type_t::normal ); // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–∏—Ç—å. std::this_thread::sleep_for( pause_generator.think_pause( thinking_type_t::normal ) ); // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –ª–µ–≤—É—é –≤–∏–ª–∫—É. tracer.take_left_attempt( philosopher_index ); so_5::send&lt; take_t &gt;( left_fork, self_ch-&gt;as_mbox(), philosopher_index ); // –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞. so_5::receive( so_5::from( self_ch ).handle_n( 1u ), [&amp;]( so_5::mhood_t&lt;taken_t&gt; ) { // –í–∑—è–ª–∏ –ª–µ–≤—É—é –≤–∏–ª–∫—É, –ø—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –ø—Ä–∞–≤—É—é. tracer.take_right_attempt( philosopher_index ); so_5::send&lt; take_t &gt;( right_fork, self_ch-&gt;as_mbox(), philosopher_index ); // –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞. so_5::receive( so_5::from( self_ch ).handle_n( 1u ), [&amp;]( so_5::mhood_t&lt;taken_t&gt; ) { // –£ –Ω–∞—Å –æ–±–µ –≤–∏–ª–∫–∏. –ú–æ–∂–Ω–æ –ø–æ–µ—Å—Ç—å. tracer.eating_started( philosopher_index ); // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ –ø–∏—â–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–∏—Ç—å. std::this_thread::sleep_for( pause_generator.eat_pause() ); // –ù–∞ —à–∞–≥ –±–ª–∏–∂–µ –∫ —Ñ–∏–Ω–∞–ª—É. ++meals_eaten; // –ü–æ—Å–ª–µ –µ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–∞–≤—É—é –≤–∏–ª–∫—É. so_5::send&lt; put_t &gt;( right_fork ); } ); // –ê —Å–ª–µ–¥–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏ –ª–µ–≤—É—é. so_5::send&lt; put_t &gt;( left_fork ); } ); } // –°–æ–æ–±—â–∞–µ–º –æ —Ç–æ–º, —á—Ç–æ –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏. tracer.philosopher_done( philosopher_index ); so_5::send&lt; philosopher_done_t &gt;( control_ch, philosopher_index ); }</span></span></code> </pre> </div></div><br><p> –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ —Ñ—É–Ω–∫—Ü–∏–∏: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">philosopher_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trace_maker_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; tracer, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> control_ch, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> philosopher_index, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left_fork, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right_fork, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> meals_count )</span></span></span></span></code> </pre> <br><p> –°–º—ã—Å–ª –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–∑ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ—è—Å–Ω–∏—Ç—å. </p><br><p> –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º SObjectizer-–æ–≤—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤, —Ç–æ —É –Ω–∞—Å –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–Ω–∏–º–∞—Ç—å —Å–ª–µ–¥ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∞ —á–µ—Ä–µ–∑ —Å–ª—É—à–∞—Ç–µ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–≥–µ–Ω—Ç–∞, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–ª–æ—Å—å –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ –Ω–∞ Actor-–∞—Ö. –ü–æ—ç—Ç–æ–º—É –≤ –∫–æ–¥–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å –≤–æ—Ç —Ç–∞–∫–∏–µ –≤—Å—Ç–∞–≤–∫–∏: </p><br><pre> <code class="cpp hljs">tracer.thinking_started( philosopher_index, <span class="hljs-keyword"><span class="hljs-keyword">thinking_type_t</span></span>::normal );</code> </pre> <br><p> –ò –∞—Ä–≥—É–º–µ–Ω—Ç <code>tracer</code> –∫–∞–∫ —Ä–∞–∑ —è–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–æ–π –Ω–∞ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. </p><br><p> –ê—Ä–≥—É–º–µ–Ω—Ç <code>control_ch</code> –∑–∞–¥–∞–µ—Ç –∫–∞–Ω–∞–ª, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ <code>philosopher_done_t</code> –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ñ–∏–ª–æ—Å–æ—Ñ —Å—ä–µ—Å—Ç –≤—Å–µ, —á—Ç–æ –µ–º—É –ø–æ–ª–æ–∂–µ–Ω–æ. –≠—Ç–æ—Ç –∫–∞–Ω–∞–ª –∑–∞—Ç–µ–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–º–µ–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. </p><br><p> –ê—Ä–≥—É–º–µ–Ω—Ç—ã <code>left_fork</code> –∏ <code>right_fork</code> –∑–∞–¥–∞—é—Ç –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–∏–ª–∫–∞–º–∏. –ò–º–µ–Ω–Ω–æ –≤ —ç—Ç–∏ –∫–∞–Ω–∞–ª—ã –±—É–¥—É—Ç –æ—Ç—Å—ã–ª–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è <code>take_t</code> –∏ <code>put_t</code> . –ù–æ –µ—Å–ª–∏ —ç—Ç–æ –∫–∞–Ω–∞–ª—ã, —Ç–æ –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø <code>mbox_t</code> –≤–º–µ—Å—Ç–æ <code>mchain_t</code> ? </p><br><p> –≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ù–æ –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–≥–æ –º—ã —É–≤–∏–¥–∏–º –Ω–∏–∂–µ, –ø—Ä–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ –¥—Ä—É–≥–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –ü–æ–∫–∞ –∂–µ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ mchain ‚Äî —ç—Ç–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ mbox-–∞, –ø–æ—ç—Ç–æ–º—É —Å—Å—ã–ª–∫–∏ –Ω–∞ mchain-—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç—ã <code>mbox_t</code> . </p><br><p> –î–∞–ª–µ–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä—è–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∞: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> meals_eaten{ <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">random_pause_generator_t</span></span> pause_generator; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> self_ch = so_5::create_mchain( control_ch-&gt;environment() );</code> </pre> <br><p> –ù–∞–≤–µ—Ä–Ω–æ–µ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ‚Äî —ç—Ç–æ <code>self_ch</code> . –≠—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª —Ñ–∏–ª–æ—Å–æ—Ñ–∞, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤–∏–ª–æ–∫. </p><br><p> –ù—É –∞ —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∞.  Those. –∫ —Ü–∏–∫–ª—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ç–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–∫ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è, –∑–∞—Ö–≤–∞—Ç –≤–∏–ª–æ–∫ –∏ –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ –ø–∏—â–∏. </p><br><p> –ú–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤, –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <code>this_thread::sleep_for</code> –≤–º–µ—Å—Ç–æ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. </p><br><p> –ü–æ–ø—ã—Ç–∫–∞ –≤–∑—è—Ç—å –≤–∏–ª–∫—É –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å –ê–∫—Ç–æ—Ä–∞–º–∏: </p><br><pre> <code class="cpp hljs">so_5::send&lt; <span class="hljs-keyword"><span class="hljs-keyword">take_t</span></span> &gt;( left_fork, self_ch-&gt;as_mbox(), philosopher_index );</code> </pre> <br><p> –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ —Ç–æ—Ç –∂–µ —Ç–∏–ø <code>take_t</code> . –ù–æ –≤ –Ω–µ–º –µ—Å—Ç—å –ø–æ–ª–µ —Ç–∏–ø–∞ <code>mbox_t</code> , —Ç–æ–≥–¥–∞ –∫–∞–∫ <code>self_ch</code> –∏–º–µ–µ—Ç —Ç–∏–ø <code>mchain_t</code> . –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª –≤ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ <code>as_mbox()</code> . </p><br><p> –î–∞–ª–µ–µ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤—ã–∑–æ–≤ <code>receive()</code> : </p><br><pre> <code class="cpp hljs">so_5::receive( so_5::from( self_ch ).handle_n( <span class="hljs-number"><span class="hljs-number">1u</span></span> ), [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span>&gt; ) {...} );</code> </pre> <br><p> –≠—Ç–æ—Ç –≤—ã–∑–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä <code>taken_t</code> –±—É–¥–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –ù—É –∏–ª–∏ –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç. –í –æ–±—â–µ–º, –º—ã –∑–¥–µ—Å—å –∂–¥–µ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–≥–æ –Ω–∞–º –æ—Ç–≤–µ—Ç–∞ –æ—Ç –≤–∏–ª–∫–∏. </p><br><p> –í –æ–±—â–µ–º-—Ç–æ —ç—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ, —á—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ <code>philosopher_process</code> . –•–æ—Ç—è —Å—Ç–æ–∏—Ç –∑–∞–æ—Å—Ç—Ä–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ–º –≤—ã–∑–æ–≤–µ <code>receive()</code> –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∫–∞–Ω–∞–ª–∞: </p><br><pre> <code class="cpp hljs">so_5::receive( so_5::from( self_ch ).handle_n( <span class="hljs-number"><span class="hljs-number">1u</span></span> ), [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span>&gt; ) { ... so_5::receive( so_5::from( self_ch ).handle_n( <span class="hljs-number"><span class="hljs-number">1u</span></span> ), [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span>&gt; ) {...} ); ... } );</code> </pre> <br><p> –≠—Ç–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∞ –≤ –ø—Ä–æ—Å—Ç–æ–º –∏ –±–æ–ª–µ–µ-–º–µ–Ω–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –≤–∏–¥–µ. </p><br><h3 id="funkciya-zapuska-simulyacii"> –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ </h3><br><p> –ü—Ä–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤ –º—ã –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å –Ω–∞ —Ä–∞–∑–±–æ—Ä–µ —Ñ—É–Ω–∫—Ü–∏–π <code>run_simulation()</code> , –ø–æ—Å–∫–æ–ª—å–∫—É —Ç–∞–º –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –∏–ª–∏ –≤–∞–∂–Ω–æ–≥–æ –Ω–µ –±—ã–ª–æ. –ù–æ –≤–æ—Ç –≤ —Å–ª—É—á–∞–µ —Å CSP-–ø–æ–¥—Ö–æ–¥–æ–º –Ω–∞ <code>run_simulation()</code> –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è. –í —Ç–æ–º —á–∏—Å–ª–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—Å—Ç–æ –ø–∏—Å–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –∫–æ–¥ (–∫—Å—Ç–∞—Ç–∏ –≥–æ–≤–æ—Ä—è –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è). </p><br><div class="spoiler"> <b class="spoiler_title">–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ run_simulation</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_simulation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">environment_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; env, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">names_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; names )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> table_size = names.size(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> join_all = []( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread&gt; &amp; threads ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; t : threads ) t.join(); }; <span class="hljs-keyword"><span class="hljs-keyword">trace_maker_t</span></span> tracer{ env, names, <span class="hljs-keyword"><span class="hljs-keyword">random_pause_generator_t</span></span>::trace_step() }; <span class="hljs-comment"><span class="hljs-comment">// –°–æ–∑–¥–∞–µ–º –≤–∏–ª–∫–∏. std::vector&lt; so_5::mchain_t &gt; fork_chains; std::vector&lt; std::thread &gt; fork_threads( table_size ); for( std::size_t i{}; i != table_size; ++i ) { // –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –æ—á–µ—Ä–µ–¥–Ω–æ–π –≤–∏–ª–∫–∏. fork_chains.emplace_back( so_5::create_mchain(env) ); // –†–∞–±–æ—á–∞—è –Ω–∏—Ç—å –¥–ª—è –æ—á–µ—Ä–µ–¥–Ω–æ–π –≤–∏–ª–∫–∏. fork_threads[ i ] = std::thread{ fork_process, fork_chains.back() }; } // –ö–∞–Ω–∞–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. auto control_ch = so_5::create_mchain( env ); // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. const auto philosopher_maker = [&amp;](auto index, auto left_fork_idx, auto right_fork_idx) { return std::thread{ philosopher_process, std::ref(tracer), control_ch, index, fork_chains[ left_fork_idx ]-&gt;as_mbox(), fork_chains[ right_fork_idx ]-&gt;as_mbox(), default_meals_count }; }; std::vector&lt; std::thread &gt; philosopher_threads( table_size ); for( std::size_t i{}; i != table_size - 1u; ++i ) { // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–∏—Ç–∏. philosopher_threads[ i ] = philosopher_maker( i, i, i+1u ); } // –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ –¥–æ–ª–∂–µ–Ω –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤–∏–ª–∫–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. philosopher_threads[ table_size - 1u ] = philosopher_maker( table_size - 1u, table_size - 1u, 0u ); // –ñ–¥–µ–º –ø–æ–∫–∞ –≤—Å–µ —Ñ–∏–ª–æ—Å–æ—Ñ—ã –∑–∞–∫–æ–Ω—á–∞—Ç. so_5::receive( so_5::from( control_ch ).handle_n( table_size ), [&amp;names]( so_5::mhood_t&lt;philosopher_done_t&gt; cmd ) { fmt::print( "{}: done\n", names[ cmd-&gt;m_philosopher_index ] ); } ); // –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö –Ω–∏—Ç–µ–π —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. join_all( philosopher_threads ); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤–∏–ª–æ–∫. for( auto &amp; ch : fork_chains ) so_5::close_drop_content( ch ); // –ü–æ—Å–ª–µ —á–µ–≥–æ –¥–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö –Ω–∏—Ç–µ–π –≤–∏–ª–æ–∫. join_all( fork_threads ); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç. tracer.done(); // –ò –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SObjectizer. env.stop(); }</span></span></code> </pre> </div></div><br><p> –í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥ <code>run_simulation()</code> –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª–µ–µ-–º–µ–Ω–µ–µ –ø–æ–Ω—è—Ç–µ–Ω. –ü–æ—ç—Ç–æ–º—É —è —Ä–∞–∑–±–µ—Ä—É —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–º–µ–Ω—Ç—ã. </p><br><p> –ù–∞–º —Ç—Ä–µ–±—É—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –¥–ª—è –≤–∏–ª–æ–∫. –≠—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–∞–∫ —Ä–∞–∑ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–µ: </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; so_5::<span class="hljs-keyword"><span class="hljs-keyword">mchain_t</span></span> &gt; fork_chains; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread &gt; fork_threads( table_size ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != table_size; ++i ) { fork_chains.emplace_back( so_5::create_mchain(env) ); fork_threads[ i ] = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread{ fork_process, fork_chains.back() }; }</code> </pre> <br><p> –ü—Ä–∏ —ç—Ç–æ–º –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –∫–∞–Ω–∞–ª—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∏–ª–æ–∫, –∏ —Å–∞–º–∏ —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏. –ö–∞–Ω–∞–ª—ã –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –Ω–∏–∂–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –Ω–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º. –ê —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∑–∞—Ç–µ–º –≤—ã–∑–≤–∞—Ç—å <code>join</code> –¥–ª—è –Ω–∏—Ö. </p><br><p> –ü–æ—Å–ª–µ —á–µ–≥–æ –º—ã —Å–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –¥–ª—è —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ –∏ —Ç–∞–∫ –∂–µ —Å–æ–±–∏—Ä–∞–µ–º —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ç.–∫. –Ω–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞—Ç—å <code>join</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread &gt; philosopher_threads( table_size ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != table_size - <span class="hljs-number"><span class="hljs-number">1u</span></span>; ++i ) { philosopher_threads[ i ] = philosopher_maker( i, i, i+<span class="hljs-number"><span class="hljs-number">1u</span></span> ); } philosopher_threads[ table_size - <span class="hljs-number"><span class="hljs-number">1u</span></span> ] = philosopher_maker( table_size - <span class="hljs-number"><span class="hljs-number">1u</span></span>, table_size - <span class="hljs-number"><span class="hljs-number">1u</span></span>, <span class="hljs-number"><span class="hljs-number">0u</span></span> );</code> </pre> <br><p> –î–∞–ª–µ–µ –º—ã –¥–æ–ª–∂–Ω—ã –¥–∞—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏. –î–æ–∂–∏–¥–∞–µ–º—Å—è –º–æ–º–µ–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞: </p><br><pre> <code class="cpp hljs">so_5::receive( so_5::from( control_ch ).handle_n( table_size ), [&amp;names]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">philosopher_done_t</span></span>&gt; cmd ) { fmt::print( <span class="hljs-string"><span class="hljs-string">"{}: done\n"</span></span>, names[ cmd-&gt;m_philosopher_index ] ); } );</code> </pre> <br><p> –≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç <code>receive()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è <code>table_size</code> —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–∏–ø–∞ <code>philosopher_done_t</code> . </p><br><p> –ù—É –∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö <code>philosopher_done_t</code> –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—á–∏—Å—Ç–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤. </p><br><p> –î–µ–ª–∞–µ–º <code>join</code> –¥–ª—è –≤—Å–µ—Ö —Ä–∞–±–æ—á–∏—Ö –Ω–∏—Ç–µ–π —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤: </p><br><pre> <code class="cpp hljs">join_all( philosopher_threads );</code> </pre> <br><p> –ü–æ—Å–ª–µ —á–µ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å <code>join</code> –¥–ª—è –≤—Å–µ—Ö –Ω–∏—Ç–µ–π –≤–∏–ª–æ–∫. –ù–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞—Ç—å <code>join</code> –Ω–µ–ª—å–∑—è, —Ç.–∫. —Ç–æ–≥–¥–∞ –º—ã —Ç—É–ø–æ –∑–∞–≤–∏—Å–Ω–µ–º. –í–µ–¥—å —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –≤–∏–ª–æ–∫ —Å–ø—è—Ç –≤–Ω—É—Ç—Ä–∏ –≤—ã–∑–æ–≤–æ–≤ <code>receive()</code> –∏ –Ω–∏–∫—Ç–æ –∏—Ö –Ω–µ —Ä–∞–∑–±—É–¥–∏—Ç. –ü–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω—É–∂–Ω–æ —Å–ø–µ—Ä–≤–∞ –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤–∏–ª–æ–∫ –∏ –ª–∏—à—å –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞—Ç—å <code>join</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; ch : fork_chains ) so_5::close_drop_content( ch ); join_all( fork_threads );</code> </pre> <br><p> –í–æ—Ç —Ç–µ–ø–µ—Ä—å –≥–ª–∞–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–º–∏. </p><br><h4 id="neskolko-slov-o-noexcept"> –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤ –æ noexcept </h4><br><p> –ù–∞–¥–µ—é—Å—å, —á—Ç–æ –∫–æ–¥ <code>run_simulation</code> —Å–µ–π—á–∞—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–Ω—è—Ç–µ–Ω –∏ —è –º–æ–≥—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±—ä—è—Å–Ω–∏—Ç—å, –ø–æ—á–µ–º—É —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ <em>noexcept</em> . –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –≤ –Ω–µ–π exception-safety –Ω–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç —Å–ª–æ–≤–∞ —Å–æ–≤—Å–µ–º. –ü–æ—ç—Ç–æ–º—É —Å–∞–º–∞—è –ª—É—á—à–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ —Ç–∞–∫–æ–π —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî —ç—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. </p><br><p> –ù–æ –ø–æ—á–µ–º—É <code>run_simulation</code> –Ω–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º? </p><br><p> –î–∞–≤–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á–∏–µ –Ω–∏—Ç–∏ –¥–ª—è –≤–∏–ª–æ–∫ –∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–Ω–æ–π –Ω–∏—Ç–∏ —É –Ω–∞—Å –≤—ã—Å–∫–∞–∫–∏–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –î–∞–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ö–æ—Ç—å –∫–∞–∫—É—é-–Ω–∏–±—É–¥—å exception-safety –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ –Ω–∏—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –∑–∞–ø—É—â–µ–Ω—ã. –ò –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –ø–æ–¥—É–º–∞—Ç—å, —á—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–æ–¥ –∑–∞–ø—É—Å–∫–∞ –Ω–∏—Ç–µ–π –¥–ª—è –≤–∏–ª–æ–∫ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != table_size; ++i ) { fork_chains.emplace_back( so_5::create_mchain(env) ); fork_threads[ i ] = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread{ fork_process, fork_chains.back() }; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( ... ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != fork_chains.size(); ++i ) { so_5::close_drop_content( fork_chains[ i ] ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( fork_threads[ i ].joinable() ) fork_threads[ i ].join(); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; }</code> </pre> <br><p> –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–æ –æ—á–µ–≤–∏–¥–Ω–æ–µ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.  Since –æ–Ω–æ –æ–∫–∞–∂–µ—Ç—Å—è –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º –µ—Å–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —É–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –≤—Å–µ –Ω–∏—Ç–∏ –¥–ª—è –≤–∏–ª–æ–∫. –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ –≤–æ—Ç —Ç–∞–∫–æ–≥–æ: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fork_threads_stuff_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; so_5::<span class="hljs-keyword"><span class="hljs-keyword">mchain_t</span></span> &gt; m_fork_chains; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread &gt; m_fork_threads; <span class="hljs-keyword"><span class="hljs-keyword">fork_threads_stuff_t</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> table_size ) : m_fork_threads( table_size ) {} ~<span class="hljs-keyword"><span class="hljs-keyword">fork_threads_stuff_t</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != m_fork_chains.size(); ++i ) { so_5::close_drop_content( m_fork_chains[ i ] ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_fork_threads[ i ].joinable() ) m_fork_threads[ i ].join(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i{}; i != m_fork_threads.size(); ++i ) { m_fork_chains.emplace_back( so_5::create_mchain(env) ); m_fork_threads[ i ] = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::thread{ fork_process, m_fork_chains.back() }; } } } fork_threads_stuff{ table_size }; <span class="hljs-comment"><span class="hljs-comment">// –ü—Ä–µ–∞–ª–ª–æ—Ü–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã. fork_threads_stuff.run(); // –°–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–∏—Ç–∏. // –í—Å—è –Ω—É–∂–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ fork_threads_stuff.</span></span></code> </pre> <br><p> –ù—É –∏–ª–∏ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç—Ä—é–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω—É–∂–Ω—ã–π –Ω–∞–º –∫–æ–¥ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∫–æ—É–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Boost-–æ–≤—Å–∫–∏–º ScopeExit-–æ–º, GSL-–æ–≤—Å–∫–∏–º finally() –∏ –∏–º –ø–æ–¥–æ–±–Ω—ã–º). </p><br><p> –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å –∑–∞–ø—É—Å–∫–æ–º –Ω–∏—Ç–µ–π –¥–ª—è —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤. –ò —Ä–µ—à–∞—Ç—å –µ–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–æ–±–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. </p><br><p> –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–æ–¥ –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é exception-safety –≤ <code>run_simulation()</code> , —Ç–æ –∫–æ–¥ <code>run_simulation()</code> –æ–∫–∞–∂–µ—Ç—Å—è –∏ –æ–±—ä–µ–º–Ω–µ–µ, –∏ —Å–ª–æ–∂–Ω–µ–µ –≤ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–∏. –ß—Ç–æ –Ω–µ –µ—Å—Ç—å —Ö–æ—Ä–æ—à–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ –Ω–µ –ø—Ä–µ—Ç–µ–Ω–¥—É—é—â–µ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–∫–∞—á–µ—Å—Ç–≤–æ. –ü–æ—ç—Ç–æ–º—É —è —Ä–µ—à–∏–ª –∑–∞–±–∏—Ç—å –Ω–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ exception-safety –≤–Ω—É—Ç—Ä–∏ <code>run_simulation()</code> –∏ –ø–æ–º–µ—Ç–∏–ª —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ <em>noexcept</em> , —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤—ã–∑–æ–≤—É <code>std::terminate</code> –≤ —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ò–ú–•–û, –¥–ª—è —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ —ç—Ç–æ –≤–ø–æ–ª–Ω–µ —Å–µ–±–µ —Ä–∞–∑—É–º–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. </p><br><p> –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–ø—ã—Ç —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –∫–æ–¥ –ø–æ –æ—á–∏—Å—Ç–∫–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –∞ –∫–∞–∫–æ–π –Ω–µ—Ç. –ù–µ–æ–ø—ã—Ç–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –º–æ–∂–µ—Ç –ø–æ—Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–ª—å–∫–æ –≤—ã–∑–≤–∞—Ç—å <code>join</code> , —Ö–æ—Ç—è –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω—É–∂–Ω–æ –µ—â–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –∫–∞–Ω–∞–ª—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º <code>join</code> . –ò —Ç–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –≤ –∫–æ–¥–µ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –Ω–µ–ø—Ä–æ—Å—Ç–æ –≤—ã–ª–æ–≤–∏—Ç—å. </p><br><h2 id="prostoe-reshenie-bez-ispolzovaniya-arbitra-oficianta"> –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞—Ä–±–∏—Ç—Ä–∞ (–æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞) </h2><br><p> –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ –≤ CSP-–ø–æ–¥—Ö–æ–¥–µ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤–∏–ª–æ–∫ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –∑–∞—Ö–≤–∞—Ç–µ, –Ω–æ –±–µ–∑ –∞—Ä–±–∏—Ç—Ä–∞. </p><br><p> –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ <a href="">–∑–¥–µ—Å—å</a> . </p><br><h3 id="nit-dlya-vilki-1"> –ù–∏—Ç—å –¥–ª—è –≤–∏–ª–∫–∏ </h3><br><p> –ù–∏—Ç—å –¥–ª—è –≤–∏–ª–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π <code>fork_process</code> , –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fork_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fork_ch )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–ª–∫–∏: –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω–∞. bool taken = false; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ—é—Ç. so_5::receive( so_5::from( fork_ch ), [&amp;]( so_5::mhood_t&lt;take_t&gt; cmd ) { if( taken ) so_5::send&lt; busy_t &gt;( cmd-&gt;m_who ); else { taken = true; so_5::send&lt; taken_t &gt;( cmd-&gt;m_who ); } }, [&amp;]( so_5::mhood_t&lt;put_t&gt; ) { if( taken ) taken = false; } ); }</span></span></code> </pre> <br><p> –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ —ç—Ç–∞ <code>fork_process</code> –ø—Ä–æ—â–µ, —á–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –≤ —Ä–µ—à–µ–Ω–∏–∏ –î–µ–π–∫—Å—Ç—Ä—ã (—Ç—É –∂–µ —Å–∞–º—É—é –∫–∞—Ä—Ç–∏–Ω—É –º—ã –º–æ–≥–ª–∏ –Ω–∞–±–ª—é–¥–∞—Ç—å, –∫–æ–≥–¥–∞ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤). </p><br><h3 id="nit-dlya-filosofa-1"> –ù–∏—Ç—å –¥–ª—è —Ñ–∏–ª–æ—Å–æ—Ñ–∞ </h3><br><p> –ù–∏—Ç—å –¥–ª—è —Ñ–∏–ª–æ—Å–æ—Ñ–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π <code>philosopher_process</code> , –∫–æ—Ç–æ—Ä–∞—è –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –µ–µ –∞–Ω–∞–ª–æ–≥ –≤ —Ä–µ—à–µ–Ω–∏–∏ –î–µ–π–∫—Å—Ç—Ä—ã. </p><br><div class="spoiler"> <b class="spoiler_title">–ü–æ–ª–Ω—ã–π –∫–æ–¥ philosopher_process</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">philosopher_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trace_maker_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; tracer, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> control_ch, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> philosopher_index, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left_fork, so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mbox_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right_fork, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> meals_count )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> meals_eaten{ <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-comment"><span class="hljs-comment">// –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Ñ–∏–ª–æ—Å–æ—Ñ–∞. thinking_type_t thinking_type{ thinking_type_t::normal }; random_pause_generator_t pause_generator; // –ö–∞–Ω–∞–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –≤–∏–ª–æ–∫. auto self_ch = so_5::create_mchain( control_ch-&gt;environment() ); while( meals_eaten &lt; meals_count ) { tracer.thinking_started( philosopher_index, thinking_type ); // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–∏—Ç—å. std::this_thread::sleep_for( pause_generator.think_pause( thinking_type ) ); // –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –≤–∏–ª–∫–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è. thinking_type = thinking_type_t::hungry; // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –ª–µ–≤—É—é –≤–∏–ª–∫—É. tracer.take_left_attempt( philosopher_index ); so_5::send&lt; take_t &gt;( left_fork, self_ch-&gt;as_mbox(), philosopher_index ); // –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞. so_5::receive( so_5::from( self_ch ).handle_n( 1u ), []( so_5::mhood_t&lt;busy_t&gt; ) { /* –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å */ }, [&amp;]( so_5::mhood_t&lt;taken_t&gt; ) { // –õ–µ–≤–∞—è –≤–∏–ª–∫–∞ –≤–∑—è—Ç–∞, –ø–æ–ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –ø—Ä–∞–≤—É—é. tracer.take_right_attempt( philosopher_index ); so_5::send&lt; take_t &gt;( right_fork, self_ch-&gt;as_mbox(), philosopher_index ); // –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞. so_5::receive( so_5::from( self_ch ).handle_n( 1u ), []( so_5::mhood_t&lt;busy_t&gt; ) { /* –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å */ }, [&amp;]( so_5::mhood_t&lt;taken_t&gt; ) { // –£ –Ω–∞—Å –æ–±–µ –≤–∏–ª–∫–∏, –º–æ–∂–Ω–æ –ø–æ–µ—Å—Ç—å. tracer.eating_started( philosopher_index ); // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–≥–ª–æ—â–µ–Ω–∏–µ –ø–∏—â–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –Ω–∏—Ç—å. std::this_thread::sleep_for( pause_generator.eat_pause() ); // –ù–∞ —à–∞–≥ –±–ª–∏–∂–µ –∫ —Ñ–∏–Ω–∞–ª—É. ++meals_eaten; // –ü–æ—Å–ª–µ –µ–¥—ã –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∞–≤—É—é –≤–∏–ª–∫—É. so_5::send&lt; put_t &gt;( right_fork ); // –°–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–∏–æ–¥ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ "normal". thinking_type = thinking_type_t::normal; } ); // –õ–µ–≤—É—é –≤–∏–ª–∫—É –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ. so_5::send&lt; put_t &gt;( left_fork ); } ); } // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã. tracer.philosopher_done( philosopher_index ); so_5::send&lt; philosopher_done_t &gt;( control_ch, philosopher_index ); }</span></span></code> </pre> </div></div><br><p> –í –æ–±—â–µ–º-—Ç–æ –∫–æ–¥ <code>philosopher_process</code> –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ –∫–æ–¥ <code>philosopher_process</code> –∏–∑ —Ä–µ—à–µ–Ω–∏—è –î–µ–π–∫—Å—Ç—Ä—ã. –ù–æ –µ—Å—Ç—å –¥–≤–∞ –≤–∞–∂–Ω—ã—Ö –æ—Ç–ª–∏—á–∏—è. </p><br><p> –í–æ-–ø–µ—Ä–≤—ã—Ö, —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è <code>thinking_type</code> . –û–Ω–∞ –Ω—É–∂–Ω–∞ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–µ–¥ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∞, –∞ —Ç–∞–∫ –∂–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª—è—Ç—å –ø–∞—É–∑—ã –ø—Ä–∏ –∏–º–∏—Ç–∞—Ü–∏–∏ "—Ä–∞–∑–¥—É–º–∏–π" —Ñ–∏–ª–æ—Å–æ—Ñ–∞. </p><br><p> –í–æ-–≤—Ç–æ—Ä—ã—Ö, —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π <code>busy_t</code> . –ú—ã –∏—Ö –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ <code>receive()</code> : </p><br><pre> <code class="cpp hljs">so_5::receive( so_5::from( self_ch ).handle_n( <span class="hljs-number"><span class="hljs-number">1u</span></span> ), []( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">busy_t</span></span>&gt; ) { <span class="hljs-comment"><span class="hljs-comment">/* –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å */</span></span> }, [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span>&gt; ) { ... so_5::receive( so_5::from( self_ch ).handle_n( <span class="hljs-number"><span class="hljs-number">1u</span></span> ), []( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">busy_t</span></span>&gt; ) { <span class="hljs-comment"><span class="hljs-comment">/* –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å */</span></span> }, [&amp;]( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mhood_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">taken_t</span></span>&gt; ) {...} );</code> </pre> <br><p> –î–∞, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è <code>busy_t</code> –ø—É—Å—Ç—ã, –Ω–æ —ç—Ç–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–∏–±–æ —É–∂–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º <code>receive()</code> , –ª–∏–±–æ –±—É–¥—É—Ç —Å–¥–µ–ª–∞–Ω—ã –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ <code>receive()</code> . –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ <code>busy_t</code> –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å. –ù–æ —Å–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, —Ç.–∫. –∏—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç <code>receive()</code> –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã <code>busy_t</code> –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—é —Ç–∞–∫–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ <code>receive()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –≤ –∫–∞–Ω–∞–ª –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ <code>busy_t</code> . </p><br><h2 id="reshenie-s-oficiantom-i-vremennymi-otmetkami"> –†–µ—à–µ–Ω–∏–µ —Å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–º –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ—Ç–º–µ—Ç–∫–∞–º–∏ </h2><br><p> –ù–∞ –±–∞–∑–µ CSP-–ø–æ–¥—Ö–æ–¥–∞ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –µ—â–µ –æ–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —è –±—ã —Ö–æ—Ç–µ–ª –∑–¥–µ—Å—å –∫—Ä–∞—Ç–∫–æ –æ—Å–≤–µ—Ç–∏—Ç—å. –†–∞–∑–±–∏—Ä–∞—è —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤ —Ä–µ—á—å —à–ª–∞ –æ —Ä–µ—à–µ–Ω–∏—è—Ö —Å –∞—Ä–±–∏—Ç—Ä–æ–º (–æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–º): –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ —Ä–µ—à–µ–Ω–∏–µ waiter_with_queue, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞—è–≤–æ–∫, –∞ —Ç–∞–∫ –∂–µ —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å —Ä–µ—à–µ–Ω–∏–µ waiter_with_timestamps. –û–±–∞ —ç—Ç–∏ —Ä–µ—à–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç—Ä—é–∫: –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —Å–æ–∑–¥–∞–≤–∞–ª –Ω–∞–±–æ—Ä mbox-–æ–≤ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–ª–æ–∫, —ç—Ç–∏ mbox-—ã —Ä–∞–∑–¥–∞–≤–∞–ª–∏—Å—å —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ mbox-–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–æ–º. </p><br><p> –ü–æ—Ö–æ–∂–∏–π —Ç—Ä—é–∫ –Ω—É–∂–µ–Ω –∏ –≤ CSP-–ø–æ–¥—Ö–æ–¥–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —è —Å–º–æ–≥ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é <code>philosopher_process</code> –∏–∑ —Ä–µ—à–µ–Ω–∏—è no_waiter_simple. –ù–æ –º–æ–∂–µ—Ç –ª–∏ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–∞–±–æ—Ä mchain-–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º–∏ –∏ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è, –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–ª–∫–∞–º? </p><br><p> –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ—Ç. </p><br><p> –°–æ–∑–¥–∞—Ç—å –Ω–∞–±–æ—Ä mchain-–æ–≤ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞. –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ä–∞–∑—É –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö mchain-–æ–≤. </p><br><p> –í SObjectizer-–µ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è <code>select()</code> , –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ç–æ –¥–µ–ª–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–∞–∫: </p><br><pre> <code class="cpp hljs">so_5::select( so_5::from_all(), case_(ch1, one_handler_1, one_handler_2, one_handler_3, ...), case_(ch2, two_handler_1, two_handler_2, two_handler_3, ...), ...);</code> </pre> <br><p> –ù–æ –¥–ª—è <code>select()</code> –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –Ω–∏—Ö –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∫–æ–º–ø–∞–π–ª-—Ç–∞–π–º. –¢–æ–≥–¥–∞ –∫–∞–∫ –≤ –º–æ–∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö –∑–∞–¥–∞—á–∏ "–æ–±–µ–¥–∞—é—â–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤" —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–∑–≤–µ—Å—Ç–µ–Ω —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ—ç—Ç–æ–º—É –≤ CSP-–ø–æ–¥—Ö–æ–¥–µ –Ω–µ–ª—å–∑—è –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä—é–∫ –∏–∑ –ø–æ–¥—Ö–æ–¥–∞ –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤. </p><br><p> –ù–æ –º—ã –º–æ–∂–µ–º –µ–≥–æ –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–∏—Ç—å. </p><br><p> –ò—Ç–∞–∫, —Å—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö <code>take_t</code> –∏ <code>put_t</code> –Ω–µ—Ç –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤–∏–ª–∫–∏. –ò –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω—É–∂–Ω–æ –∫–∞–∫-—Ç–æ —ç—Ç–∏ –∏–Ω–¥–µ–∫—Å—ã –ø–æ–ª—É—á–∏—Ç—å. –†–∞–∑ —É–∂ –º—ã –Ω–µ –º–æ–∂–µ–º –∑–∞–ø–∏—Ö–Ω—É—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤–Ω—É—Ç—Ä—å <code>take_t</code> –∏ <code>put_t</code> , —Ç–æ –¥–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —ç—Ç–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extended_take_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">message_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> m_who; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_philosopher_index; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_fork_index; <span class="hljs-keyword"><span class="hljs-keyword">extended_take_t</span></span>( so_5::<span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> who, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> philosopher_index, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> fork_index ) : m_who{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(who) } , m_philosopher_index{ philosopher_index } , m_fork_index{ fork_index } {} }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extended_put_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">message_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> m_fork_index; <span class="hljs-keyword"><span class="hljs-keyword">extended_put_t</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> fork_index ) : m_fork_index{ fork_index } {} };</code> </pre> <br><blockquote> –í–æ–æ–±—â–µ –≥–æ–≤–æ—Ä—è, –Ω–µ—Ç –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç <code>so_5::message_t</code> , —Ö–æ—Ç—è —è –æ–±—ã—á–Ω–æ –∫–∞–∫ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑—É—é —Ç–∞–∫–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (—É –Ω–µ–≥–æ –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–±–æ–ª—å—à–∏–µ –±–µ–Ω–µ—Ñ–∏—Ç—ã). –í –¥–∞–Ω–Ω–æ–º –∂–µ —Å–ª—É—á–∞–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π —Å–ø–æ—Å–æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è SObjectizer-–æ–≤—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. </blockquote><p> –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —á–∏—Ç–∞–ª –∏–º–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö. –ó–Ω–∞—á–∏—Ç –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è <code>take_t</code> –∏ <code>put_t</code> , –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –∏—Ö –≤ <code>extended_take_t</code> –∏ <code>extended_put_t</code> , –æ—Ç—Å—ã–ª–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É. </p><br><p> –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π mbox. –í—Å–µ–≥–æ –ª–∏—à—å :) </p><br><div class="spoiler"> <b class="spoiler_title">–ö–æ–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ mbox-–∞</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrapping_mbox_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::extra::mboxes::proxy::<span class="hljs-keyword"><span class="hljs-keyword">simple_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base_type_t</span></span> = so_5::extra::mboxes::proxy::<span class="hljs-keyword"><span class="hljs-keyword">simple_t</span></span>; <span class="hljs-comment"><span class="hljs-comment">// –ö—É–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è. const so_5::mbox_t m_target; // –ò–Ω–¥–µ–∫—Å –≤–∏–ª–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö. const std::size_t m_fork_index; // –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞. static std::type_index original_take_type; static std::type_index original_put_type; public : wrapping_mbox_t( const so_5::mbox_t &amp; target, std::size_t fork_index ) : base_type_t{ target } , m_target{ target } , m_fork_index{ fork_index } {} // –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ so_5::abstract_message_box_t –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π. void do_deliver_message( const std::type_index &amp; msg_type, const so_5::message_ref_t &amp; message, unsigned int overlimit_reaction_deep ) const override { if( original_take_type == msg_type ) { // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é. const auto &amp; original_msg = so_5::message_payload_type&lt;::take_t&gt;:: payload_reference( *message ); // –®–ª–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ. so_5::send&lt; extended_take_t &gt;( m_target, original_msg.m_who, original_msg.m_philosopher_index, m_fork_index ); } else if( original_put_type == msg_type ) { // –®–ª–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ. so_5::send&lt; extended_put_t &gt;( m_target, m_fork_index ); } else base_type_t::do_deliver_message( msg_type, message, overlimit_reaction_deep ); } // –§–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—â–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å wrapping_mbox_t. static auto make( const so_5::mbox_t &amp; target, std::size_t fork_index ) { return so_5::mbox_t{ new wrapping_mbox_t{ target, fork_index } }; } }; std::type_index wrapping_mbox_t::original_take_type{ typeid(::take_t) }; std::type_index wrapping_mbox_t::original_put_type{ typeid(::put_t) };</span></span></code> </pre> </div></div><br><p> –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ mbox-–∞: –≤ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ <a href="https://stiffstream.com/en/products/so_5_extra.html">so_5_extra</a> –µ—Å—Ç—å –∑–∞–≥–æ—Ç–æ–≤–∫–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–±–µ –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏. –ë–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –±—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –æ—Ç <code>so_5::abstract_message_box_t</code> –∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ä—è–¥ —á–∏—Å—Ç—ã—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤. </p><br><p> –ö–∞–∫ –±—ã —Ç–æ –Ω–∏ –±—ã–ª–æ, —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å –∫–ª–∞—Å—Å <code>wrapping_mbox_t</code> . –¢–∞–∫ —á—Ç–æ –º—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–∞–±–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –∏ –±—É–¥—É—Ç —Ä–∞–∑–¥–∞–≤–∞—Ç—å—Å—è —Ñ–∏–ª–æ—Å–æ—Ñ–∞–º. –§–∏–ª–æ—Å–æ—Ñ—ã –±—É–¥—É—Ç –æ—Ç—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ wrapping_mbox, –∞ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –∏ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π mchain –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞. –ü–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏—è <code>waiter_process</code> , –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –Ω–∏—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞, –±—É–¥–µ—Ç –∏–º–µ—Ç—å –≤–æ—Ç —Ç–∞–∫–æ–π –ø—Ä–æ—Å—Ç–æ–π –≤–∏–¥: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waiter_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( so_5::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mchain_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waiter_ch, details::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">waiter_logic_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; logic )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// –ü–æ–ª—É—á–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ—é—Ç. so_5::receive( so_5::from( waiter_ch ), [&amp;]( so_5::mhood_t&lt;details::extended_take_t&gt; cmd ) { logic.on_take_fork( std::move(cmd) ); }, [&amp;]( so_5::mhood_t&lt;details::extended_put_t&gt; cmd ) { logic.on_put_fork( std::move(cmd) ); } ); }</span></span></code> </pre> <br><p> –ö–æ–Ω–µ—á–Ω–æ –∂–µ, –ø—Ä–∏–∫–ª–∞–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∏ –µ–µ –∫–æ–¥ –Ω–µ —Ç–∞–∫ –ø—Ä–æ—Å—Ç –∏ –∫–æ—Ä–æ—Ç–æ–∫, –Ω–æ –º—ã –Ω–µ –±—É–¥–µ–º —Ç—É–¥–∞ –ø–æ–≥—Ä—É–∂–∞—Ç—å—Å—è. –ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ—Å—è –º–æ–≥—É—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥ —Ä–µ—à–µ–Ω–∏—è waiter_with_timestamps <a href="">–∑–¥–µ—Å—å</a> . </p><br><p> –í–æ—Ç —Å–µ–π—á–∞—Å –º—ã –º–æ–∂–µ–º –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å: "–ü–æ—á–µ–º—É –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤–∏–ª–æ–∫ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ <code>philosopher_process</code> –∫–∞–∫ mbox-—ã?" –≠—Ç–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è waiter_with_timestamps –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π mbox, –∞ –Ω–µ mchain. </p><br><p> –ö–æ–Ω–µ—á–Ω–æ –∂–µ, –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–æ–∑–¥–∞—Ç—å –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π mchain. –ù–æ —ç—Ç–æ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ –±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã, —Ç.–∫. –≤ so_5_extra –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∞–∫–æ–π –∂–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö mchain-–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—è–≤–∏—Ç—Å—è). –¢–∞–∫ —á—Ç–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ —è –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ mbox-–∞—Ö –≤–º–µ—Å—Ç–æ mchain-–æ–≤. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p> –í–æ—Ç, –ø–æ–∂–∞–ª—É–π, –∏ –≤—Å–µ, —á—Ç–æ —Ö–æ—Ç–µ–ª–æ—Å—å —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –±–∞–∑–µ –ê–∫—Ç–æ—Ä–æ–≤ –∏ CSP —Ä–µ—à–µ–Ω–∏—è. –°–≤–æ—é –∑–∞–¥–∞—á—É —è –≤–∏–¥–µ–ª –Ω–µ –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è. –ê –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –æ–Ω–∏ –º–æ–≥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å. –ù–∞–¥–µ—é—Å—å, —á—Ç–æ –∫–æ–º—É-—Ç–æ —ç—Ç–æ –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. </p><br><p> –ü–æ–∑–≤–æ–ª—é —Å–µ–±–µ –æ—Ç–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ç–µ—Ö, –∫—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è SObjectizer-–æ–º. –í—Å–µ –∏–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—á–Ω–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–ª–µ–¥—É—é—â–µ–π "–±–æ–ª—å—à–æ–π" –≤–µ—Ä—Å–∏–µ–π SObjectizer ‚Äî –≤–µ—Ç–∫–æ–π 5.6, –Ω–∞—Ä—É—à–∞—é—â–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–µ—Ç–∫–æ–π 5.5. –ñ–µ–ª–∞—é—â–∏–µ —Å–∫–∞–∑–∞—Ç—å —Å–≤–æ–µ –≤–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ –ø–æ —ç—Ç–æ–º—É –ø–æ–≤–æ–¥—É, –º–æ–≥—É—Ç —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ <a href="https://github.com/eao197/so-5-5/issues/19">–∑–¥–µ—Å—å</a> (–∏–ª–∏ <a href="https://sourceforge.net/p/sobjectizer/discussion/550088/thread/4e530cf329/">–∑–¥–µ—Å—å</a> ). –ë–æ–ª–µ–µ-–º–µ–Ω–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ, —á—Ç–æ –ø–æ–º–µ–Ω—è–µ—Ç—Å—è –≤ SO-5.6 –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ <a href="https://sourceforge.net/p/sobjectizer/discussion/550088/thread/40e9b8ac/">–∑–¥–µ—Å—å</a> (—Ç—É–¥–∞ –∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏ —Å–≤–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è). </p><br><p> –ù–∞ —ç—Ç–æ–º —É –º–µ–Ω—è –≤—Å–µ, –±–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –≤—Å–µ–º —á–∏—Ç–∞—Ç–µ–ª—è–º –∑–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –Ω–∞ –¥–∞–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é –≤—Ä–µ–º—è! </p><br><p>  Ps. –°–ª–æ–≤–æ "—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ" –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –≤–∑—è—Ç–æ –≤ –∫–∞–≤—ã—á–∫–∏ –ø–æ—Ç–æ–º—É, —á—Ç–æ –≤ —Å–∞–º–∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö –Ω–µ—Ç –Ω–∏—á–µ–≥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ. –†–∞–∑–≤–µ —á—Ç–æ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ C++14. </p></div><p>Source: <a href="https://habr.com/ru/post/437998/">https://habr.com/ru/post/437998/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>