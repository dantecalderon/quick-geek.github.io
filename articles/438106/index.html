<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flashing vintage LEDs or as we warn of "fires" on the project</title>
  <meta name="description" content="Routine is a huge field for automation. If the task takes a lot of effort, requires perseverance, and repeats from time to time - this is a sure sign ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Flashing vintage LEDs or as we warn of "fires" on the project</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/29/ky/np/29kynpsxkjuzjwdby5s9o7czujw.png"></p><br><p>  Routine is a huge field for automation.  If the task takes a lot of effort, requires perseverance, and repeats from time to time - this is a sure sign that it is worth taking a couple of steps to reduce this recurring pain.  And the implementation can be turned into a good techno fan. </p><br><p>  Today I will talk about the automation of the alert system, monitoring and alerts.  Under the cut Polish flasher in 1984 and no missed ignition.  Code and assembly instructions are attached. </p><a name="habracut"></a><br><p>  Recently I turned 8 years old.  8 years, as I work in 2GIS.  On this occasion, one comrade asked: "How do you last so long?"  There was no desire to try something new? " </p><br><p>  There was.  And still arises.  And still try.  I try myself in new roles, teams, technologies.  Why not?  After all, work is not only and not so much about ‚Äúcoming at 9:00, opening a task manager and taking on another task, at 18:00 going home,‚Äù and not even ‚ÄúA !!!  We are again DDoS'y, let's request_limit dug it in here, and here I‚Äôm getting better IPs, and here ... Oh, how already 3 in the morning? ‚Äù.  This is all wrong.  Work - it's about the team, relationships, evening gatherings in the kitchen.  About interesting tasks and comfortable living environment, after all.  Everything kills pofigizm and routine.  I don‚Äôt know how to work with the first, I didn‚Äôt notice myself, but I‚Äôll tell you about the second. </p><br><p>  Today we will go the beaten track: <a href="https://habr.com/ru/post/169097/">build-traffic light in the office</a> , <a href="https://habr.com/ru/post/206486/">and another one</a> ;  and automate alerts, monitoring and alerts.  But making another traffic light for the build server is gone.  We have a lot of builds, branches and tests, and there is no desire to rob the traffic police warehouse for a dozen traffic lights.  We will visualize the "fires"! </p><br><h1>  Standard monitoring system </h1><br><p><img src="https://habrastorage.org/webt/hp/q0/ct/hpq0ctxkqoknb410zxwps-ceyhs.jpeg"></p><br><p>  Here is a typical screen that hangs in our office.  95% of the time he shows how our project is alive and what is happening to it.  In parallel, there is a channel in Slack with notifications of releases and errors. </p><br><p>  In order not to distract the whole team, a duty officer is appointed for a week, who performs the role of a release master and takes the fire upon himself if something terrible has happened.  His task is to find out what happened, and either fix it himself, or find someone who fixes it. </p><br><p>  We also use this monitor for daily meetings - we open the Kanban Board in Jira and it started. </p><br><h1>  What's wrong? </h1><br><p>  The status of duty does not cancel work tasks.  If the person responsible for the fires wandered too far into the halls of his mind, the result may be less operational than required.  This prompted the idea that for complete happiness we need a weightier sounder than endless notifications from Slack. </p><br><h1>  Automate it! </h1><br><p>  The idea grew stronger when Avto showed a great vintage Polish flasher of 1984 in the open spaces.  If there is a fire somewhere, then let this thing turn on!  They promised a piece even in almost working condition.  500 rubles and I have it in my backpack.  So let's add some IoT HYIPs and pinging on the Arduino. </p><br><p><img src="https://habrastorage.org/webt/6u/hg/ty/6uhgtyey8v4painxacw_ufdqog4.png"></p><br><h1>  Action plan </h1><br><p>  The plan was simple and brilliant!  Take the power supply for 12 volts, add Sonoff SV - esp8266 with a relay and all the necessary strapping and power from 12 volts.  Reflash with something like <a href="http://wifi-iot.ru/">http://wifi-iot.ru/</a> , we catch a flasher - profit!  We have a Wi-Fi connected device with a REST API and another 1000 features. </p><br><h1>  About expenses </h1><br><p><img src="https://habrastorage.org/webt/xf/sw/4j/xfsw4jknxqlkun2ol0dvj_q4baa.png"></p><br><p>  Power cord with a flat plug from the grandmother's radio or from the nearest market of radio products - 60 rubles <br>  Power supply 12v 10w with Aliexpress or all the same radio goods - 260 rubles <br>  <a href="https://www.itead.cc/smart-home/sonoff-sv.html">Sonoff SV</a> - $ 4.85 + shipping <br>  Vintage flasher - priceless (500 rubles) </p><br><h1>  Opinion of corporate Wi-Fi </h1><br><p>  For such bold corporate Wi-Fi actions with EAP-PEAP certificates and other terrible words, said ‚ÄúYou will not pass!‚Äù. </p><br><p><img src="https://habrastorage.org/webt/oy/n-/nt/oyn-nth-sypocgf1vdx0hxz8fuq.jpeg"></p><br><p>  You could roll up your sleeves, google <a href="https://github.com/esp8266/Arduino/issues/1032">https://github.com/esp8266/Arduino/issues/1032</a> , take a fresh SDK and quickly write everything yourself.  But then the technofan turns into a long digging and debugging.  I will postpone this option until the release of version 2.0, improved and corrected. </p><br><h1>  Soft products </h1><br><p>  Take the not so beloved <a href="https://habr.com/ru/users/olartamonov/" class="user_link">olartamonov</a> Arduino, a scattering of what has been collecting dust in the boxes for N years, and collect the monster Frankenstein.  The warehouse of household parts will be enough to check the viability of MVP and throw out after debugging a beautiful and brilliant version 2.0. </p><br><p><img src="https://habrastorage.org/webt/ac/om/-9/acom-9r68ntrxwj6ag8ii0ysvhe.jpeg"></p><br><p>  The solution is clumsy: the Arduino connects to the network via Ethernet, receives IP via DHCP, listens to requests via HTTP and flashes ‚ÄúLED‚Äù.  Anyone in the evening can build such a solution from Examples Arduino IDE (but never, hear, never use it! This is hell). </p><br><div class="spoiler">  <b class="spoiler_title">What to use?</b> <div class="spoiler_text"><p>  Those who are still crying, prickly, but continue to eat cactus, I suggest to transfer at least to PlatformIO (placed on Atom or VSCode), but it is better not to use it at all, but read the course on STM32 or something more useful.  And I, as bitten as a child by arduinschiki, will finish my dirty deed :) </p></div></div><br><p>  The code is laid out on <a href="https://github.com/aotd1/flasher">github</a> , there is no authorization, a spread API and beautiful html pages.  Only MVP, only hardcore!  Use at your own risk, I warned. </p><br><h1>  Solid products </h1><br><p>  When the software is written, it is time to start the flasher.  Below is a diagram that should help sort out the device. </p><br><h2>  Expectation: </h2><br><p><img src="https://habrastorage.org/webt/x6/oo/s9/x6oos9z3gfgyp2gk9k8hwjaann4.png"></p><br><h2>  Reality: </h2><br><p><img src="https://habrastorage.org/webt/fo/7a/t1/fo7at166uyswi0-uhsyqianycfg.jpeg"></p><br><p>  So replace Sonoff SV with: <br>  Arduino UNO + wiznet w5100 + Relay </p><br><p>  Connection by pin: <br>  DIGITAL 10 - SS <br>  DIGITAL 11 - MOSI <br>  DIGITAL 12 - MISO <br>  DIGITAL 13 - SCK <br>  GND - GND <br>  5V - 5V </p><br><p>  Connecting the relay is even simpler: the signal pin on the DIGITAL 4, the power wire to the flasher is caught in the gap to C (common) and NC (normally closed). </p><br><p>  <strong>Achtung!</strong> <br>  See your device documentation.  Not the fact that by connecting the Ethernet board to 5 volts, you will not get a cheerful smoke when testing!  In my case, everything is normal, and the module is powered by 5 volts. </p><br><h1>  Plastic products </h1><br><p>  Announcement on Avito stated that the flasher in almost working condition.  Over the years, only one detail died in it - the gear that revolves the reflector. </p><br><p><img src="https://habrastorage.org/webt/sx/6j/vi/sx6jviptedu-vrq_aj7ez2jryt0.jpeg"></p><br><p>  We exhale, take Fusion360 in our hands, model a new one and print it on an office 3D printer. </p><br><div class="spoiler">  <b class="spoiler_title">Gear modeling process</b> <div class="spoiler_text"><p>  Check the radii and other characteristics of the gear, struggle with under-extrusion and slicer parameters <br><img src="https://habrastorage.org/webt/vm/sr/fw/vmsrfwhkdv3815zocydv9fntdyu.jpeg"></p><br><p>  We continue to model <br><img src="https://habrastorage.org/webt/hp/mv/z5/hpmvz5doqty3zajkkxakgnajk_s.png"></p><br><p>  Print, try on <br><img src="https://habrastorage.org/webt/lt/an/j2/ltanj2vww5u6phkeiv6mluezm1w.gif"></p><br><p>  A little more customize and print again.  The original rivets were drilled and replaced with a combination of conventional M3 screws and self-locking nuts.  Do not forget to add a landing for them. <br><img src="https://habrastorage.org/webt/zy/t-/nd/zyt-ndarwrrswyepbnyy96ia99o.png"></p><br><p><img src="https://habrastorage.org/webt/8e/ja/aj/8ejaajyh2kiup7bcse5wjzkzhbg.jpeg"></p></div></div><br><p>  We grease gears, we replace wires, we collect back - it works! </p><br><p>  It would be nice to print a nylon gear, but the first fine print failed, and the second sampler balance from the bestfilament was not enough. </p><br><h1>  What we are for, no matter what! </h1><br><p><img src="https://habrastorage.org/webt/zr/gw/vp/zrgwvpeop5ig3rjqjqnkq0f5mnc.gif"></p><br><h4 id="kak-zastavit-migalku-vklyuchatsya-kogda-proizoshlo-chto-to-iz-ryada-von-vyhodyaschee">  How to make the flasher turn on when something out of the ordinary happened? </h4><br><p>  Elementary!  We use Grafana at work, so we just start a new Notification Channel with the WebHook type, which sends a request to turn on the flasher according to certain criteria.  It turns itself off after a few seconds in order not to force the atmosphere even more. </p><br><p>  How much time was spent on all this disgrace?  A couple of evenings, if not distracted.  Plus half a day of working time to set up integration with other internal systems. </p><br><p>  The technofan was a success, the benefit to the team was brought, photos of the assembly process are given finally. </p><br><div class="spoiler">  <b class="spoiler_title">Here it is in front of us, flasher with wires</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ez/fb/q7/ezfbq7hfzeexf6w8w9wfbjwohcu.jpeg"><br><img src="https://habrastorage.org/webt/as/qq/5-/asqq5-j3yotupe_cniquxe4psn8.jpeg"><br><img src="https://habrastorage.org/webt/p7/au/zx/p7auzx-p5ilvxb2k636yiplhb3y.jpeg"><br><img src="https://habrastorage.org/webt/y8/wb/3w/y8wb3weqcxns3azl1kq_2tbsxfg.jpeg"><br><img src="https://habrastorage.org/webt/il/qe/jf/ilqejfnwtv6dsypzxlfphpp4bik.jpeg"><br><img src="https://habrastorage.org/webt/cr/-o/qb/cr-oqbz0oz8jfeik7pydles-8h4.jpeg"></p></div></div></div><p>Source: <a href="https://habr.com/ru/post/438106/">https://habr.com/ru/post/438106/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>