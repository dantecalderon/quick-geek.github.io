<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New features of C # 8: switch expressions</title>
  <meta name="description" content="In late January, the .NET Core development team released a new version of the .NET Core 3 preview 2 framework. It introduced some new features of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>New features of C # 8: switch expressions</h1><div class="post__text post__text-html js-mediator-article">  In late January, the .NET Core development team released a new version of the .NET Core 3 preview 2 framework. It introduced some new features of the C # language.  What seems to me quite interesting is the switch expressions.  Although this addition seems simple, I think its potential is quite large.  Using the new postfix switch construct, you can optionally replace all other branch constructions: if, switch, and the ternary operator.  And, which is especially interesting, to make it in a functional style.  How exactly, you will learn by reading the article to the end. <br><br><img src="https://habrastorage.org/webt/qu/17/dp/qu17dpxertycgiaenur-fhbw520.jpeg"><br><img src="https://habrastorage.org/webt/6x/mz/cc/6xmzcc8gbkl2-7uqvmub3prf7oi.png" align="right"><br><a name="habracut"></a><br>  switch expression seems pretty simple and intuitive.  I think that a small example may be quite enough for review: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// –≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é result –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π operation, –±—É–¥–µ—Ç // –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏–±–æ —Å–ª–æ–∂–µ–Ω–∏–µ, –ª–∏–±–æ –≤—ã—á–∏—Ç–∞–Ω–∏–µ, –ª–∏–±–æ –¥–µ–ª–µ–Ω–∏–µ. var result = operation switch { "+" =&gt; a + b, "-" =&gt; a - b, "/" =&gt; a / b };</span></span></code> </pre> <br>  The first difference with the switch statement is, of course, the absence of the case and break (or return) keywords.  The second, not so obvious, is that the expression after the arrow (=&gt;) must be a calculated expression.  As the right side of the assignment operator. <br><br>  If you know the switch structure well, then you may ask how to define a default?  Here it should be noted that starting with C # 7 in switch, you can use pattern matching (pattern matching).  Therefore, instead of a special default block, a template is used, the comparison with which is always calculated to be true for any value.  This is just an underscore: _. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">// –≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é result –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π operation, –±—É–¥–µ—Ç // –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏–±–æ —Å–ª–æ–∂–µ–Ω–∏–µ, –ª–∏–±–æ –≤—ã—á–∏—Ç–∞–Ω–∏–µ, –ª–∏–±–æ –¥–µ–ª–µ–Ω–∏–µ. // –í —Å–ª—É—á–∞–µ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç –±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. var result = operation switch { "+" =&gt; a + b, "-" =&gt; a - b, "/" =&gt; a / b, _ =&gt; throw new NotSupportedException() };</span></span></code> </pre><br>  Since the pattern matching is performed in turn, you should not put such a construction first.  No other comparisons will be made. <br><br><div class="spoiler">  <b class="spoiler_title">But there is one thing</b> <div class="spoiler_text">  In fact, the compiler will not let you do this.  The error will be something like this: error CS8510: The pattern has already been handled. <br></div></div><br>  Another unobvious feature of the switch expression is that all expressions must return the same type.  For example, only int.  Or just string.  In this switch expression is similar to the ternary operator. <br><br>  The only question that remains is how to perform several operations in the expression?  There is no beautiful solution yet, but the use of lambda functions is closest to the ideal. <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">// –≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é result –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π operation, –±—É–¥–µ—Ç // –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏–±–æ —Å–ª–æ–∂–µ–Ω–∏–µ, –ª–∏–±–æ –≤—ã—á–∏—Ç–∞–Ω–∏–µ, –ª–∏–±–æ –¥–µ–ª–µ–Ω–∏–µ. // –í —Å–ª—É—á–∞–µ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç –±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. // –í—Å–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è. var result = operation switch { "+" =&gt; ((Func&lt;int&gt;)(() =&gt; { Log("—Å–ª–æ–∂–µ–Ω–∏–µ"); return a + b; }))(), "-" =&gt; ((Func&lt;int&gt;)(() =&gt; { Log("–≤—ã—á–∏—Ç–∞–Ω–∏–µ"); return a - b; }))(), "/" =&gt; ((Func&lt;int&gt;)(() =&gt; { Log("–¥–µ–ª–µ–Ω–∏–µ"); return a / b; }))(), _ =&gt; throw new NotSupportedException() };</span></span></code> </pre> <br>  Why do I think this change is potentially significant? <br><br>  Let's see how a switch expression replaces other language constructs.  Let there be the following if: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> error = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileSize &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) { error = <span class="hljs-string"><span class="hljs-string">"file is too large"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { processFile(); }</code> </pre> <br>  Similar code using switch expression: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> error = (fileSize &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> { <span class="hljs-literal"><span class="hljs-literal">true</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"file is too large"</span></span>, _ =&gt; ((Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;)(() =&gt; { processFile(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; }))() };</code> </pre><br>  Since switch is relatively easy to translate into a set of if -s, replacing any switch is also not difficult.  The ternary operator is also trivially replaced. <br><br>  Naturally, the solution with the explicit use of Func &lt;&gt; is not beautiful.  But if this technical problem is solved, the switch expression will be much more convenient and, in many cases, preferable. <br><br>  If you are interested in the possibilities of C # 8, then you may be interested in screencasts on nullable reference types and using declaration, which can be found on my <a href="https://www.youtube.com/user/AlexNetkachov">youtube channel</a> . <br><br>  <i>About the author: Alexander Netkachev graduated from Tavrichesky National University with a degree in Computer Science.</i>  <i>Works and lives in the UK.</i>  <i>For many years he has been engaged in professional software development, he maintains a personal site [there was a link to the author‚Äôs site, but since TM believes that having a paid udemy course and mentioning it on the author‚Äôs site is a paid service, it is removed].</i> </div><p>Source: <a href="https://habr.com/ru/post/440254/">https://habr.com/ru/post/440254/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>