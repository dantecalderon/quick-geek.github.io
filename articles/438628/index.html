<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notification of changes to the shared state of SharedState in components</title>
  <meta name="description" content="As a continuation to the previous article about the general state for components , I continue to develop the topic and I want to implement a feature t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>Notification of changes to the shared state of SharedState in components</h1><div class="post__text post__text-html js-mediator-article">  As a continuation to the <a href="https://habr.com/ru/post/438554/">previous article about the general state for components</a> , I continue to develop the topic and I want to implement a feature that allows you to catch and process an event in each component by a state change (when the data in the general state changes in some component). <br><br>  <a href="https://github.com/deniskozlov/yunka_sharedstate_exaple">Link to the project</a> <br><br>  Usually, in order to track the data change, in some component, a direct link is created, that is, we, or in the Update method, check whether the data has changed <br><br><img src="https://habrastorage.org/webt/-1/gf/ku/-1gfkucrj5abburhxd_vtvqagki.png"><br>  <i>Frame data verification via Update method</i> <br><a name="habracut"></a><br>  or we subscribe to a very specific event, which is triggered independently in the ‚Äúmonitored‚Äù component, and is eventually processed. <br><br><img src="https://habrastorage.org/webt/e4/mn/q-/e4mnq-sccgk2wlges6ovwizufwu.png"><br>  <i>Subscribing to an event in a component and processing it</i> <br><br>  There are many shortcomings in this approach, which for the most part are described in the last article.  The main common cause of these shortcomings is strong coherence and complex maintenance (the ability to maintain, develop the project, refactor). <br><br><h2>  Creating a solution "Status Notifications" </h2><br>  Now that you have a system that allows you to weaken the connection between components and the means to create mailings between components, you can get rid of manually checking values ‚Äã‚Äãin a general state, as follows: <br><br><img src="https://habrastorage.org/webt/7w/s8/va/7ws8vae6-qqmrpm_l_9wqjbta1a.png"><br>  <i>General Status Notification Scheme</i> <br><br>  In the implementation described in the previous article, the data is changed in one place in the indexer of the SharedState component and therefore it is very easy to control their change. <br><br><img src="https://habrastorage.org/webt/uy/zv/xb/uyzvxbhx-nepvv1giwrkd7pxaeu.jpeg"><br>  <i>Indexer in general condition</i> <br><br>  In the indexer setter, we assign state values. <br><br>  Now, for the <b>SharedState</b> component, you need to add a dependency on <b>SharedEvents</b> , since I‚Äôll use it to send notifications.  Add attribute for <b>SharedState</b> <br><br><img src="https://habrastorage.org/webt/_7/l1/-n/_7l1-nuhqo6ylipqxgpsvotn8bw.jpeg"><br>  <i>Add dependency to SharedState from SharedEvents</i> <br><br>  And create a class that inherits from EventData to send data in the state change notification.  It will contain the name of the parameter, the state and its new value. <br><br><img src="https://habrastorage.org/webt/_i/20/nz/_i20nz08kpnahewfnh3dbyxy2d4.jpeg"><br>  <i>Adding a class that contains information about the change in the general state</i> <br><br>  Now you need to add a link to <b>SharedEvents</b> , getting it from the game object in the <b>SharedState</b> component <br><br><img src="https://habrastorage.org/webt/r8/tq/kt/r8tqktsica48---wrqvsy_d0ho8.jpeg"><br>  <i>Getting SharedEvents in the SharedState component</i> <br><br>  Now we will change the setter of the indexer so that every time a state changes, a notification with the name ‚Äúsharedstatechanged‚Äù is created and we will pass an object containing all the data about the change. <br><br><img src="https://habrastorage.org/webt/xp/dn/ck/xpdnckwptsg7xwwmpqjcmplzx9c.jpeg"><br>  <i>Change Indexer Setter</i> <br><br>  Now it remains to subscribe to changes in any component, change the data in another, and check how it works. <br><br>  Suppose the <b>SecondComponent</b> changes state, for example the ‚Äúsomedata‚Äù parameter, and the <b>FirstComponent</b> component tracks the state change by subscribing to notifications <br><br>  In the <b>SecondComponent, we invoke the</b> parameter change. <br><br><img src="https://habrastorage.org/webt/fp/uo/u3/fpuou3efwyrujfdxgia1dufdvii.jpeg"><br>  <i>Call data change</i> <br><br>  And now, in the <b>FirstComponent</b> method, <b>we</b> add a handler and <b>output</b> information on changes in the general state to the console. <br><br><img src="https://habrastorage.org/webt/4i/js/kd/4ijskdeiwopjqe_tevz1dx7rgsg.jpeg"><br>  <i>Handling General State Change Events</i> <br><br>  Now, if we start the game, after the general state is changed in the <b>SecondComponent</b> , in the <b>FirstComponent</b> component we will receive a notification and output the data to the console <br><br><img src="https://habrastorage.org/webt/sb/v9/09/sbv909u0qrag-xdvsho9xgcnfua.jpeg"><br><br>  Now that it works, you can refactor a bit and make the code even more convenient.  To do this, you need to transfer the subscription to common state change notifications to the <b>SharedStateComponent</b> base class and create an abstract method, implementing which each component will process state changes in it, or not, at the component‚Äôs discretion. <br><br>  We transfer the subscription to <b>SharedStateComponent</b> <br><br><img src="https://habrastorage.org/webt/wm/ja/v8/wmjav8ntn-fmjnlmfpzzgoy4gmm.jpeg"><br>  <i>Subscribing to general status notifications in base class</i> <br><br>  Add an abstract method and call it in the event handler. <br><br><img src="https://habrastorage.org/webt/m8/_c/fd/m8_cfdykkvyyhuryvwxh7be6s8a.jpeg"><br>  <i>Adding an abstract method to handle events in child classes</i> <br><br>  And now in each child component <b>FirstComponent</b> and <b>SecondComponent</b> you need to implement this method and process the change in the general state in it.  But as before, we will simply output this to the console. <br><br><img src="https://habrastorage.org/webt/qr/ef/pl/qrefplcb2ee40ldokajn5iybrt8.jpeg"><br>  <i>Implementation of the abstract method in the components FirstComponent and SecondComponent</i> <br><br>  And now when we start the game we will see 2 entries in the console, from both components. <br><br><img src="https://habrastorage.org/webt/zo/ts/_l/zots_l96h0b7kawbgjgq6pnouco.jpeg"><br><br><h2>  Important! </h2><br>  In the previous implementation there was a bug in the <b>SharedEvents</b> class and in order to fix it, you need to change the <b>Subscribe</b> method to: <br><br><img src="https://habrastorage.org/webt/gc/5r/wn/gc5rwn39xjl39ui_tuag3xqr-3k.jpeg"></div><p>Source: <a href="https://habr.com/ru/post/438628/">https://habr.com/ru/post/438628/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>