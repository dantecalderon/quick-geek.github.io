<div class="post__text post__text-html js-mediator-article">  Good day!  In this article I want to talk about the implementation of devices on ESP modules.  The theme of similar devices has already been disclosed on the Internet, but does not cease to be relevant. <br><img src="https://habrastorage.org/webt/85/au/eq/85aueqa-qfotfuc69mmwk7pbmnq.jpeg"><a name="habracut"></a>  <b>Idea</b> <br><br>  I have long thought about the implementation of a certain display and control system in an apartment, but I could not find any use of commercially available sensors for myself.  The first thing that confused was the presence of a certain server (a separate piece of iron) that collects data, processes it and throws it somewhere for viewing.  I would like to have a scalable system of independent devices, preferably working with a single application, optimally if the application is ready, which seemed almost impossible (looking ahead to say that such an application exists and it can be quite flexible for our tasks).  And of course I wanted to make a line of their devices. <br><br>  <b>System requirements</b> <br><br><ol><li>  No hardware server ("central unit"). </li><li>  Independent sensors / controls. </li><li>  Sensors must be wireless. </li><li>  When changing the composition and types of sensors, there should be no dependence (adding a new device should not be necessary to “cut” something on others). </li><li>  If possible, the sensors should be battery-powered. </li><li>  If necessary, the sensors should be able to customize, but without digging into the code (optimally web). </li><li>  Notifications.  This is a separate requirement.  We are all accustomed to using cell phones and receiving notifications instantly. </li></ol><br>  This is not a complete list of "hotelok", but this is the main. <br><br>  <b>Finding a solution</b> <br><br>  The decision to create the system came a little later.  First, the first device was developed, which I will write about in this article. <br><br>  Hardware part  ESP-12E and ESP32.  All projects described below are implemented on the first module.  On the second module there are several commercial projects that will not be considered under this article. <br><br>  About ESP-12E there are many articles and forums on the Internet, and I will not repeat about all the pros and cons.  All the "gags" occurred mainly due to the lack of experience in working with the module and with the environment, in principle. <br><br><img src="https://habrastorage.org/webt/j6/bb/aa/j6bbaaawco5ytnkte4mw5qtag2c.jpeg"><br>  <i>Figure 1. Photo of ESP-12E.</i> <br><br>  The software part.  The firmware for ESP was written in the Arduino IDE environment.  The “Blynk” application is running on the phone / tablet side.  This is a very handy constructor for displaying data.  The application has a cloud server, where devices (sensors) send data, and Blynk receives it and allows displaying it (www.blynk.cc).  Feedback is organized in the same way with the device.  Importantly, one application can collect and display data from multiple devices. <br><br><img src="https://habrastorage.org/webt/jd/zf/yz/jdzfyzmdxnywx1kkcxedbn6ru8q.png"><br><br><img src="https://habrastorage.org/webt/iu/e5/mi/iue5mivk9phy0yb2jro75v3rtze.jpeg"><br>  <i>Figure 2. Screenshots of the application.</i> <br><br>  Later we will post an article on the software and links to the source.  I do the hardware.  The software implementation is carried out by my colleague. <br><br>  <b>The first trio of sensors</b> <br><br>  1. <b><i>OpenWindAir</i></b> Carbon Dioxide Sensor. <br><br>  Built on the basis of Wi-Fi module ESP-12E.  Measurement takes place using the CO2 sensor MH-Z19.  It is widely known and allows you to quickly and accurately measure.  In addition, the device has a built-in temperature and humidity sensor AM2302.  There is also support for a remote sensor for use, for example, with the People Monitoring system.  The device is powered by miniUSB from a PC or 5V power supply.  LED and audible alarms are implemented (the latter can be disabled from the application, or used by the clock - so as not to wake up at night). <br><br>  2. <b><i>LifeOfFlowers</i></b> Sensor soil moisture for plants. <br><br>  Built on the basis of Wi-Fi module ESP-12E.  Soil moisture measurement is performed using a plug-in electrode into the ground (part of the device board).  What is important is that the electrode, like the entire board, is filled with varnish (it had to be clever with the measurements), which would prevent the contacts from rotting.  In addition to soil moisture, the device measures the humidity and ambient temperature (AM2302), light intensity and battery voltage.  Yes, LifeOfFlowers runs from 1 to 3 years from two AAA batteries (the running time depends on the data refresh rate). <br><br>  3. <b><i>WarningWater Leak</i></b> Sensor. <br><br>  Built on the basis of Wi-Fi module ESP-12E.  Measurement takes place with the help of electrodes that are part of the IP-65 housing.  The device operates on two AAA batteries (or AA), the operating time is also from 1 year.  The dimensions of the device are only 55x55x30mm.  To get started, you need to put the device in a potentially dangerous place and it will signal the presence of water on the floor.  The application also displays the voltage of the batteries, so as not to forget to replace them in time. <br><br>  <b>OpenWindAir - hardware implementation</b> <br><br>  Circuit delicacies here not to meet, everything is simple and datasheets.  If someone needs a scheme, I can give. <br><br>  Structure of the device: <br><br>  ESP8266 ESP-12E is the module itself, which is responsible for collecting, processing and sending data.  Power 3.3V. <br>  The MH-Z19 is a carbon dioxide sensor.  Works on the UART, measures up to 5000ppm and is powered by 5V. <br>  AM2302 - measurement of humidity and temperature.  Since the sensor is inside the case, calibration constants had to be entered, and the measurement data are for reference only.  For more accurate measurements using a remote sensor. <br><br>  1-1462037-8 (IM03TS) - the relay, for switching the weak point, laid, just in case, to play.  In principle, the piece is interesting, but the applications have not yet been invented (brought to the same external connector as the external humidity sensor). <br><br>  CP2102-GM - USB-UART.  Yes, we decided to make beautiful logs to display information in real time, it turned out very convenient, you can watch the data in the terminal, watch the boot order, debug it. <br><br>  LM1117MP-ADJ - LDO for 3.3V. <br><br>  There is also a beeper, a pair of buttons and three LEDs.  In addition to the thresholds of CO2 concentration, LEDs indicate the process of loading the device, connecting to an access point (or working offline), and updating. <br><br>  The device has an OTA update.  We throw the firmware on any server (after registering it), press the button, apply power and the firmware process begins.  After flashing (or restarting) for a specified time, you can go to the web interface (the device is represented as an access point) and drive the network settings - after that, everything is ready for operation. <br><br><img src="https://habrastorage.org/webt/tw/xr/qq/twxrqqcpb_t9szkzqan7ch4qu4w.jpeg"><br>  <i>Figure 3. Photo board with components.</i> <br><br>  I want to write a little about the form and features of the printed circuit board.  When testing, it was found that during long-term Wi-Fi operation, the module warms up the board.  It would not be critical if the built-in temperature and humidity sensor inside the case.  I had to push the ESP module with the feeder and the sensors in different directions, and also to make a cutout in the board, where, like the designer, a special partition is still inserted.  Thus, there is no mixing of air inside the case and measuring the temperature and humidity are much more reliable. <br><br><img src="https://habrastorage.org/webt/gs/nn/ze/gsnnze6gsm7vhckw58ug61l5lf0.jpeg"><br>  <i>Figure 4. Photos of the partition on the board.</i> <br><br>  <b>Housing</b> <br><br>  There were many doubts here - I wanted to have a beautiful metal, streamlined body with a matte display strip, etc., but as always, minimalism came to the rescue.  The form factor of the case determined the presence of old-school 5mm LEDs, which, as it turned out, are very convenient.  Due to the fact that they are convex - this allows you to put the device, for example, on the shelf and the display will still be clearly visible.  The case itself was cut out of 2mm plexiglas by laser. <br><br>  We made several options, in different colors and with a combination of colors, as well as from different materials.  It looks very decent.  I even tried to make PCB immediately with the order of printed circuit boards.  At the moment, we are considering an option with the manufacture of housing in production, but for now this is only in the plans.  Models can also lay out. <br><br><img src="https://habrastorage.org/webt/tc/qd/cr/tcqdcro5aqh9f8jbiyhkhly3d_0.jpeg"><br>  <i>Figure 5. Photo device.</i> <br><br>  <b>Plans</b> <br><br>  In general, plans to make a few more devices (in addition to these three).  For example, ESP32 has built-in Ethernet (only physics is needed) and more built-in ADCs, which will allow you to do without a multiplexer, as is the case with LifeOfFlowers, but more on that later. <br><br>  <b>Shl.</b>  Blynk has a server API that is easily deployed (checked) on a PC.  Thus, the binding to the server disappears. <br><br>  <b>ZZY.</b>  To have less negative renamed article.  When we proceed to control the house with the help of devices, I will correct the article. <br><br>  Thanks for attention! <br><br>  ZZZY: As promised, here is the link to the article on the software <a href="https://geektimes.ru/post/122601/">geektimes.ru/post/122601</a> </div>