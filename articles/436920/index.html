<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PAS2JS Transporter from Pascal to JavaScript: Delphi incompatibilities and workarounds</title>
  <meta name="description" content="Nowadays, in the pocket of an ordinary person lies a powerful personal computer, which 10-20 years ago could only be dreamed of. And if you have kilom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="https://quick-geek.github.io/search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <section class="page js-page"><h1>PAS2JS Transporter from Pascal to JavaScript: Delphi incompatibilities and workarounds</h1><div class="post__text post__text-html js-mediator-article"><p>  Nowadays, in the pocket of an ordinary person lies a powerful personal computer, which 10-20 years ago could only be dreamed of.  And if you have kilometers of debugged Windows code and perfectly working applications and utilities written in Delphi, you probably would like to use this wealth for mobile development.  As well as the experience gained during programming under Windows.  PAS2JS helps you to combine two worlds: development for Windows and the creation of Web applications and Node.js modules. </p><br><p>  Some of the difficulties found from personal experience are discussed in this article. </p><a name="habracut"></a><br><h1>  Why not just learn JavaScript and write Web applications on it? </h1><br><p>  I learned the javascript language sufficiently.  But first, programming for the Web is more than just language skills.  Secondly, the ability to write one code for different platforms is priceless.  You can debug application modules in Delphi IDE, using its powerful debugger and editor, and then, adding the necessary binding, get a ready-made working application for the site.  And when you correct the error or add new functionality to the application for Windows, it will be enough just to recompile the JavaScript modules in <a href="http://wiki.freepascal.org/pas2js">PAS2JS</a> . </p><br><p>  It should be noted that while PAS2JS does not support all the features of the Delphi language, they are listed on the <a href="http://wiki.freepascal.org/pas2js">site</a> .  Also, some fragments of seemingly simple PAS2JS code cannot transpose into JavaScript. </p><br><h1>  Translation difficulties </h1><br><p>  So, the new PAS2JS package is downloaded from <a href="">FTP</a> , we try to recompile a simple ‚ÄúHello world‚Äù, and immediately stop at: </p><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> System.SysUtils;</code> </pre> <br><blockquote>  Error: can't find unit "System.SysUtils" </blockquote><p>  Ready-made PAS2JS packages, which can be found in the packages folder, partially duplicate Delphi system units.  But they do not have a prefix in the name.  The solution is simple: we delete the prefix ‚ÄúSystem.‚Äù From the name of the unit.  A program in Delphi is compiled (if not, check the presence of the ‚ÄúSystem‚Äù prefix in the Unit Scope Names, in the Delphi Project | Options | Delphi Compiler menu). </p><br><h1>  Type reduction in constants </h1><br><p>  PAS2JS does not support type conversion in constant expressions: </p><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CODE_A = Word(<span class="hljs-string"><span class="hljs-string">'a'</span></span>);</code> </pre> <br><blockquote>  Error: Constant expression expected </blockquote><p>  In the case of enumerated types, you can try to change it, so it passes: </p><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CODE_A = Ord(<span class="hljs-string"><span class="hljs-string">'a'</span></span>);</code> </pre> <br><p>  Also, PAS2JS does not understand the built-in functions of the Lo and Hi languages.  In the definition of constants, they can be replaced as follows: </p><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LO_BYTE = $<span class="hljs-number"><span class="hljs-number">1234</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $FF; <span class="hljs-comment"><span class="hljs-comment">// Lo($1234); HI_BYTE = $1234 shr 8;// Hi($1234);</span></span></code> </pre> <br><h1>  ANSI characters and strings </h1><br><p>  I hope you have already switched to Unicode strings in your Delphi projects?  If you have left part of the strings in ANSI format in order to save memory, they will not be converted to JavaScript: PAS2JS does not know the types AnsiChar, AnsiString, Utf8String and RawByteString.  Consider replacing them with Unicode types, or Byte and Array of Byte. </p><br><p>  Here is an example of replacing AnsiChar with Byte: </p><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">// –ë—ã–ª–æ procedure TestAnsiCharAndByte1; const SMALL_ENG_LETTERS = ['a'..'z']; CAPITAL_ENG_LETTERS = ['A'..'Z']; var ch: AnsiChar; engs: set of AnsiChar; begin engs := SMALL_ENG_LETTERS + CAPITAL_ENG_LETTERS; ch := 'Z'; if ch in engs then Writeln('It''s an English letter'); end; // –°—Ç–∞–ª–æ procedure TestAnsiCharAndByte2; const SMALL_ENG_LETTERS = [Ord('a')..Ord('z')]; CAPITAL_ENG_LETTERS = [Ord('A')..Ord('Z')]; var ch: Byte; engs: set of Byte; begin engs := SMALL_ENG_LETTERS + CAPITAL_ENG_LETTERS; ch := Ord('Z'); if ch in engs then Writeln('It''s an English letter'); end;</span></span></code> </pre> <br><h1>  Awkward letter √≥ </h1><br><p>  As a curiosity: in Polish there is the letter √≥ - O kreskowane, Unicode # $ 00F3.  For some reason, PAS2JS disliked it, and in some cases can not perceive the line if this letter is included in it: </p><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> s := #$<span class="hljs-number"><span class="hljs-number">00</span></span>F3<span class="hljs-string"><span class="hljs-string">'abdef'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è s := 'abdef'#$017C; // –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è s := #$00F3'abdef'#$017C; // Error: Illegal character s := #$00F3; s := s + 'abdef'#$017C; // –¢–∞–∫ —Å–Ω–æ–≤–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è end;</span></span></code> </pre> <br><h1>  Case operator </h1><br><p>  A sudden surprise came up in the case statement, in which PAS2JS refused to accept Russian letters as options: </p><br><pre> <code class="delphi hljs"> ch := <span class="hljs-string"><span class="hljs-string">'–Ø'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ch <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'–ê'</span></span>: Writeln(<span class="hljs-string"><span class="hljs-string">'–≠—Ç–æ "–ê"'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Error: Incompatible types: got "Char" expected "Char" (???) '–ë'..'–Ø': Writeln('–≠—Ç–æ –¥—Ä—É–≥–∞—è —Ä—É—Å—Å–∫–∞—è –±—É–∫–≤–∞'); // Error: char expected, but string found end;</span></span></code> </pre> <br><p>  The definition of constants for the desired Russian letters helped: </p><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ckbA = #$<span class="hljs-number"><span class="hljs-number">410</span></span>; <span class="hljs-comment"><span class="hljs-comment">// –ê ckbB = #$411; // –ë ckbYa = #$42F; // –Ø var ch: Char; begin ch := '–Ø'; case ch of ckbA: Writeln('–≠—Ç–æ "–ê"'); ckbB..ckbYa: Writeln('–≠—Ç–æ –¥—Ä—É–≥–∞—è —Ä—É—Å—Å–∫–∞—è –±—É–∫–≤–∞'); end;</span></span></code> </pre> <br><h1>  findings </h1><br><p>  I managed to compile a small Delphi project for the Web, making relatively small changes to the source code of the program, and for the time saved I wrote this article.  Testing has shown that both versions of the program: for Windows and for the Web, work in exactly the same way.  This is undoubtedly a success: now I can develop this project, modifying the program in Delphi, and transpiling it into JavaScript using PAS2JS. </p><br><p>  As for the minor shortcomings revealed, I am sure they will be quickly eliminated.  Since the <a href="http://wiki.freepascal.org/pas2js">project PAS2JS</a> - open and free, actively developed by the <a href="https://www.freepascal.org/">community Free Pascal</a> . </p></div><p>Source: <a href="https://habr.com/ru/post/436920/">https://habr.com/ru/post/436920/</a></p>
<section class="navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container">Waiting for the list from <a href="../../index.html">here</a>...</nav>
</section>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52319614 = new Ya.Metrika({
                  id:52319614,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52319614" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>
</body>

</html>